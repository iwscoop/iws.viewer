(function(t){var e=t.iws||(t.iws={version:"1.2.0"});e.debug=false;e.useAnimationFrame=true;e.mask=true;e.log=function(){var t="";for(var e=0;e<arguments.length;e++){t+=arguments[e]+" >>>> "}console.log(">>>>   iws : "+t)};e.warn=function(){var t="";for(var e=0;e<arguments.length;e++){t+=arguments[e]+" >>>> "}console.log(">>>>   iws warn!!!: "+t)};e.msie=function(){var t;var e="N/A";var i=navigator.userAgent.toLowerCase();var n=navigator.appName;if(n=="Microsoft Internet Explorer"){t="msie "}else{if(i.search("trident")>-1)t="trident/.*rv:";else if(i.search("edge/")>-1)t="edge/"}var r=new RegExp(t+"([0-9]{1,})(\\.{0,}[0-9]{0,1})");if(r.exec(i)!=null)e=RegExp.$1+RegExp.$2;console.log(e);return t=="msie"}();e.toolbar={};e.Observable={observe:function(t,e,i){if(!this.topics){this.topics={}}if(typeof e!=="function"){return false}if(!this.topics.hasOwnProperty(t)){this.topics[t]={}}var n=Math.random().toString(35);this.topics[t][n]=[e,!!i];return n},stopObserving:function(t){if(!this.topics){return}for(var e in this.topics){if(this.topics[e][t]){delete this.topics[e][t];return true}}return false},fire:function(t){if(!this.topics){return}if(this.topics.hasOwnProperty(t)){var e=Array.prototype.slice.call(arguments,1),i=[];for(var n in this.topics[t]){var r=this.topics[t][n];try{r[0].apply(this,e)}catch(t){console.error("viewer fire Error",t.message,t)}if(r[1])i.push(n)}if(i.length)i.forEach(this.unsubscribe)}}};e.Collection={_objects:[],add:function(){this._objects.push.apply(this._objects,arguments);if(this._onObjectAdded){for(var t=0,e=arguments.length;t<e;t++){this._onObjectAdded(arguments[t])}}this.renderAll();return this},insertAt:function(t,e,i){var n=this.getObjects();if(i){n[e]=t}else{n.splice(e,0,t)}this._onObjectAdded&&this._onObjectAdded(t);this.renderAll();return this},remove:function(){var t=this.getObjects(),e,i=false;for(var n=0,r=arguments.length;n<r;n++){e=t.indexOf(arguments[n]);if(e!==-1){i=true;t.splice(e,1);this._onObjectRemoved&&this._onObjectRemoved(arguments[n])}}i&&this.renderAll();return this},forEachObject:function(t,e){var i=this.getObjects();for(var n=0,r=i.length;n<r;n++){t.call(e,i[n],n,i)}return this},getObjects:function(t){if(typeof t==="undefined"){return this._objects}return this._objects.filter(function(e){return e.type===t})},item:function(t){return this.getObjects()[t]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(t){return this.getObjects().indexOf(t)>-1},complexity:function(){return this.getObjects().reduce(function(t,e){t+=e.complexity?e.complexity():0;return t},0)}};(function(t){"use strict";var e=t.iws||(t.iws={});if(e.Point){e.warn("iws.Point is already defined");return}e.Point=i;function i(t,e){this.x=t;this.y=e}i.prototype={type:"point",constructor:i,add:function(t){return new i(this.x+t.x,this.y+t.y)},addEquals:function(t){this.x+=t.x;this.y+=t.y;return this},scalarAdd:function(t){return new i(this.x+t,this.y+t)},scalarAddEquals:function(t){this.x+=t;this.y+=t;return this},subtract:function(t){return new i(this.x-t.x,this.y-t.y)},subtractEquals:function(t){this.x-=t.x;this.y-=t.y;return this},scalarSubtract:function(t){return new i(this.x-t,this.y-t)},scalarSubtractEquals:function(t){this.x-=t;this.y-=t;return this},multiply:function(t){return new i(this.x*t,this.y*t)},multiplyEquals:function(t){this.x*=t;this.y*=t;return this},divide:function(t){return new i(this.x/t,this.y/t)},divideEquals:function(t){this.x/=t;this.y/=t;return this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,e){if(typeof e==="undefined"){e=.5}e=Math.max(Math.min(1,e),0);return new i(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return this.lerp(t)},min:function(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){this.x=t;this.y=e;return this},setX:function(t){this.x=t;return this},setY:function(t){this.y=t;return this},setFromPoint:function(t){this.x=t.x;this.y=t.y;return this},swap:function(t){var e=this.x,i=this.y;this.x=t.x;this.y=t.y;t.x=e;t.y=i},clone:function(){return new i(this.x,this.y)}}})(t);(function(t){"use strict";var e=t.iws||(t.iws={});if(e.Intersection){e.warn("iws.Intersection is already defined");return}function i(t){this.status=t;this.points=[]}e.Intersection=i;e.Intersection.prototype={constructor:i,appendPoint:function(t){this.points.push(t);return this},appendPoints:function(t){this.points=this.points.concat(t);return this}};e.Intersection.intersectLineLine=function(t,n,r,o){var s,a=(o.x-r.x)*(t.y-r.y)-(o.y-r.y)*(t.x-r.x),l=(n.x-t.x)*(t.y-r.y)-(n.y-t.y)*(t.x-r.x),h=(o.y-r.y)*(n.x-t.x)-(o.x-r.x)*(n.y-t.y);if(h!==0){var c=a/h,u=l/h;if(0<=c&&c<=1&&0<=u&&u<=1){s=new i("Intersection");s.appendPoint(new e.Point(t.x+c*(n.x-t.x),t.y+c*(n.y-t.y)))}else{s=new i}}else{if(a===0||l===0){s=new i("Coincident")}else{s=new i("Parallel")}}return s};e.Intersection.intersectLinePolygon=function(t,e,n){var r=new i,o=n.length,s,a,l;for(var h=0;h<o;h++){s=n[h];a=n[(h+1)%o];l=i.intersectLineLine(t,e,s,a);r.appendPoints(l.points)}if(r.points.length>0){r.status="Intersection"}return r};e.Intersection.intersectPolygonPolygon=function(t,e){var n=new i,r=t.length;for(var o=0;o<r;o++){var s=t[o],a=t[(o+1)%r],l=i.intersectLinePolygon(s,a,e);n.appendPoints(l.points)}if(n.points.length>0){n.status="Intersection"}return n};e.Intersection.intersectPolygonRectangle=function(t,n,r){var o=n.min(r),s=n.max(r),a=new e.Point(s.x,o.y),l=new e.Point(o.x,s.y),h=i.intersectLinePolygon(o,a,t),c=i.intersectLinePolygon(a,s,t),u=i.intersectLinePolygon(s,l,t),f=i.intersectLinePolygon(l,o,t),d=new i;d.appendPoints(h.points);d.appendPoints(c.points);d.appendPoints(u.points);d.appendPoints(f.points);if(d.points.length>0){d.status="Intersection"}return d}})(t);(function(t){"use strict";var e=t.iws||(t.iws={});if(e.Color){e.warn("iws.Color is already defined.");return}function i(t){if(!t){this.setSource([0,0,0,1])}else{this._tryParsingColor(t)}}e.Color=i;e.Color.prototype={_tryParsingColor:function(t){var e;if(t in i.colorNameMap){t=i.colorNameMap[t]}if(t==="transparent"){e=[255,255,255,0]}if(!e){e=i.sourceFromHex(t)}if(!e){e=i.sourceFromRgb(t)}if(!e){e=i.sourceFromHsl(t)}if(!e){e=[0,0,0,1]}if(e){this.setSource(e)}},_rgbToHsl:function(t,i,n){t/=255;i/=255;n/=255;var r,o,s,a=e.util.array.max([t,i,n]),l=e.util.array.min([t,i,n]);s=(a+l)/2;if(a===l){r=o=0}else{var h=a-l;o=s>.5?h/(2-a-l):h/(a+l);switch(a){case t:r=(i-n)/h+(i<n?6:0);break;case i:r=(n-t)/h+2;break;case n:r=(t-i)/h+4;break}r/=6}return[Math.round(r*360),Math.round(o*100),Math.round(s*100)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t=this.getSource(),e,i,n;e=t[0].toString(16);e=e.length===1?"0"+e:e;i=t[1].toString(16);i=i.length===1?"0"+i:i;n=t[2].toString(16);n=n.length===1?"0"+n:n;return e.toUpperCase()+i.toUpperCase()+n.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();e[3]=t;this.setSource(e);return this},toGrayscale:function(){var t=this.getSource(),e=parseInt((t[0]*.3+t[1]*.59+t[2]*.11).toFixed(0),10),i=t[3];this.setSource([e,e,e,i]);return this},toBlackWhite:function(t){var e=this.getSource(),i=(e[0]*.3+e[1]*.59+e[2]*.11).toFixed(0),n=e[3];t=t||127;i=Number(i)<Number(t)?0:255;this.setSource([i,i,i,n]);return this},overlayWith:function(t){if(!(t instanceof i)){t=new i(t)}var e=[],n=this.getAlpha(),r=.5,o=this.getSource(),s=t.getSource();for(var a=0;a<3;a++){e.push(Math.round(o[a]*(1-r)+s[a]*r))}e[3]=n;this.setSource(e);return this}};e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;e.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",grey:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"};function n(t,e,i){if(i<0){i+=1}if(i>1){i-=1}if(i<1/6){return t+(e-t)*6*i}if(i<1/2){return e}if(i<2/3){return t+(e-t)*(2/3-i)*6}return t}e.Color.fromRgb=function(t){return i.fromSource(i.sourceFromRgb(t))};e.Color.sourceFromRgb=function(t){var e=t.match(i.reRGBa);if(e){var n=parseInt(e[1],10)/(/%$/.test(e[1])?100:1)*(/%$/.test(e[1])?255:1),r=parseInt(e[2],10)/(/%$/.test(e[2])?100:1)*(/%$/.test(e[2])?255:1),o=parseInt(e[3],10)/(/%$/.test(e[3])?100:1)*(/%$/.test(e[3])?255:1);return[parseInt(n,10),parseInt(r,10),parseInt(o,10),e[4]?parseFloat(e[4]):1]}};e.Color.fromRgba=i.fromRgb;e.Color.fromHsl=function(t){return i.fromSource(i.sourceFromHsl(t))};e.Color.sourceFromHsl=function(t){var e=t.match(i.reHSLa);if(!e){return}var r=(parseFloat(e[1])%360+360)%360/360,o=parseFloat(e[2])/(/%$/.test(e[2])?100:1),s=parseFloat(e[3])/(/%$/.test(e[3])?100:1),a,l,h;if(o===0){a=l=h=s}else{var c=s<=.5?s*(o+1):s+o-s*o,u=s*2-c;a=n(u,c,r+1/3);l=n(u,c,r);h=n(u,c,r-1/3)}return[Math.round(a*255),Math.round(l*255),Math.round(h*255),e[4]?parseFloat(e[4]):1]};e.Color.fromHsla=i.fromHsl;e.Color.fromHex=function(t){return i.fromSource(i.sourceFromHex(t))};e.Color.sourceFromHex=function(t){if(t.match(i.reHex)){var e=t.slice(t.indexOf("#")+1),n=e.length===3||e.length===4,r=e.length===8||e.length===4,o=n?e.charAt(0)+e.charAt(0):e.substring(0,2),s=n?e.charAt(1)+e.charAt(1):e.substring(2,4),a=n?e.charAt(2)+e.charAt(2):e.substring(4,6),l=r?n?e.charAt(3)+e.charAt(3):e.substring(6,8):"FF";return[parseInt(o,16),parseInt(s,16),parseInt(a,16),parseFloat((parseInt(l,16)/255).toFixed(2))]}};e.Color.fromSource=function(t){var e=new i;e.setSource(t);return e}})(t)})(typeof exports!=="undefined"?exports:this);(function(){(function(t){"use strict";var e=void 0;var i=1e5;function n(t){switch(typeof t){case"undefined":return"undefined";case"boolean":return"boolean";case"number":return"number";case"string":return"string";default:return t===null?"null":"object"}}function r(t){return Object.prototype.toString.call(t).replace(/^\[object *|\]$/g,"")}function o(t){return typeof t==="function"}function s(t){if(t===null||t===e)throw TypeError();return Object(t)}function a(t){return t>>0}function l(t){return t>>>0}var h=Math.LN2,c=Math.abs,u=Math.floor,f=Math.log,d=Math.max,g=Math.min,p=Math.pow,v=Math.round;(function(){var t=Object.defineProperty;var e=!function(){try{return Object.defineProperty({},"x",{})}catch(t){return false}}();if(!t||e){Object.defineProperty=function(e,i,n){if(t)try{return t(e,i,n)}catch(t){}if(e!==Object(e))throw TypeError("Object.defineProperty called on non-object");if(Object.prototype.__defineGetter__&&"get"in n)Object.prototype.__defineGetter__.call(e,i,n.get);if(Object.prototype.__defineSetter__&&"set"in n)Object.prototype.__defineSetter__.call(e,i,n.set);if("value"in n)e[i]=n.value;return e}}})();function m(e){if("TYPED_ARRAY_POLYFILL_NO_ARRAY_ACCESSORS"in t)return;if(e.length>i)throw RangeError("Array too large for polyfill");function n(t){Object.defineProperty(e,t,{get:function(){return e._getter(t)},set:function(i){e._setter(t,i)},enumerable:true,configurable:false})}var r;for(r=0;r<e.length;r+=1){n(r)}}function b(t,e){var i=32-e;return t<<i>>i}function w(t,e){var i=32-e;return t<<i>>>i}function y(t){return[t&255]}function _(t){return b(t[0],8)}function x(t){return[t&255]}function C(t){return w(t[0],8)}function k(t){t=v(Number(t));return[t<0?0:t>255?255:t&255]}function S(t){return[t&255,t>>8&255]}function T(t){return b(t[1]<<8|t[0],16)}function M(t){return[t&255,t>>8&255]}function O(t){return w(t[1]<<8|t[0],16)}function E(t){return[t&255,t>>8&255,t>>16&255,t>>24&255]}function P(t){return b(t[3]<<24|t[2]<<16|t[1]<<8|t[0],32)}function A(t){return[t&255,t>>8&255,t>>16&255,t>>24&255]}function j(t){return w(t[3]<<24|t[2]<<16|t[1]<<8|t[0],32)}function I(t,e,i){var n=(1<<e-1)-1;function r(t){var e=u(t),i=t-e;if(i<.5)return e;if(i>.5)return e+1;return e%2?e+1:e}var o,s,a;if(t!==t){s=(1<<e)-1;a=p(2,i-1);o=0}else if(t===Infinity||t===-Infinity){s=(1<<e)-1;a=0;o=t<0?1:0}else if(t===0){s=0;a=0;o=1/t===-Infinity?1:0}else{o=t<0;t=c(t);if(t>=p(2,1-n)){s=g(u(f(t)/h),1023);var l=t/p(2,s);if(l<1){s-=1;l*=2}if(l>=2){s+=1;l/=2}var d=p(2,i);a=r(l*d)-d;s+=n;if(a/d>=1){s+=1;a=0}if(s>2*n){s=(1<<e)-1;a=0}}else{s=0;a=r(t/p(2,1-n-i))}}var v=[],m;for(m=i;m;m-=1){v.push(a%2?1:0);a=u(a/2)}for(m=e;m;m-=1){v.push(s%2?1:0);s=u(s/2)}v.push(o?1:0);v.reverse();var b=v.join("");var w=[];while(b.length){w.unshift(parseInt(b.substring(0,8),2));b=b.substring(8)}return w}function F(t,e,i){var n=[],r,o,s,a,l,h,c,u;for(r=0;r<t.length;++r){s=t[r];for(o=8;o;o-=1){n.push(s%2?1:0);s=s>>1}}n.reverse();a=n.join("");l=(1<<e-1)-1;h=parseInt(a.substring(0,1),2)?-1:1;c=parseInt(a.substring(1,1+e),2);u=parseInt(a.substring(1+e),2);if(c===(1<<e)-1){return u!==0?NaN:h*Infinity}else if(c>0){return h*p(2,c-l)*(1+u/p(2,i))}else if(u!==0){return h*p(2,-(l-1))*(u/p(2,i))}else{return h<0?-0:0}}function R(t){return F(t,11,52)}function D(t){return I(t,11,52)}function L(t){return F(t,8,23)}function B(t){return I(t,8,23)}(function(){function i(t){t=a(t);if(t<0)throw RangeError("ArrayBuffer size is not a small enough positive integer.");Object.defineProperty(this,"byteLength",{value:t});Object.defineProperty(this,"_bytes",{value:Array(t)});for(var e=0;e<t;e+=1)this._bytes[e]=0}t.ArrayBuffer=t.ArrayBuffer||i;function h(){if(!arguments.length||typeof arguments[0]!=="object"){return function(t){t=a(t);if(t<0)throw RangeError("length is not a small enough positive integer.");Object.defineProperty(this,"length",{value:t});Object.defineProperty(this,"byteLength",{value:t*this.BYTES_PER_ELEMENT});Object.defineProperty(this,"buffer",{value:new i(this.byteLength)});Object.defineProperty(this,"byteOffset",{value:0})}.apply(this,arguments)}if(arguments.length>=1&&n(arguments[0])==="object"&&arguments[0]instanceof h){return function(t){if(this.constructor!==t.constructor)throw TypeError();var e=t.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new i(e)});Object.defineProperty(this,"byteLength",{value:e});Object.defineProperty(this,"byteOffset",{value:0});Object.defineProperty(this,"length",{value:t.length});for(var n=0;n<this.length;n+=1)this._setter(n,t._getter(n))}.apply(this,arguments)}if(arguments.length>=1&&n(arguments[0])==="object"&&!(arguments[0]instanceof h)&&!(arguments[0]instanceof i||r(arguments[0])==="ArrayBuffer")){return function(t){var e=t.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new i(e)});Object.defineProperty(this,"byteLength",{value:e});Object.defineProperty(this,"byteOffset",{value:0});Object.defineProperty(this,"length",{value:t.length});for(var n=0;n<this.length;n+=1){var r=t[n];this._setter(n,Number(r))}}.apply(this,arguments)}if(arguments.length>=1&&n(arguments[0])==="object"&&(arguments[0]instanceof i||r(arguments[0])==="ArrayBuffer")){return function(t,i,n){i=l(i);if(i>t.byteLength)throw RangeError("byteOffset out of range");if(i%this.BYTES_PER_ELEMENT)throw RangeError("buffer length minus the byteOffset is not a multiple of the element size.");if(n===e){var r=t.byteLength-i;if(r%this.BYTES_PER_ELEMENT)throw RangeError("length of buffer minus byteOffset not a multiple of the element size");n=r/this.BYTES_PER_ELEMENT}else{n=l(n);r=n*this.BYTES_PER_ELEMENT}if(i+r>t.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:t});Object.defineProperty(this,"byteLength",{value:r});Object.defineProperty(this,"byteOffset",{value:i});Object.defineProperty(this,"length",{value:n})}.apply(this,arguments)}throw TypeError()}Object.defineProperty(h,"from",{value:function(t){return new this(t)}});Object.defineProperty(h,"of",{value:function(){return new this(arguments)}});var f={};h.prototype=f;Object.defineProperty(h.prototype,"_getter",{value:function(t){if(arguments.length<1)throw SyntaxError("Not enough arguments");t=l(t);if(t>=this.length)return e;var i=[],n,r;for(n=0,r=this.byteOffset+t*this.BYTES_PER_ELEMENT;n<this.BYTES_PER_ELEMENT;n+=1,r+=1){i.push(this.buffer._bytes[r])}return this._unpack(i)}});Object.defineProperty(h.prototype,"get",{value:h.prototype._getter});Object.defineProperty(h.prototype,"_setter",{value:function(t,e){if(arguments.length<2)throw SyntaxError("Not enough arguments");t=l(t);if(t>=this.length)return;var i=this._pack(e),n,r;for(n=0,r=this.byteOffset+t*this.BYTES_PER_ELEMENT;n<this.BYTES_PER_ELEMENT;n+=1,r+=1){this.buffer._bytes[r]=i[n]}}});Object.defineProperty(h.prototype,"constructor",{value:h});Object.defineProperty(h.prototype,"copyWithin",{value:function(t,i){var n=arguments[2];var r=s(this);var o=r.length;var h=l(o);h=d(h,0);var c=a(t);var u;if(c<0)u=d(h+c,0);else u=g(c,h);var f=a(i);var p;if(f<0)p=d(h+f,0);else p=g(f,h);var v;if(n===e)v=h;else v=a(n);var m;if(v<0)m=d(h+v,0);else m=g(v,h);var b=g(m-p,h-u);var w;if(p<u&&u<p+b){w=-1;p=p+b-1;u=u+b-1}else{w=1}while(b>0){r._setter(u,r._getter(p));p=p+w;u=u+w;b=b-1}return r}});Object.defineProperty(h.prototype,"every",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(!o(t))throw TypeError();var r=arguments[1];for(var s=0;s<n;s++){if(!t.call(r,i._getter(s),s,i))return false}return true}});Object.defineProperty(h.prototype,"fill",{value:function(t){var i=arguments[1],n=arguments[2];var r=s(this);var o=r.length;var h=l(o);h=d(h,0);var c=a(i);var u;if(c<0)u=d(h+c,0);else u=g(c,h);var f;if(n===e)f=h;else f=a(n);var p;if(f<0)p=d(h+f,0);else p=g(f,h);while(u<p){r._setter(u,t);u+=1}return r}});Object.defineProperty(h.prototype,"filter",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(!o(t))throw TypeError();var r=[];var s=arguments[1];for(var a=0;a<n;a++){var h=i._getter(a);if(t.call(s,h,a,i))r.push(h)}return new this.constructor(r)}});Object.defineProperty(h.prototype,"find",{value:function(t){var i=s(this);var n=i.length;var r=l(n);if(!o(t))throw TypeError();var a=arguments.length>1?arguments[1]:e;var h=0;while(h<r){var c=i._getter(h);var u=t.call(a,c,h,i);if(Boolean(u))return c;++h}return e}});Object.defineProperty(h.prototype,"findIndex",{value:function(t){var i=s(this);var n=i.length;var r=l(n);if(!o(t))throw TypeError();var a=arguments.length>1?arguments[1]:e;var h=0;while(h<r){var c=i._getter(h);var u=t.call(a,c,h,i);if(Boolean(u))return h;++h}return-1}});Object.defineProperty(h.prototype,"forEach",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(!o(t))throw TypeError();var r=arguments[1];for(var s=0;s<n;s++)t.call(r,i._getter(s),s,i)}});Object.defineProperty(h.prototype,"indexOf",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(n===0)return-1;var r=0;if(arguments.length>0){r=Number(arguments[1]);if(r!==r){r=0}else if(r!==0&&r!==1/0&&r!==-(1/0)){r=(r>0||-1)*u(c(r))}}if(r>=n)return-1;var o=r>=0?r:d(n-c(r),0);for(;o<n;o++){if(i._getter(o)===t){return o}}return-1}});Object.defineProperty(h.prototype,"join",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);var r=Array(n);for(var o=0;o<n;++o)r[o]=i._getter(o);return r.join(t===e?",":t)}});Object.defineProperty(h.prototype,"lastIndexOf",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(n===0)return-1;var r=n;if(arguments.length>1){r=Number(arguments[1]);if(r!==r){r=0}else if(r!==0&&r!==1/0&&r!==-(1/0)){r=(r>0||-1)*u(c(r))}}var o=r>=0?g(r,n-1):n-c(r);for(;o>=0;o--){if(i._getter(o)===t)return o}return-1}});Object.defineProperty(h.prototype,"map",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(!o(t))throw TypeError();var r=[];r.length=n;var s=arguments[1];for(var a=0;a<n;a++)r[a]=t.call(s,i._getter(a),a,i);return new this.constructor(r)}});Object.defineProperty(h.prototype,"reduce",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(!o(t))throw TypeError();if(n===0&&arguments.length===1)throw TypeError();var r=0;var s;if(arguments.length>=2){s=arguments[1]}else{s=i._getter(r++)}while(r<n){s=t.call(e,s,i._getter(r),r,i);r++}return s}});Object.defineProperty(h.prototype,"reduceRight",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(!o(t))throw TypeError();if(n===0&&arguments.length===1)throw TypeError();var r=n-1;var s;if(arguments.length>=2){s=arguments[1]}else{s=i._getter(r--)}while(r>=0){s=t.call(e,s,i._getter(r),r,i);r--}return s}});Object.defineProperty(h.prototype,"reverse",{value:function(){if(this===e||this===null)throw TypeError();var t=Object(this);var i=l(t.length);var n=u(i/2);for(var r=0,o=i-1;r<n;++r,--o){var s=t._getter(r);t._setter(r,t._getter(o));t._setter(o,s)}return t}});Object.defineProperty(h.prototype,"set",{value:function(t,e){if(arguments.length<1)throw SyntaxError("Not enough arguments");var i,n,r,o,s,a,h,c,u,f;if(typeof arguments[0]==="object"&&arguments[0].constructor===this.constructor){i=arguments[0];r=l(arguments[1]);if(r+i.length>this.length){throw RangeError("Offset plus length of array is out of range")}c=this.byteOffset+r*this.BYTES_PER_ELEMENT;u=i.length*this.BYTES_PER_ELEMENT;if(i.buffer===this.buffer){f=[];for(s=0,a=i.byteOffset;s<u;s+=1,a+=1){f[s]=i.buffer._bytes[a]}for(s=0,h=c;s<u;s+=1,h+=1){this.buffer._bytes[h]=f[s]}}else{for(s=0,a=i.byteOffset,h=c;s<u;s+=1,a+=1,h+=1){this.buffer._bytes[h]=i.buffer._bytes[a]}}}else if(typeof arguments[0]==="object"&&typeof arguments[0].length!=="undefined"){n=arguments[0];o=l(n.length);r=l(arguments[1]);if(r+o>this.length){throw RangeError("Offset plus length of array is out of range")}for(s=0;s<o;s+=1){a=n[s];this._setter(r+s,Number(a))}}else{throw TypeError("Unexpected argument type(s)")}}});Object.defineProperty(h.prototype,"slice",{value:function(t,i){var n=s(this);var r=n.length;var o=l(r);var h=a(t);var c=h<0?d(o+h,0):g(h,o);var u=i===e?o:a(i);var f=u<0?d(o+u,0):g(u,o);var p=f-c;var v=n.constructor;var m=new v(p);var b=0;while(c<f){var w=n._getter(c);m._setter(b,w);++c;++b}return m}});Object.defineProperty(h.prototype,"some",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(!o(t))throw TypeError();var r=arguments[1];for(var s=0;s<n;s++){if(t.call(r,i._getter(s),s,i)){return true}}return false}});Object.defineProperty(h.prototype,"sort",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);var r=Array(n);for(var o=0;o<n;++o)r[o]=i._getter(o);if(t)r.sort(t);else r.sort();for(o=0;o<n;++o)i._setter(o,r[o]);return i}});Object.defineProperty(h.prototype,"subarray",{value:function(t,e){function i(t,e,i){return t<e?e:t>i?i:t}t=a(t);e=a(e);if(arguments.length<1){t=0}if(arguments.length<2){e=this.length}if(t<0){t=this.length+t}if(e<0){e=this.length+e}t=i(t,0,this.length);e=i(e,0,this.length);var n=e-t;if(n<0){n=0}return new this.constructor(this.buffer,this.byteOffset+t*this.BYTES_PER_ELEMENT,n)}});function p(t,e,i){var n=function(){Object.defineProperty(this,"constructor",{value:n});h.apply(this,arguments);m(this)};if("__proto__"in n){n.__proto__=h}else{n.from=h.from;n.of=h.of}n.BYTES_PER_ELEMENT=t;var r=function(){};r.prototype=f;n.prototype=new r;Object.defineProperty(n.prototype,"BYTES_PER_ELEMENT",{value:t});Object.defineProperty(n.prototype,"_pack",{value:e});Object.defineProperty(n.prototype,"_unpack",{value:i});return n}var v=p(1,y,_);var b=p(1,x,C);var w=p(1,k,C);var I=p(2,S,T);var F=p(2,M,O);var z=p(4,E,P);var W=p(4,A,j);var q=p(4,B,L);var Y=p(8,D,R);t.Int8Array=t.Int8Array||v;t.Uint8Array=t.Uint8Array||b;t.Uint8ClampedArray=t.Uint8ClampedArray||w;t.Int16Array=t.Int16Array||I;t.Uint16Array=t.Uint16Array||F;t.Int32Array=t.Int32Array||z;t.Uint32Array=t.Uint32Array||W;t.Float32Array=t.Float32Array||q;t.Float64Array=t.Float64Array||Y})();(function(){function i(t,e){return o(t.get)?t.get(e):t[e]}var n=function(){var t=new Uint16Array([4660]),e=new Uint8Array(t.buffer);return i(e,0)===18}();function s(t,i,n){if(!(t instanceof ArrayBuffer||r(t)==="ArrayBuffer"))throw TypeError();i=l(i);if(i>t.byteLength)throw RangeError("byteOffset out of range");if(n===e)n=t.byteLength-i;else n=l(n);if(i+n>t.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:t});Object.defineProperty(this,"byteLength",{value:n});Object.defineProperty(this,"byteOffset",{value:i})}function a(t){return function e(r,o){r=l(r);if(r+t.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");r+=this.byteOffset;var s=new Uint8Array(this.buffer,r,t.BYTES_PER_ELEMENT),a=[];for(var h=0;h<t.BYTES_PER_ELEMENT;h+=1)a.push(i(s,h));if(Boolean(o)===Boolean(n))a.reverse();return i(new t(new Uint8Array(a).buffer),0)}}Object.defineProperty(s.prototype,"getUint8",{value:a(Uint8Array)});Object.defineProperty(s.prototype,"getInt8",{value:a(Int8Array)});Object.defineProperty(s.prototype,"getUint16",{value:a(Uint16Array)});Object.defineProperty(s.prototype,"getInt16",{value:a(Int16Array)});Object.defineProperty(s.prototype,"getUint32",{value:a(Uint32Array)});Object.defineProperty(s.prototype,"getInt32",{value:a(Int32Array)});Object.defineProperty(s.prototype,"getFloat32",{value:a(Float32Array)});Object.defineProperty(s.prototype,"getFloat64",{value:a(Float64Array)});function h(t){return function e(r,o,s){r=l(r);if(r+t.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");var a=new t([o]),h=new Uint8Array(a.buffer),c=[],u,f;for(u=0;u<t.BYTES_PER_ELEMENT;u+=1)c.push(i(h,u));if(Boolean(s)===Boolean(n))c.reverse();f=new Uint8Array(this.buffer,r,t.BYTES_PER_ELEMENT);f.set(c)}}Object.defineProperty(s.prototype,"setUint8",{value:h(Uint8Array)});Object.defineProperty(s.prototype,"setInt8",{value:h(Int8Array)});Object.defineProperty(s.prototype,"setUint16",{value:h(Uint16Array)});Object.defineProperty(s.prototype,"setInt16",{value:h(Int16Array)});Object.defineProperty(s.prototype,"setUint32",{value:h(Uint32Array)});Object.defineProperty(s.prototype,"setInt32",{value:h(Int32Array)});Object.defineProperty(s.prototype,"setFloat32",{value:h(Float32Array)});Object.defineProperty(s.prototype,"setFloat64",{value:h(Float64Array)});t.DataView=t.DataView||s})()})(self);(function(){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")};String.prototype.trimRight=function(){return this.replace(/\s+$/,"")}})();(function(){Node.prototype.hasClass=function(t){if(this.classList){return this.classList.contains(t)}else{return-1<this.className.indexOf(t)}};Node.prototype.addClass=function(t){if(this.classList){this.classList.add(t)}else if(!this.hasClass(t)){var e=this.className.split(" ");e.push(t);this.className=e.join(" ")}return this};Node.prototype.removeClass=function(t){if(this.classList){this.classList.remove(t)}else{var e=this.className.split(" ");e.splice(e.indexOf(t),1);this.className=e.join(" ")}return this};if(!NodeList.prototype.forEach){NodeList.prototype.forEach=Array.prototype.forEach}})();(function(){CanvasRenderingContext2D.prototype.getFontStyle=function(){var t=document.createElement("div");t.style.cssText="font: "+this.font+" !important;";this.canvas.appendChild(t);var e=window.getComputedStyle(t),i={fontFamily:e.fontFamily,fontSize:e.fontSize,fontStyle:e.fontStyle,fontVariant:e.fontVariant,fontWeight:e.fontWeight,lineHeight:e.lineHeight};this.canvas.removeChild(t);return i};CanvasRenderingContext2D.prototype.textArea=function(t,e,i,n,r,o,s){var a=t instanceof Array?t:t.split(/\b(?=\S)|(?=\s)/g),l=this.getFontStyle(),h=this.textBaseline,c=s||0,u=0,f=parseInt(l.fontSize),o=(o||1)*f,d,g,p,v,m,b,w;this.textBaseline="top";for(g=0;g<a.length;++g){if("\n"===a[g]){c=0;u+=o;continue}if(!c&&/^\t+/.test(a[g]))a[g]=a[g].replace(/^\t+/,"");d=this.measureText(a[g]).width;if((p=n-d)<=0){p=Math.abs(p);if(p-n<=0)for(v=a[g].length;v;--v){if(n>this.measureText(a[g].substr(0,v)+"-").width+f){m=v;break}}else for(v=0;v<a[g].length;++v){if(n<this.measureText(a[g].substr(0,v+1)+"-").width+f){m=v;break}}if(m){var b=a[g].substr(0,v+1)+"-",w=a[g].substr(v+1);a[g]=b;a.splice(g+1,0,w);d=this.measureText(b).width}}if(c>0&&c+d>=n){if(u+o*2>=r)return{x:c+e,y:u+i,remainder:a.slice(g)};c=0;u+=o;if(" "===a[g])continue}this.fillText(a[g],c+e,u+i);c+=d}this.textBaseline=h;return{x:c+e,y:u+i,remainder:[]}}})();(function(){var t=/([a-z\d])([A-Z])/g;var e=/\s+/;var i=/^(width|height|left|top|marginLeft|marginTop)$/;var n=/^\s+(.*)\s+$/;var r=Object.prototype;var o=r.toString;var s=r.hasOwnProperty;var a=Array.prototype.slice;function l(t){return t===+t&&t!==(t|0)}function h(t){return t===+t&&t===(t|0)}function c(t){return o.call(t).slice(8,-1).toLowerCase()}function u(t){return typeof t==="string"}function f(t){return typeof t==="number"&&!isNaN(t)}function d(t){return typeof t==="undefined"}function g(t){return(typeof t==="undefined"?"undefined":_typeof(t))==="object"&&t!==null}function p(t){if(!g(t)){return false}try{var e=t.constructor;var i=e.prototype;return e&&i&&s.call(i,"isPrototypeOf")}catch(t){return false}}function v(t){return c(t)==="function"}function m(t){return Array.isArray?Array.isArray(t):c(t)==="array"}function b(t,e){e=e>=0?e:0;if(Array.from){return Array.from(t).slice(e)}return a.call(t,e)}function w(t,e){var i=-1;if(e.indexOf){return e.indexOf(t)}e.forEach(function(e,n){if(e===t){i=n}});return i}function y(t){if(u(t)){t=t.trim?t.trim():t.replace(n,"1")}return t}function _(t,e){if(t&&v(e)){var i=void 0;if(m(t)||f(t.length)){var n=t.length;for(i=0;i<n;i++){if(e.call(t,t[i],i,t)===false){break}}}else if(g(t)){Object.keys(t).forEach(function(i){e.call(t,t[i],i,t)})}}return t}function x(e){return e.replace(t,"$1-$2").toLowerCase()}function C(t,e){if(g(t[e])){return t[e]}else if(t.dataset){return t.dataset[e]}return t.getAttribute("data-"+x(e))}function k(t,e,i){if(g(i)){t[e]=i}else if(t.dataset){t.dataset[e]=i}else{t.setAttribute("data-"+x(e),i)}}function S(t,e){if(g(t[e])){delete t[e]}else if(t.dataset){try{delete t.dataset[e]}catch(i){t.dataset[e]=null}}else{t.removeAttribute("data-"+x(e))}}function T(t,i,n){var r=y(i).split(e);if(r.length>1){_(r,function(e){T(t,e,n)});return}if(t.removeEventListener){t.removeEventListener(i,n,false)}else if(t.detachEvent){t.detachEvent("on"+i,n)}}function M(t,i,n,r){var o=y(i).split(e);var s=n;if(o.length>1){_(o,function(e){M(t,e,n)});return}if(r){n=function e(){for(var r=arguments.length,o=Array(r),a=0;a<r;a++){o[a]=arguments[a]}T(t,i,n);return s.apply(t,o)}}if(t.addEventListener){t.addEventListener(i,n,false)}else if(t.attachEvent){t.attachEvent("on"+i,n)}}function O(t,e,i){if(t.dispatchEvent){var n=void 0;if(v(Event)&&v(CustomEvent)){if(d(i)){n=new Event(e,{bubbles:true,cancelable:true})}else{n=new CustomEvent(e,{detail:i,bubbles:true,cancelable:true})}}else if(d(i)){
n=document.createEvent("Event");n.initEvent(e,true,true)}else{n=document.createEvent("CustomEvent");n.initCustomEvent(e,true,true,i)}return t.dispatchEvent(n)}else if(t.fireEvent){return t.fireEvent("on"+e)}return true}iws.event={addListener:M,removeListener:T,dispatchEvent:O}})();(function(){"use strict";var t=Math.PI/180;iws.util={degreesToRadians:function(e){return e*t},radiansToDegrees:function(e){return e/t},rotatePoint:function(t,e,i){t.subtractEquals(e);var n=iws.util.rotateVector(t,i);return new iws.Point(n.x,n.y).addEquals(e)},rotateVector:function(t,e){var i=Math.sin(e),n=Math.cos(e),r=t.x*n-t.y*i,o=t.x*i+t.y*n;return{x:r,y:o}},falseFunction:function(){return false},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},loadImage:function(t,e,i,n){if(!t){e&&e.call(i,t);return}var r=document.createElement("img");r.onload=function(){e&&e.call(i,r);r=r.onload=r.onerror=null};r.onerror=function(){iws.log("Error loading "+r.src);e&&e.call(i,null,true);r=r.onload=r.onerror=null};if(t.indexOf("data")!==0&&n){r.crossOrigin=n}r.src=t},makeElement:function(t,e){var i=document.createElement(t);for(var n in e){if(n==="class"){i.className=e[n]}else if(n==="for"){i.htmlFor=e[n]}else{i.setAttribute(n,e[n])}}return i},wrapElement:function(t,e,i){if(typeof e==="string"){e=this.makeElement(e,i)}if(t.parentNode){t.parentNode.replaceChild(e,t)}e.appendChild(t);return e},addClass:function(t,e){if(t&&(" "+t.className+" ").indexOf(" "+e+" ")===-1){t.className+=(t.className?" ":"")+e}},drawDashedLine:function(t,e,i,n,r,o){var s=n-e,a=r-i,l=sqrt(s*s+a*a),h=atan2(a,s),c=o.length,u=0,f=true;t.save();t.translate(e,i);t.moveTo(0,0);t.rotate(h);e=0;while(l>e){e+=o[u++%c];if(e>l){e=l}t[f?"lineTo":"moveTo"](e,0);f=!f}t.restore()},clipContext:function(t,e){e.save();e.beginPath();t.clipTo(e);e.clip()},transformPoint:function(t,e,i){if(i){return new iws.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y)}return new iws.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),i=[e*t[3],-e*t[1],-e*t[2],e*t[0]],n=iws.util.transformPoint({x:t[4],y:t[5]},i,true);i[4]=-n.x;i[5]=-n.y;return i},makeBoundingBoxFromPoints:function(t){var e=[t[0].x,t[1].x,t[2].x,t[3].x],i=iws.util.array.min(e),n=iws.util.array.max(e),r=Math.abs(i-n),o=[t[0].y,t[1].y,t[2].y,t[3].y],s=iws.util.array.min(o),a=iws.util.array.max(o),l=Math.abs(s-a);return{left:i,top:s,width:r,height:l}},multiplyTransformMatrices:function(t,e,i){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(e){var i=Math.atan2(e[1],e[0]),n=Math.pow(e[0],2)+Math.pow(e[1],2),r=Math.sqrt(n),o=(e[0]*e[3]-e[2]*e[1])/r,s=Math.atan2(e[0]*e[2]+e[1]*e[3],n);return{angle:i/t,scaleX:r,scaleY:o,skewX:s/t,skewY:0,translateX:e[4],translateY:e[5]}},populateWithProperties:function(t,e,i){if(i&&Object.prototype.toString.call(i)==="[object Array]"){for(var n=0,r=i.length;n<r;n++){if(i[n]in t){e[i[n]]=t[i[n]]}}}},getKlass:function(t,e,i){t=iws.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1));return iws.util.resolveNamespace(e)[i+t]},resolveNamespace:function(t){if(!t){return iws}var e=t.split("."),i=e.length,n,r=global||iws.window;for(n=0;n<i;++n){r=r[e[n]]}return r},enlivenObjects:function(t,e,i,n,r){t=t||[];function o(){if(++a===l){e&&e(s)}}var s=[],a=0,l=t.length;if(!l){e&&e(s);return}t.forEach(function(t,e){if(!t||!t.type){o();return}var a=iws.util.getKlass(t.type,i,n);s[e]=a.fromObject(t);r&&r(t,s[e]);o()})}}})();(function(){function t(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})}function e(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())}function i(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function n(t,e){var i;if(typeof t==="undefined"||t==="")return e;if(t.charAt(t.length-1)==="/"){if(e.charAt(0)==="/"){return t+e.slice(1)}else{return t+e}}else{if(e.charAt(0)==="/"){return t+e}else{return t+"/"+e}}return i}iws.util.string={camelize:t,capitalize:e,escapeXml:i,combinePath:n}})();(function(){"use strict";iws.util.find={getAngleFromPointToPoint:function(t,e,i,n){var r=i-t,o=n-e;var s=Math.atan2(o,r),a=s*180/Math.PI;return{radian:s,angle:a}},distanceOfTwoPoints:function(t,e){var i=Math.pow(t.x-e.x,2);var n=Math.pow(t.y-e.y,2);return Math.sqrt(i+n)},getContainFromCoords:function(t,e){var i=this._getImageLines(t),n=this._findCrossPoints(e,i);var r=n!==0&&n%2===1;return r},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,n,r,o,s,a=0,l;for(var h in e){l=e[h];if(l.o.y<t.y&&l.d.y<t.y){continue}if(l.o.y>=t.y&&l.d.y>=t.y){continue}if(l.o.x===l.d.x&&l.o.x>=t.x){s=l.o.x}else{i=0;n=(l.d.y-l.o.y)/(l.d.x-l.o.x);r=t.y-i*t.x;o=l.o.y-n*l.o.x;s=-(r-o)/(i-n)}if(s>=t.x){a+=1}if(a===2){break}}return a}}})();(function(){"use strict";function t(){}function e(t){var e=this.constructor.superclass.prototype[t];if(arguments.length>1){return e.apply(this,Array.prototype.slice.call(arguments,1))}else{return e.call(this)}}function i(){var i=null,n=Array.prototype.slice.call(arguments,0),r=n.shift();r.subclasses=[];if(typeof n[0]==="function"){i=n.shift();t.prototype=i.prototype;r.prototype=new t;i.subclasses.push(r)}r.superclass=i;for(var o=0,s=n.length;o<s;o++){for(var a in n[o]){var l=n[o];r.prototype[a]=l[a]}}r.prototype.constructor=r;r.prototype.callSuper=e;return r}iws.util.createInheritClass=i})();(function(){var t=document.documentElement.style,e="userSelect"in t?"userSelect":"MozUserSelect"in t?"MozUserSelect":"WebkitUserSelect"in t?"WebkitUserSelect":"KhtmlUserSelect"in t?"KhtmlUserSelect":"";function i(t){$(t).attr("unselectable","on").css({"-moz-user-select":"-moz-none","-moz-user-select":"none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"}).bind("selectstart",function(){return false});return t}function n(t){if(typeof t.onselectstart!=="undefined"){t.onselectstart=null}if(e){t.style[e]=""}else if(typeof t.unselectable==="string"){t.unselectable=""}return t}function r(t){var e=0,i=0,n=document.documentElement,r=document.body||{scrollLeft:0,scrollTop:0};while(t&&(t.parentNode||t.host)){t=t.parentNode||t.host;if(t===document){e=r.scrollLeft||n.scrollLeft||0;i=r.scrollTop||n.scrollTop||0}else{e+=t.scrollLeft||0;i+=t.scrollTop||0}if(t.nodeType===1&&iws.util.getElementStyle(t,"position")==="fixed"){break}}return{left:e,top:i}}function o(t){var e,i=t&&t.ownerDocument,n={left:0,top:0},o={left:0,top:0},a,l={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!i){return o}for(var h in l){o[l[h]]+=parseInt(s(t,h),10)||0}e=i.documentElement;if(typeof t.getBoundingClientRect!=="undefined"){n=t.getBoundingClientRect()}a=r(t);return{left:n.left+a.left-(e.clientLeft||0)+o.left,top:n.top+a.top-(e.clientTop||0)+o.top}}var s;if(document.defaultView&&document.defaultView.getComputedStyle){s=function(t,e){var i=document.defaultView.getComputedStyle(t,null);return i?i[e]:undefined}}else{s=function(t,e){var i=t.style[e];if(!i&&t.currentStyle){i=t.currentStyle[e]}return i}}iws.util.makeElementUnselectable=i;iws.util.makeElementSelectable=n;iws.util.getScrollLeftTop=r;iws.util.getElementOffset=o;iws.util.getElementStyle=s;function a(t){t||(t=window.event);var e=t.target||(typeof t.srcElement!==unknown?t.srcElement:null),i=iws.util.getScrollLeftTop(e);return{x:(t.clientX||t.touches[0].clientX)+i.left,y:(t.clientY||t.touches[0].clientY)+i.top}}iws.util.getPointer=a;var l=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function h(t){return toString.call(t).slice(8,-1).toLowerCase()}function c(t){return typeof t==="number"&&!isNaN(t)}function u(t){return(typeof t==="undefined"?"undefined":l(t))==="object"&&t!==null}function f(t){return h(t)==="function"}function d(t){return Array.isArray?Array.isArray(t):h(t)==="array"}function g(t,e){if(t&&f(e)){var i=void 0;if(d(t)||c(t.length)){var n=t.length;for(i=0;i<n;i++){if(e.call(t,t[i],i,t)===false){break}}}else if(u(t)){Object.keys(t).forEach(function(i){e.call(t,t[i],i,t)})}}return t}function p(t){var e=v(t);var i=[];if(e.changedTouches){g(e.changedTouches,function(t){i.push({x:t.pageX,y:t.pageY})})}else{i.push({x:e.pageX,y:e.pageY})}return i}iws.util.getPointers=p;function v(t){var e=t||window.event;if(!e.target){e.target=e.srcElement||document}if(!c(e.pageX)&&c(e.clientX)){var i=t.target.ownerDocument||document;var n=i.documentElement;var r=i.body;e.pageX=e.clientX+((n&&n.scrollLeft||r&&r.scrollLeft||0)-(n&&n.clientLeft||r&&r.clientLeft||0));e.pageY=e.clientY+((n&&n.scrollTop||r&&r.scrollTop||0)-(n&&n.clientTop||r&&r.clientTop||0))}return e}iws.util.getEvent=v;function m(t){var e=document.documentElement;var i=t.getBoundingClientRect();return{left:i.left+((window.scrollX||e&&e.scrollLeft||0)-(e&&e.clientLeft||0)),top:i.top+((window.scrollY||e&&e.scrollTop||0)-(e&&e.clientTop||0))}}iws.util.getOffset=m})();(function(){var t=Array.prototype.slice;function e(e,i){var n=t.call(arguments,2),r=[];for(var o=0,s=e.length;o<s;o++){r[o]=n.length?e[o][i].apply(e[o],n):e[o][i].call(e[o])}return r}function i(t,e){return o(t,e,function(t,e){return t>=e})}function n(t,e){return o(t,e,function(t,e){return t<e})}function r(t,e){var i=t.length;while(i--){t[i]=e}return t}function o(t,e,i){if(!t||t.length===0){return}var n=t.length-1,r=e?t[n][e]:t[n];if(e){while(n--){if(i(t[n][e],r)){r=t[n][e]}}}else{while(n--){if(i(t[n],r)){r=t[n]}}}return r}iws.util.array={fill:r,invoke:e,min:n,max:i}})();(function(){var t={},e={},i={},n=Array.prototype.join;function r(e,i,r,a,l,h,c){var u=n.call(arguments);if(t[u]){return t[u]}var f=Math.PI,d=c*f/180,g=Math.sin(d),p=Math.cos(d),v=0,m=0;r=Math.abs(r);a=Math.abs(a);var b=-p*e*.5-g*i*.5,w=-p*i*.5+g*e*.5,y=r*r,_=a*a,x=w*w,C=b*b,k=y*_-y*x-_*C,S=0;if(k<0){var T=Math.sqrt(1-k/(y*_));r*=T;a*=T}else{S=(l===h?-1:1)*Math.sqrt(k/(y*x+_*C))}var M=S*r*w/a,O=-S*a*b/r,E=p*M-g*O+e*.5,P=g*M+p*O+i*.5,A=s(1,0,(b-M)/r,(w-O)/a),j=s((b-M)/r,(w-O)/a,(-b-M)/r,(-w-O)/a);if(h===0&&j>0){j-=2*f}else if(h===1&&j<0){j+=2*f}var I=Math.ceil(Math.abs(j/f*2)),F=[],R=j/I,D=8/3*Math.sin(R/4)*Math.sin(R/4)/Math.sin(R/2),L=A+R;for(var B=0;B<I;B++){F[B]=o(A,L,p,g,r,a,E,P,D,v,m);v=F[B][4];m=F[B][5];A=L;L+=R}t[u]=F;return F}function o(t,i,r,o,s,a,l,h,c,u,f){var d=n.call(arguments);if(e[d]){return e[d]}var g=Math.cos(t),p=Math.sin(t),v=Math.cos(i),m=Math.sin(i),b=r*s*v-o*a*m+l,w=o*s*v+r*a*m+h,y=u+c*(-r*s*p-o*a*g),_=f+c*(-o*s*p+r*a*g),x=b+c*(r*s*m+o*a*v),C=w+c*(o*s*m-r*a*v);e[d]=[y,_,x,C,b,w];return e[d]}function s(t,e,i,n){var r=Math.atan2(e,t),o=Math.atan2(n,i);if(o>=r){return o-r}else{return 2*Math.PI-(r-o)}}iws.util.drawArc=function(t,e,i,n){var o=n[0],s=n[1],a=n[2],l=n[3],h=n[4],c=n[5],u=n[6],f=[[],[],[],[]],d=r(c-e,u-i,o,s,l,h,a);for(var g=0,p=d.length;g<p;g++){f[g][0]=d[g][0]+e;f[g][1]=d[g][1]+i;f[g][2]=d[g][2]+e;f[g][3]=d[g][3]+i;f[g][4]=d[g][4]+e;f[g][5]=d[g][5]+i;t.bezierCurveTo.apply(t,f[g])}};iws.util.getBoundsOfArc=function(t,e,i,n,o,s,l,h,c){var u=0,f=0,d,g=[],p=r(h-t,c-e,i,n,s,l,o);for(var v=0,m=p.length;v<m;v++){d=a(u,f,p[v][0],p[v][1],p[v][2],p[v][3],p[v][4],p[v][5]);g.push({x:d[0].x+t,y:d[0].y+e});g.push({x:d[1].x+t,y:d[1].y+e});u=p[v][4];f=p[v][5]}return g};function a(t,e,r,o,s,a,l,h){var c=n.call(arguments);if(i[c]){return i[c]}var u=Math.sqrt,f=Math.min,d=Math.max,g=Math.abs,p=[],v=[[],[]],m,b,w,y,_,x,C,k;b=6*t-12*r+6*s;m=-3*t+9*r-9*s+3*l;w=3*r-3*t;for(var S=0;S<2;++S){if(S>0){b=6*e-12*o+6*a;m=-3*e+9*o-9*a+3*h;w=3*o-3*e}if(g(m)<1e-12){if(g(b)<1e-12){continue}y=-w/b;if(0<y&&y<1){p.push(y)}continue}C=b*b-4*w*m;if(C<0){continue}k=u(C);_=(-b+k)/(2*m);if(0<_&&_<1){p.push(_)}x=(-b-k)/(2*m);if(0<x&&x<1){p.push(x)}}var T,M,O=p.length,E=O,P;while(O--){y=p[O];P=1-y;T=P*P*P*t+3*P*P*y*r+3*P*y*y*s+y*y*y*l;v[0][O]=T;M=P*P*P*e+3*P*P*y*o+3*P*y*y*a+y*y*y*h;v[1][O]=M}v[0][E]=t;v[1][E]=e;v[0][E+1]=l;v[1][E+1]=h;var A=[{x:f.apply(null,v[0]),y:f.apply(null,v[1])},{x:d.apply(null,v[0]),y:d.apply(null,v[1])}];i[c]=A;return A}iws.util.getBoundsOfCurve=a})();(function(){function t(t,e){for(var i in e){t[i]=e[i]}return t}function e(e){return t({},e)}iws.util.extend=t;iws.util.clone=e})();(function(){function t(t,e){var i=iws.util.makeElement("div",{class:"resize",style:"position:absolute; width:auto; height:auto; top:0; right:0; bottom:0; left:0; margin:0; padding:0; overflow:hidden; visibility:hidden; z-index:-1"});t.appendChild(i);var n=iws.util.makeElement("iframe",{style:"width:100%; height:0; border:0; visibility:visible; margin:0"});i.appendChild(n);var r=iws.util.makeElement("iframe",{style:"width:0; height:100%; border:0; visibility:visible; margin:0"});i.appendChild(r);this.callback=e;this.resizeData={w:t.offsetWidth,h:t.offsetHeight,t:null,throttle:10};function o(){var i=this.resizeData;if(!i.t||i.w!==t.offsetWidth||i.h!==t.offsetHeight){if(i.t)clearTimeout(i.t);i.t=setTimeout(function(){i.w=t.offsetWidth;i.h=t.offsetHeight;e()}.bind(this),i.throttle)}}n.contentWindow.addEventListener("resize",o.bind(this));r.contentWindow.addEventListener("resize",o.bind(this))}iws.util.resize=t})();(function(){iws.util.regexp={};iws.util.regexp.checkUrlForm=function(t){var e=/^http[s]?\:\/\//i;return e.test(t)};iws.util.regexp.getDigitString=function(t){var e=t.replace(/[^-\d\.]/g,"");return e}})();(function(){iws.util.fullscreen={toggleFullScreen:function(t){if(document.fullScreenElement&&document.fullScreenElement!==null||!document.mozFullScreen&&!document.webkitIsFullScreen){if(t.requestFullScreen){t.requestFullScreen()}else if(t.msRequestFullscreen){t.msRequestFullscreen()}else if(t.mozRequestFullScreen){t.mozRequestFullScreen()}else if(t.webkitRequestFullScreen){t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}}else{if(document.exitFullscreen){document.exitFullscreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}},onFullScreenChange:function(t){$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(e){var i=!(!document.fullscreenElement&&!document.msFullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement);t&&t(i)}.bind(this))}}})();(function(){iws.util.urlDownload=function(t,e){function i(t,e){var i=0;var n=new XMLHttpRequest;n.open("GET",t);n.responseType="arraybuffer";n.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");n.onload=function(t){if(i===200)e(n.response)};n.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total}else{}};n.onreadystatechange=function t(){if(n.readyState===4){if(n.status===200){i=n.status}else{alert("There was a problem with the request.\n"+n.statusText)}}};n.send()}i(t,e)}})();(function(){iws.util.Unique={prevTimeId:0,prevUniqueId:0,thumbFrameId:0,getUniqueID:function(){try{var t=new Date;var e=t.getTime();if(e==iws.util.Unique.prevTimeId)iws.util.Unique.prevUniqueId=iws.util.Unique.prevUniqueId+1;else{iws.util.Unique.prevTimeId=e;iws.util.Unique.prevUniqueId=0}e=e+""+iws.util.Unique.prevUniqueId;return e}catch(t){console.log("mwUnique.getUniqueID error:"+t.message+".")}},getFrameId:function(){var t=iws.util.Unique.thumbFrameId++;return"thumb_frame_"+t.toString()}}})();(function(){iws.util.ListenDropFile=function(t,e){t.addEventListener("dragover",function(t){t.preventDefault();t.dataTransfer.dropEffect="copy"});t.addEventListener("drop",function(t){t.stopPropagation();t.preventDefault();var i=t.dataTransfer.files;if(i.length>0){var n=i[0];var r=new FileReader;r.onload=function(){e(r)};r.readAsArrayBuffer(n)}})};iws.util.RemoveDropFile=function(t){t.removeEventListener("dragover");t.removeEventListener("drop")}})();(function(){iws.util.run_waitMe=function(t,e){iws.util.waitMe(t,{effect:e,text:"",bg:"rgba(255,255,255,0.2)",color:"#222222",maxSize:"20px",onClose:function(){}})};iws.util.hide_waitMe=function(t){iws.util.waitMe(t,"hide")};iws.util.waitMe=function(t,e){return function(){var i=t,n="waitMe",r,o,s,a=false,l="background-color",h="",c="",u,f,d;var g={init:function(){var t={effect:"bounce",text:"",bg:"rgba(255,255,255,0.7)",color:"#000",maxSize:"",source:"",onClose:function(){}};f=$.extend(t,e);d=(new Date).getMilliseconds();u=$('<div class="'+n+'" data-waitme_id="'+d+'"></div>');switch(f.effect){case"none":s=0;break;case"bounce":s=3;break;case"rotateplane":s=1;break;case"stretch":s=5;break;case"orbit":s=2;break;case"roundBounce":s=12;break;case"win8":s=5;a=true;break;case"win8_linear":s=5;a=true;break;case"ios":s=12;break;case"facebook":s=3;break;case"rotation":s=1;l="border-color";break;case"timer":s=2;if($.isArray(f.color)){var g=f.color[0]}else{var g=f.color}h="border-color:"+g;break;case"pulse":s=1;l="border-color";break;case"progressBar":s=1;break;case"bouncePulse":s=3;break;case"img":s=1;break}if(h!==""){h+=";"}if(s>0){if(f.effect==="img"){c='<img src="'+f.source+'">'}else{for(var p=1;p<=s;++p){if($.isArray(f.color)){var g=f.color[p];if(g==undefined){g="#000"}}else{var g=f.color}if(a){c+='<div class="'+n+"_progress_elem"+p+'"><div style="'+l+":"+g+'"></div></div>'}else{c+='<div class="'+n+"_progress_elem"+p+'" style="'+l+":"+g+'"></div>'}}}o=$('<div class="'+n+"_progress "+f.effect+'" style="'+h+'">'+c+"</div>")}if(f.text&&f.maxSize===""){if($.isArray(f.color)){var g=f.color[0]}else{var g=f.color}r=$('<div class="'+n+'_text" style="color:'+g+'">'+f.text+"</div>")}var v=i.find("> ."+n);if(v){v.remove()}var m=$('<div class="'+n+'_content"></div>');m.append(o,r);u.append(m);if(i[0]&&i[0].tagName=="HTML"){i=$("body")}i.addClass(n+"_container").attr("data-waitme_id",d).append(u);v=i.find("> ."+n);var b=i.find("."+n+"_content");v.css({background:f.bg});b.css({marginTop:-b.outerHeight()/2+"px"});if(f.maxSize!==""){var w=o.outerHeight();var y=o.outerWidth();var _=w;if(f.effect==="img"){o.css({height:f.maxSize+"px"});o.find(">img").css({maxHeight:"100%"});b.css({marginTop:-b.outerHeight()/2+"px"})}else{if(f.maxSize<_){m.css({transform:"scale("+f.maxSize/_+")"})}}}function x(t){b.css({top:"auto",transform:"translateY("+t+"px) translateZ(0)"})}if(i.outerHeight()>$(window).height()){var C=$(window).scrollTop(),k=b.outerHeight(),S=i.offset().top,T=i.outerHeight(),M=C-S+$(window).height()/2;if(M<0){M=Math.abs(M)}if(M-k>=0&&M+k<=T){if(S-C>$(window).height()/2){M=k}x(M)}else{if(C>S+T-k){M=C-S-k}else{M=C-S+k}x(M)}$(document).scroll(function(){var t=$(window).scrollTop(),e=t-S+$(window).height()/2;if(e-k>=0&&e+k<=T){x(e)}})}v.on("destroyed",function(){if(f.onClose&&$.isFunction(f.onClose)){f.onClose()}v.trigger("close")});$.event.special.destroyed={remove:function(t){if(t.handler){t.handler()}}};return v},hide:function(){p()}};function p(){var t=i.attr("data-waitme_id");i.removeClass(n+"_container").removeAttr("data-waitme_id");i.find("."+n+'[data-waitme_id="'+t+'"]').remove()}if(g[e]){return g[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return g.init.apply(this,arguments)}}()}})();(function(t){t.fn.tabSlideOut=function(e){function i(t,e){return parseInt(t.css("border-"+e+"-width"),10)}function n(){return o.hasClass("ui-slideouttab-open")}function r(){var e=t(o).parent().height();if(a==="top"||a==="bottom"){e=t(o).parent().width()}return e-parseInt(s.otherOffset)-parseInt(s.offset)}var o=this;if(typeof e=="string"){switch(e){case"open":if(!n())this.children(".ui-slideouttab-handle").click();break;case"close":if(n())this.children(".ui-slideouttab-handle").click();break;case"isOpen":return n();break;case"toggle":this.children(".ui-slideouttab-handle").click();break;case"bounce":this.children(".ui-slideouttab-handle").trigger("bounce");break;case"resize":this.trigger("resize");break;default:throw"Invalid tabSlideOut command"}}else{var s=t.extend({tabLocation:"left",tabHandle:".handle",speed:300,action:"click",offset:"200px",offsetReverse:false,otherOffset:null,handleOffset:null,handleOffsetReverse:false,bounceDistance:"50px",bounceTimes:4,tabImage:null,tabImageHeight:null,tabImageWidth:null,onLoadSlideOut:false,clickScreenToClose:true,toggleButton:".tab-opener",onOpen:function(){},onClose:function(){}},e||{});var a=s.tabLocation;var l=s.tabHandle=t(s.tabHandle,o);o.addClass("ui-slideouttab-panel");o.addClass("ui-slideouttab-"+a);if(s.offsetReverse)o.addClass("ui-slideouttab-panel-reverse");l.addClass("ui-slideouttab-handle");if(s.handleOffsetReverse)l.addClass("ui-slideouttab-handle-reverse");s.toggleButton=t(s.toggleButton);if(s.tabImage!==null){var h=0;var c=0;if(s.tabImageHeight!==null&&s.tabImageWidth!==null){h=s.tabImageHeight;c=s.tabImageWidth}else{var u=new Image;u.src=s.tabImage;h=u.naturalHeight;c=u.naturalWidth}l.addClass("ui-slideouttab-handle-image");l.css({background:"url("+s.tabImage+") no-repeat",width:c,height:h})}l.css({display:"block",position:"absolute"});o.css({position:"absolute"});if(a==="top"||a==="bottom"){s.panelOffsetFrom=s.offsetReverse?"right":"left";s.handleOffsetFrom=s.handleOffsetReverse?"right":"left"}else{s.panelOffsetFrom=s.offsetReverse?"bottom":"top";s.handleOffsetFrom=s.handleOffsetReverse?"bottom":"top"}if(s.handleOffset===null){s.handleOffset="-"+i(o,s.handleOffsetFrom)+"px"}function f(){return{panelWidth:parseInt(o.outerWidth()+1,10)+"px",panelHeight:parseInt(o.outerHeight()+1,10)+"px",handleWidth:parseInt(l.outerWidth(),10)+"px",handleHeight:parseInt(l.outerHeight()+1,10)+"px"}}if(a==="top"||a==="bottom"){o.css(s.panelOffsetFrom,s.offset);l.css(s.handleOffsetFrom,s.handleOffset);if(s.otherOffset!==null){o.css("width",r()+"px");o.on("resize",function(){o.css("width",r()+"px")})}var d=f();if(a==="top"){o.css({top:"-"+d.panelHeight});l.css({bottom:"-"+d.handleHeight})}else{o.css({bottom:"-"+d.panelHeight});l.css({top:"-"+d.handleHeight})}}if(a==="left"||a==="right"){o.css(s.panelOffsetFrom,s.offset);l.css(s.handleOffsetFrom,s.handleOffset);if(s.otherOffset!==null){o.css("height",r()+"px");o.on("resize",function(){o.css("height",r()+"px")})}var d=f();if(a==="left"){o.css({left:"-"+d.panelWidth});l.css({right:"0"})}else{o.css({right:"-"+d.panelWidth});l.css({left:"0"})}}l.click(function(t){t.preventDefault()});s.toggleButton.click(function(t){t.preventDefault()});var g=function(){var t=f();var e;switch(a){case"top":case"bottom":e=t.panelHeight;break;case"left":case"right":e=t.panelWidth}var i=[];i[a]="-"+e;o.removeClass("ui-slideouttab-open").animate(i,s.speed,function(){o.trigger("slideouttabclose");s.onClose()})};var p=function(){var t=[];t[a]="-"+i(o,a)+"px";o.animate(t,s.speed,function(){o.addClass("ui-slideouttab-open").trigger("slideouttabopen");s.onOpen()})};var v=[];v[a]="-="+s.bounceDistance;var m=[];m[a]="+="+s.bounceDistance;var b=function(){var t=o;for(var e=0;e<s.bounceTimes;e++){t=t.animate(v,s.speed).animate(m,s.speed)}o.trigger("slideouttabbounce")};var w=function(){var t=o;for(var e=0;e<s.bounceTimes;e++){t=t.animate(m,s.speed).animate(v,s.speed)}o.trigger("slideouttabbounce")};var y=function(){o.click(function(t){t.stopPropagation()});s.toggleButton.click(function(t){t.stopPropagation()});t(document).click(function(){if(n()){g()}})};var _=function(){l.click(function(t){if(n()){g()}else{p()}});s.toggleButton.click(function(t){if(n()){g()}else{p()}});if(s.clickScreenToClose)y()};var x=function(){o.hover(function(){if(!n()){p()}},function(){if(n()){setTimeout(g,1e3)}});l.click(function(t){if(n()){g()}});s.toggleButton.click(function(t){if(n()){g()}else{p()}});if(s.clickScreenToClose)y()};var C=function(){g();setTimeout(p,500)};if(s.action==="click"){_()}if(s.action==="hover"){x()}if(s.onLoadSlideOut){C()}l.on("bounce",function(t){if(n()){b()}else{w()}})}return this}})(jQuery);(function(){iws.util.work={};if(typeof Worker==="undefined"){console.log(">>>> \tworker 작동하지 않는 환경입니다.")}iws.util.work.Spliter=function(t,e){var i=new Worker(t);i.onerror=function(t){console.log("iwsT.Spliter : "+event.message+" ("+event.filename+":"+event.lineno+")")};var n=false;var r={};var o=function(){};var s=function(t){};return{init:function(){if(n===true){if(i!==null){i.terminate();i=null}n=false}if(i===null){i=new Worker(t)}},close:function(){if(i!==null){i.terminate();i=null}},postMessage:function(r){n=true;i.onmessage=function(r){o(r);n=false;if(e===true){i.terminate();i=null;i=new Worker(t)}};i.onerror=function(r){console.log("iwsT.Spliter : "+r.message+" ("+r.filename+":"+r.lineno+")");s(r);n=false;if(e===true){i.terminate();i=null;i=new Worker(t)}};i.postMessage(r)},callBackonmessage:function(t){o=t},callBackonerror:function(t){s=t}}};iws.util.work.WorkCrew=function(t,e,i,n){this.filename=t;this.count=this.mincount=e;this.maxcount=i||4;this.queue=[];this.results=[];this.pool=[];this.working={};this.uuid=0;this.fillPool();this.isRunning=false;this.inited=function(){};this.refresh=n||true};iws.util.work.WorkCrew.prototype.onfinish=function(){};iws.util.work.WorkCrew.prototype.onstarted=function(t){};iws.util.work.WorkCrew.prototype.oncomplete=function(t,e){};iws.util.work.WorkCrew.prototype.oncanceled=function(t){};iws.util.work.WorkCrew.prototype.unshiftWork=function(t){if(this.count===0){this.count++;this.addWorker()}this.isRunning=true;var e=this.uuid++;this.queue.unshift({id:e,work:t});this.processQueue();return e};iws.util.work.WorkCrew.prototype.addWork=function(t){if(this.count===0){this.count++;this.addWorker()}this.isRunning=true;var e=this.uuid++;this.queue.push({id:e,work:t});this.processQueue();return e};iws.util.work.WorkCrew.prototype.close=function(){this.mincount=0;this.init();var t=this.pool.length;for(var e=0;e<t;e++){var i=this.pool.shift();i.terminate();i=undefined}};iws.util.work.WorkCrew.prototype.init=function(){this.uuid=0;if(this.isRunning===true){for(var t=this.queue.length-1;t>=0;t--)this.queue.splice(t,1);for(var t in this.working){var e=this.working[t];console.log("<<<<    oncanceled "+e.work.cmd+" : "+e.work.id.index+", uniqueId="+e.work.id.uniqueId);this.oncanceled(e.work);e.terminate();e=undefined;delete this.working[t];this.count--}this.isRunning=false}var i=this.mincount-this.count;for(var t=0;t<i;t++){this.addWorker();this.count++}};iws.util.work.WorkCrew.prototype.clearData=function(t){if(t===null){for(var e=this.queue.length-1;e>=0;e--){this.oncanceled(this.queue[e].work);this.queue.splice(e,1)}}else{for(var e=this.queue.length-1;e>=0;e--){if(t===this.queue[e].work.cmd){this.oncanceled(this.queue[e].work);this.queue.splice(e,1)}}}};iws.util.work.WorkCrew.prototype.initAsync=function(){for(var t=this.queue.length-1;t>=0;t--)this.queue.splice(t,1);this.uuid=0;var e=this;(function(t){function i(){setTimeout(function(){if(e.isRunning===true){i(t)}else t()},0)}i()})(this.inited)};iws.util.work.WorkCrew.prototype.processQueue=function(){if(this.queue.length==0&&this.pool.length==this.count){if(this.onfinish){var t=this.count-this.mincount;if(this.refresh){t=this.count}for(var e=0;e<t;e++){var i=this.pool.shift();i.terminate();i=undefined;this.count--}this.onfinish();this.isRunning=false;this.uuid=0;if(this.refresh){for(var e=0;e<this.mincount;e++){this.addWorker();this.count++}}}}else{while(this.queue.length>0&&this.pool.length>0){var n=this.queue.shift();var i=this.pool.shift();i.id=n.id;i.work=n.work;this.working[i.id]=i;i.postMessage(n.work);this.onstarted(n.work)}}};iws.util.work.WorkCrew.prototype.addWorker=function(){var t=new Worker(this.filename);var e=this;t.onmessage=function(t){var i=this.id;delete e.working[this.id];this.id=null;e.pool.push(this);try{e.oncomplete(i,t)}catch(n){console.log(n);console.log("iwsT.WorkCrew onmessage: "+n.message+" ("+n.filename+":"+n.lineno+")");e.oncomplete(i,t)}if(e.queue.length!==0&&e.count<e.maxcount){e.addWorker();e.count++}e.processQueue()};t.onerror=function(t){console.log(t);console.log("iwsT.WorkCrew onerror: "+t.message+" ("+t.filename+":"+t.lineno+")")};this.pool.push(t)};iws.util.work.WorkCrew.prototype.fillPool=function(){for(var t=0;t<this.count;t++){this.addWorker()}}})();(function(){iws.util.print={};var t=function(e){return{point:function(t,i,n,r){var o=Math.PI/180*e,s=Math.cos(o),a=Math.sin(o),l=s*(n-t)-a*(r-i)+t,h=s*(r-i)+a*(n-t)+i;return{x:l,y:h}},size:function(i,n){var r=t(e).point(0,0,i,n);return{width:Math.round(Math.abs(r.x)),height:Math.round(Math.abs(r.y))}}}};var e=function(e,i,n,r,o){var s=t(o).size(n,r);var a=1;var l="";if(i/s.height*s.width<=e){a=i/s.height;l="H"}else{a=e/s.width;l="W"}var h=e/2-n/2*a;var c=i/2-r/2*a;var u=h+n*a;var f=c+r*a;var d=Math.round(h+(u-h)/2);var g=Math.round(c+(f-c)/2);var p=Math.round(s.width*a/2);var v=Math.round(s.height*a/2);return{scale:a,start:{x:h,y:c},end:{x:u,y:f},center:{x:d,y:g},offset:{x:d-p,y:g-v},fit:l}};var i=function(t,e,i,n){var r={width:i,height:n};var o=1;var s="";if(e/r.height*r.width<=t){o=e/r.height;s="H"}else{o=t/r.width;s="W"}var a=t/2-i/2*o;var l=e/2-n/2*o;var h=a+i*o;var c=l+n*o;var u=Math.round(a+(h-a)/2);var f=Math.round(l+(c-l)/2);var d=Math.round(r.width*o/2);var g=Math.round(r.height*o/2);return{scale:o,start:{x:a,y:l},end:{x:h,y:c},center:{x:u,y:f},offset:{x:u-d,y:f-g},fit:s}};function n(i,n,r,o,s,a){var l=[];if(r){var h=typeof r==="string"?JSON.parse(r):iws.util.object.clone(r);iws.util.enlivenObjects(h.objects,function(t){t.forEach(function(t,e){l[e]=t})},null,"object")}var c=document.createElement("canvas");var u=c.getContext("2d");c.width=210*5;c.height=297*5;if(n&&n.printAutoFit){var f=c.width/c.height;var d=t(s).size(i.width,i.height);var g=t(s+90).size(i.width,i.height);var p=Math.abs(f-d.width/d.height);var v=Math.abs(f-g.width/g.height);s=p>v?(s+90)%360:s}var m=e(c.width,c.height,i.width,i.height,s);u.clearRect(0,0,c.width,c.height);u.save();u.fillStyle="#fff";u.fillRect(0,0,c.width,c.height);u.translate(m.center.x,m.center.y);u.rotate(s*Math.PI/180);u.translate(-m.center.x,-m.center.y);u.translate(m.start.x,m.start.y);u.scale(m.scale,m.scale);u.drawImage(i,0,0);u.restore();u.save();l.forEach(function(t){t.setControlVisible("mrdel",false);t._objectSizeChangeScale(m.scale,{x:0,y:0},{x:0,y:0});t.set({left:t.get("left")+m.offset.x,top:t.get("top")+m.offset.y});t.setCoords();var e=t.get("left");var i=t.get("top");var n=a.xres<96?96:a.xres;t.render(u,null,m.scale*n/96)}.bind(this));u.restore();return c.toDataURL("image/jpeg",o)}var r=function(t,e,i,r,o,s,a,l){var h=a||0;var c=document.createElement("canvas");var u=c.getContext("2d").createImageData(e,i);u.data.set(t);c.width=e;c.height=i;c.getContext("2d").putImageData(u,0,0);return n(c,r,o,s,h,l)};function o(t,e,i,r,o,s,a){var l=o||0;var h=new Image;h.onload=function(t){a&&a(n(this,e,i,r,l,s))};h.src=t}iws.util.print.image_didenUseWorker=function(t,e){iws.util.run_waitMe($("body"),"progressBar");var i="print-"+(new Date).getTime();var n=$("<iframe/>",{id:i,class:"printBody",name:"printIframe",style:"display:none;",load:function(){console.log("laod the iframe")}});n.appendTo("body");var r=n.contents();var o=r.contents();var s=o.find("head");var a=o.find("body");var l=i;s.append("<title>"+l+"</title>");s.append('<meta charset="UTF-8">');s.append("<style> "+'body { margin: 0;\tpadding: 0;\tbackground-color: #FAFAFA;\tfont: 12pt "Tahoma"; }'+"* {\tbox-sizing: border-box;\t-moz-box-sizing: border-box;}"+".page {\twidth: 21cm;\tmin-height: 29.7cm;}"+".subpage {\tmargin: 0cm;\tpadding: 0.2cm;\twidth: 21.0cm;\theight: 29.7cm;\tbackground: #DFDFDF;}"+".printimg{\twidth: 20.6cm;\theight: 29.3cm;}"+"@page {\tsize: A4;\tmargin: 0;}"+"@media print {\t"+"\t.page {\tmargin: 0; border: initial;\tborder-radius: initial;\twidth: initial;\tmin-height: initial; box-shadow: initial; background: initial; page-break-after: always; }"+"}"+"</style> ")};iws.util.print.image=function(t,e,i){iws.util.run_waitMe($("body"),"progressBar");
var n="print-"+(new Date).getTime();var s=$("<iframe/>",{id:n,class:"printBody",name:"printIframe",style:"display:none;",load:function(){console.log("laod the iframe")}});s.appendTo("body");var a=s.contents();var l=a.contents();var h=l.find("head");var c=l.find("body");var u=n;h.append("<title>"+u+"</title>");h.append('<meta charset="UTF-8">');h.append("<style> "+'body { margin: 0;\tpadding: 0;\tbackground-color: #FAFAFA;\tfont: 12pt "Tahoma"; }'+"* {\tbox-sizing: border-box;\t-moz-box-sizing: border-box;}"+".page {\twidth: 21cm;\tmin-height: 29.7cm;}"+".subpage {\tmargin: 0cm;\tpadding: 0.2cm;\twidth: 21.0cm;\theight: 29.7cm;\tbackground: #DFDFDF;}"+".printimg{\twidth: 20.6cm;\theight: 29.3cm;}"+"@page {\tsize: A4;\tmargin: 0;}"+"@media print {\t"+"\t.page {\tmargin: 0; border: initial;\tborder-radius: initial;\twidth: initial;\tmin-height: initial; box-shadow: initial; background: initial; page-break-after: always; }"+"}"+"</style> ");function f(){setTimeout(function(){var t=s[0].contentWindow.document.execCommand("print",false,null);if(t===false)s[0].contentWindow.print();$("#"+n).remove()},0);iws.util.hide_waitMe($("body"))}if(t){var d=new iws.util.work.WorkCrew(t,1,1,false);d.oncomplete=function(t,e){var n=e.data,s=n.id;var a=new Date;var l="";l+='<div class="page" id="'+s.index.toString()+'">';l+='<div class="subpage">';l+='<img class="printimg"/>';l+="</div>";l+="</div>";$output=$(l);c.append($output);if(n.src&&n.src!=""){o(n.src,i,s.annotation,20,s.angle,s.pageinfo,function(t,e){return function(t){e.find("img").each(function(){this.onload=function(t){console.log("출력 이미지 로드")};this.src=t})}}(s,$output))}else{var h=r(n.pagearray,n.pageInfo.width,n.pageInfo.height,i,s.annotation,20,s.angle,s.pageinfo);$output.find("img").each(function(){this.onload=function(t){console.log("출력 이미지 로드")};this.src=h})}};d.onfinish=function(){f();d.close()};e.forEach(function(t){t.__id=d.addWork(t)})}else{var g=function(t){this.option=t;this.uuid=0;this.sendQueue=[];this.working=null;this.processQueue=function(){var t=this;if(this.sendQueue.length===0&&this.working===null){this.onfinish()}else if(this.sendQueue.length>0&&this.working===null){var e=this.working=this.sendQueue.shift();var i=iws.util.WebImageType(e.buffer);if(i){iws.util.arrayBufferToImageBase64(i.mime,new Uint8Array(e.buffer),function(e){return function(i){t.oncomplete(t.working.__id,i,e);setTimeout(function(){t.working=null;t.processQueue()},10)}}(e.id))}}}};g.prototype.addWork=function(t){this.sendQueue.push(t);this.processQueue();return this.uuid++};g.prototype.oncomplete=function(t,e,i){};g.prototype.onfinish=function(){};var p=new g(i);p.oncomplete=function(t,e,n){var r="";r+='<div class="page" id="'+n.index.toString()+'">';r+='<div class="subpage">';r+='<img class="printimg"/>';r+="</div>";r+="</div>";$output=$(r);c.append($output);o(e,i,n.annotation,20,n.angle,n.pageinfo,function(t,e){return function(t){e.find("img").each(function(){this.onload=function(t){console.log("출력 이미지 로드")};this.src=t})}}(n,$output))};p.onfinish=function(){f()};e.forEach(function(t){t.__id=p.addWork(t)})}}})();(function(){function t(){this.initialize.apply(this,arguments)}iws.Pattern=iws.util.createInheritClass(t,{repeat:"repeat",offsetX:0,offsetY:0,initialize:function(t){t||(t={});if(t.source){if(typeof t.source==="string"){if(typeof iws.util.getFunctionBody(t.source)!=="undefined"){this.source=new Function(iws.util.getFunctionBody(t.source))}else{var e=this;this.source=document.createElement("img");iws.util.loadImage(t.source,function(t){e.source=t})}}else{this.source=t.source}}if(t.repeat){this.repeat=t.repeat}if(t.offsetX){this.offsetX=t.offsetX}if(t.offsetY){this.offsetY=t.offsetY}},toLive:function(t){var e=typeof this.source==="function"?this.source():this.source;if(!e){return""}if(typeof e.src!=="undefined"){if(!e.complete){return""}if(e.naturalWidth===0||e.naturalHeight===0){return""}}return t.createPattern(e,this.repeat)}})})();(function(){var t=function(t){var e=new Uint8Array(t);if(!(e&&e.length>1)){return null}var i=function(t,i){if(!i){i={offset:0}}for(var n=0;n<t.length;n++){if(t[n]!==e[n+i.offset]){return false}}return true};if(i([255,216,255])){return{ext:"jpg",mime:"image/jpeg"}}if(i([137,80,78,71,13,10,26,10])){return{ext:"png",mime:"image/png"}}if(i([71,73,70])){return{ext:"gif",mime:"image/gif"}}if(i([87,69,66,80],{offset:8})){return{ext:"webp",mime:"image/webp"}}if((i([73,73,42,0])||i([77,77,0,42]))&&i([67,82],{offset:8})){return{ext:"cr2",mime:"image/x-canon-cr2"}}if(i([73,73,42,0])||i([77,77,0,42])){return{ext:"tif",mime:"image/tiff"}}if(i([66,77])){return{ext:"bmp",mime:"image/bmp"}}if(i([73,73,188])){return{ext:"jxr",mime:"image/vnd.ms-photo"}}if(i([56,66,80,83])){return{ext:"psd",mime:"image/vnd.adobe.photoshop"}}if(i([37,80,68,70])){return{ext:"pdf",mime:"application/pdf"}}if(i([80,75])&&(e[2]===3||e[2]===5||e[2]===7)&&(e[3]===4||e[3]===6||e[3]===8)){return{ext:"zip",mime:"application/zip"}}if(i([117,115,116,97,114],{offset:257})){return{ext:"tar",mime:"application/x-tar"}}if(i([82,97,114,33,26,7])&&(e[6]===0||e[6]===1)){return{ext:"rar",mime:"application/x-rar-compressed"}}if(i([31,139,8])){return{ext:"gz",mime:"application/gzip"}}if(i([66,90,104])){return{ext:"bz2",mime:"application/x-bzip2"}}if(i([55,122,188,175,39,28])){return{ext:"7z",mime:"application/x-7z-compressed"}}if(i([0,0,0])&&(e[3]===24||e[3]===32)&&i([102,116,121,112],{offset:4})||i([51,103,112,53])||i([0,0,0,28,102,116,121,112,109,112,52,50])&&i([109,112,52,49,109,112,52,50,105,115,111,109],{offset:16})||i([0,0,0,28,102,116,121,112,105,115,111,109])||i([0,0,0,28,102,116,121,112,109,112,52,50,0,0,0,0])){return{ext:"mp4",mime:"video/mp4"}}if(i([77,90])){return{ext:"exe",mime:"application/x-msdownload"}}return null};var e=["jpg","png","gif","bmp"];function i(i){var n=t(i);if(e.indexOf(n&&n.ext)!=-1){return n}else{return null}}iws.util.WebImageType=i})();(function(){var t=function(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var i="";var n;var r=0;while(t.length>=r+3){n=(t[r++]&255)<<16|(t[r++]&255)<<8|t[r++]&255;i+=e.charAt((n&16515072)>>18)+e.charAt((n&258048)>>12)+e.charAt((n&4032)>>6)+e.charAt(n&63)}if(t.length-r>0&&t.length-r<3){var o=Boolean(t.length-r-1);n=(t[r++]&255)<<16|(o?(t[r]&255)<<8:0);i+=e.charAt((n&16515072)>>18)+e.charAt((n&258048)>>12)+(o?e.charAt((n&4032)>>6):"=")+"="}return i};function e(t,e){var i=new Blob([t],{type:"application/octet-binary"});var n=new FileReader;n.onload=function(t){var i=t.target.result;e(i.substr(i.indexOf(",")+1))};n.readAsDataURL(i)}function i(t,e,i){var n=new Blob([e],{type:t});var r=new FileReader;r.onload=function(t){var e=t.target.result;i(t.target.result)};r.readAsDataURL(n)}iws.util.byteArrayToBase64=t;iws.util.arrayBufferToBase64=e;iws.util.arrayBufferToImageBase64=i})()})();(function(){"use strict";function t(i){return{point:function(t,e,n,r){var o=Math.PI/180*i,s=Math.cos(o),a=Math.sin(o),l=s*(n-t)-a*(r-e)+t,h=s*(r-e)+a*(n-t)+e;return{x:l,y:h}},rect:function(n,r,o){var s=t(i).point(n,r,o.left,o.top);var a=t(i).point(n,r,o.right,o.top);var l=t(i).point(n,r,o.right,o.bottom);var h=t(i).point(n,r,o.left,o.bottom);return e([s,a,l,h]).getRect()},size:function(e,n){var r=t(i).point(0,0,e,n);return{width:Math.round(Math.abs(r.x)),height:Math.round(Math.abs(r.y))}}}}iws.util.Rotate=t;function e(t){function e(t,e,i,n){if(t>i)i=[t,t=i][0];if(e>n)n=[e,e=n][0];return{left:t,top:e,right:i,bottom:n}}return{getRect:function(){var i,n,r,o;i=r=t[0].x;n=o=t[0].y;for(var s=0;s<t.length;s++){if(i>t[s].x)i=t[s].x;if(n>t[s].y)n=t[s].y;if(r<t[s].x)r=t[s].x;if(o<t[s].y)o=t[s].y}return e(i,n,r,o)}}}iws.util.Points=e;function i(t){return{round:function(){return{left:Math.round(t.left),top:Math.round(t.top),right:Math.round(t.right),bottom:Math.round(t.bottom)}},abs:function(){return{left:Math.abs(t.left),top:Math.abs(t.top),right:Math.abs(t.right),bottom:Math.abs(t.bottom)}},size:function(){return{width:t.right-t.left,height:t.bottom-t.top}},width:function(){return Math.abs(t.right-t.left)},height:function(){return Math.abs(t.bottom-t.top)},center:function(){return{x:t.left+(t.right-t.left)/2,y:t.top+(t.bottom-t.top)/2}},normal:function(){var e=t.left;var i=t.top;var n=t.right;var r=t.bottom;if(e>n)n=[e,e=n][0];if(i>r)r=[i,i=r][0];return{left:e,top:i,right:n,bottom:r}}}}iws.util.Rect=i;function n(){this.leftMouseButtonDown=false;this.mouseDownPos={x:0,y:0};this.mouseMovePos={x:0,y:0};this.mousePrevMoveOffset={x:0,y:0};this._mouseType="move";this.magnificationScale=2;this.intersectRect={}}n.prototype={get mouseType(){return this._mouseType},set mouseType(t){this._mouseType=t},isRange:function(){return this.leftMouseButtonDown&&this.mouseType=="range"},isMove:function(){return this.leftMouseButtonDown&&this.mouseType=="move"},isGlass:function(){return this.leftMouseButtonDown&&this.mouseType=="glass"},getRect:function(){return i({left:this.mouseDownPos.x,top:this.mouseDownPos.y,right:this.mouseMovePos.x,bottom:this.mouseMovePos.y}).normal()},getLT:function(){var t=this.getRect();return{x:t.left,y:t.top}},getRB:function(){var t=this.getRect();return{x:t.right,y:t.bottom}},getIntersectRect:function(t){this.intersectRect=this.getRect();if(this.intersectRect.left<t.left)this.intersectRect.left=t.left;else if(this.intersectRect.left>t.right)this.intersectRect.left=t.right;if(this.intersectRect.top<t.top)this.intersectRect.top=t.top;else if(this.intersectRect.top>t.bottom)this.intersectRect.top=t.bottom;if(this.intersectRect.right>t.right)this.intersectRect.right=t.right;else if(this.intersectRect.right<t.left)this.intersectRect.right=this.intersectRect.left;if(this.intersectRect.bottom>t.bottom)this.intersectRect.bottom=t.bottom;else if(this.intersectRect.bottom<t.top)this.intersectRect.bottom=t.top;return this.intersectRect},drawMagnifyGlass:function(t){t.getContext("2d").save();var e={};var i=60;e.x=this.mouseMovePos.x-i;e.y=this.mouseMovePos.y-i;e.width=i*2;e.height=i*2;var n={width:e.width*this.magnificationScale,height:e.height*this.magnificationScale};var r=e.x+e.width/2-n.width/2;var o=e.y+e.height/2-n.height/2;t.getContext("2d").drawImage(t,e.x,e.y,e.width,e.height,r,o,n.width,n.height);t.getContext("2d").lineWidth=2;t.getContext("2d").strokeStyle="#FF0000";t.getContext("2d").strokeRect(r,o,n.width,n.height);t.getContext("2d").restore()},drawRange:function(t,e){var i=t.getContext("2d");this.intersectRect=this.getIntersectRect(e);i.save();this._drawRect(i,this.intersectRect,"red","#FF0000");i.restore()},drawSelect:function(t,e){var i=t.getContext("2d");i.save();this._drawRect(i,e,"blue","#0000FF");i.restore()},_drawRect:function(t,e,i,n){t.beginPath();t.setLineDash([2]);t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top);t.lineWidth=1;t.strokeStyle=i;t.stroke();t.fillStyle=n;t.globalAlpha=.2;t.fill()}};iws.TrackMouse=n;function r(){this.initialize.apply(this,arguments)}r.prototype={get width(){return this.imgCanvas.width},set width(t){this.imgCanvas.width=t},get height(){return this.imgCanvas.height},set height(t){this.imgCanvas.height=t},get angle(){return this.m_angle},set angle(t){this.m_angle=(t||0)%360},get scale(){return this.m_scale},set scale(t){if(t<.1)t=.1;if(t>4)t=4;this.m_scale=t},get fitMode(){if(this.m_fitMode.name==="scale"){this.m_fitMode.scale=this.scale}return this.m_fitMode},set fitMode(t){var e=this.scale;var i=this.getDrawCenter();this.m_fitMode=t;var n=null;if(this.isValid()){switch(this.m_fitMode.name){case"auto":this.fitAuto();break;case"width":this.fitWidth();break;case"height":this.fitHeight();break;case"scale":this.fitScale();break;case"original":this.fitOriginal();break}var r=this.getDrawCenter();n={oldScale:e,changeRate:this.scale/e,oldCenter:i,center:r,offset:{x:r.x-i.x,y:r.y-i.y}}}this.page.fire("page:fitMode",{input:{mode:t},output:n})},initialize:function(t){this.page=t;if(iws.mask){this.maskImage=new Image;this.maskImage.onload=function(t){iws.log("mask ready!")};this.maskImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVMAAAAgCAYAAACvipuvAAAJ0klEQVR42u2c34tVVRTHzx0HTSYzyx9MYv6AUFGkMH8OlSRjRXilC5F5Y3y41BBCdg0TQ0O0JApNE0Eis3yY0MAMBxIMDTEcJIbwQQaffBJ68GX+gdvetA5tN9+199r3njuMuL6wQO4c1z1n//jstdfa52aZSqVSqVQqlUqlUsVUNdYAVtWmUT1kWmjsbzAXThibrM2jUpiqVApTlcJUpVKYqhSmKpXCVKVSqRSmClOVSqV6aGF6GDzEz8ameteVjO0A114y1g389oJr7xqrM58vBz5W0t/ca0eNrQfXPmXsCvC9m57H/9w+90TPxyRjR8G1p4x1ge/sB9f+aWxuAdv85eDZrZWBr/nGhsC1NXDtFGOnBe1h22IdtcdVane3D67S39YY64g8qx0784x9aOxXY3eAr4P0fdLJ85ixzcZ+Mjbi+Buhz7YYm5kwD1r1xwGhh9rnJWM/OM9u/R6idilKtu02GDtu7Lp3H/lz2DE7h/okJnvfS40d8MZA3mf28xXGOscIprOMnWfmzRDda8hflfx94PTxcJEwRdC7aWyRd900Y+fAtQhutqP2gGvtJH6GgV6fEN7W9hub4F3f4014a7eNLWOgZxeBGUIo3TK2BAzcE+Dag+DemoEpB719YCJUGF9oEeAGWq9zje2jC4xPZCdBW7rw/hz0DWc3jK0NTHYL+a0ekDm7R4t3CNBF+ePa9TVj30R8bhbCLbRYraW2k7TxKPXJlIDPBcbOCP3ZsfJsm2HaRYtEDKQhf7afd4HPC1M3gSUWAXGRUoPAWRJEPzUCzX5BZDSViSit/WZsuiBKzGGyhIAYi4bLgQFTFUTCXNTcDEwzaq/YrmEis7to0IBaKFg83d3FbGOXE0Ca2zEAmRnMOIjZHYrkfHURBFL9HWd2FkX64ybw3RaeVwrSinAxkLbLGuZZ2vUMMZh2MhDMQbpY6O8kaKfRImHKRZF+BFQPNKQPN/QwbnSHokg/UgzBe5R8xKLEWuTvfUIooS0H9wzdBcIUtaO/a5hLqQXJIsD1tRvp15hFKX8uuy0dEOxQOpsEVW6XCezuvW9vwd9Ob8dQtL+FTQDItbO0+0vVMhAopNi73jy3/XutSV9DtKspEqZdlGIZFYI0tS8uFZ03RblJNwKaEokwfLiVIzBCKQM/UuyPNIIbDSOg+FFZJRINczlXzl9dEKG3ClMuh1uORJpcu6No3++7vYKFdSW19ymCr82bPenlTlcyi6H9vm2Uo8x3Rtz2rSaYIDbSeMeJYDYyUZqfqhkrfw0a6wuofVYzqaSUXU1sfFgbJNB20HO87uWCUQAwgWoMyN8APUOJrv82IQXXLEztd7yXCNJUmO4oGqYIbm4EtIzyjxK4cdFPRZAP7RPC24+GUZR4lAZbKB/qRsO9goavBiLduwSQrECYcotADrcJlKNtCBcBNMjOeRHRXmaiDxDceqgQECsUcTuZ3WCyzabCgi2QfESFqFleYaNfGFmV6DN0bb2N/rgJfIvmjyTHvTtx3nK7EpTeKVH/2cLRlxTtWRg9Kiji+ruEUDpIWoCVwO8fBqSWRc814S+H8Apqj2mg0F6I6oEIqB8MkKsM3FD0M0Qwi+Vg80gRwXswEFHVI/DmtvF5NIygdBMM1DzKQ4P4XOI2TQpT9F35rgEN/j9A21UDO4YdHjzWJxSLbL9+bOxpYXHuNgCLRI8w0SvnbxH1HxelF+0vNIFPg0KPxJ9EPUy/SIugvlYzfY/8lWhRbzAnGIqAaUp6QupvTF6KQUWafTQQToEcWoWBG3oQ1BldwG8eKdYAvF8B4NhDfvyJe4VA4wuBoo8pwu2n7Sha8VEk3J/Y3lKYooJdvmvwn8f++w0Q1ee5pz0CeNho/tPEgW0r0u87kSRXPGwmagn54/qZi7DyRahof9KKtFuYu5TJjiSGVBZEzFkB/rixzUX35TGAaSg/y/lDp5TaIgQ327mrwI31MxGTnaybEnJBNRApvgDgeJpycodBNPw8uA8ub4OgaX2+DODYy0TPVRAJo6NTRcGUWwQ2ATjmMKiDRWAVAAh3fnYSwTGlQjxK95SnjQYz2XG0hxGmnL+LNM6leovpi76HAKYNKnB2JvhLbd+WVAUkP8REM2jbfJGOH0gr3Oihv2bgjTrbTuADCfBG+dzfQTI9n1Ro0p2hyqsESkXBdDotHP4xj4vMDgAtAofA1rIWucdOqu5uoW3xcGRw51va8brNP06+ivan2/z759/qgmE6woy9OxRMSf2hvmibuEPr3A2VBatHqMIdqkaiAR47BsSdQc0EVWZu8NQTClNcAadBnzcL09ALDOjgfeiMbqhIIdFkasOBwMrPFSG5XJet7H+f/Xf4+xOqPM/3wFIvoGDU30Z/RRSg3HEnGUfcd6KCkZV9O+ovWgTQKQxufqUUoNzonrs/f+zFCkaL6d5HmYq/9MzvmL6eKoFbXVBNTKlwVyLf526lYmdBUUHFF/cmF7dNWR6Br19cawdMJYuAn4+MLQL+aYccHFNp8Nrc62cEyO/AgH0xw8dxpkUKWTaayI8elWhSfpXF3+BCOf3c30aKolOOMhXtLwSEQcrvdRDAuIClkjiOUGoOHWWy8+ZV5v7cnRz3Qk0OrW4nXSY5GtUqTN3jT9yzuumlcQXTWLTpnwWNwU1S4Y4BuZ54f5LjSfUEKMWiPB9K7YJp7D78N8hii0BFWITMB+x2B2zcZHInkh20x5rIg7nfucErxO1swd92b5Et2l+rh/avZfe/py8dRz1Zc28/5fZj9v+Z34ygP1TQM7QKUx9+3AJtf+9h5niEKfd6KQfHcgIIkUKrIYJjCL7SaigHDS5iqwuj2HbCFBXsQnAMwZerqrcCGFRdDf0wRcx2geJCs69/HsmKfZ30SMLWUrpwbPHgLB1HpYx/Q0jSZ+jgezOvk47QbiVrI0xDkbibnhk3MA3BDeU/ObilFBu4FQflP0PRsPR4UqhTEMy4KA9Vf9sJU24R4PKf9SYKFJOpn1Mm54WMP6byhLEvEvzZSfl2xv8SkV3o7JG1e5nsyNY2sDi2w1+ognw+4nMreF7pOMqBak+k3MjSItI5gXZZlMl/7OZCho8cFQ3TECvcxXxc/aQfOkfpv3YYy7OmVLhRtTpUvKoIcljNVNM5KHF5VnQEq50w5ark3CBJ+QlDf3LOocXJvpV0HQDAFh8O0ELTIfRnj1v9AiqzwzRe3vS2nCHFfjJvc4KvIvyFJvDjlLM860B7mNpvHuMvBabu+FhH8/Gyt0DcI7Db/79U0GdZJvsJvpCvdsA0FAjlR6X0x6ZVqgdYOoFVKpVKYapSqVQKU5VKpVKYqlQqlUphqlKpVApTlUqlUqlUKpVK9SDpX8bUI9HUwnSFAAAAAElFTkSuQmCC"}this.imgCanvas=document.createElement("canvas");this.imgCanvas.getContext("2d").imageSmoothingEnabled=true;this.imgCanvas.width=0;this.imgCanvas.height=0;this.reSampleCanvas=document.createElement("canvas");this.reSampleCanvas.getContext("2d").imageSmoothingEnabled=true;this.reSampleCanvas.width=0;this.reSampleCanvas.height=0;this.originalImageData=null;this.m_scale=1;this.m_scaleStep=.1;this.m_angle=0;this.m_fitMode={name:"auto"};this.startPt={x:0,y:0};this.getEndPt=function(){var t=this.startPt.x+this.imgCanvas.width*this.scale;var e=this.startPt.y+this.imgCanvas.height*this.scale;return{x:t,y:e}};this.getRect=function(){var t=this.startPt;var e=this.getEndPt();return{left:t.x,top:t.y,right:e.x,bottom:e.y}};this.fitAuto=function(){var t=this.page.lowerCanvasEl;var e=this.getRotateSize();if(t.clientHeight/e.height*e.width<=t.clientWidth)this.fitHeight();else this.fitWidth()};this.fitHeight=function(){var t=this.page.lowerCanvasEl;var e=this.getRotateSize();this.scale=t.clientHeight/e.height;this._fixPosition(t)};this.fitWidth=function(){var t=this.page.lowerCanvasEl;var e=this.getRotateSize();this.scale=t.clientWidth/e.width;this._fixPosition(t)};this.fitScale=function(){if(this.m_fitMode.scale){this.scale=this.m_fitMode.scale}var t=this.page.lowerCanvasEl;this._fixPosition(t)};this.fitOriginal=function(){this.scale=96/this.xres;this.scaleX=96/this.xres;this.scaleY=96/this.yres;var t=this.width*96/this.xres;var e=this.height*96/this.yres;this.fitScale()};this._fixPosition=function(t){var e=this.startPt;var n=this.getDrawRect();if(i(n).height()>t.height){if(n.top>0){this.startPt.y=this.startPt.y-n.top}else if(n.bottom<t.height){this.startPt.y+=t.height-n.bottom}}else{this.startPt.y=t.height/2-this.height/2*this.scale}if(i(n).width()>t.width){if(n.left>0){this.startPt.x=this.startPt.x-n.left}else if(n.right<t.width){this.startPt.x+=t.width-n.right}}else{this.startPt.x=t.width/2-this.width/2*this.scale}return{offsetX:this.startPt.x-e.x,offsetY:this.startPt.y-e.y}};this.ImageProps={xres:true,yres:true}},clear:function(){this.width=0,this.height=0;this.clearResample();this.originalImageData=null},clearResample:function(){this.reSampleCanvas.width=0,this.reSampleCanvas.height=0},isValid:function(){return this.width>0&&this.height>0},isValidResample:function(){return this.reSampleCanvas.width>0&&this.reSampleCanvas.height>0},setSrc:function(t,e,i){var n=this;var r=new Image;r.onload=function(){n.clear();n.width=this.width,n.height=this.height,n.angle=e;var t=n.imgCanvas.getContext("2d");n.imgCanvas.width=this.width;n.imgCanvas.height=this.height;t.drawImage(this,0,0,this.width,this.height);if(n.maskImage){t.globalAlpha=.5;t.drawImage(n.maskImage,0,this.height-n.maskImage.height);t.globalAlpha=1}n.page.fire("page:setRawData");n.fitRefresh();i&&i()};r.src=t},setRawData:function(t,e,i,n,r){this.clear();this.width=t,this.height=e,this.angle=n;var o=this.imgCanvas.getContext("2d").createImageData(this.imgCanvas.width,this.imgCanvas.height);o.data.set(i);this.imgCanvas.getContext("2d").putImageData(o,0,0);this.page.fire("page:setRawData");this.fitRefresh();r&&r()},setRawDataReSample:function(t,e,i){this.reSampleCanvas.width=t;this.reSampleCanvas.height=e;var n=this.reSampleCanvas.getContext("2d").createImageData(t,e);n.data.set(i);this.reSampleCanvas.getContext("2d").putImageData(n,0,0)},getImageData:function(){if(!this.isValid())return null;var t=this.imgCanvas.getContext("2d").getImageData(0,0,this.width,this.height);return t},getOriginalImageData:function(){if(!this.originalImageData){this.originalImageData=this.getImageData()}return this.originalImageData},putImageData:function(t){this.imgCanvas.getContext("2d").putImageData(t,0,0)},rotate:function(t){this.m_angle+=t;this.page.fire("page:rotate",{input:{angle:t}});this.fitRefresh()},zoom:function(t,e){var n=this.page.lowerCanvasEl;e=e||{x:n.width/2,y:n.height/2};var r=this.getDrawCenter();var o=this.getDrawRect();var s=this.scale;if(t==="in"){this.scale=this.scale*(1+this.m_scaleStep)}else if(t==="out"){this.scale=this.scale*(1-this.m_scaleStep)}else if(typeof t==="object"){if(t.name==="custom"){this.scale=t.scale}}var a=this.getDrawRect();var l=(e.x-o.left)/(o.right-o.left);var h=(e.y-o.top)/(o.bottom-o.top);var c=e.x-i(a).width()*l;var u=e.y-i(a).height()*h;this.startPt.x+=c-a.left;this.startPt.y+=u-a.top;this._fixPosition(n);this.fitMode={name:"scale",scale:this.scale};var f=this.getDrawCenter();var d={oldScale:s,changeRate:this.scale/s,oldCenter:r,center:f,offset:{x:f.x-r.x,y:f.y-r.y}};this.page.fire("page:zoom",{input:{type:t,point:e},output:d})},move:function(t){var e={x:this.startPt.x,y:this.startPt.y};this.startPt.x+=t.X;this.startPt.y+=t.Y;var i=this.page.lowerCanvasEl;this._fixPosition(i);var n={x:this.startPt.x-e.x,y:this.startPt.y-e.y};this.page.fire("page:move",{input:{delta:t},output:{offset:n}})},fixPosition:function(){var t={x:this.startPt.x,y:this.startPt.y};var e=this.page.lowerCanvasEl;this._fixPosition(e);var i={x:this.startPt.x-t.x,y:this.startPt.y-t.y};this.page.fire("page:move",{input:{orgPt:t},output:{offset:i}})},fitRefresh:function(t){this.fitMode=this.fitMode},render:function(t){if(this.isValid()){t.save();var e=this.getDrawCenter();t.translate(e.x,e.y);t.rotate(this.angle*Math.PI/180);t.translate(-e.x,-e.y);t.translate(this.startPt.x,this.startPt.y);t.scale(this.scale,this.scale);t.drawImage(this.imgCanvas,0,0);t.restore();if(this.isValidResample()){t.save();var e=this.getDrawCenter();t.translate(e.x,e.y);t.rotate(this.angle*Math.PI/180);t.translate(-e.x,-e.y);t.translate(this.startPt.x,this.startPt.y);var i=this.getScaleSize();var n=i.width/this.reSampleCanvas.width;t.scale(n,n);t.drawImage(this.reSampleCanvas,0,0);t.restore()}this.page.fire("page:render",{})}},getDrawCenter:function(){var t=this.getRect();var e=i(t).center();return e},getRotateSize:function(){return t(this.angle).size(this.width,this.height)},getScaleSize:function(){return{width:Math.round(this.width*this.scale),height:Math.round(this.height*this.scale)}},getDrawPoints:function(){var e=this.getDrawCenter();var i=this.getRect();var n=t(this.angle).point(e.x,e.y,i.left,i.top);var r=t(this.angle).point(e.x,e.y,i.right,i.top);var o=t(this.angle).point(e.x,e.y,i.right,i.bottom);var s=t(this.angle).point(e.x,e.y,i.left,i.bottom);return[n,r,o,s]},getDrawRect:function(){var t=this.getDrawPoints();var i=e(t).getRect();return i},isInDrawImage:function(t,e){var i=false;var n=this.getDrawPoints();t.save();t.beginPath();t.moveTo(n[0].x,n[0].y);t.lineTo(n[1].x,n[1].y);t.lineTo(n[2].x,n[2].y);t.lineTo(n[3].x,n[3].y);t.closePath();if(t.isPointInPath(e.x,e.y)){i=true}t.restore();return i},getImagePoint:function(t){var e={x:0,y:0};if(this.angle===0){e.x=t.x-this.startPt.x;e.y=t.y-this.startPt.y}else{var i=this.getDrawRect();e.x=t.x-i.left;e.y=t.y-i.top}var n={x:0,y:0};n.x=e.x/this.scale;n.y=e.y/this.scale;return{x:n.x,y:n.y}},getImageRect:function(t){var e=this.getImagePoint({x:t.left,y:t.top});var n=this.getImagePoint({x:t.right,y:t.bottom});var r=i({left:e.x,top:e.y,right:n.x,bottom:n.y}).normal();return r},getBasicPoint:function(){var t=1/this.scale;var e=i(this.getDrawRect()).size();var n={width:e.width*t/2,height:e.height*t/2};var r=this.getDrawCenter();return{x:r.x-n.width,y:r.y-n.height,rate:t}}};iws.ImageControl=r})();(function(t){"use strict";var e=t;var i="1.0";var n;if(typeof exports!=="undefined"){n=exports}else{n=e.iwsT={}}n.getVersion=function(){return i};n.debug=false;n._transform=function(t,e,i,n,r){var o=0,s=0,a=1;var l=i/t;var h=n/e;if(r===90||r===270||r===-90||r===-270){l=n/t,h=i/e}a=Math.min(l,h);o=(i-t)/2;s=(n-e)/2;return{x:o,y:s,ratio:a}};n.defaults={debug:false,direction:"V",beforehandLoad:true,plugin:false};n._makeSrc=function(t,e,i,n){if(t.length===0)return"";var r=document.createElement("canvas");var o=r.getContext("2d").createImageData(e,i);o.data.set(t);r.width=e;r.height=i;r.getContext("2d").putImageData(o,0,0);return r.toDataURL("image/jpeg",n)};n._getDimension=function(t,e,i,n){var r=0,o=0,s=0,a=0,l=t/i,h=e/n,c=Math.max(l,h);if(c>1){r=t/c;o=e/c}else{r=t;o=e}s=(i-r)/2;a=(n-o)/2;return{w:r,h:o,x:s,y:a}};n._makeSrcFromImage=function(t,e,i,n){var r=document.createElement("canvas");r.width=e;r.height=i;var o=r.getContext("2d");o.drawImage(t,0,0,e,i);return r.toDataURL("image/jpeg",n)};n._makeThumbnail=function(t,e){var i=new Image;i.onload=e(index);i.src=data.src};n._MakeThumbFrame=function(t,e){var i=document.createElement("div");var n=iws.util.Unique.getFrameId();$(i).attr("id",n).addClass("thumb_frame");if(e==="V"){$(i).css("left","0"),$(i).css("right","0")}else if(e==="H"){$(i).css("top","0"),$(i).css("bottom","0"),$(i).css("white-space","nowrap")}t.append(i);return{div:i,id:n,class:"thumb_frame"}};n.Thumbnail=function(t,e){var i=$.extend({},n.defaults,e);"use strict";var r=$(t);iws.util.ListenDropFile(r[0],function(t){F();W(t.result)});var o=function(){return{auto:function(t,e){if(t<e){o().next(e)}if(t>e){o().prev(e)}},prev:function(t){if(i.direction==="V"){var e=$(T.div).children('[uniqueId="'+f.item[t].uniqueId+'"]');var n=e[0].offsetTop;var o=r.scrollTop()-n;if(o>0){r.scrollTop(n-4)}}},next:function(t){if(i.direction==="V"){var e=$(T.div).children('[uniqueId="'+f.item[t].uniqueId+'"]');var n=e[0].offsetTop;var o=e.outerHeight();var s=r.innerHeight();var a=r.scrollTop()+s-(n+o);if(a<0){var l=n+o-s;r.scrollTop(l+4)}}}}};r.attr("tabindex","0").keydown(function(t){var e=f.focusIndex;var i=e;switch(t.keyCode){case 39:case 40:if(f.focusIndex+1<f.item.length){i=f.focusIndex+1}break;case 37:case 38:if(f.focusIndex>0){i=f.focusIndex-1}break}if(e!==i){O(f.item[i].uniqueId).trigger("click")}return false});function s(){var t=[];for(var e=0;e<f.item.length;e++){if(f.item[e].started===false){t.push({cmd:"loadAndMakeThumb",buffer:f.item[e].filebuffer,id:{index:e,uniqueId:f.item[e].uniqueId}})}}t.forEach(function(t){t.__id=y.addWork(t)});return t.length}var a=null;var l=function(t){var e=t.scrollTop();var i=t.innerHeight();if(a!==null)clearTimeout(H);var n=-1;for(var r=0;r<f.item.length;r++){var o=$(T.div).children('[uniqueId="'+f.item[r].uniqueId+'"]');var s=o[0].offsetTop;var l=o.outerHeight();var h=e-(s+l);if(h<0){n=r;break}}var c=[];if(n!==-1){for(var r=n;r<f.item.length;r++){var u=f.item[r].uniqueId;var o=$(T.div).children('[uniqueId="'+u+'"]');var s=o[0].offsetTop;var l=o.outerHeight();var d=e+i-(s+4);if(d>0){if(f.item[r].imgsrc===""){c.push({cmd:"loadAndMakeThumb",buffer:f.item[r].filebuffer,id:{index:r,uniqueId:f.item[r].uniqueId}})}}}}y.clearData("loadAndMakeThumb");c.forEach(function(t){t.__id=y.addWork(t)})};r.on("focus blur scroll",function(t){switch(t.type){case"focus":n.debug&&console.log("on focused...");break;case"blur":n.debug&&console.log("on blured...");break;case"scroll":n.debug&&console.log("on scroll...("+$(this).scrollTop()+", "+$(this).innerHeight()+")");if(i.direction==="V"){a=setTimeout(l(r),100)}break}});var h=function(t,e){return function(i){i.preventDefault();i.stopPropagation();var n=f.focusIndex;if(t===-1||e===""){f.focusIndex=-1;Y(n)}else{var r=I(e);f.focusIndex=r;Y(n);Y(r);z(r,n);o().auto(n,f.focusIndex)}}};r.click(h(-1,""));r.on("mousemove",function(t){t.preventDefault()});var c=function(t,e,i){this.uniqueId=iws.util.Unique.getUniqueID();this.imgWidth=t||0;this.imgHeight=e||0;this.imgsrc="";this.filebuffer=i;this.pagebuffer=null;this.angle=0;this.angleDisplay=0;this.selected=false;this.pageInfo=null;this.pageSrc="";this.annotation="";this.started=false};var u=function(t){this.width=200;this.height=160;this.direction=t||"V";this.focusIndex=-1;this.item=[];this.checkVisible=false};var f=new u(i.direction);function d(){}d.prototype=iws.Observable;var g=new d;var p=function(){};var v=function(){};var m=function(){};var b=null;if(i.path){var w=iws.util.work.Spliter(iws.util.string.combinePath(i.path,"/engine/iws.w.split.js"),false);var y=null;var _=null;var x="";var C=iws.util.string.combinePath(i.path,"/engine/iws.w.loader.js");var k=iws.util.string.combinePath(i.path,"/engine/iws.w.loader.plugin.js");b=function t(e){if(y!==null)y.close();if(_!==null)_.close();if(e===0){x=C}else if(e===1){x=k}y=new iws.util.work.WorkCrew(x,1,2,false);if(i.beforehandLoad===true){_=new iws.util.work.WorkCrew(x,2,2,false)}y.onstarted=function(t){if(t.cmd==="loadAndMakeThumb"){var e=f.item[t.id.index];if(e!==undefined){e.started=true;iws.util.run_waitMe(O(t.id.uniqueId),"facebook")}}else if(t.cmd==="loadpage"){g.fire("loadpage_start",t.id.uniqueId)}};y.onfinish=function(){var t=s();if(t===0)v(-1,f.item.length,"loadcomplite")};y.oncanceled=function(t){if(t.cmd==="loadpage"){R=false;var e=t.id;setTimeout(B(),0)}};y.oncomplete=function(t,e){var i=e.data,r=i.id,o=I(r.uniqueId);var s=f.item[o];if(s===undefined){return}s.pageInfo=i.pageInfo;if(i.cmd==="loadAndMakeThumb"){if(i.src){s.pageSrc=i.src;var a=200;var l=new Image;l.onload=function(t){return function(e){var i=f.item[t];if(i===undefined)return;var r=l.naturalWidth;var o=l.naturalHeight;var s=n._getDimension(this.width,this.height,a,a);i.imgWidth=s.w,i.imgHeight=s.h;i.imgsrc=n._makeSrcFromImage(this,s.w,s.h,20);S(t)}}(o);l.src=i.src}else{s.imgWidth=i.xsize,f.item[o].imgHeight=i.ysize;s.imgsrc=n._makeSrc(i.bytearray,i.xsize,i.ysize,20);s.pagebuffer=i.pagearray;S(o)}}else if(i.cmd==="loadpage"){R=false;s.pagebuffer=i.pagearray;s.pageInfo=i.pageInfo;if(L.length>0){setTimeout(B(),0)}g.fire("loadpage_end",r.uniqueId)}}};b(i.plugin===true?1:0)}function S(t){var e=O(f.item[t].uniqueId);var i=e.children("div.thumb_border_wrap").children("div.thumb_border");var r=n._transform(f.item[t].imgWidth,f.item[t].imgHeight,i.width(),i.height(),f.item[t].angle);var o=i.children("div.thumb_img_wrap").children("img");o.attr("src",f.item[t].imgsrc);o.css("transform","translate("+r.x+"px, "+r.y+"px) scale("+r.ratio+") rotate("+f.item[t].angleDisplay+"deg)");iws.util.hide_waitMe(e);v(t,f.item.length,f.item[t]);if(t===0){e.trigger("click")}}var T=n._MakeThumbFrame(r,f.direction);var M=$(T.div);var O=function(t){return M.children('[uniqueId="'+t+'"]').children("div.thumb_layout")};if(iws.scroll){t.addClass("contentHolder");iws.scroll.initialize(t)}var E={w:M.width(),h:M.height()};function P(){n.debug&&console.log("ChangeSize ... ("+E.w+", "+E.h+")");if(f===null)return;for(var t=0;t<f.item.length;t++)Y(t)}function A(){var e=M.width();var n=M.height();if(i.direction==="V"&&e!=E.w){P();E.w=M.width()}if(i.direction==="H"&&n!=E.h){P();E.h=M.height()}iws.scroll&&iws.scroll.update(t)}var j=setInterval(A,1e3);function I(t){for(var e=0;e<f.item.length;e++){if(f.item[e].uniqueId===t){return e}}return-1}function F(){if(w)w.init();if(y)y.init();if(_)_.init();$(T.div).empty();f.focusIndex=-1;for(var t=f.item.length-1;t>=0;t--){f.item.splice(t,1)}}var R=false;var D=null;var L=[];var B=function(){var t=L[L.length-1];if(t.thumbinfo.pagebuffer!==null||t.thumbinfo.pageSrc!==""){p(t.index,f.item[t.index],t.oldIndex);if(i.beforehandLoad===true){H=setTimeout(U(t.index,t.oldIndex),10)}else{f.item[t.index].pagebuffer=null}L.splice(0,L.length)}else{if(R===false){R=true;var e=[];e.push({cmd:"loadpage",buffer:f.item[t.index].filebuffer,id:{index:t.index,uniqueId:f.item[t.index].uniqueId}});e.forEach(function(t){t.__id=y.unshiftWork(t)})}}};var z=function(t,e){if(D!==null){clearTimeout(D)}L.push({index:t,oldIndex:e,thumbinfo:f.item[t]});D=setTimeout(B(),0)};function W(t){if(w){w.callBackonmessage(function(t){var e=t.data;var i=e.bufferarray;var n=f.item.length;var r=[];for(var o=0;o<i.length;o++){var s=n+o;q(s,i[o].buffer)}m&&m(f.item.length)});w.callBackonerror(function(t){console.log("An splite error occurred.")});w.postMessage({cmd:"split",buffer:t})}else{q(f.item.length,t);m&&m(f.item.length)}}function q(t,e){var i=f.item[t]=new c(0,0,e);var r=N(t,i.uniqueId);if(y){var o={cmd:"loadAndMakeThumb",buffer:i.filebuffer,id:{index:t,uniqueId:i.uniqueId}};o.__id=y.addWork(o)}else{var s=iws.util.WebImageType(e);if(s){iws.util.arrayBufferToImageBase64(s.mime,new Uint8Array(e),function(t){return function(e){var i=f.item[t];if(i===undefined){return}i.pageSrc=e;var r=200;var o=new Image;o.onload=function(t){return function(e){var o=f.item[t];if(o===undefined)return;var s=n._getDimension(this.width,this.height,r,r);o.imgWidth=s.w,o.imgHeight=s.h;o.imgsrc=n._makeSrcFromImage(this,s.w,s.h,20);i.pageInfo={result:true,width:this.width,height:this.height,bpp:24,xres:96,yres:96};S(t)}}(t);o.src=i.pageSrc}}(t))}else{}}}function Y(t){if(t<0||t>=f.item.length)return;var e=f.item[t];var i=O(e.uniqueId);if(f.focusIndex==t){i.addClass("thumb_layout_focused")}else{i.removeClass("thumb_layout_focused")}var r=i.children("div.thumb_border_wrap").children("div.thumb_border");if(e.selected===true){
r.addClass("thumb_border_select")}else{r.removeClass("thumb_border_select")}var o=n._transform(e.imgWidth,e.imgHeight,r.width(),r.height(),e.angle);var s=r.children("div.thumb_img_wrap").children("img");s.css("transform","translate("+o.x+"px, "+o.y+"px) scale("+o.ratio+") rotate("+e.angleDisplay+"deg)")}function X(t,e){var i=$("<div/>",{class:"thumb_border_wrap",id:"thumb_border_wrap_"+t});var r=$("<input/>",{type:"checkbox",class:"thumb_check",id:"thumb_check"+t});r.css("visibility",f.checkVisible===true?"visible":"hidden");r.click(function(t,e){return function(t){var i=I(e);if($(this).is(":checked")==true){f.item[i].selected=true}else{f.item[i].selected=false}Y(i);t.stopPropagation()}}(t,e));i.append(r);var o=$("<img/>",{class:"thumb_img",id:"thumb_img_"+t});o.attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAoRJREFUaIHtmb+LE0EUx79vNH9BmqQ67g/QK61O7c+TaLGlEBFskgkxhWWyXHVFiDvZziJic7KgKLlGBEl5ndr5DwgLknASC9Fknk0iOU3uZjP54ZL9QCDsvnnvfZd5810SICFhs6EowcxMvu/vM/MOM1+yKTwYDJ5WKpUvNjmACAKYmZRSr4goZ1t0xAchxPVCofDdJomxgGazeZuZ3zBzpdfrKdd1B/MU9DyvRkRVrfUvInqbzWZzjuMM58kFAMI0kJl3AMCm+TOFhXhARLfCMGxY5TENHO/5RTQPAFLK58x8AKDoeV5x3jzGApaBlLKqtT5i5oZSam+eHJdtGvA8r2YSJ4ToFIvFzt/XiYhbrdb9fr+/pbV+0Wg0dsvl8scoPVgJIKKqSZzWGgA60+7l8/kfnuflhBAnAI7r9fq1KMerlQApZSQfmUWpVPqqlNrTWp+kUqm27/vGx+vKZ4CIGACq1eqZhyel/CyEuAvgynA4PAqCwMgo1zHEnwAgnU4/miLiPTM/jHK8Wm0hpRSbxDGzWyqVagCQyWTaYRi2ARym0+lDpdSsZUUA8qLcVgKY2TWJE0J0xt8dxxkGQXAnDMN9Zr6KKbuAiG4CuGGS20rA+KlGZfTq8Hr0+YfR64aRgLUa2SJYiZGZMMvsLmIlRmbCeWZ3Hv+FkdkQ+xmIvYCVGJkJk2YXhZUYmQmTZheFtRjZItnsGUiMbILEyOJK7AUkRmazfpLEyOJKYmQ26ydJjCyubI4AIvoGAL7vby2vnT9sAzg1CTSeAa31SyHEgdb6nVIqYOaF/NU0hW0iugfgiUlwpCFUSu0CUACm/qa5IE4BPOt2u49d1/25pBoJCWN+AzouHvLW3VsUAAAAAElFTkSuQmCC");o.css("opacity","0.0");var s=$("<div/>",{class:"thumb_img_wrap"});s.append(o);var a=$("<div/>",{class:"thumb_border"});a.append(s);i.append(a);o.load(function(t){return function(e){var i=I(t);if(i>=0){f.item[i].imgWidth=this.width;f.item[i].imgHeight=this.height;var r=O(t).children("div.thumb_border_wrap").children("div.thumb_border");var o=n._transform(this.width,this.height,r.width(),r.height(),f.item[i].angle);var s=r.children("div.thumb_img_wrap").children("img");s.css("transform","translate("+o.x+"px, "+o.y+"px) scale("+o.ratio+") rotate("+f.item[i].angleDisplay+"deg)");s.css("opacity","1.0")}}}(e));var l=$('<div class="thumb_number" id="thumb_number_'+t.toString()+'">'+(t+1)+"</div>");i.append(l);return i}var H=null;var U=function(t,e){if(t===e)return;var n=(new Date).getTime();_.onstarted=function(t){if(i.debug===true){iws.util.run_waitMe(O(t.id.uniqueId),"pulse")}};_.onfinish=function(){var t=(new Date).getTime();console.log("preload.onfinish time is "+(t-n)/1e3)};_.oncomplete=function(t,e){var n=e.data,r=n.id;f.item[r.index].pagebuffer=n.pagearray;f.item[r.index].pageInfo=n.pageInfo;if(i.debug===true){iws.util.hide_waitMe(O(f.item[r.index].uniqueId))}console.log(r.index+".work preload.onfinish complete."+r.index+", maketime = "+n.maketime)};_.oncanceled=function(t){var e=t.id;if(i.debug===true){iws.util.hide_waitMe(O(f.item[e.index].uniqueId))}};if(H!==null)clearTimeout(H);_.initAsync();var r=[];var o=true;if(t<e)o=false;var s=Math.max(t-(o===true?1:3),0);var a=Math.min(t+(o===true?3:1),f.item.length-1);if(o===true){for(var l=t+1;l<=a;l++){if(f.item[l].pagebuffer===null)r.push({cmd:"loadpage",buffer:f.item[l].filebuffer,id:{index:l,uniqueId:f.item[l].uniqueId}})}for(var l=t-1;l>=s;l--){if(f.item[l].pagebuffer===null)r.push({cmd:"loadpage",buffer:f.item[l].filebuffer,id:{index:l,uniqueId:f.item[l].uniqueId}})}}else{for(var l=t-1;l>=s;l--){if(f.item[l].pagebuffer===null)r.push({cmd:"loadpage",buffer:f.item[l].filebuffer,id:{index:l,uniqueId:f.item[l].uniqueId}})}for(var l=t+1;l<=a;l++){if(f.item[l].pagebuffer===null)r.push({cmd:"loadpage",buffer:f.item[l].filebuffer,id:{index:l,uniqueId:f.item[l].uniqueId}})}}for(var l=0;l<f.item.length;l++){if(l<s||l>a){if(f.item[l].pagebuffer!==null){f.item[l].pagebuffer=null;console.log("pagebuffer = null index="+l)}}}r.forEach(function(t){t.__id=_.addWork(t)})};function N(t,e){var i=$("<div/>",{class:"thumb_layout_wrap",id:"thumb_layout_wrap_"+t.toString()});i.attr("uniqueId",e);i.attr("index",t.toString());var n=$("<div>",{class:"thumb_layout",id:"thumb_layout_"+t});n.click(h(t,e));i.append(n);M.append(i);if(f.direction==="V"){i.css("height",f.height+"px")}else if(f.direction==="H"){i.css("width",f.width+"px"),i.css("height","100%"),i.css("display","inline-block")}var r=X(t,e);n.append(r);return i}var V=function(t){return(f.checkVisible===true?false:f.focusIndex===t)||f.item[t].selected===true};function G(t,e){for(var i=0;i<f.item.length;i++){if(V(i)){f.item[i].angleDisplay=f.item[i].angleDisplay+t;f.item[i].angle=(f.item[i].angle+t)%360;if(f.item[i].angle<0)f.item[i].angle=360+f.item[i].angle;Y(i);e&&e(t,f.item[i])}}}function K(){for(var t=f.item.length-1;t>=0;t--){if(V(t)){M.children("div.thumb_layout_wrap").remove('[uniqueId="'+f.item[t].uniqueId+'"]');f.item.splice(t,1)}}for(var t=0;t<f.item.length;t++){var e=O(f.item[t].uniqueId).children("div.thumb_border_wrap").children("div.thumb_number");e.text((t+1).toString())}}return{setOption:function(t){i=$.extend({},i,t)},init:function(){F()},load:function(t){F();W(t)},append:function(t){W(t)},setCallbackClick:function(t){p=t},setCallbackLoad:function(t){v=t},setCallbackSplit:function(t){m=t},setWidth:function(t){f.width=t},setHeight:function(t){f.height=t},rotate:function(t,e){G(t,e)},remove:function(){K();if(f.focusIndex>=0){if(f.focusIndex>=f.item.length){f.focusIndex=f.item.length-1}if(f.focusIndex>=0){O(f.item[f.focusIndex].uniqueId).trigger("click")}else{p(-1,"removeAll",-1)}}},setSelect:function(t,e){f.item[t].selected=e;var i=O(f.item[t].uniqueId).children("div.thumb_border_wrap").children(".thumb_check");i.prop("checked",e);Y(t)},getSelect:function(t){return f.item[t].selected},get pageIndex(){return f.focusIndex},set pageIndex(t){if(t>=0&&t<f.item.length){O(f.item[t].uniqueId).trigger("click")}},pageCount:function(){return f.item.length},get selectVisible(){return f.checkVisible},set selectVisible(t){f.checkVisible=t;for(var e=0;e<f.item.length;e++){var i=O(f.item[e].uniqueId).children("div.thumb_border_wrap").children(".thumb_check");if(f.checkVisible===true){i.css("visibility","visible")}else{i.css("visibility","hidden")}}},getItem:function(t){return f.item[t]},setLoadType:function(t){b(t)},print:function(){var t=[];for(var e=0;e<f.item.length;e++){if(V(e))t.push({cmd:"print",buffer:f.item[e].filebuffer,id:{index:e,uniqueId:f.item[e].uniqueId,angle:f.item[e].angle,annotation:f.item[e].annotation,pageinfo:f.item[e].pageInfo}})}if(t.length>0){iws.util.print.image(x,t,{printAutoFit:i.printAutoFit})}},pageSave:function(t,e){var i=f.focusIndex;if(i==-1)e(false,null);else{e(true,f.item[i].filebuffer)}},pageSaveTiff:function(t){var e=3;var i=[];var n=[];for(var r=0;r<f.item.length;r++){if(V(r))n.push({cmd:"savepage",buffer:f.item[r].filebuffer,id:{index:r,uniqueId:f.item[r].uniqueId,angle:f.item[r].angle},format:e})}var o=new iws.util.work.WorkCrew(C,1,1,false);o.oncomplete=function(t,e){var n=e.data,r=n.id;i.push({id:n.id,filearray:n.filearray})};o.onfinish=function(){o.close();w.init();w.callBackonmessage(function(e){var i=e.data;t(i.success,i.bufferarray)});w.callBackonerror(function(e){console.log("An merge error occurred.");t(false,"exception")});w.postMessage({cmd:"merge",buffer:i})};n.forEach(function(t){t.__id=o.addWork(t)})},annotationSave:function(t){var e=true;var i=new Array;f.item.forEach(function(t){i.push(t.annotation);if(t.annotation!==""){e=false}});var n="";if(!e){n=JSON.stringify(i)}t(n)},annotationLoad:function(t){var e=JSON.parse(t);for(var i=0;i<e.length;i++){if(f.item[i])f.item[i].annotation=e[i]}},findIndex:function(t){return I(t)},getObserver:function(){return g},destroy:function(){r.off("dragover drop keydown focus blur scroll click mousemove");M.remove();for(var t=f.item.length-1;t>=0;t--){f.item.splice(t,1)}f=null;if(w!==null){w.close();w=null}if(y!==null){y.close();y=null}if(_!==null){_.close();_=null}clearInterval(j)}}}})(window);(function(){"use strict";function t(){this.initialize.apply(this,arguments)}iws.Page=iws.util.createInheritClass(t,iws.Observable,{containerClass:"page-container",lowerCanvasEl:null,viewportTransform:[1,0,0,1,0,0],backgroundVpt:true,overlayVpt:true,backgroundColor:"",imageCtrl:null,stopRendering:true,dirty:false,autoResize:true,reSampleUse:true,reSampleRate:.8,reSampleFilter:"convolveFloat32",info:{},initialize:function(t,e){e||(e={});this.imageCtrl=new iws.ImageControl(this);this.trackMouse=new iws.TrackMouse;this._initWrapperElement(t);this._initOptions(e);this._initEventListeners();this._initResample();if(!window.requestAnimationFrame){window.requestAnimationFrame=function(t){var e=(new Date).getTime();var i=Math.max(0,16-(e-r));var n=window.setTimeout(function(){t(e+i)},i);var r=e+i;return n}}this.mainToolbar=new iws.toolbar.page(this);this.setTrackMode("move");this.fire("annotation:use",false);if(typeof this.visibleToolbar!=="undefined"){this.fire("toolbar:visible",this.visibleToolbar)}if(typeof this.fitMode!=="undefined"){this.setFitMode(this.fitMode)}if(this.autoResize){this.resizer=new iws.util.resize(this.fullScreenEl,this._reSize.bind(this))}this._reSize();if(typeof window.Hammer!=="undefined"){this.touchInfo=new function(){return{isStarted:false,scale:0,pinchScale:0,timerId:0,center:{x:0,y:0}}};var i=new Hammer(this.lowerCanvasEl,{domEvents:true});i.on("swipeleft",function(){var t=this.imageCtrl.getDrawRect();var e=t.right-t.left;var i=t.bottom-t.top;if(this.getTrackMode()==="move"&&e<=this.width){this.fire("page:swipe_left")}}.bind(this));i.on("swiperight",function(){var t=this.imageCtrl.getDrawRect();var e=t.right-t.left;var i=t.bottom-t.top;if(this.getTrackMode()==="move"&&e<=this.width){this.fire("page:swipe_right")}}.bind(this));i.get("pinch").set({enable:true});i.on("pan",function(t){}.bind(this));i.on("panend",function(t){});i.on("pinchstart",function(t){this.touchInfo.isStarted=true}.bind(this));i.on("pinch",function(t){if(this.getTrackMode()==="move"){this.touchInfo.pinchScale=t.scale;var e=$(this.lowerCanvasEl).offset();this.touchInfo.center={x:t.center.x-e.left,y:t.center.y-e.top};clearTimeout(this.touchInfo.timerId);this.touchInfo.timerId=setTimeout(function(){var t=this.touchInfo.scale*this.touchInfo.pinchScale;this._zoom({name:"custom",scale:t},this.touchInfo.center)}.bind(this),1)}}.bind(this));i.on("pinchend",function(t){this.touchInfo.isStarted=false}.bind(this));i.on("doubletap",function(t){console.log("doubletap");if(this.getTrackMode()==="move"){var e=this.getFitMode();if(e.name!=="auto"){this.setFitMode({name:"auto"})}else{var i=$(this.lowerCanvasEl).offset();var n={x:t.center.x-i.left,y:t.center.y-i.top};this._zoom({name:"custom",scale:1},n)}}}.bind(this))}},_initWrapperElement:function(t){this.wrapperEl=t;iws.util.makeElementUnselectable(this.wrapperEl);$(this.wrapperEl).css("overflow","hidden");this.fullScreenEl=iws.util.makeElement("div",{class:"page-fullScreen"});this.wrapperEl.appendChild(this.fullScreenEl);this.pageContainer=iws.util.makeElement("div",{class:"page-container"});this.fullScreenEl.appendChild(this.pageContainer);this._createLowerCanvas(this.pageContainer);this.tooltipBox=iws.util.makeElement("div",{class:"iws-viewer-tooltip"});iws.util.makeElementUnselectable(this.tooltipBox);this.pageContainer.appendChild(this.tooltipBox);this.pageContainer.addClass("contentHolder");iws.scroll&&iws.scroll.initialize(this.pageContainer,{handlers:["click-rail","drag-scrollbar"],customInfo:{getContentInfo:function(){var t=this.imageCtrl.getDrawRect();var e=t.right-t.left;var i=t.bottom-t.top;return{scrollWidth:e,scrollHeight:i,scrollLeft:-t.left,scrollTop:-t.top}}.bind(this),setContentInfo:function(t){var e=this.imageCtrl.getDrawRect();if(t.direction==="top"){var i=e.top-t.value;this.imageCtrl.move({X:0,Y:-i});this.renderAll()}else if(t.direction==="left"){var n=e.left-t.value;this.imageCtrl.move({X:-n,Y:0});this.renderAll()}}.bind(this)}});this.observe("page:render",function(){iws.scroll&&iws.scroll.update(this.pageContainer)});if(iws.pageFilter){this.pageFilter=new iws.pageFilter(this)}},_createLowerCanvas:function(t){this.lowerCanvasEl=iws.util.makeElement("canvas",{class:"lower-canvas"});this.contextContainer=this.lowerCanvasEl.getContext("2d");this.contextContainer.imageSmoothingEnabled=true;t.appendChild(this.lowerCanvasEl)},_reSize:function(){var t=this.fullScreenEl.clientWidth;var e=this.fullScreenEl.clientHeight;var i=t;var n=e;if(this.mainToolbar.isVisible()){n=e-this.mainToolbar.height()}this.pageContainer.style.width=i+"px";this.pageContainer.style.height=n+"px";this.lowerCanvasEl.width=i;this.lowerCanvasEl.height=n;this.lowerCanvasEl.style.width=i+"px";this.lowerCanvasEl.style.height=n+"px";this.width=parseInt(t,10)||0;this.height=parseInt(e,10)||0;this.imageCtrl.fitRefresh();this.renderAll()},_initOptions:function(t){for(var e in t){this[e]=t[e]}this.viewportTransform=this.viewportTransform.slice()},_initEventListeners:function(){$(this.lowerCanvasEl).on("mousedown touchstart",this.onMouseDown.bind(this));$(this.lowerCanvasEl).on("mousemove touchmove",this.onMouseMove.bind(this));$(this.lowerCanvasEl).on("mousewheel DOMMouseScroll",this.onMouseWheel.bind(this));$(this.lowerCanvasEl).on("dblclick",this.onMouseDblclick.bind(this));this.observe("page:zoom",function(){this.tooltip()});this.observe("page:fitMode",function(){this.tooltip()})},_initResample:function(){if(typeof Worker==="undefined"||typeof this.path==="undefined")return;if(this.reSampleUse){var t=function(){this.initialize.apply(this,arguments)};t.prototype={reSampler:null,reSampler_Queue:[],reSampler_Running:false,lastInfo:{scale:0,width:0,height:0},currentInfo:{scale:0,width:0,height:0},initialize:function(t,e,i){for(var n in t){this[n]=t[n]}this.callback_Resampled=e;this.callback_Canceled=i},setRawData:function(t){this.init();this.reSampler=new Worker(iws.util.string.combinePath(this.path,"/engine/iws.w.resample.js"));if(this.reSampler){this.reSampler.onmessage=this._worker_onmessage.bind(this);this.reSampler.onerror=this._worker_onerror;this.reSampler.postMessage({cmd:"page-set",imageData:t})}},requestResample:function(t,e){this.currentInfo={scale:t,width:e.width,height:e.height};this.timer_Resample&&clearTimeout(this.timer_Resample);if(this._needToResample(t)&&this.reSampler){this.timer_Resample=setTimeout(function(){this.reSampler_Queue.push({scale:t,width:e.width,height:e.height});if(!this.reSampler_Running){this._workLastRequest()}}.bind(this),100)}else{this.callback_Canceled&&this.callback_Canceled()}},init:function(){if(this.reSampler!==null){this.reSampler.terminate();this.reSampler=null}this.reSampler_Running=false;this.lastInfo={scale:0,width:0,height:0};this.currentInfo={scale:0,width:0,height:0};for(var t=this.reSampler_Queue.length-1;t>=0;t--){this.reSampler_Queue.splice(t,1)}},_workLastRequest:function(){var t=this.reSampler_Queue.pop();if(t.scale!==this.lastInfo.scale){this.lastInfo=t;this.reSampler&&this.reSampler.postMessage({cmd:"resampling",w:t.width,h:t.height,filter:this.reSampleFilter});this.reSampler_Running=true}for(var e=this.reSampler_Queue.length-1;e>=0;e--){this.reSampler_Queue.splice(e,1)}},_needToResample:function(t){return t<=this.reSampleRate},_worker_onerror:function(t){console.log(t);console.log("reSampler.onerror : "+t.message+" ("+t.filename+":"+t.lineno+")")},_worker_onmessage:function(t){switch(t.data.cmd){case"page-set":break;case"resampling":if(this._needToResample(this.currentInfo.scale)){this.callback_Resampled(t.data.w,t.data.h,t.data.bytearray)}this.reSampler_Running=false;if(this.reSampler_Queue.length){this._workLastRequest()}break}}};var e=function(t,e,i){this.imageCtrl.setRawDataReSample(t,e,i);this.renderAll()};var i=function(){this.imageCtrl.clearResample();this.renderAll()};var n=function(){if(this.imageCtrl.isValid()){this.imageCtrl.clearResample();this.reSample.requestResample(this.imageCtrl.scale,this.imageCtrl.getScaleSize())}};this.reSample=new t({path:this.path,reSampleRate:this.reSampleRate,reSampleFilter:this.reSampleFilter},e.bind(this),i.bind(this));this.observe("page:setRawData",function(){this.reSample.setRawData(this.imageCtrl.getImageData())});this.observe("page:setFilter",function(){this.reSample.setRawData(this.imageCtrl.getImageData());n.call(this)});this.observe("canvas:cleared",function(){this.reSample.init()});this.observe("page:zoom",function(){n.call(this)});this.observe("page:fitMode",function(){n.call(this)})}},setCursor:function(t){this.lowerCanvasEl.style.cursor=t},onMouseDown:function(t){if(this.touchInfo){this.touchInfo.scale=this.imageCtrl.scale}$(this.lowerCanvasEl).off("mousemove touchmove");$(document).on("mousemove touchmove",this.onMouseMove.bind(this));$(document).on("mouseup touchend",this.onMouseUp.bind(this));this._onMouseDown(t.originalEvent||t)},onMouseMove:function(t){this._onMouseMove(t.originalEvent||t)},onMouseUp:function(t){$(document).off("mouseup touchend");$(document).off("mousemove touchmove");$(this.lowerCanvasEl).on("mousemove touchmove",this.onMouseMove.bind(this));this._onMouseUp(t.originalEvent||t)},_onMouseDown:function(t){var e=iws.util.getPointers(t);if(e.length===1){var i=this.getPointer(t);this.trackMouse.mouseMovePos=this.trackMouse.mouseDownPos=i;this.trackMouse.leftMouseButtonDown=true;this.renderAll()}else{console.log("_onMouseDown : ("+e[0].x+", "+e[0].y+"), ("+e[1].x+", "+e[1].y+")")}},_onMouseMove:function(t){if(!this.touchInfo||this.touchInfo&&!this.touchInfo.isStarted){var e=this.getPointer(t);var i=this.trackMouse.mousePrevMoveOffset.x=e.x-this.trackMouse.mouseMovePos.x,n=this.trackMouse.mousePrevMoveOffset.y=e.y-this.trackMouse.mouseMovePos.y;if(this.trackMouse.isMove()){this.imageCtrl.move({X:i,Y:n})}if(this.imageCtrl.isInDrawImage(this.contextContainer,e)){if(this.trackMouse.mouseType=="move")this.setCursor("move");else if(this.trackMouse.mouseType=="range")this.setCursor("crosshair");else if(this.trackMouse.mouseType=="glass"){if(this.trackMouse.leftMouseButtonDown){this.setCursor("none")}else this.setCursor("pointer")}}else{this.setCursor("default")}this.trackMouse.mouseMovePos=e;this.renderAll()}},_onMouseUp:function(t){if(this.trackMouse.isRange()&&this.imageCtrl.isValid()){var e=this.trackMouse.getIntersectRect(this.imageCtrl.getDrawRect());var i=this.imageCtrl.getImageRect(e);var n=iws.util.Rect(i);if(n.width()>4&&n.height()>4){this.fire("mouse:drawRanged",n.round())}}this.trackMouse.leftMouseButtonDown=false;this.renderAll()},onMouseWheel:function(t){t.preventDefault();t.stopPropagation();var e=$(this.lowerCanvasEl).offset(),i=(t.pageX||t.originalEvent.pageX)-e.left,n=(t.pageY||t.originalEvent.pageY)-e.top;var r=this.getPointer(t.originalEvent||t);if(t.originalEvent.detail<0||t.originalEvent.wheelDelta>0){this._zoom("out",r)}else{this._zoom("in",r)}},onMouseDblclick:function(t){t.preventDefault();t.stopPropagation();if(this.getTrackMode()==="move"){this.setFitMode({name:"auto"})}},tooltip:function(){if(!this.imageCtrl.isValid())return;var t=this;var e=true;var i=t.tooltipBox;var n=t.imageCtrl.scale;function r(t){return typeof t==="undefined"}function o(t,e){if(!r(t.textContent)){t.textContent=e}else{t.innerText=e}}o(i,Math.round(n*100)+"%");clearTimeout(t.tooltiping);if(!t.tooltiping){if(e){if(t.fading){iws.event.dispatchEvent(i,"transitionend")}i.addClass("iws-viewer-show");i.addClass("iws-viewer-fade");i.addClass("iws-viewer-transition");i.addClass("iws-viewer-in")}else{i.addClass("iws-viewer-show")}}else{clearTimeout(t.tooltiping)}t.tooltiping=setTimeout(function(){if(e){iws.event.addListener(i,"transitionend",function(){i.removeClass("iws-viewer-show");i.removeClass("iws-viewer-fade");i.removeClass("iws-viewer-transition");t.fading=false},true);i.removeClass("iws-viewer-in");t.fading=true}else{i.removeClass("iws-viewer-show")}t.tooltiping=false},1e3)},clearContext:function(t){t.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this.clearContext(this.contextContainer);this.imageCtrl.clear();this.fire("canvas:cleared");this.renderAll();this.stopRendering=true;return this},setInfo:function(t){for(var e in t){this.info[e]=t[e];if(e in this.imageCtrl.ImageProps){this.imageCtrl[e]=t[e]}}},_setDefault:function(){this.pageFilter&&this.pageFilter.changeDefaultValue()},setSrc:function(t,e,i){this._setDefault();this.imageCtrl.setSrc(t,e,function(){i&&i();this.renderAll()}.bind(this))},setRawData:function(t,e,i,n,r){this._setDefault();this.imageCtrl.setRawData(e,i,new Uint8Array(t),n,function(){r&&r();this.renderAll()}.bind(this))},setFitMode:function(t){this.imageCtrl.fitMode=t;this.renderAll()},getFitMode:function(){return this.imageCtrl.fitMode},_zoom:function(t,e){this.imageCtrl.zoom(t,e);this.renderAll()},zoomIn:function(){this._zoom("in")},zoomOut:function(){this._zoom("out")},setRotate:function(t){this.imageCtrl.rotate(t);this.renderAll()},setTrackMode:function(t){this.trackMouse.mouseType=t;this.fire("mouseTrackChange",t)},getTrackMode:function(){return this.trackMouse.mouseType},renderAll:function(){if(iws.useAnimationFrame){this.dirty=true;if(this.stopRendering){this.stopRendering=false;var t=this;var e=function(){if(t.dirty){t.dirty=false;var i=t.contextContainer;t._renderCanvas(i)}if(!t.stopRendering)window.requestAnimationFrame(e)};e()}}else{this._renderCanvas(this.contextContainer)}return this},_renderCanvas:function(t){this._renderBefore(t);console.log("_renderCanvas.................");this.imageCtrl.render(t);this._renderTracking(t);this._renderAfter(t)},_renderBefore:function(t){this.clearContext(t);this.fire("before:render");this._renderBackgroundOrOverlay(t,"background")},_renderTracking:function(t){if(this.trackMouse.isGlass()){this.trackMouse.drawMagnifyGlass(this.lowerCanvasEl)}if(this.trackMouse.isRange()&&this.imageCtrl.isValid()){this.trackMouse.drawRange(this.lowerCanvasEl,this.imageCtrl.getDrawRect())}},_renderAfter:function(t){this._renderBackgroundOrOverlay(t,"overlay");this.fire("after:render")},_renderBackgroundOrOverlay:function(t,e){var i=this[e+"Color"];if(i){t.fillStyle=i.toLive?i.toLive(t):i;t.fillRect(i.offsetX||0,i.offsetY||0,this.width,this.height)}i=this[e+"Image"];if(i){if(this[e+"Vpt"]){t.save();t.transform.apply(t,this.viewportTransform)}i.render(t);this[e+"Vpt"]&&t.restore()}},setBackgroundColor:function(t){return this.__setBgOverlayColor("backgroundColor",t,this.renderAll.bind(this))},__setBgOverlayColor:function(t,e,i){if(e&&e.source){var n=this;iws.util.loadImage(e.source,function(r){if(r!=null){n[t]=new iws.Pattern({source:r,repeat:e.repeat,offsetX:e.offsetX,offsetY:e.offsetY})}i&&i()})}else{this[t]=e;i&&i()}return this},restorePointerVpt:function(t){return iws.util.transformPoint(t,iws.util.invertTransform(this.viewportTransform))},getPointer:function(t,e){var i=iws.util.getPointer(t),n=this.lowerCanvasEl.getBoundingClientRect(),r=n.width||0,o=n.height||0,s;if(!r||!o){if("top"in n&&"bottom"in n){o=Math.abs(n.top-n.bottom)}if("right"in n&&"left"in n){r=Math.abs(n.right-n.left)}}this._offset=iws.util.getElementOffset(this.lowerCanvasEl);i.x=i.x-this._offset.left;i.y=i.y-this._offset.top;if(!e){i=this.restorePointerVpt(i)}if(r===0||o===0){s={width:1,height:1}}else{s={width:this.lowerCanvasEl.width/r,height:this.lowerCanvasEl.height/o}}return{x:i.x*s.width,y:i.y*s.height}},crop:function(t,e){var i=this.imageCtrl.getRotateSize();var n=document.createElement("canvas");n.width=i.width;n.height=i.height;var r=n.getContext("2d");var o={x:this.imageCtrl.width/2,y:this.imageCtrl.height/2};r.translate(o.x,o.y);r.rotate(this.imageCtrl.angle*Math.PI/180);r.translate(-o.x,-o.y);var s={left:0,top:0,right:this.imageCtrl.width,bottom:this.imageCtrl.height};var a=iws.util.Rotate;var l=this.imageCtrl.angle;var h=a(l).point(o.x,o.y,s.left,s.top);var c=a(l).point(o.x,o.y,s.right,s.top);var u=a(l).point(o.x,o.y,s.right,s.bottom);var f=a(l).point(o.x,o.y,s.left,s.bottom);var d=iws.util.Points([h,c,u,f]).getRect();var g=a(-l).point(0,0,d.left,d.top);r.drawImage(this.imageCtrl.imgCanvas,-g.x,-g.y);var p=iws.util.Rect(t).width();var v=iws.util.Rect(t).height();var m=document.createElement("canvas");m.width=p;m.height=v;m.getContext("2d").drawImage(n,t.left,t.top,p,v,0,0,p,v);function b(t){var e=t.split(","),i=e[0].match(/:(.*?);/)[1],n=atob(e[1]),r=n.length,o=new Uint8Array(r);while(r--){o[r]=n.charCodeAt(r)}return o}var w=m.toDataURL("image/png");e&&e(w,b(w))},visible:function(t,e){this.fire(t+":visible",e)},destroy:function(){if(this.reSample){this.reSample.init();this.reSample=null}$(this.fullScreenEl).remove()}})})();(function(){iws.pageFilter=function(t){this.page=t;this.initialize()};iws.pageFilter.prototype={defaultValue:{brightness:0,contrast:0,gamma:100},initialize:function(){this.imageFilter=iws.util.makeElement("div",{class:"page-imageFilter",id:"imageFilter"});this.imageFilter.innerHTML='<a class="handle ui-slideouttab-handle-rounded">Filter<i class="fa fa-icon fa-bank"></i></a>'+'<div class="range-slider">'+'<label class="range-label" >Brightness</label>'+'<div class="range-input-wrap">'+'<input id="brightness" class="range-slider__range" type="range" value="0" min="-255" max="255" step="5">'+'<span class="range-slider__value">0</span>'+"</div>"+"</div>"+'<div class="range-slider">'+'<label class="range-label" >Contrast</label>'+'<div class="range-input-wrap">'+'<input id="contrast" class="range-slider__range" type="range" value="0" min="-100" max="100" step="5">'+'<span class="range-slider__value">0</span>'+"</div>"+"</div>"+'<div class="range-slider">'+'<label class="range-label" >Gamma</label>'+'<div class="range-input-wrap">'+'<input id="gamma" class="range-slider__range" type="range" value="100" min="0" max="255" step="5">'+'<span class="range-slider__value">0</span>'+"</div>"+"</div>"+'<button class="range-btn range-btnGray" id="reset">Reset default</button>';this.page.wrapperEl.appendChild(this.imageFilter);var t=this;$(this.imageFilter).find("button#reset").on("click",function(){t.changeDefaultValue();var e=$(t.imageFilter).find(".range-slider__range");e.each(function(){$(this).trigger("input")})});$(this.imageFilter).tabSlideOut({offset:10,tabLocation:"bottom",offsetReverse:true,handleOffsetReverse:true});var e=function(){var e=$(this.imageFilter).find(".range-slider"),i=$(this.imageFilter).find(".range-slider__range"),n=$(this.imageFilter).find(".range-slider__value");var r=null;var o=this.page;n.each(function(){var e=$(this).prev().attr("id");var i=t.defaultValue[e];$(this).prev().val(i);$(this).html(i)});e.each(function(){function t(t){var e=o.imageCtrl.getOriginalImageData();if(e){var i=t(e);o.imageCtrl.putImageData(i);o.fire("page:setFilter");o.renderAll()}}i.on("input change",function(){$(this).next(n).html(this.value);clearTimeout(r);var e=this;r=setTimeout(function(){console.log(e.value);switch(e.id){case"brightness":case"contrast":{t(function(t){var e=i.filter("#brightness").val();var n=i.filter("#contrast").val();return iws.pageFilter.brightness_contrast(t,Number(e),Number(n))})}break;case"gamma":{t(function(t){return iws.pageFilter.gamma(t,Number(e.value)/100)})}break}},10)})})};e.call(this);this.page.observe("filter:visible",function(t){if(t==="show"){this.imageFilter.style.display="block"}if(t==="hide"){this.imageFilter.style.display="none"}}.bind(this))},changeDefaultValue:function(){var t=this;var e=$(this.imageFilter).find(".range-slider__value");e.each(function(){var e=$(this).prev().attr("id");var i=t.defaultValue[e];$(this).prev().val(i);$(this).html(i)})}};iws.pageFilter.brightness_contrast=function(t,e,i,n){var r=new Uint8Array(256);var o=i/100+1;var s=128*(1-o);var a=e;var l=s+a;for(var h=0;h<r.length;h++){var c=h*o+l;r[h]=c<0?0:c>255?255:c}var u=document.createElement("canvas");var f=u.getContext("2d").createImageData(t.width,t.height);var d=t.data;for(var h=0,g=d.length;h<g;h+=4){f.data[h]=r[d[h]];f.data[h+1]=r[d[h+1]];f.data[h+2]=r[d[h+2]];f.data[h+3]=d[h+3]}return f};iws.pageFilter.brightness=function(t,e){var i=new Uint8Array(256);for(var n=0;n<i.length;n++){var r=n+e;i[n]=r<0?0:r>255?255:r}var o=document.createElement("canvas");var s=o.getContext("2d").createImageData(t.width,t.height);var a=t.data;for(var n=0,l=a.length;n<l;n+=4){s.data[n]=i[a[n]];s.data[n+1]=i[a[n+1]];s.data[n+2]=i[a[n+2]];s.data[n+3]=a[n+3]}return s};iws.pageFilter.contrast=function(t,e){var i=new Uint8Array(256);var n=e/100+1;var r=128*(1-n);for(var o=0;o<i.length;o++){var s=o*n+r;i[o]=s<0?0:s>255?255:s}var a=document.createElement("canvas");var l=a.getContext("2d").createImageData(t.width,t.height);var h=t.data;for(var o=0,c=h.length;o<c;o+=4){l.data[o]=i[h[o]];l.data[o+1]=i[h[o+1]];l.data[o+2]=i[h[o+2]];l.data[o+3]=h[o+3]}return l};iws.pageFilter.gamma=function(t,e){var i=new Uint8Array(256);for(var n=0;n<i.length;n++){var r=Math.pow(n/255,1/e)*255;i[n]=r<0?0:r>255?255:r}var o=document.createElement("canvas");var s=o.getContext("2d").createImageData(t.width,t.height);var a=t.data;for(var n=0,l=a.length;n<l;n+=4){s.data[n]=i[a[n]];s.data[n+1]=i[a[n+1]];s.data[n+2]=i[a[n+2]];s.data[n+3]=a[n+3]}return s}})();(function(){(function(){"use strict";function t(){this.initialize.apply(this,arguments)}iws.PageAnnotation=iws.util.createInheritClass(t,iws.Page,iws.Collection,{hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",deleteCursor:"pointer",rotationCursor:"crosshair",useAnnotation:false,useFilter:false,initialize:function(t,e){this.callSuper("initialize",t,e);this.annotToolbar=new iws.toolbar.annotation(this);this._initEvent();this.visible("annotation",this.useAnnotation?"show":"hide");this.visible("filter",this.useFilter?"show":"hide")},_reSize:function(){if(window.matchMedia){var t=window.matchMedia("(max-width: 600px)");if(t&&t.matches){this.visible("annotation","hide")}else{this.visible("annotation",this.useAnnotation?"show":"hide")}}this.callSuper("_reSize")},keydownControl:false,_initEvent:function(){this.observe("page:zoom",this._eventPageZoom);this.observe("page:fitMode",this._eventPageZoom);this.observe("page:rotate",this._eventPageRotate);this.observe("page:move",this._eventPageMove);document.addEventListener("keydown",function(t){var e=t.key;if(e==="Control"){this.keydownControl=true;return}if(e==="Shift"){return}if(this.isSelectMode()){if(t.which===46){var i=[];this._objects.forEach(function(t){if(t.active){i.push(t)}});this.discardActiveObject();this.remove.apply(this,i)}else if(t.which===65&&t.shiftKey){this._objects.forEach(function(t){t.set("active",true)});this.renderAll()}}}.bind(this),false);document.addEventListener("keyup",function(t){var e=t.key;if(e==="Control"){this.keydownControl=false;return}}.bind(this),false)},_eventPageZoom:function(t){$.each(this.getObjects(),function(e,i){t.output&&i._objectSizeChangeScale(t.output.changeRate,t.output.offset,t.output.center)}.bind(this))},_eventPageRotate:function(t){var e=t.input.angle;var i=this.imageCtrl.getDrawCenter();$.each(this.getObjects(),function(t,n){var r=iws.util.Rotate(e).point(i.x,i.y,n.left,n.top);n.set({angle:(n.angle+e)%360,left:r.x,top:r.y});n.setCoords()})},_eventPageMove:function(t){var e=t.output.offset;$.each(this.getObjects(),function(t,i){i.set({left:i.get("left")+e.x,top:i.get("top")+e.y});i.setCoords()})},clear:function(t){this._objects.length=0;if(t==="onlyAnn")return;this.callSuper("clear")},showAnnotation:function(t){this.fire("annotation:visible",t)},toJSON:function(t){var e={objects:this.getObjects().filter(function(t){return!t.excludeFromExport}).map(function(e){return e["toObject"](t)},this)};return e},loadFromJSON:function(t,e,i){if(!t){return}var n=typeof t==="string"?JSON.parse(t):iws.util.object.clone(t);var r=this;this._enlivenObjects(n.objects,function(){e&&e()},i);return this},_enlivenObjects:function(t,e,i){var n=this;if(!t||t.length===0){e&&e();return}iws.util.enlivenObjects(t,function(t){
t.forEach(function(t,e){n.insertAt(t,e)});e&&e()},null,"object",i)},_renderCanvas:function(t){this._renderBefore(t);this.imageCtrl.render(t);this._renderObjects(t);this._drawObjectsControls(t);this._renderTracking(t);this._renderAfter(t)},_renderTracking:function(t){this.callSuper("_renderTracking",t);if(this.trackMouse.leftMouseButtonDown){this.trackMouse.leftMouseButtonDown=this.trackMouse.leftMouseButtonDown}if(this.trackMouse.leftMouseButtonDown&&this.isSelectMode()&&!this._currentTransform){this.trackMouse.drawSelect(this.lowerCanvasEl,this.trackMouse.getRect())}},_renderObjects:function(t){t.save();t.transform.apply(t,this.viewportTransform);for(var e=0,i=this._objects.length;e<i;++e){if(this.imageCtrl.xres===undefined){console.log("need to get image resolution.")}this._objects[e]&&this._objects[e].render(t,undefined,this.imageCtrl.scale*(this.imageCtrl.xres/96))}t.restore()},_drawObjectsControls:function(t){for(var e=0,i=this._objects.length;e<i;++e){if(!this._objects[e]||!this._objects[e].active){continue}this._objects[e]._renderControls(t)}},_onObjectAdded:function(t){t._set("canvas",this);t.setCoords();this.fire("object:added",{target:t});t.fire("added")},_onObjectRemoved:function(t){this.fire("object:removed",{target:t});t.fire("removed");delete t.canvas},_setActiveObject:function(t){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=t;t.set("active",true)},setActiveObject:function(t,e){this._setActiveObject(t);this.renderAll();this.fire("object:selected",{target:t,e:e});t.fire("selected",{e:e});return this},getActiveObject:function(){return this._activeObject},_shouldClearSelection:function(t,e){if(!e)return true;var i=this._selectedObjects();if(i.indexOf(e)===-1)return true;var n=this.getActiveObject();return e&&!e.selectable&&n&&n!==e},_discardActiveObject:function(){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=null},discardActiveObject:function(t){var e=this._activeObject;this.fire("before:selection:cleared",{target:e,e:t});this._discardActiveObject();this.fire("selection:cleared",{e:t});e&&e.fire("deselected",{e:t});return this},deactivateAll:function(){var t=this.getObjects(),e=0,i=t.length;for(;e<i;e++){t[e].set("active",false)}this._discardActiveObject();return this},_clearSelection:function(t,e,i){this.discardActiveObject();this.deactivateAll();if(e&&e.selectable){this.setActiveObject(e,t)}},checkDel:function(t,e){var i=this.getPointer(t,true),n=[],r=this;this._objects.forEach(function(t){var e=iws.util.find.getContainFromCoords(t.oCoords["mrdel"].corner,i);if(e){n.push(t)}});e&&e(n);return n},_onMouseDown:function(t){this.callSuper("_onMouseDown",t);if(this.isAnnotationMode()){this.__onMouseDown_AnnotationControl(t)}},_onMouseMove:function(t){this.callSuper("_onMouseMove",t);if(this.isAnnotationMode()){this.__onMouseMove_AnnotationControl(t)}this.checkDel(t,function(t){if(t.length>0)this.setCursor(this.deleteCursor)}.bind(this))},_onMouseUp:function(t){if(this.isAnnotationMode()){this.__onMouseUp_AnnotationControl(t)}this.checkDel(t,function(t){if(t.length>0){this.discardActiveObject();this.remove.apply(this,t)}}.bind(this));this.callSuper("_onMouseUp",t)},getAnnotation:function(){var t=[];var e=this.imageCtrl.getBasicPoint();this.getObjects().forEach(function(i){var n=i.clone();n._objectSizeChangeScale(e.rate,{x:0,y:0},this.imageCtrl.getDrawCenter());n.left-=e.x;n.top-=e.y;if(n.type=="line"){n.x1-=e.x;n.y1-=e.y;n.x2-=e.x;n.y2-=e.y}t.push(n)}.bind(this));var i={objects:t.filter(function(t){return!t.excludeFromExport}).map(function(t){return t["toObject"](null)},this)};return i.objects.length>0?JSON.stringify(i):""},setAnnotation:function(t){this.clear("onlyAnn");if(this.loadFromJSON(t)){var e=this.imageCtrl.getBasicPoint();this.getObjects().forEach(function(t){t._objectSizeChangeScale(this.imageCtrl.scale,e,this.imageCtrl.getDrawCenter())}.bind(this))}this.renderAll()},addAnnotation:function(t){var e=this.imageCtrl.getBasicPoint();t._objectSizeChangeScale(this.imageCtrl.scale,e,this.imageCtrl.getDrawCenter());this.add(t)},removeAnnotation:function(){var t=this.getObjects();if(t){this.remove(t[t.length-1])}}})})();(function(){iws.util.extend(iws.PageAnnotation.prototype,{createObject:null,annotationMap:["annotSelect","annotDrawFree","annotDrawLine","annotDrawRect","annotDrawText"],isAnnotationMode:function(){var t=this.getTrackMode();var e=this.annotationMap.indexOf(t);return e>=0},isSelectMode:function(){return this.getTrackMode()===this.annotationMap[0]},_handleEvent:function(t,e,i){var n=typeof i===undefined?this.findTarget(t):i,r={e:t,target:n};n&&n.fire("mouse"+e,r)},_makeText:function(t){var e=$('<textarea placeholder="Memo ... " class="annotText"></textarea>');var i=this.getPointer(t);var n=this.annotToolbar.getInitParam(this.getTrackMode());this.imageCtrl.xres=this.imageCtrl.xres<96?96:this.imageCtrl.xres;var r=this.imageCtrl.scale*(this.imageCtrl.xres/96);var o=n["fontSize"]*r;var s=200*r;var a=o+32*r;var l=1.2;e.css({left:i.x,top:i.y,width:s,height:a,"font-family":"Times New Roman","font-size":o+"px",color:n["fill"],background:n["backgroundColor"],position:"absolute","line-height":l,border:"0 none white",padding:0,outline:"none","IME-MODE":"active"}).appendTo($(this.pageContainer));var h=this;e.on("focusout",function(t){if($(this).val()!=""){h.setTrackMode(h.annotationMap[0],true);n["left"]=i.x;n["top"]=i.y;n["width"]=e.width();n["height"]=e.height();h.createObject=new iws.objectText($(this).val(),n);h.add(h.createObject);h.setActiveObject(h.createObject);h.createObject=null}$(this).remove()});e.on("input",function(){e.css({"overflow-y":"hidden"}).height(e[0].scrollHeight)});return e},__onMouseDown_AnnotationControl:function(t){if(this.isSelectMode()){var e=this.findTarget(t),i=this.getPointer(t,true);if(this._shouldClearSelection(t,e)){this._clearSelection(t,e,i)}if(e){if(e.selectable){this._setupCurrentTransform(t,e)}if(this._selectedObjects().length<=1){if(e!==this.getActiveObject()){this.discardActiveObject();e.selectable&&this.setActiveObject(e,t)}this.renderAll()}this._handleEvent(t,"down",e)}}else{this.discardActiveObject();var n=this.annotToolbar.getInitParam(this.getTrackMode());switch(this.getTrackMode()){case"annotDrawFree":this.createObject=new iws.objectPath([],n);this.add(this.createObject);break;case"annotDrawLine":this.createObject=new iws.objectLine(n);this.add(this.createObject);break;case"annotDrawRect":this.createObject=new iws.objectRect(n);this.add(this.createObject);break;case"annotDrawText":{var r=$(this.wrapperEl).find(".annotText");if(r.length!=0)return;var o=this._makeText(t);setTimeout(function(){o.select()},1)}break}this.createObject&&this.createObject._onCreateMouseDown(t)}this.renderAll()},__onMouseMove_AnnotationControl:function(t){if(this.isSelectMode()){var e;if(!this._currentTransform){e=this.findTarget(t);this._setCursorFromEvent(t,e)}else{var i=this._selectedObjects();if(i.length>1){var n=this.getPointer(t);i.forEach(function(t){t.set({left:t.get("left")+this.trackMouse.mousePrevMoveOffset.x,top:t.get("top")+this.trackMouse.mousePrevMoveOffset.y});t.setCoords()}.bind(this));this.renderAll()}else{this._transformObject(t)}}this._handleEvent(t,"move",e?e:null)}else{this.setCursor(this.defaultCursor);this.createObject&&this.createObject._onCreateMouseMove(t);this.renderAll()}},__onMouseUp_AnnotationControl:function(t){if(this.isSelectMode()){var e,i=true,n=this._currentTransform;if(n){this._finalizeCurrentTransform();i=!n.actionPerformed;this._currentTransform=null;e=i?this.findTarget(t,true):n.target;if(e){e.isMoving=false}}else{this._collectObjects()}this._handleEvent(t,"up",e?e:null)}else{if(this.createObject){if(!this.keydownControl){this.setTrackMode(this.annotationMap[0],true)}this.setActiveObject(this.createObject);this.createObject._onCreateMouseUp(t);this.createObject=null}}},_selectedObjects:function(){var t=[];for(var e=0;e<this._objects.length;e++){if(this._objects[e].get("active"))t.push(this._objects[e])}return t},_collectObjects:function(){var t=[],e,i=this.trackMouse.getLT(),n=this.trackMouse.getRB(),r=new iws.Point(i.x,i.y),o=new iws.Point(n.x,n.y),s=i.x===n.x&&i.y===n.y;for(var a=this._objects.length;a--;){e=this._objects[a];if(!e||!e.selectable||!e.visible){continue}if(e.isContainedWithinRect(r,o)){t.push(e);if(s){break}}}if(t.length===1){this.setActiveObject(t[0])}else{t.forEach(function(t){t.set("active",true)})}}})})();(function(){iws.util.extend(iws.PageAnnotation.prototype,{cursorOffset:{mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],findTarget:function(t){var e=this.getPointer(t,true),i=this.getActiveObject();if(i&&i._findTargetCorner(e)){return i}if(i&&this._checkTarget(e,i)){return i}var n=this._searchPossibleTargets(this._objects,e);return n},_checkTarget:function(t,e){if(e&&e.visible&&e.evented&&this.containsPoint(null,e,t)){return true}},_searchPossibleTargets:function(t,e){var i,n=t.length,r,o;while(n--){if(this._checkTarget(e,t[n])){i=t[n]}}return i},containsPoint:function(t,e,i){var n=true,r=i||this.getPointer(t,n),o;o={x:r.x,y:r.y};return e.containsPoint(o)||e._findTargetCorner(r)},_setCursorFromEvent:function(t,e){if(!e){this.setCursor(this.defaultCursor);return false}var i=e.hoverCursor||this.hoverCursor;if(!e.selectable){this.setCursor(i)}else{var n=e._findTargetCorner&&e._findTargetCorner(this.getPointer(t,true));if(!n){this.setCursor(i)}else{this._setCornerCursor(n,e,t)}}return true},_setCornerCursor:function(t,e,i){if(t in this.cursorOffset){this.setCursor(this._getRotatedCornerCursor(t,e,i))}else if(t==="mtr"&&e.hasRotatingPoint){this.setCursor(this.rotationCursor)}else{this.setCursor(this.defaultCursor);return false}},_getRotatedCornerCursor:function(t,e,i){var n=Math.round(e.get("angle")%360/45);if(n<0){n+=8}n+=this.cursorOffset[t];if(i[this.altActionKey]&&this.cursorOffset[t]%2===0){n+=2}n%=8;return this.cursorMap[n]}})})();(function(){iws.util.extend(iws.PageAnnotation.prototype,{_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=false;i.target.isMoving=true;this._beforeScaleTransform(t,i);this._performTransformAction(t,i,e);i.actionPerformed&&this.renderAll()},_beforeScaleTransform:function(t,e){if(e.action==="scale"||e.action==="scaleX"||e.action==="scaleY"){var i=this._shouldCenterTransform(e.target);if(i&&(e.originX!=="center"||e.originY!=="center")||!i&&e.originX==="center"&&e.originY==="center"){this._resetCurrentTransform();e.reset=true}}},_performTransformAction:function(t,e,i){var n=i.x,r=i.y,o=e.target,s=e.action,a=false;if(s==="rotate"){(a=this._rotateObject(n,r))&&this.fire("object:rotating",{target:o,e:t})}else if(s==="scale"){(a=this._onScale(t,e,n,r))&&this.fire("object:scaling",{target:o,e:t})}else if(s==="scaleX"){(a=this._scaleObject(n,r,"x"))&&this.fire("object:scaling",{target:o,e:t})}else if(s==="scaleY"){(a=this._scaleObject(n,r,"y"))&&this.fire("object:scaling",{target:o,e:t})}else if(s==="drag"){a=this._translateObject(n,r);if(a){this.renderAll();this.fire("object:moving",{target:o,e:t});this.setCursor(o.moveCursor||this.moveCursor)}}e.actionPerformed=a},_rotateObject:function(t,e){var i=this._currentTransform;if(i.target.get("lockRotation")){return false}var n=Math.atan2(i.ey-i.top,i.ex-i.left),r=Math.atan2(e-i.top,t-i.left),o=iws.util.radiansToDegrees(r-n+i.theta);if(o<0){o=360+o}i.target.angle=o%360;return true},_translateObject:function(t,e){var i=this._currentTransform,n=i.target;return n.translateOffset(t,e,i.offsetX,i.offsetY)},_finalizeCurrentTransform:function(){var t=this._currentTransform,e=t.target;if(e._scaling){e._scaling=false}e.setCoords();if(this._previousOriginX&&this._previousOriginY){e.restoreOriginXY(this._previousOriginX,this._previousOriginY);this._previousOriginX=null;this._previousOriginY=null}this.renderAll();if(t.actionPerformed){this.fire("object:modified",{target:e});e.fire("modified")}},_restoreOriginXY:function(t){if(this._previousOriginX&&this._previousOriginY){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX;t.originY=this._previousOriginY;t.left=e.x;t.top=e.y;if(t instanceof iws.objectLine){t.fixPoint()}this._previousOriginX=null;this._previousOriginY=null}},_onScale:function(t,e,i,n){if((t[this.uniScaleKey]||this.uniScaleTransform)&&!e.target.get("lockUniScaling")){e.currentAction="scale";return this._scaleObject(i,n)}else{if(!e.reset&&e.currentAction==="scale"){this._resetCurrentTransform()}e.currentAction="scaleEqually";return this._scaleObject(i,n,"equally")}},_scaleObject:function(t,e,i){var n=this._currentTransform,r=n.target,o=r.get("lockScalingX"),s=r.get("lockScalingY"),a=r.get("lockScalingFlip");if(o&&s){return false}var l=r.translateToOriginPoint(r.getCenterPoint(),n.originX,n.originY),h=r.toLocalPoint(new iws.Point(t,e),n.originX,n.originY),c=r._getTransformedDimensions(),u=false;this._setLocalMouse(h,n);if(r instanceof iws.objectText){var f=r.width*(h.x/r.scaleX/(r.width+r.strokeWidth));if(f>=r.getMinWidth()){r.set("width",f);u=true}}else if(r instanceof iws.objectLine){r._cornerMove(t,e);u=true}else{u=this._setObjectScale(h,n,o,s,i,a,c)}r.setPositionByOrigin(l,n.originX,n.originY);return u},_setLocalMouse:function(t,e){var i=e.target;if(e.originX==="right"){t.x*=-1}else if(e.originX==="center"){t.x*=e.mouseXSign*2;if(t.x<0){e.mouseXSign=-e.mouseXSign}}if(e.originY==="bottom"){t.y*=-1}else if(e.originY==="center"){t.y*=e.mouseYSign*2;if(t.y<0){e.mouseYSign=-e.mouseYSign}}if(Math.abs(t.x)>i.padding){if(t.x<0){t.x+=i.padding}else{t.x-=i.padding}}else{t.x=0}if(Math.abs(t.y)>i.padding){if(t.y<0){t.y+=i.padding}else{t.y-=i.padding}}else{t.y=0}},_setObjectScale:function(t,e,i,n,r,o,s){var a=e.target,l=false,h=false,c=false,u,f,d,g;d=t.x*a.scaleX/s.x;g=t.y*a.scaleY/s.y;u=a.scaleX!==d;f=a.scaleY!==g;if(o&&d<=0&&d<a.scaleX){l=true}if(o&&g<=0&&g<a.scaleY){h=true}if(r==="equally"&&!i&&!n){l||h||(c=this._scaleObjectEqually(t,a,e,s))}else if(!r){l||i||a.set("scaleX",d)&&(c=c||u);h||n||a.set("scaleY",g)&&(c=c||f)}else if(r==="x"&&!a.get("lockUniScaling")){l||i||a.set("scaleX",d)&&(c=c||u)}else if(r==="y"&&!a.get("lockUniScaling")){h||n||a.set("scaleY",g)&&(c=c||f)}e.newScaleX=d;e.newScaleY=g;l||h||this._flipObject(e,r);return c},_scaleObjectEqually:function(t,e,i,n){var r=t.y+t.x,o=n.y*i.original.scaleY/e.scaleY+n.x*i.original.scaleX/e.scaleX,s;i.newScaleX=i.original.scaleX*r/o;i.newScaleY=i.original.scaleY*r/o;s=i.newScaleX!==e.scaleX||i.newScaleY!==e.scaleY;e.set("scaleX",i.newScaleX);e.set("scaleY",i.newScaleY);return s},_flipObject:function(t,e){if(t.newScaleX<0&&e!=="y"){if(t.originX==="left"){t.originX="right"}else if(t.originX==="right"){t.originX="left"}}if(t.newScaleY<0&&e!=="x"){if(t.originY==="top"){t.originY="bottom"}else if(t.originY==="bottom"){t.originY="top"}}},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};if(e==="ml"||e==="tl"||e==="bl"){i.x="right"}else if(e==="mr"||e==="tr"||e==="br"){i.x="left"}if(e==="tl"||e==="mt"||e==="tr"){i.y="bottom"}else if(e==="bl"||e==="mb"||e==="br"){i.y="top"}return i},_getActionFromCorner:function(t,e,i){if(!e){return"drag"}switch(e){case"mrdel":return"delete";case"mtr":return"rotate";case"ml":case"mr":return"scaleX";case"mt":case"mb":return"scaleY";default:return"scale"}},_setupCurrentTransform:function(t,e){if(!e){return}var i=this.getPointer(t),n=e._findTargetCorner(this.getPointer(t,true)),r=this._getActionFromCorner(e,n,t),o=this._getOriginFromCorner(e,n);this._currentTransform={target:e,action:r,corner:n,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:i.x-e.left,offsetY:i.y-e.top,originX:o.x,originY:o.y,ex:i.x,ey:i.y,lastX:i.x,lastY:i.y,left:e.left,top:e.top,theta:iws.util.degreesToRadians(e.angle),width:e.width*e.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:t.shiftKey,altKey:t[this.centeredKey]};this._currentTransform.original={left:e.left,top:e.top,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,originX:o.x,originY:o.y};this._resetCurrentTransform()},_resetCurrentTransform:function(){var t=this._currentTransform;if(this._shouldCenterTransform(t.target)){if(t.action==="rotate"){this._setOriginToCenter(t.target)}else{if(t.originX!=="center"){if(t.originX==="right"){t.mouseXSign=-1}else{t.mouseXSign=1}}if(t.originY!=="center"){if(t.originY==="bottom"){t.mouseYSign=-1}else{t.mouseYSign=1}}t.originX="center";t.originY="center"}}else{t.originX=t.original.originX;t.originY=t.original.originY}},_setOriginToCenter:function(t){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var e=t.getCenterPoint();t.originX="center";t.originY="center";t.left=e.x;t.top=e.y;this._currentTransform.left=t.left;this._currentTransform.top=t.top},_shouldCenterTransform:function(t){if(!t){return}var e=this._currentTransform,i;if(e.action==="scale"||e.action==="scaleX"||e.action==="scaleY"){i=this.centeredScaling||t.centeredScaling}else if(e.action==="rotate"){i=this.centeredRotation||t.centeredRotation}return i?!e.altKey:e.altKey},destroy:function(){this.clear();this.annotToolbar.destroy();this.callSuper("destroy")}})})()})();(function(){function t(){this.initialize.apply(this,arguments)}iws.Object=iws.util.createInheritClass(t,iws.Observable,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,delIconSize:20,transparentCorners:true,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:false,centeredRotation:true,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:true,evented:true,visible:true,hasControls:true,hasBorders:true,hasRotatingPoint:true,rotatingPointOffset:40,deletePointOffset:20,perPixelTargetFind:false,includeDefaultValues:true,clipTo:null,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,lockScalingY:false,lockUniScaling:false,lockSkewingX:false,lockSkewingY:false,lockScalingFlip:false,excludeFromExport:false,stateProperties:("top left width height scaleX scaleY flipX flipY originX originY transformMatrix "+"stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit "+"angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor "+"skewX skewY").split(" "),imgDelete:null,initialize:function(t){if(t){this.setOptions(t)}this.imgDelete=document.createElement("img");this.imgDelete.onload=function(){console.log("image(delete) loaded")};this.imgDelete.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAcNJREFUOI2Nk79rU3EUxT/3vu8z7lJa3aSr1ZAaXdsudRRHQcShSP8BaSQQgpFGcO4QRAX/AiEUXMRNaiUIFR0snTSCRZyTl3dvh/ryW8zZLt9zzr2H+73CFJRaNheZreJcBFDhqJvq2/p1/T3OleGisucLFiVPDG4rGkaYZgkqr3oabW0X9HjCoNzqXBGTN6Dz06Ya+FhbxG/UirmDvsHfzp/+Jx42sRDy2wU9VoBUk6ezigFU9UKwtA4gpfc2H+LeD9Bo0MKfITTNvYFigmzg3BKRe0NjJImH8xoHWxsRnwZrPirGr0MIqyJhrXY1bgK7Y2PEsaQrweV0VSMZ3RuVln2rFvQLQHm/syTuO4iMEkUWdXpILHU8KyPHjUGdwQVXN47GHwTZqC3r1/J+Z6nyoXOpei33WSLZnOT5oZRaNqfWaw9/HHd/AeyK+46BSySbuN8U9E4/plk3PRsvCED5Y/eloHenxvkHzL3xuBjfV4AohAeY/ZxZjH1PLXoIoADVvP5y8XUza88iDhrWs8Pqb6FWzB1YCHnw55glE0Kzrrk30jTks/XC2DVm2Nqzc7GkK4gsuuCCHyZnwrv6Zfkzzj0BqZvGllBG5UgAAAAASUVORK5CYII="},_initGradient:function(t){if(t.fill&&t.fill.colorStops&&!(t.fill instanceof iws.Gradient)){this.set("fill",new iws.Gradient(t.fill))}if(t.stroke&&t.stroke.colorStops&&!(t.stroke instanceof iws.Gradient)){this.set("stroke",new iws.Gradient(t.stroke))}},_initPattern:function(t){if(t.fill&&t.fill.source&&!(t.fill instanceof iws.Pattern)){this.set("fill",new iws.Pattern(t.fill))}if(t.stroke&&t.stroke.source&&!(t.stroke instanceof iws.Pattern)){this.set("stroke",new iws.Pattern(t.stroke))}},_initClipping:function(t){if(!t.clipTo||typeof t.clipTo!=="string"){return}var e=iws.util.getFunctionBody(t.clipTo);if(typeof e!=="undefined"){this.clipTo=new Function("ctx",e)}},setOptions:function(t){for(var e in t){this.set(e,t[e])}this._initGradient(t);this._initPattern(t);this._initClipping(t)},transform:function(t,e){if(this.group&&!this.group._transformDone&&this.group===this.canvas._activeGroup){this.group.transform(t);iws.log("transform: this.group.transform(ctx)")}var i=this.left;var n=this.top;var r=e?this._getLeftTopCoords():this.getCenterPoint();t.translate(r.x,r.y);iws.log("transform: center",e,r.x,r.y);t.rotate(iws.util.degreesToRadians(this.angle));var o=this.scaleX*(this.flipX?-1:1);var s=this.scaleY*(this.flipY?-1:1);t.scale(o,s);var a=Math.tan(iws.util.degreesToRadians(this.skewX));var l=Math.tan(iws.util.degreesToRadians(this.skewY));t.transform(1,0,a,1,0,0);t.transform(1,l,0,1,0,0)},toObject:function(t){var e=2,i={type:this.type,originX:this.originX,originY:this.originY,left:parseFloat(Number(this.left).toFixed(e)),top:parseFloat(Number(this.top).toFixed(e)),width:parseFloat(Number(this.width).toFixed(e)),height:parseFloat(Number(this.height).toFixed(e)),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:parseFloat(Number(this.strokeWidth).toFixed(e)),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:parseFloat(Number(this.strokeMiterLimit).toFixed(e)),scaleX:parseFloat(Number(this.scaleX).toFixed(e)),scaleY:parseFloat(Number(this.scaleY).toFixed(e)),angle:parseFloat(Number(this.angle).toFixed(e)),flipX:this.flipX,flipY:this.flipY,opacity:parseFloat(Number(this.opacity).toFixed(e)),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:parseFloat(Number(this.skewX).toFixed(e)),skewY:parseFloat(Number(this.skewY).toFixed(e))};iws.util.populateWithProperties(this,i,t);return i},toDatalessObject:function(t){return this.toObject(t)},toString:function(){return"#<fabric."+capitalize(this.type)+">"},get:function(t){return this[t]},getObjectScaling:function(){var t=this.scaleX,e=this.scaleY;if(this.group){var i=this.group.getObjectScaling();t*=i.scaleX;e*=i.scaleY}return{scaleX:t,scaleY:e}},_setObject:function(t){for(var e in t){this._set(e,t[e])}},set:function(t,e){if(typeof t==="object"){this._setObject(t)}else{if(typeof e==="function"&&t!=="clipTo"){this._set(t,e(this.get(t)))}else{this._set(t,e)}}return this},_set:function(t,e){var i=t==="scaleX"||t==="scaleY";if(i){e=this._constrainScale(e)}if(t==="scaleX"&&e<0){this.flipX=!this.flipX;e*=-1}else if(t==="scaleY"&&e<0){this.flipY=!this.flipY;e*=-1}this[t]=e;if(t==="width"||t==="height"){this.minScaleLimit=Math.min(.1,1/Math.max(this.width,this.height))}return this},translateOffset:function(t,e,i,n){var r=t-i,o=e-n,s=!this.get("lockMovementX")&&this.left!==r,a=!this.get("lockMovementY")&&this.top!==o;s&&this.set("left",r);a&&this.set("top",o);return s||a},setOnGroup:function(){},toggle:function(t){var e=this.get(t);if(typeof e==="boolean"){this.set(t,!e)}return this},setSourcePath:function(t){this.sourcePath=t;return this},getViewportTransform:function(){if(this.canvas&&this.canvas.viewportTransform){return this.canvas.viewportTransform}return[1,0,0,1,0,0]},render:function(t,e,i){if(!this.visible){return}t.save();this._setupCompositeOperation(t);this.drawSelectionBackground(t);if(!e){this.transform(t);iws.log("!noTransform",e)}this._setOpacity(t);this._setShadow(t);this._renderBackground(t);this._setStrokeStyles(t);this._setFillStyles(t);if(this.transformMatrix){t.transform.apply(t,this.transformMatrix)}this._render(t,e,i);t.restore();t.save();this.drawDelete(t);t.restore()},_renderBackground:function(t){if(!this.backgroundColor){return}t.fillStyle=this.backgroundColor;t.fillRect(-this.width/2,-this.height/2,this.width,this.height);this._removeShadow(t)},_setOpacity:function(t){if(this.group){this.group._setOpacity(t)}t.globalAlpha*=this.opacity},_setStrokeStyles:function(t){if(this.stroke){t.lineWidth=this.strokeWidth;t.lineCap=this.strokeLineCap;t.lineJoin=this.strokeLineJoin;t.miterLimit=this.strokeMiterLimit;t.strokeStyle=this.stroke.toLive?this.stroke.toLive(t,this):this.stroke}},_setFillStyles:function(t){if(this.fill){t.fillStyle=this.fill.toLive?this.fill.toLive(t,this):this.fill}},_setLineDash:function(t,e,i){if(!e){return}if(1&e.length){e.push.apply(e,e)}if(supportsLineDash){t.setLineDash(e)}else{i&&i(t)}},_renderControls:function(t,e){if(!this.active||e||this.group&&this.group!==this.canvas.getActiveGroup()){return}var i=this.getViewportTransform(),n=this.calcTransformMatrix(),r;n=iws.util.multiplyTransformMatrices(i,n);r=iws.util.qrDecompose(n);t.save();t.translate(r.translateX,r.translateY);t.lineWidth=1*this.borderScaleFactor;t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;t.rotate(iws.util.degreesToRadians(this.angle));this.drawBorders(t);this.drawControls(t);t.restore()},_setShadow:function(t){if(!this.shadow){return}var e=this.canvas&&this.canvas.viewportTransform[0]||1,i=this.canvas&&this.canvas.viewportTransform[3]||1,n=this.getObjectScaling();t.shadowColor=this.shadow.color;t.shadowBlur=this.shadow.blur*(e+i)*(n.scaleX+n.scaleY)/4;t.shadowOffsetX=this.shadow.offsetX*e*n.scaleX;t.shadowOffsetY=this.shadow.offsetY*i*n.scaleY},_removeShadow:function(t){if(!this.shadow){return}t.shadowColor="";t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0},_renderFill:function(t){if(!this.fill){return}t.save();if(this.fill.gradientTransform){var e=this.fill.gradientTransform;t.transform.apply(t,e)}if(this.fill.toLive){t.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)}if(this.fillRule==="evenodd"){t.fill("evenodd")}else{t.fill()}t.restore()},_renderStroke:function(t){if(!this.stroke||this.strokeWidth===0){return}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(t)}t.save();this._setLineDash(t,this.strokeDashArray,this._renderDashedStroke);if(this.stroke.gradientTransform){var e=this.stroke.gradientTransform;t.transform.apply(t,e)}if(this.stroke.toLive){t.translate(-this.width/2+this.stroke.offsetX||0,-this.height/2+this.stroke.offsetY||0)}t.stroke();t.restore()},clone:function(t,e){if(this.constructor.fromObject){return this.constructor.fromObject(this.toObject(e),t)}return new iws.Object(this.toObject(e))},cloneAsImage:function(t,e){var i=this.toDataURL(e);iws.util.loadImage(i,function(e){if(t){t(new iws.Image(e))}});return this},isType:function(t){return this.type===t},complexity:function(){return 0},toJSON:function(t){return this.toObject(t)},setColor:function(t){this.set("fill",t);return this},setAngle:function(t){var e=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;if(e){this._setOriginToCenter()}this.set("angle",t);if(e){this._resetOrigin()}return this},centerH:function(){this.canvas&&this.canvas.centerObjectH(this);return this},viewportCenterH:function(){this.canvas&&this.canvas.viewportCenterObjectH(this);return this},centerV:function(){this.canvas&&this.canvas.centerObjectV(this);return this},viewportCenterV:function(){this.canvas&&this.canvas.viewportCenterObjectV(this);return this},center:function(){this.canvas&&this.canvas.centerObject(this);return this},viewportCenter:function(){this.canvas&&this.canvas.viewportCenterObject(this);return this},remove:function(){this.canvas&&this.canvas.remove(this);return this},getLocalPointer:function(t,e){e=e||this.canvas.getPointer(t);var i=new iws.Point(e.x,e.y),n=this._getLeftTopCoords();if(this.angle){i=iws.util.rotatePoint(i,n,iws.util.degreesToRadians(-this.angle))}return{x:i.x-n.x,y:i.y-n.y}},_setupCompositeOperation:function(t){if(this.globalCompositeOperation){t.globalCompositeOperation=this.globalCompositeOperation}}})})();(function(){var t=iws.util.degreesToRadians,e={left:-.5,center:0,right:.5},i={top:-.5,center:0,bottom:.5};iws.util.extend(iws.Object.prototype,{translateToGivenOrigin:function(t,n,r,o,s){var a=t.x,l=t.y,h,c,u;if(typeof n==="string"){n=e[n]}else{n-=.5}if(typeof o==="string"){o=e[o]}else{o-=.5}h=o-n;if(typeof r==="string"){r=i[r]}else{r-=.5}if(typeof s==="string"){s=i[s]}else{s-=.5}c=s-r;if(h||c){u=this._getTransformedDimensions();a=t.x+h*u.x;l=t.y+c*u.y}return new iws.Point(a,l)},translateToCenterPoint:function(e,i,n){var r=this.translateToGivenOrigin(e,i,n,"center","center");if(this.angle){return iws.util.rotatePoint(r,e,t(this.angle))}return r},translateToOriginPoint:function(e,i,n){var r=this.translateToGivenOrigin(e,"center","center",i,n);if(this.angle){return iws.util.rotatePoint(r,e,t(this.angle))}return r},getCenterPoint:function(){var t=new iws.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(e,i,n){var r=this.getCenterPoint(),o,s;if(typeof i!=="undefined"&&typeof n!=="undefined"){o=this.translateToGivenOrigin(r,"center","center",i,n)}else{o=new iws.Point(this.left,this.top)}s=new iws.Point(e.x,e.y);if(this.angle){s=iws.util.rotatePoint(s,r,-t(this.angle))}return s.subtractEquals(o)},setPositionByOrigin:function(t,e,i){var n=this.translateToCenterPoint(t,e,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x);this.set("top",r.y)},adjustPosition:function(i){var n=t(this.angle),r=this.getWidth(),o=Math.cos(n)*r,s=Math.sin(n)*r,a,l;if(typeof this.originX==="string"){a=e[this.originX]}else{a=this.originX-.5}if(typeof i==="string"){l=e[i]}else{l=i-.5}this.left+=o*(l-a);this.top+=s*(l-a);this.setCoords();this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center";this.originY="center";this.left=t.x;this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=t.x;this.top=t.y;this._originalOriginX=null;this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})})();(function(){function t(t){return[new iws.Point(t.tl.x,t.tl.y),new iws.Point(t.tr.x,t.tr.y),new iws.Point(t.br.x,t.br.y),new iws.Point(t.bl.x,t.bl.y)]}var e=iws.util.degreesToRadians,i=iws.util.multiplyTransformMatrices;iws.util.extend(iws.Object.prototype,{oCoords:null,intersectsWithRect:function(e,i){var n=t(this.oCoords),r=iws.Intersection.intersectPolygonRectangle(n,e,i);return r.status==="Intersection"},intersectsWithObject:function(e){var i=iws.Intersection.intersectPolygonPolygon(t(this.oCoords),t(e.oCoords));return i.status==="Intersection"||e.isContainedWithinObject(this)||this.isContainedWithinObject(e)},isContainedWithinObject:function(e){var i=t(this.oCoords),n=0;for(;n<4;n++){if(!e.containsPoint(i[n])){return false}}return true},isContainedWithinRect:function(t,e){var i=this.getBoundingRect();return i.left>=t.x&&i.left+i.width<=e.x&&i.top>=t.y&&i.top+i.height<=e.y},containsPoint:function(t){if(!this.oCoords){this.setCoords()}var e=iws.util.find.getContainFromCoords(this.oCoords,t);if(e){e=e}return e},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){
return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();return iws.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){if(Math.abs(t)<this.minScaleLimit){if(t<0){return-this.minScaleLimit}else{return this.minScaleLimit}}return t},scale:function(t){t=this._constrainScale(t);if(t<0){this.flipX=!this.flipX;this.flipY=!this.flipY;t*=-1}this.scaleX=t;this.scaleY=t;this.setCoords();return this},scaleToWidth:function(t){var e=this.getBoundingRect().width/this.getWidth();return this.scale(t/this.width/e)},scaleToHeight:function(t){var e=this.getBoundingRect().height/this.getHeight();return this.scale(t/this.height/e)},setCoords:function(){var t=e(this.angle),i=this.getViewportTransform(),n=this._calculateCurrentDimensions(),r=n.x,o=n.y;if(r<0){r=Math.abs(r)}var s=Math.sin(t),a=Math.cos(t),l=r>0?Math.atan(o/r):0,h=r/Math.cos(l)/2,c=Math.cos(l+t)*h,u=Math.sin(l+t)*h,f=iws.util.transformPoint(this.getCenterPoint(),i),d=new iws.Point(f.x-c,f.y-u),g=new iws.Point(d.x+r*a,d.y+r*s),p=new iws.Point(d.x-o*s,d.y+o*a),v=new iws.Point(f.x+c,f.y+u),m=new iws.Point((d.x+p.x)/2,(d.y+p.y)/2),b=new iws.Point((g.x+d.x)/2,(g.y+d.y)/2),w=new iws.Point((v.x+g.x)/2,(v.y+g.y)/2),y=new iws.Point((v.x+p.x)/2,(v.y+p.y)/2),_=new iws.Point(b.x+s*this.rotatingPointOffset,b.y-a*this.rotatingPointOffset),x=new iws.Point(w.x+this.deletePointOffset*a,w.y+this.deletePointOffset*s);this.oCoords={tl:d,tr:g,br:v,bl:p,ml:m,mt:b,mr:w,mb:y,mtr:_,mrdel:x};this._setCornerCoords&&this._setCornerCoords(this.oCoords);this._setCornerCoords_del(this.oCoords);return this},_calcRotateMatrix:function(){if(this.angle){var t=e(this.angle),i=Math.cos(t),n=Math.sin(t);return[i,n,-n,i,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var t=this.getCenterPoint(),e=[1,0,0,1,t.x,t.y],n=this._calcRotateMatrix(),r=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,true),o=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0];o=i(o,e);o=i(o,n);o=i(o,r);return o},_calcDimensionsTransformMatrix:function(t,n,r){var o=[1,0,Math.tan(e(t)),1],s=[1,Math.tan(e(n)),0,1],a=this.scaleX*(r&&this.flipX?-1:1),l=this.scaleY*(r&&this.flipY?-1:1),h=[a,0,0,l],c=i(h,o,true);return i(c,s,true)}})})();(function(){var t=iws.util.degreesToRadians,e=function(){return typeof G_vmlCanvasManager!=="undefined"};iws.util.extend(iws.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||!this.active){return false}var e=t.x,i=t.y,n,r;this.__corner=0;for(var o in this.oCoords){if(!this.isControlVisible(o)){continue}if(o==="mtr"&&!this.hasRotatingPoint){continue}if(this.get("lockUniScaling")&&(o==="mt"||o==="mr"||o==="mb"||o==="ml")){continue}var s=iws.util.find.getContainFromCoords(this.oCoords[o].corner,{x:e,y:i});if(s){this.__corner=o;return o}}return false},findDeleteButton:function(t){},_setCornerCoords:function(e){var i=Math.sqrt(2*Math.pow(this.delIconSize,2))/2;var n=t(45-this.angle),r=this.cornerSize*.707106,o=r*Math.cos(n),s=r*Math.sin(n),a,l;for(var h in e){a=e[h].x;l=e[h].y;e[h].corner={tl:{x:a-s,y:l-o},tr:{x:a+o,y:l-s},bl:{x:a-o,y:l+s},br:{x:a+s,y:l+o}}}},_setCornerCoords_del:function(e){var i=t(45-this.angle),n=Math.sqrt(2)/2,r=this.delIconSize*n,o=r*Math.cos(i),s=r*Math.sin(i),a,l;var h="mrdel";a=e[h].x;l=e[h].y;e[h].corner={tl:{x:a-s,y:l-o},tr:{x:a+o,y:l-s},bl:{x:a-o,y:l+s},br:{x:a+s,y:l+o}}},_getNonTransformedDimensions:function(){var t=this.strokeWidth,e=this.width,i=this.height,n=true,r=true;if(this.type==="line"&&this.strokeLineCap==="butt"){r=e;n=i}if(r){i+=i<0?-t:t}if(n){e+=e<0?-t:t}return{x:e,y:i}},_getTransformedDimensions:function(t,e){if(typeof t==="undefined"){t=this.skewX}if(typeof e==="undefined"){e=this.skewY}var i=this._getNonTransformedDimensions(),n=i.x/2,r=i.y/2,o=[{x:-n,y:-r},{x:n,y:-r},{x:-n,y:r},{x:n,y:r}],s,a=this._calcDimensionsTransformMatrix(t,e,false),l;for(s=0;s<o.length;s++){o[s]=iws.util.transformPoint(o[s],a)}l=iws.util.makeBoundingBoxFromPoints(o);return{x:l.width,y:l.height}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),e=this._getTransformedDimensions(),i=e.x,n=e.y,r=iws.util.transformPoint(new iws.Point(i,n),t,true);return r.scalarAdd(2*this.padding)},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.group||!this.active){return this}e.save();var i=this.getCenterPoint(),n=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;e.translate(i.x,i.y);e.scale(1/r[0],1/r[3]);e.rotate(t(this.angle));e.fillStyle=this.selectionBackgroundColor;e.fillRect(-n.x/2,-n.y/2,n.x,n.y);e.restore();return this},drawDelete:function(t){var e=this.getViewportTransform(),i=this.calcTransformMatrix(),n;i=iws.util.multiplyTransformMatrices(e,i);n=iws.util.qrDecompose(i);t.save();t.translate(n.translateX,n.translateY);t.rotate(iws.util.degreesToRadians(this.angle));var r=this._calculateCurrentDimensions(),o=1/this.borderScaleFactor,s=r.x+o,a=r.y+o;if(this.isControlVisible("mrdel")){t.strokeStyle=this.borderColor;t.globalAlpha=.2;t.beginPath();t.moveTo(s/2,0);t.lineTo(s/2+this.deletePointOffset,0);t.closePath();t.stroke();t.globalAlpha=1;var l=this.delIconSize;this.imgDelete&&t.drawImage(this.imgDelete,s/2+this.deletePointOffset-this.imgDelete.width/2,-this.imgDelete.height/2)}t.restore()},drawBorders:function(t){if(!this.hasBorders){return this}var e=this._calculateCurrentDimensions(),i=1/this.borderScaleFactor,n=e.x+i,r=e.y+i;t.save();t.strokeStyle=this.borderColor;this._setLineDash(t,this.borderDashArray,null);t.strokeRect(-n/2,-r/2,n,r);if(this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var o=-r/2;t.beginPath();t.moveTo(0,o);t.lineTo(0,o-this.rotatingPointOffset);t.closePath();t.stroke()}t.restore();return this},drawBordersInGroup:function(t,e){if(!this.hasBorders){return this}var i=this._getNonTransformedDimensions(),n=iws.util.customTransformMatrix(e.scaleX,e.scaleY,e.skewX),r=iws.util.transformPoint(i,n),o=1/this.borderScaleFactor,s=r.x+o+2*this.padding,a=r.y+o+2*this.padding;t.save();this._setLineDash(t,this.borderDashArray,null);t.strokeStyle=this.borderColor;t.strokeRect(-s/2,-a/2,s,a);t.restore();return this},drawControls:function(t){if(!this.hasControls){return this}var e=this._calculateCurrentDimensions(),i=e.x,n=e.y,r=this.cornerSize,o=-(i+r)/2,s=-(n+r)/2,a=this.transparentCorners?"stroke":"fill";t.save();t.strokeStyle=t.fillStyle=this.cornerColor;if(!this.transparentCorners){t.strokeStyle=this.cornerStrokeColor}this._setLineDash(t,this.cornerDashArray,null);this._drawControl("tl",t,a,o,s);this._drawControl("tr",t,a,o+i,s);this._drawControl("bl",t,a,o,s+n);this._drawControl("br",t,a,o+i,s+n);if(!this.get("lockUniScaling")){this._drawControl("mt",t,a,o+i/2,s);this._drawControl("mb",t,a,o+i/2,s+n);this._drawControl("mr",t,a,o+i,s+n/2);this._drawControl("ml",t,a,o,s+n/2)}if(this.hasRotatingPoint){this._drawControl("mtr",t,a,o+i/2,s-this.rotatingPointOffset)}t.restore();return this},_drawControl:function(t,i,n,r,o){if(!this.isControlVisible(t)){return}var s=this.cornerSize,a=!this.transparentCorners&&this.cornerStrokeColor;switch(this.cornerStyle){case"circle":i.beginPath();i.arc(r+s/2,o+s/2,s/2,0,2*Math.PI,false);i[n]();if(a){i.stroke()}break;default:e()||this.transparentCorners||i.clearRect(r,o,s,s);i[n+"Rect"](r,o,s,s);if(a){i.strokeRect(r,o,s,s)}}},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){this._getControlsVisibility()[t]=e;return this},setControlsVisibility:function(t){t||(t={});for(var e in t){this.setControlVisible(e,t[e])}return this},_getControlsVisibility:function(){if(!this._controlsVisibility){this._controlsVisibility={tl:true,tr:true,br:true,bl:true,ml:true,mt:true,mr:true,mb:true,mtr:true,mrdel:true}}return this._controlsVisibility}})})();(function(){iws.util.extend(iws.Object.prototype,{_onCreateMouseDown:function(t){},_onCreateMouseMove:function(t){var e=this.canvas.trackMouse.getRect();this.set({left:e.left}).set({top:e.top});this.set("width",Math.abs(e.right-e.left)).set("height",Math.abs(e.bottom-e.top))},_onCreateMouseUp:function(t){this.setCoords()},restoreOriginXY:function(t,e){var i=this.translateToOriginPoint(this.getCenterPoint(),t,e);this.originX=t;this.originY=e;this.left=i.x;this.top=i.y}})})();(function(t){"use strict";var e=t.iws||(t.iws={}),i=e.util.extend,n={left:1,top:1,x1:1,x2:1,y1:1,y2:1,angle:1};if(e.objectLine){e.warn("iws.Line is already defined");return}function r(){this.initialize.apply(this,arguments)}e.objectLine=e.util.createInheritClass(r,e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,lineHeight:14,initialize:function(t){t=t||{};this.callSuper("initialize",t);this.setControlsVisibility({tl:false,tr:false,br:false,bl:false,ml:true,mt:false,mr:true,mb:false,mtr:true});this._initValue(t);this.setCoords();this.originX="left";this.originY="top"},_initValue:function(t){t||(t={});this.width=this.width||e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.height=this.height||this.lineHeight;this.angle=this.angle||e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle;this.left=this.left||this.x1;this.top=this.top||this.y1-this.lineHeight/2},_changeWidthHeight:function(){this.width=e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.height=this.lineHeight;this.angle=e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle;this.left=this.x1;this.top=this.y1-this.lineHeight/2},_cornerMove:function(t,i){if(this.__corner==="mr"){this.set("x2",t).set("y2",i);this.width=e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.angle=e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle}else if(this.__corner==="ml"){this.set("x1",t).set("y1",i);this.width=e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.angle=e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle;this.left=this.x1;this.top=this.y1-this.lineHeight/2}},_set:function(t,e){this.callSuper("_set",t,e);if(typeof n[t]!=="undefined"){}return this},translateOffset:function(t,e,i,n){var r=t-i,o=e-n,s=!this.get("lockMovementX")&&this.left!==r,a=!this.get("lockMovementY")&&this.top!==o;var l=this.x2-this.x1;this.x1=r;this.x2=l+this.x1;var h=this.y2-this.y1;this.y1=o+this.lineHeight/2;this.y2=h+this.y1;this.left=this.x1;this.top=o;return s||a},_render:function(t,e){t.beginPath();if(e){var i=this.getCenterPoint();t.translate(i.x-this.strokeWidth/2,i.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&supportsLineDash){t.moveTo(-this.width/2,0);t.lineTo(this.width/2,0)}t.lineWidth=this.strokeWidth;var n=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle;this.stroke&&this._renderStroke(t);t.strokeStyle=n},toObject:function(t){var e=2;return i(this.callSuper("toObject",t),{x1:parseFloat(Number(this.x1).toFixed(e)),y1:parseFloat(Number(this.y1).toFixed(e)),x2:parseFloat(Number(this.x2).toFixed(e)),y2:parseFloat(Number(this.y2).toFixed(e))})},complexity:function(){return 1},setCoords:function(){this.callSuper("setCoords");this.x1=this.oCoords.ml.x;this.y1=this.oCoords.ml.y;this.x2=this.oCoords.mr.x;this.y2=this.oCoords.mr.y;return this}});e.objectLine.fromObject=function(t,i){var n=new e.objectLine(t);i&&i(n);return n}})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectLine.prototype,{_onCreateMouseDown:function(t){var e=this.canvas.getPointer(t);this.set({x1:e.x,y1:e.y,x2:e.x,y2:e.y})},_onCreateMouseMove:function(t){var e=this.canvas.getPointer(t);this.set({x2:e.x}).set({y2:e.y});this._changeWidthHeight()},_onCreateMouseUp:function(t){this.callSuper("_onCreateMouseUp",t)},_objectSizeChangeScale:function(t,e,i){var n=function(t,e,i,n){var r={width:e.x-t.x,height:e.y-t.y};return{x:i.x-r.width*n,y:i.y-r.height*n}};var r={x:this.get("left")+this.get("width")/2,y:this.get("top")+this.get("height")/2};var o={x:i.x-e.x,y:i.y-e.y};var s=n(r,o,i,t);var a=n({x:this.x1,y:this.y1},o,i,t);var l=n({x:this.x2,y:this.y2},o,i,t);this.set({left:s.x-t*(this.width/2),top:s.y-t*(this.height/2),x1:a.x,y1:a.y,x2:l.x,y2:l.y,width:t*this.get("width"),height:t*this.get("height")});this.setCoords()}})})();(function(){iws.util.extend(iws.objectLine.prototype,{})})();(function(t){"use strict";var e=t.iws||(t.iws={}),i=e.util.array.min,n=e.util.array.max,r=e.util.extend,o=Object.prototype.toString,s=e.util.drawArc,a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};if(e.objectPath){e.warn("iws.Path is already defined");return}function h(){this.initialize.apply(this,arguments)}e.objectPath=e.util.createInheritClass(h,e.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(t,e){e=e||{};this.callSuper("initialize",e);if(!t){t=[]}var i=o.call(t)==="[object Array]";this.path=i?t:t.match&&t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path){return}if(!i){this.path=this._parsePath()}this._setPositionDimensions(e);if(e.sourcePath){this.setSourcePath(e.sourcePath)}},_setPositionDimensions:function(t){var e=this._parseDimensions();this.minX=e.left;this.minY=e.top;this.width=e.width;this.height=e.height;if(typeof t.left==="undefined"){this.left=e.left+(this.originX==="center"?this.width/2:this.originX==="right"?this.width:0)}if(typeof t.top==="undefined"){this.top=e.top+(this.originY==="center"?this.height/2:this.originY==="bottom"?this.height:0)}if(e.width>0){e.width=e.width}this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_renderPathCommands:function(t){var e,i=null,n=0,r=0,o=0,a=0,l=0,h=0,c,u,f=-this.pathOffset.x,d=-this.pathOffset.y;if(this.group&&this.group.type==="path-group"){f=0;d=0}t.beginPath();for(var g=0,p=this.path.length;g<p;++g){e=this.path[g];switch(e[0]){case"l":o+=e[1];a+=e[2];t.lineTo(o+f,a+d);break;case"L":o=e[1];a=e[2];t.lineTo(o+f,a+d);break;case"h":o+=e[1];t.lineTo(o+f,a+d);break;case"H":o=e[1];t.lineTo(o+f,a+d);break;case"v":a+=e[1];t.lineTo(o+f,a+d);break;case"V":a=e[1];t.lineTo(o+f,a+d);break;case"m":o+=e[1];a+=e[2];n=o;r=a;t.moveTo(o+f,a+d);break;case"M":o=e[1];a=e[2];n=o;r=a;t.moveTo(o+f,a+d);break;case"c":c=o+e[5];u=a+e[6];l=o+e[3];h=a+e[4];t.bezierCurveTo(o+e[1]+f,a+e[2]+d,l+f,h+d,c+f,u+d);o=c;a=u;break;case"C":o=e[5];a=e[6];l=e[3];h=e[4];t.bezierCurveTo(e[1]+f,e[2]+d,l+f,h+d,o+f,a+d);break;case"s":c=o+e[3];u=a+e[4];if(i[0].match(/[CcSs]/)===null){l=o;h=a}else{l=2*o-l;h=2*a-h}t.bezierCurveTo(l+f,h+d,o+e[1]+f,a+e[2]+d,c+f,u+d);l=o+e[1];h=a+e[2];o=c;a=u;break;case"S":c=e[3];u=e[4];if(i[0].match(/[CcSs]/)===null){l=o;h=a}else{l=2*o-l;h=2*a-h}t.bezierCurveTo(l+f,h+d,e[1]+f,e[2]+d,c+f,u+d);o=c;a=u;l=e[1];h=e[2];break;case"q":c=o+e[3];u=a+e[4];l=o+e[1];h=a+e[2];t.quadraticCurveTo(l+f,h+d,c+f,u+d);o=c;a=u;break;case"Q":c=e[3];u=e[4];t.quadraticCurveTo(e[1]+f,e[2]+d,c+f,u+d);o=c;a=u;l=e[1];h=e[2];break;case"t":c=o+e[1];u=a+e[2];if(i[0].match(/[QqTt]/)===null){l=o;h=a}else{l=2*o-l;h=2*a-h}t.quadraticCurveTo(l+f,h+d,c+f,u+d);o=c;a=u;break;case"T":c=e[1];u=e[2];if(i[0].match(/[QqTt]/)===null){l=o;h=a}else{l=2*o-l;h=2*a-h}t.quadraticCurveTo(l+f,h+d,c+f,u+d);o=c;a=u;break;case"a":s(t,o+f,a+d,[e[1],e[2],e[3],e[4],e[5],e[6]+o+f,e[7]+a+d]);o+=e[6];a+=e[7];break;case"A":s(t,o+f,a+d,[e[1],e[2],e[3],e[4],e[5],e[6]+f,e[7]+d]);o=e[6];a=e[7];break;case"z":case"Z":o=n;a=r;t.closePath();break}i=e}},_render:function(t){this._renderPathCommands(t);this._renderFill(t);this._renderStroke(t)},toObject:function(t){var e=2;var i=r(this.callSuper("toObject",t),{path:this.path.map(function(t){var i=t.slice();var n=i.map(function(t){if(typeof t==="number"&&!isNaN(t)){t=parseFloat(Number(t).toFixed(e))}return t});return n}),pathOffset:function(){for(var t in this.pathOffset){if(typeof this.pathOffset[t]==="number"){this.pathOffset[t]=parseFloat(Number(this.pathOffset[t]).toFixed(e))}}}.bind(this)});if(this.sourcePath){i.sourcePath=this.sourcePath}if(this.transformMatrix){i.transformMatrix=this.transformMatrix}return i},toDatalessObject:function(t){var e=this.toObject(t);if(this.sourcePath){e.path=this.sourcePath}delete e.sourcePath;return e},_parsePath:function(){var t=[],e=[],i,n,r=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,o,s;for(var h=0,c,u=this.path.length;h<u;h++){i=this.path[h];s=i.slice(1).trim();e.length=0;while(o=r.exec(s)){e.push(o[0])}c=[i.charAt(0)];for(var f=0,d=e.length;f<d;f++){n=parseFloat(e[f]);if(!isNaN(n)){c.push(n)}}var g=c[0],p=a[g.toLowerCase()],v=l[g]||g;if(c.length-1>p){for(var m=1,b=c.length;m<b;m+=p){t.push([g].concat(c.slice(m,m+p)));g=v}}else{t.push(c)}}return t},_parseDimensions:function(){var t=[],r=[],o,s=null,a=0,l=0,h=0,c=0,u=0,f=0,d,g,p;for(var v=0,m=this.path.length;v<m;++v){o=this.path[v];switch(o[0]){case"l":h+=o[1];c+=o[2];p=[];break;case"L":h=o[1];c=o[2];p=[];break;case"h":h+=o[1];p=[];break;case"H":h=o[1];p=[];break;case"v":c+=o[1];p=[];break;case"V":c=o[1];p=[];break;case"m":h+=o[1];c+=o[2];a=h;l=c;p=[];break;case"M":h=o[1];c=o[2];a=h;l=c;p=[];break;case"c":d=h+o[5];g=c+o[6];u=h+o[3];f=c+o[4];p=e.util.getBoundsOfCurve(h,c,h+o[1],c+o[2],u,f,d,g);h=d;c=g;break;case"C":h=o[5];c=o[6];u=o[3];f=o[4];p=e.util.getBoundsOfCurve(h,c,o[1],o[2],u,f,h,c);break;case"s":d=h+o[3];g=c+o[4];if(s[0].match(/[CcSs]/)===null){u=h;f=c}else{u=2*h-u;f=2*c-f}p=e.util.getBoundsOfCurve(h,c,u,f,h+o[1],c+o[2],d,g);u=h+o[1];f=c+o[2];h=d;c=g;break;case"S":d=o[3];g=o[4];if(s[0].match(/[CcSs]/)===null){u=h;f=c}else{u=2*h-u;f=2*c-f}p=e.util.getBoundsOfCurve(h,c,u,f,o[1],o[2],d,g);h=d;c=g;u=o[1];f=o[2];break;case"q":d=h+o[3];g=c+o[4];u=h+o[1];f=c+o[2];p=e.util.getBoundsOfCurve(h,c,u,f,u,f,d,g);h=d;c=g;break;case"Q":u=o[1];f=o[2];p=e.util.getBoundsOfCurve(h,c,u,f,u,f,o[3],o[4]);h=o[3];c=o[4];break;case"t":d=h+o[1];g=c+o[2];if(s[0].match(/[QqTt]/)===null){u=h;f=c}else{u=2*h-u;f=2*c-f}p=e.util.getBoundsOfCurve(h,c,u,f,u,f,d,g);h=d;c=g;break;case"T":d=o[1];g=o[2];if(s[0].match(/[QqTt]/)===null){u=h;f=c}else{u=2*h-u;f=2*c-f}p=e.util.getBoundsOfCurve(h,c,u,f,u,f,d,g);h=d;c=g;break;case"a":p=e.util.getBoundsOfArc(h,c,o[1],o[2],o[3],o[4],o[5],o[6]+h,o[7]+c);h+=o[6];c+=o[7];break;case"A":p=e.util.getBoundsOfArc(h,c,o[1],o[2],o[3],o[4],o[5],o[6],o[7]);h=o[6];c=o[7];break;case"z":case"Z":h=a;c=l;break}s=o;p.forEach(function(e){t.push(e.x);r.push(e.y)});t.push(h);r.push(c)}var b=i(t)||0,w=i(r)||0,y=n(t)||0,_=n(r)||0,x=y-b,C=_-w,k={left:b,top:w,width:x,height:C};return k}});e.objectPath.fromObject=function(t,i){var n=new e.objectPath(t.path,t);i&&i(n);return n};e.objectPath.async=true})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectPath.prototype,{_onCreateMouseDown:function(t){this.set({fill:null});var e=this.canvas.getPointer(t);this._addPoint(["M",e.x,e.y])},_onCreateMouseMove:function(t){var e=this.canvas.getPointer(t);this._addPoint(["L",e.x,e.y]);this.canvas.renderAll()},_onCreateMouseUp:function(t){this.callSuper("_onCreateMouseUp",t)},_addPoint:function(t){this.path.push(t);this._setPositionDimensions({})},_objectSizeChangeScale:function(t,e,i){var n=function(t,e,i,n){var r={width:e.x-t.x,height:e.y-t.y};return{x:i.x-r.width*n,y:i.y-r.height*n}};var r={x:this.get("left")+this.get("width")/2,y:this.get("top")+this.get("height")/2};var o={x:i.x-e.x,y:i.y-e.y};var s=n(r,o,i,t);for(var a=0;a<this.path.length;a++){var l=this.path[a];if(l.length>=3){var h=n({x:l[1],y:l[2]},o,i,t);l[1]=h.x;l[2]=h.y;if(l.length==5){h=n({x:l[3],y:l[4]},o,i,t);l[3]=h.x;l[4]=h.y}}}this.pathOffset=n({x:this.pathOffset.x,y:this.pathOffset.y},o,i,t);this.set({left:s.x-t*(this.get("width")/2),top:s.y-t*(this.get("height")/2),width:t*this.get("width"),height:t*this.get("height")});this.setCoords()}})})();(function(t){"use strict";var e=iws.Object.prototype.stateProperties.concat();e.push("rx","ry","x","y");function i(){this.initialize.apply(this,arguments)}iws.objectRect=iws.util.createInheritClass(i,iws.Object,{stateProperties:e,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(t){t=t||{};this.callSuper("initialize",t);this._initRxRy()},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx}else if(this.ry&&!this.rx){this.rx=this.ry}},_render:function(t,e){if(this.width===1&&this.height===1){t.fillRect(-.5,-.5,1,1);return}var i=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0,r=this.width,o=this.height,s=e?this.left:-this.width/2,a=e?this.top:-this.height/2,l=i!==0||n!==0,h=1-.5522847498;t.beginPath();t.moveTo(s+i,a);iws.log("moveTo",s+i,a);t.lineTo(s+r-i,a);l&&t.bezierCurveTo(s+r-h*i,a,s+r,a+h*n,s+r,a+n);t.lineTo(s+r,a+o-n);l&&t.bezierCurveTo(s+r,a+o-h*n,s+r-h*i,a+o,s+r-i,a+o);t.lineTo(s+i,a+o);l&&t.bezierCurveTo(s+h*i,a+o,s,a+o-h*n,s,a+o-n);t.lineTo(s,a+n);l&&t.bezierCurveTo(s,a+h*n,s+h*i,a,s+i,a);t.closePath();this._renderFill(t);this._renderStroke(t)},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,n=this.width,r=this.height;t.beginPath();iws.util.drawDashedLine(t,e,i,e+n,i,this.strokeDashArray);iws.util.drawDashedLine(t,e+n,i,e+n,i+r,this.strokeDashArray);iws.util.drawDashedLine(t,e+n,i+r,e,i+r,this.strokeDashArray);iws.util.drawDashedLine(t,e,i+r,e,i,this.strokeDashArray);t.closePath()},toObject:function(t){var e=iws.util.extend(this.callSuper("toObject",t),{rx:this.get("rx")||0,ry:this.get("ry")||0});return e},complexity:function(){return 1}});iws.objectRect.fromObject=function(t,e){var i=new iws.objectRect(t);e&&e(i);return i}})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectRect.prototype,{_onCreateMouseDown:function(t){var e=this.canvas.getPointer(t);this.set({left:e.x,top:e.y,originX:"left",originY:"top",width:10,height:10})},_onCreateMouseMove:function(t){this.callSuper("_onCreateMouseMove",t)},_onCreateMouseUp:function(t){this.callSuper("_onCreateMouseUp",t)},_objectSizeChangeScale:function(t,e,i){var n=function(t,e,i,n){var r={width:e.x-t.x,height:e.y-t.y};return{x:i.x-r.width*n,y:i.y-r.height*n}};var r={x:this.get("left")+this.get("width")/2,y:this.get("top")+this.get("height")/2};var o={x:i.x-e.x,y:i.y-e.y};var s=n(r,o,i,t);this.set({left:s.x-t*(this.width/2),top:s.y-t*(this.height/2),width:t*this.get("width"),height:t*this.get("height")});this.setCoords()}})})();(function(t){"use strict";var e=t.iws||(t.iws={}),i=e.util.extend,n=e.util.clone,r=e.util.toFixed,o=e.Object.NUM_FRACTION_DIGITS,s=2;if(e.objectText){e.warn("iws.Text is already defined");return}var a=e.Object.prototype.stateProperties.concat();a.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight");function l(){this.initialize.apply(this,arguments)}e.objectText=e.util.createInheritClass(l,e.Object,{_dimensionAffectingProps:{fontSize:true,fontWeight:true,fontFamily:true,fontStyle:true,lineHeight:true,text:true,charSpacing:true,textAlign:true,strokeWidth:true,width:true,height:true},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.2,stateProperties:a,stroke:null,shadow:null,charSpacing:0,minWidth:20,dynamicMinWidth:2,__cachedLines:null,baseScale:1,initialize:function(t,e){e=e||{};this.callSuper("initialize",e);this.text=t;this.ctx=document.createElement("canvas").getContext("2d");this.initBehavior();this.setControlsVisibility({tl:false,tr:false,br:false,bl:false,ml:true,mt:false,mr:true,mb:false,mtr:true})},_render:function(t){this._setOpacity(t);this._setShadow(t);this._setupCompositeOperation(t);this._renderBackground(t);this._setStrokeStyles(t);this._setFillStyles(t);this._renderText(t);this._renderTextDecoration(t)},_renderText:function(t){this._renderTextFill(t);this._renderTextStroke(t)},_setTextStyles:function(t){t.textBaseline="alphabetic";t.font=this._getFontDeclaration()},_getTextHeight:function(){var t,e=0;for(var i=0,n=this._textLines.length;i<n;i++){t=this._getHeightOfLine();e+=t}return e},_getTextWidth:function(t){var e=this._getLineWidth(t,0);for(var i=1,n=this._textLines.length;i<n;i++){var r=this._getLineWidth(t,i);if(r>e){e=r}}return e},_getNonTransformedDimensions:function(){return{x:this.width,y:this.height}},_renderChars:function(t,e,i,n,r){var o=t.slice(0,-4),s,a;if(this[o].toLive){var l=-this.width/2+this[o].offsetX||0,h=-this.height/2+this[o].offsetY||0;e.save();e.translate(l,h);n-=l;r-=h}if(this.charSpacing!==0){var c=this._getWidthOfCharSpacing();i=i.split("");for(var u=0,f=i.length;u<f;u++){s=i[u];a=e.measureText(s).width+c;e[t](s,n,r);n+=a>0?a:0}}else{e[t](i,n,r)}this[o].toLive&&e.restore()},_renderTextLine:function(t,e,i,n,r,o){var s=this._getLineWidth(e,o);if(this.textAlign!=="justify"||this.width<s){this._renderChars(t,e,i,n,r,o);return}var a=i.split(/\s+/),l=0,h=this._getWidthOfWords(e,a.join(""),o,0),c=this.width-h,u=a.length-1,f=u>0?c/u:0,d=0,g;for(var p=0,v=a.length;p<v;p++){while(i[l]===" "&&l<i.length){l++}g=a[p];this._renderChars(t,e,g,n+d,r,o,l);d+=this._getWidthOfWords(e,g,o,l)+f;l+=g.length}},_getWidthOfWords:function(t,e){var i=t.measureText(e).width,n,r;if(this.charSpacing!==0){n=e.split("").length;r=n*this._getWidthOfCharSpacing();i+=r}return i>0?i:0},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},isEmptyStyles:function(){return true},_renderTextCommon:function(t,e){var i=0,n=this._getLeftOffset(),r=this._getTopOffset();for(var o=0,s=this._textLines.length;o<s;o++){var a=this._getHeightOfLine(t,o),l=a/this.lineHeight,h=this._getLineWidth(t,o),c=this._getLineLeftOffset(h);this._renderTextLine(e,t,this._textLines[o],n+c,r+i+l,o);i+=a}},_renderTextFill:function(t){if(!this.fill&&this.isEmptyStyles()){return}this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){if((!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()){return}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(t)}t.save();this._setLineDash(t,this.strokedashArray);t.beginPath();this._renderTextCommon(t,"strokeText");t.closePath();t.restore()},_getHeightOfLine:function(){return this.fontSize*this.baseScale*this.lineHeight},_getLineLeftOffset:function(t){if(this.textAlign==="center"){return(this.width-t)/2}if(this.textAlign==="right"){return this.width-t}return 0},_clearCache:function(){this.__lineWidths=[]},_getLineWidth:function(t,e){if(this.__lineWidths[e]){return this.__lineWidths[e]===-1?this.width:this.__lineWidths[e]}var i,n,r=this._textLines[e];if(r===""){i=0}else{i=this._measureLine(t,e)}this.__lineWidths[e]=i;if(i&&this.textAlign==="justify"){n=r.split(/\s+/);if(n.length>1){this.__lineWidths[e]=-1}}return i},_getWidthOfCharSpacing:function(){if(this.charSpacing!==0){return this.fontSize*this.baseScale*this.charSpacing/1e3}return 0},_measureLine:function(t,e){var i=this._textLines[e],n=t.measureText(i).width,r=0,o,s;if(this.charSpacing!==0){o=i.split("").length;r=(o-1)*this._getWidthOfCharSpacing()}s=n+r;return s>0?s:0},_renderTextDecoration:function(t){if(!this.textDecoration){return}var e=this.height/2,i=this,n=[];function r(n){var r,o=0,s,a,l,h,c,u;var f=i.fontSize*this.baseScale;for(r=0,s=i._textLines.length;r<s;r++){h=i._getLineWidth(t,r);c=i._getLineLeftOffset(h);u=i._getHeightOfLine(t,r);for(a=0,l=n.length;a<l;a++){t.fillRect(i._getLeftOffset()+c,o+n[a]*f-e,h,f/15)}o+=u}}if(this.textDecoration.indexOf("underline")>-1){n.push(.85)}if(this.textDecoration.indexOf("line-through")>-1){n.push(.43)}if(this.textDecoration.indexOf("overline")>-1){n.push(-.12)}if(n.length>0){r(n)}},_getFontDeclaration:function(){return[this.fontStyle,this.fontWeight,this.fontSize*this.baseScale+"px",this.fontFamily].join(" ")},render:function(t,e,i){if(!this.visible){return}t.save();this.baseScale=i;this._setTextStyles(t);this.dynamicMinWidth=0;this._textLines=this._splitTextIntoLines();this._clearCache();if(this.width<this.getMinWidth()){this.width=this.getMinWidth()}this.height=this._getTextHeight();this.setCoords();this.drawSelectionBackground(t);if(!e){this.transform(t)}if(this.transformMatrix){t.transform.apply(t,this.transformMatrix)}this._render(t);t.restore();this.drawDelete(t)},_getWidthOfSpace:function(t,e){if(this.__widthOfSpace[e]){return this.__widthOfSpace[e]}var i=this._textLines[e],n=this._getWidthOfWords(t,i,e,0),r=this.width-n,o=i.length-i.replace(this._reSpacesAndTabs,"").length,s=Math.max(r/o,t.measureText(" ").width);this.__widthOfSpace[e]=s;return s},_wrapText:function(t,e){var i=e.split(this._reNewline),n=[],r;for(r=0;r<i.length;r++){n=n.concat(this._wrapLine(t,i[r],r))}return n},_getWidthOfChar:function(t,e,i,n){if(!this._isMeasuring&&this.textAlign==="justify"&&this._reSpacesAndTabs.test(e)){return this._getWidthOfSpace(t,i)}t.save();var r=this._applyCharStylesGetWidth(t,e,i,n);if(this.charSpacing!==0){r+=this._getWidthOfCharSpacing()}t.restore();return r>0?r:0},_measureText:function(t,e,i,n){var r=0;n=n||0;for(var o=0,s=e.length;o<s;o++){r+=this._getWidthOfChar(t,e[o],i,o+n)}return r},_wrapLine:function(t,e,i){var n=0,r=[],o="",s=e.split(" "),a="",l=0,h=" ",c=0,u=0,f=0,d=true,g=this._getWidthOfCharSpacing();for(var p=0;p<s.length;p++){a=s[p];c=t.measureText(a).width;l+=a.length;n+=u+c-g;if(n>=this.width&&!d){r.push(o);o="";n=c;d=true}else{n+=g}if(!d){o+=h}o+=a;u=t.measureText(h).width;l++;d=false;if(c>f){f=c}}p&&r.push(o);if(f>this.dynamicMinWidth){this.dynamicMinWidth=f-g}return r},_splitTextIntoLines:function(){var t=this.textAlign;this.ctx.save();this._setTextStyles(this.ctx);this.textAlign="left";var e=this._wrapText(this.ctx,this.text);this.textAlign=t;this.ctx.restore();this._textLines=e;this._styleMap=this._generateStyleMap();return e},_generateStyleMap:function(){var t=0,e=0,i=0,n={};for(var r=0;r<this._textLines.length;r++){if(this.text[i]==="\n"&&r>0){e=0;i++;t++}else if(this.text[i]===" "&&r>0){e++;i++}n[r]={line:t,offset:e};i+=this._textLines[r].length;e+=this._textLines[r].length}return n},toObject:function(t){var e=i(this.callSuper("toObject",t),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,charSpacing:this.charSpacing,minWidth:this.minWidth});return e},_set:function(t,e){this.callSuper("_set",t,e);if(t in this._dimensionAffectingProps){this.setCoords()}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)}});e.objectText.fromObject=function(t,i){var r=new e.objectText(t.text,n(t));i&&i(r);return r}})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectText.prototype,{initBehavior:function(){this.initSelect();this.initDeselect();this.initMousedownHandler();this.initMouseupHandler();this.initDoubleClickSimulation();this.initTextClickHandler()},initSelect:function(){this.observe("selected",function(t){setTimeout(function(){this.selected=true}.bind(this),100)})},initDeselect:function(){this.observe("deselected",function(t){this.selected=false})},initMousedownHandler:function(){this.observe("mousedown",function(t){t.target;var e=this.canvas.getPointer(t.e);this.__mousedownX=e.x;this.__mousedownY=e.y;this.__isMousedown=true;this.__lastSelected=this.selected})},_isObjectMoved:function(t){var e=this.canvas.getPointer(t);return this.__mousedownX!==e.x||this.__mousedownY!==e.y},initMouseupHandler:function(){this.observe("mouseup",function(t){this.__isMousedown=false;if(this._isObjectMoved(t.e)){return}if(this.__lastSelected&&!this.__corner){this.fire("textClick",t)}this.selected=true})},initTextClickHandler:function(){this.observe("textClick",function(){this.visible=false;this.active=false;this.canvas.renderAll();var t=this.fontSize*this.baseScale;var e=1.2;var i=$('<textarea class="annotText"></textarea>');i.val(this.text);i.css({left:this.left,top:this.top,width:this.width,height:this.height+2,"font-family":"Times New Roman","font-size":t+"px",color:this.fill,background:this.backgroundColor,position:"absolute",
"line-height":e,border:"0 none white",padding:0,outline:"none","IME-MODE":"active"}).appendTo($(this.canvas.pageContainer));var n=this;i.on("focusout blur",function(t){if($(this).val()!=""){n.set("text",$(this).val());n.set("width",i.width());n.set("height",i.height())}n.visible=true;n.active=true;n.canvas.renderAll();$(this).remove()});i.on("input",function(){i.css({"overflow-y":"hidden"}).height(i[0].scrollHeight)});setTimeout(function(){i.select()},1)})},initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.observe("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(t){this.__newClickTime=+new Date;var e=this.canvas.getPointer(t.e);if(this.isTripleClick(e)){this.fire("tripleclick",t);this._stopEvent(t.e)}else if(this.isDoubleClick(e)){this.fire("dblclick",t);this._stopEvent(t.e)}this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=e},isDoubleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault();t.stopPropagation&&t.stopPropagation()}})})();(function(){iws.util.extend(iws.objectText.prototype,{_objectSizeChangeScale:function(t,e,i){var n=function(t,e,i,n){var r={width:e.x-t.x,height:e.y-t.y};return{x:i.x-r.width*n,y:i.y-r.height*n}};var r={x:this.get("left")+this.get("width")/2,y:this.get("top")+this.get("height")/2};var o={x:i.x-e.x,y:i.y-e.y};var s=n(r,o,i,t);this.set({left:s.x-t*(this.get("width")/2),top:s.y-t*(this.get("height")/2),width:t*this.get("width"),height:t*this.get("height")});this.setCoords()}})})();(function(){iws.toolbar.annotation=function(t){this.page=t;this.initialize()};iws.toolbar.annotation.prototype={mappingParam:{fillColor:"fill",strokeColor:"stroke",fontColor:"fill"},mappingObject:{path:"annotDrawFree",line:"annotDrawLine",rect:"annotDrawRect",text:"annotDrawText"},configProperty:{strokeWidth:{value:".js-selected-properties-stroke-width-value",parent:".js-selected-properties-stroke-width"},strokeColor:{value:".js-selected-properties-stroke-color-value",parent:".js-selected-properties-stroke-color"},fillColor:{value:".js-selected-properties-fill-color-value",parent:".js-selected-properties-fill-color"},backgroundColor:{value:".js-selected-properties-background-color-value",parent:".js-selected-properties-background-color"},fontFamily:{value:".js-selected-properties-font-family-value",parent:".js-selected-properties-font-family"},fontColor:{value:".js-selected-properties-font-color-value",parent:".js-selected-properties-font-color"},fontSize:{value:".js-selected-properties-font-size-value",parent:".js-selected-properties-font-size"},fontStyle:{value:".js-selected-properties-font-style-value",parent:".js-selected-properties-font-style"},fontWeight:{value:".js-selected-properties-font-weight-value",parent:".js-selected-properties-font-weight"}},initialize:function(){this._makeProperties();this._makeToolbar();this._eventListen();var t=function(t){return function(e){var i=this._getDomElementValue($(e.target));var n=this.properties[t].getValue(i);this.properties[t].setValue(n);var r=this.page.getActiveObject();if(r){r.set(this.mappingParam[t]||t,n);this.page.renderAll()}}};this._eachPropertyConfig(function(e,i){var n=$(i.value);var r=this.properties[e].getValue();n.change(t(e).bind(this));this._setDomElementValue(n,r)}.bind(this));this._updateProperty("",[])},getInitParam:function(t){var e=this._toolProperties(t);var i={};e.forEach(function(t){var e=this.mappingParam[t]||t;var n=this.properties[t].getValue();i[e]=n}.bind(this));return i},_makeProperties:function(){var t=function(t){this.parser=t.parser||function(t){return t};this.initial=t.initial;this.save=t.save||function(){}};var e={};var i={fillColor:"iws.viewer.annotation.fillColor",strokeColor:"iws.viewer.annotation.strokeColor",strokeWidth:"iws.viewer.annotation.strokeWidth",fontFamily:"iws.viewer.annotation.fontFamily",fontSize:"iws.viewer.annotation.fontSize",fontStyle:"iws.viewer.annotation.fontStyle",fontWeight:"iws.viewer.annotation.fontWeight",fontColor:"iws.viewer.annotation.fontColor",backgroundColor:"iws.viewer.annotation.backgroundColor"};var n={fillColor:new t({initial:function(){return localStorage.getItem(i.fillColor)||"rgba(0, 0, 200, 0.5)"}(),save:function(t){localStorage.setItem(i.fillColor,t)}}),strokeColor:new t({initial:function(){return localStorage.getItem(i.strokeColor)||"red"}(),save:function(t){localStorage.setItem(i.strokeColor,t)}}),strokeWidth:new t({initial:function(){var t=localStorage.getItem(i.strokeWidth);return t&&isNaN(t)?1:t||2}(),parser:function(t){return parseInt(t,10)},save:function(t){localStorage.setItem(i.strokeWidth,t)}}),fontFamily:new t({initial:function(){return localStorage.getItem(i.fontFamily)||"sans-serif"}(),save:function(t){localStorage.setItem(i.fontFamily,t)}}),fontSize:new t({initial:function(){return localStorage.getItem(i.fontSize)||16}(),parser:function(t){return parseInt(t,10)},save:function(t){localStorage.setItem(i.fontSize,t)}}),fontStyle:new t({initial:function(){return localStorage.getItem(i.fontStyle)||"normal"}(),save:function(t){localStorage.setItem(i.fontStyle,t)}}),fontWeight:new t({initial:function(){return localStorage.getItem(i.fontWeight)||"normal"}(),save:function(t){localStorage.setItem(i.fontWeight,t)}}),fontColor:new t({initial:function(){return localStorage.getItem(i.fontColor)||"black"}(),save:function(t){localStorage.setItem(i.fontColor,t)}}),backgroundColor:new t({initial:function(){return localStorage.getItem(i.backgroundColor)||"rgba(240, 240, 240, 0.9)"}(),save:function(t){localStorage.setItem(i.backgroundColor,t)}})};for(var r in n){if(n.hasOwnProperty(r)){var o=n[r];var s=this;e[r]=function(t,e){var i=e.initial;return{getValue:function(n){if(typeof n!="undefined"){i=e.parser(n);s.fire("property:change",t)}return i},setValue:function(t){e.save(t)}}}(r,o)}}this.properties=e},_setDomElementValue:function(t,e){if(e===null||e=="none"){return}if(t.is('[type="checkbox"]')){t.prop("checked",e==t.val())}else{t.val((e||"").toString())}t.trigger("change")},_getDomElementValue:function(t){if(t.is('[type="checkbox"]')){if(t.prop("checked")){return t.val()}else{return"normal"}}else{return t.val()}},_toolProperties:function(t){switch(t){case"annotDrawFree":case"annotDrawLine":return["strokeColor","strokeWidth"];case"annotDrawRect":return["fillColor","strokeColor","strokeWidth"];case"annotDrawText":return["fontColor","backgroundColor","fontFamily","fontStyle","fontSize","fontWeight"];default:return[]}},_eachPropertyConfig:function(t){for(var e in this.configProperty){if(this.configProperty.hasOwnProperty(e)){t(e,this.configProperty[e])}}},_updateDOM:function(t){var e=this.mappingObject[t.target.type]||"";var i={};var n=this._toolProperties(e);n.forEach(function(e){var n=this.mappingParam[e]||e;i[e]=t.target.get(n)}.bind(this));this._updateProperty(e,i)},_updateProperty:function(t,e){var i=this._toolProperties(t);this._eachPropertyConfig(function(t,n){if(i.indexOf(t)>=0){this.property.querySelectorAll(n.parent).forEach(function(t){t.style.display=""});if(typeof e!=="undefined")this._setDomElementValue($(n.value),e[t])}else{this.property.querySelectorAll(n.parent).forEach(function(t){t.style.display="none"})}}.bind(this))},_makeToolbar:function(){this.annotToolbarEl=iws.util.makeElement("div",{class:"pop-annotation"});this.page.wrapperEl.appendChild(this.annotToolbarEl);this.__makeDomTool();this.__makeDomProperty();var t=this;$(this.annotToolbarEl).append('<a class="handle ui-slideouttab-handle-rounded">Tool</a>');this.tabSlide=$(this.annotToolbarEl).tabSlideOut({clickScreenToClose:false,offset:10,tabLocation:"right",offsetReverse:false,handleOffsetReverse:false,onOpen:function(){console.log("open")},onClose:function(){console.log("close");t.page.setTrackMode("move")}});$(this.annotToolbarEl).filter(".ui-slideouttab-panel").css("background-color","transparent")},__makeDomTool:function(){this.poptool=iws.util.makeElement("div",{class:"pop-tool",id:"pop-tool",draggable:"false"});this.annotToolbarEl.appendChild(this.poptool);this.poptool.innerHTML='<div id="pop-command">'+'<div class="popbtn-group-v">'+'<button class="popbtn" id="annotSelect" title="Select annotation"><i class="vIcon-Select"></i></button>'+'<button class="popbtn" id="annotDrawFree" title="Draw freely"><i class="vIcon-DrawFree"></i></button>'+'<button class="popbtn" id="annotDrawLine" title="Draw line"><i class="vIcon-DrawLine"></i></button>'+'<button class="popbtn" id="annotDrawRect" title="Draw rectangle"><i class="vIcon-DrawRect"></i></button>'+'<button class="popbtn" id="annotDrawText" title="Write memo"><i class="vIcon-DrawText"></i></button>'+"</div>"+"</div>"},__makeDomProperty:function(){this.property=iws.util.makeElement("div",{class:"pop-property"});this.annotToolbarEl.appendChild(this.property);this.property.innerHTML="<h3>Property</h3>"+"<dl>"+'<dt class="js-selected-properties-stroke-width">Stroke width</dt>'+'<dd class="js-selected-properties-stroke-width">'+'<select class="js-selected-properties-stroke-width-value property-span">'+'<option value="1">1</option>'+'<option value="2">2</option>'+'<option value="3">3</option>'+'<option value="4">4</option>'+'<option value="5">5</option>'+"</select>"+"</dd>"+'<dt class="js-selected-properties-fill-color">Fill color</dt>'+'<dd class="js-selected-properties-fill-color">'+'<input type="text" class="js-selected-properties-fill-color-value property-span js-color"/>'+"</dd>"+'<dt class="js-selected-properties-stroke-color">Stroke color</dt>'+'<dd class="js-selected-properties-stroke-color">'+'<input type="text" class="js-selected-properties-stroke-color-value property-span js-color"/>'+"</dd>"+'<dt class="js-selected-properties-font-color">font Color</dt>'+'<dd class="js-selected-properties-font-color">'+'<input type="text" class="js-selected-properties-font-color-value property-span js-color"/>'+"</dd>"+'<dt class="js-selected-properties-background-color">background</dt>'+'<dd class="js-selected-properties-background-color">'+'<input type="text" class="js-selected-properties-background-color-value property-span js-color"/>'+"</dd>"+'<dt class="js-selected-properties-font-size">Font Size</dt>'+'<dd class="js-selected-properties-font-size">'+'<select type="text" class="js-selected-properties-font-size-value property-span">'+'<option value="12">12</option>'+'<option value="14">14</option>'+'<option value="16">16</option>'+'<option value="20">20</option>'+'<option value="24">24</option>'+'<option value="36">36</option>'+'<option value="48">48</option>'+'<option value="64">64</option>'+'<option value="72">72</option>'+"</select>"+"</dd>"+'<dt class="js-selected-properties-font-style">Italic</dt>'+'<dd class="js-selected-properties-font-style">'+'<input class="popbtn js-selected-properties-font-style-value" type="checkbox" value="italic"/><i class="icon-italic"></i>'+"</dd>"+'<dt class="js-selected-properties-font-weight">Bold</dt>'+'<dd class="js-selected-properties-font-weight">'+'<input class="popbtn js-selected-properties-font-weight-value" type="checkbox" value="bold"/><i class="icon-bold"></i>'+"</dd>"+"</dl>";$(this.property).find(".js-color").each(function(t,e){var i=$(e);if(typeof i.spectrum=="function"){i.spectrum({showPalette:true,palette:[["white","black"],["blue","CornflowerBlue"],["red","Coral"],["yellow","Chartreuse"],["Grey","Green"],["Peru","Pink"],["rgb(255, 128, 0)","hsv 100 70 50"]],showAlpha:true,preferredFormat:"rgb"})}i.change(function(){var t=i.val();if(typeof i.spectrum=="function"){if(i.spectrum("get")!=t){i.spectrum("set",t)}}})})},_eventListen:function(){var t=this.poptool.querySelectorAll(".popbtn");var e=this;t.forEach(function(t){t.addEventListener("click",function(){e.page.setTrackMode(t.id,true)})});this.page.observe("after:render",function(){if(this.page.imageCtrl.isValid()){this.poptool.querySelectorAll("*").forEach(function(t){t.removeAttribute("disabled")});this.property.querySelectorAll("*").forEach(function(t){t.removeAttribute("disabled")})}else{this.poptool.querySelectorAll("*").forEach(function(t){t.setAttribute("disabled",true)});this.property.querySelectorAll("*").forEach(function(t){t.setAttribute("disabled",true)})}}.bind(this));this.page.observe("annotation:visible",function(t){if(t==="show"){this.annotToolbarEl.style.display="block"}if(t==="hide"){this.annotToolbarEl.style.display="none"}}.bind(this));this.page.observe("mouseTrackChange",function(t){this.poptool.querySelectorAll(".popbtn").forEach(function(t){t.removeClass("toggled")});var e=this.poptool.querySelector("#"+t);if(e)e.addClass("toggled");this.fire("tool:change",t)}.bind(this));this.observe("tool:change",function(t){if(t!=="annotSelect"){this.page.discardActiveObject();this.page.renderAll()}this._updateProperty(t)});this.page.observe("object:selected",function(t){this._updateDOM(t)}.bind(this));this.page.observe("selection:cleared",function(t){this._updateProperty("")}.bind(this))},destroy:function(){$(this.property).find(".js-color").each(function(t,e){var i=$(e);if(typeof i.spectrum=="function"){i.spectrum("destroy")}})}};iws.util.extend(iws.toolbar.annotation.prototype,iws.Observable)})();(function(){iws.toolbar.page=function(t){this.page=t;this.initialize()};iws.toolbar.page.prototype={toolbarMargin:8,trackModeMap:["move","range","glass","annotSelect","annotPath","annotLine","annotRect","annotText"],trackModeMapping:{move:"trackMove",range:"trackRange",glass:"trackGlass"},initialize:function(){this._makeToolbar();this.page.observe("toolbar:visible",function(t){if(t){this.toolbarContainerEl.style.display="block"}else{this.toolbarContainerEl.style.display="none"}}.bind(this))},isVisible:function(){if(this.toolbarContainerEl.style.display!=="none")return true;else return false},height:function(){var t=this.toolbarContainerEl.clientHeight;return t},_makeToolbar:function(){this.toolbarContainerEl=iws.util.makeElement("div",{class:"pageToolbar_Container"});var t=this.page.pageContainer.parentElement;t.insertBefore(this.toolbarContainerEl,this.page.pageContainer);this.toolbarFrameEl=iws.util.makeElement("div",{class:"pageToolbar_Frame"});this.toolbarContainerEl.appendChild(this.toolbarFrameEl);this.__makeToolbarLeft();this.__makeToolbarZoom();this.__makeToolbarRight()},__makeToolbarLeft:function(){this.toolbarLeft=iws.util.makeElement("div",{class:"pageToolbar"});this.toolbarFrameEl.appendChild(this.toolbarLeft);this.toolbarLeft.innerHTML='<button id="scalePlus" type="button" class="pageToolbarButton" title="ZoomIn"><i class="pageToolbarButton_scalePlus"></i></button>'+'<button id="scaleMinus" type="button" class="pageToolbarButton" title="ZoomOut"><i class="pageToolbarButton_scaleMinus"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<button id="fitWidth" type="button" class="pageToolbarButton" title="Fix Width"><i class="pageToolbarButton_fitWidth"></i></button>'+'<button id="fitHeight" type="button" class="pageToolbarButton" title="Fix Height"><i class="pageToolbarButton_fitHeight"></i></button>'+'<button id="fitAuto" type="button" class="pageToolbarButton" title="Fix Auto"><i class="pageToolbarButton_fitAuto"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<button id="rotate270" type="button" class="pageToolbarButton" title="Rotate 270"><i class="pageToolbarButton_rotate270"></i></button>'+'<button id="rotate90" type="button" class="pageToolbarButton" title="Rotate 90"><i class="pageToolbarButton_rotate90"></i></button>'+'<button id="rotate180" type="button" class="pageToolbarButton" title="Rotate 180"><i class="pageToolbarButton_rotate180"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<div class="trackModeGroup" style="display:inline-block;"> '+'<button id="trackMove" type="button" class="pageToolbarButton" title="Move Image" value="move"><i class="pageToolbarButton_trackMove"></i> </button>'+'<button id="trackRange" type="button" class="pageToolbarButton" title="Select area" value="range"><i class="pageToolbarButton_trackRange"></i> </button>'+'<button id="trackGlass" type="button" class="pageToolbarButton" title="Magnifying Glass" value="glass"><i class="pageToolbarButton_trackGlass"></i> </button>'+"</div>";this.toolbarLeft.querySelector("#scalePlus").addEventListener("click",function(){this.page.zoomIn()}.bind(this),false);this.toolbarLeft.querySelector("#scaleMinus").addEventListener("click",function(){this.page.zoomOut()}.bind(this),false);this.toolbarLeft.querySelector("#fitWidth").addEventListener("click",function(){this.page.setFitMode({name:"width"})}.bind(this),false);this.toolbarLeft.querySelector("#fitHeight").addEventListener("click",function(){this.page.setFitMode({name:"height"})}.bind(this),false);this.toolbarLeft.querySelector("#fitAuto").addEventListener("click",function(){this.page.setFitMode({name:"auto"})}.bind(this),false);this.toolbarLeft.querySelector("#rotate270").addEventListener("click",function(){this.page.setRotate(270)}.bind(this),false);this.toolbarLeft.querySelector("#rotate90").addEventListener("click",function(){this.page.setRotate(90)}.bind(this),false);this.toolbarLeft.querySelector("#rotate180").addEventListener("click",function(){this.page.setRotate(180)}.bind(this),false);this.toolbarLeft.querySelector("#trackMove").addEventListener("click",function(){this.page.setTrackMode("move")}.bind(this),false);this.toolbarLeft.querySelector("#trackRange").addEventListener("click",function(){this.page.setTrackMode("range")}.bind(this),false);this.toolbarLeft.querySelector("#trackGlass").addEventListener("click",function(){this.page.setTrackMode("glass")}.bind(this),false);this.buttonTrackModeGroup=this.toolbarLeft.querySelector(".trackModeGroup");this.page.observe("mouseTrackChange",function(t){if(this.trackModeMap.indexOf(t)>=0){this.buttonTrackModeGroup.querySelectorAll(".pageToolbarButton").forEach(function(t){t.removeClass("toggled")});var e=this.buttonTrackModeGroup.querySelector("#"+this.trackModeMapping[t]);if(e)e.addClass("toggled")}}.bind(this))},__makeToolbarZoom:function(){this.toolbarZoom=iws.util.makeElement("div",{class:"pageToolbar"});this.toolbarFrameEl.appendChild(this.toolbarZoom);this.toolbarZoom.innerHTML='<span id="scaleSelectContainer" class="iws-dropdownToolbarButton">'+'<select id="scaleSelect" title="Zoom" tabindex="23" data-l10n-id="zoom">'+'<option id="pageAutoOption"    title="" value="auto" >Fit auto</option>'+'<option id="pageFitWidthOption" title="" value="width" >Fit Width</option>'+'<option id="pageFitHeightOption" title="" value="height" >Fit Height</option>'+'<option id="customScaleOption" title="" value="custom">0%</option>'+'<option title="" value="0.25"  >25%</option>'+'<option title="" value="0.5"   >50%</option>'+'<option title="" value="0.75"  >75%</option>'+'<option title="" value="1"     >100%</option>'+'<option title="" value="1.25"  >125%</option>'+'<option title="" value="1.5"   >150%</option>'+'<option title="" value="2"     >200%</option>'+'<option title="" value="3"     >300%</option>'+'<option title="" value="4"     >400%</option>'+"</select>"+"</span>";var t=this;this.toolbarZoom.querySelector("#scaleSelect").addEventListener("change",function(e){switch(this.value){case"auto":case"width":case"height":t.page.setFitMode({name:this.value});break;default:t.page._zoom({name:"custom",scale:this.value})}},false);function e(t){var e=this.toolbarZoom.querySelector("#scaleSelect").options;var i=false;for(var n=0,r=e.length;n<r;n++){var o=e[n];if(o.value!==t){o.selected=false;continue}o.selected=true;i=true}return i}function i(){var t=this.toolbarZoom.querySelector("#scaleSelect");var i=this.page.getFitMode();var n="";switch(i.name){case"width":case"height":case"auto":n=i.name;break;case"scale":n=i.scale;break}var r=e.call(this,n);if(!r){var o=document.getElementById("customScaleOption");o.textContent="scale";o.selected=true}}this.page.observe("page:zoom",i.bind(this));this.page.observe("page:fitMode",i.bind(this))},__makeToolbarRight:function(){this.toolbarRight=iws.util.makeElement("div",{class:"pageToolbar size"});this.toolbarFrameEl.appendChild(this.toolbarRight);this.toolbarRight.innerHTML='<button id="fullDisplay" type="button" class="pageToolbarButton" title="Full screen"><i class="pageToolbarButton_FullScreen"></i></button>';this.toolbarRight.querySelector("#fullDisplay").addEventListener("click",function(){iws.util.fullscreen.toggleFullScreen(this.page.fullScreenEl)}.bind(this),false)}}})();(function(){"use strict";function t(){this.initialize.apply(this,arguments)}iws.multiPage=iws.util.createInheritClass(t,iws.Observable,{thumb:null,page:null,thumbShow:true,thumbHeight:160,saveType:"annotation",useAnnotation:false,useFilter:false,reSampleUse:true,reSampleRate:.8,reSampleFilter:"convolveFloat32",printAutoFit:false,initialize:function(t,e){e||(e={});this._initOptions(e);this._initWrapperElement(t);this._addThumb();this._addPage();this.mainToolbar=new iws.toolbar.multiPage(this);this.setTrackMode("move");this.visible("annotation",this.useAnnotation?"show":"hide");this.visible("filter",this.useFilter?"show":"hide");this._initEvent();if(this.selectMode!=undefined){this.selectVisible(this.selectMode)}this.resizer=new iws.util.resize(this.fullScreenEl,this._reSize.bind(this));this._reSize();$(t).on("destroyed",function(){console.log("viewer destroyed");this.destroy()});$(t).on("remove",function(){console.log("viewer remove");this.destroy()});$.event.special.destroyed={remove:function(t){if(t.handler){t.handler()}}}},_initWrapperElement:function(t){this.wrapperEl=t;iws.util.makeElementUnselectable(this.wrapperEl);this.fullScreenEl=iws.util.makeElement("div",{class:"multiPage-fullScreen"});this.wrapperEl.appendChild(this.fullScreenEl);this.pageContainerEl=iws.util.makeElement("div",{class:"multiPage-container"});this.fullScreenEl.appendChild(this.pageContainerEl);this.pageFrameEl=iws.util.makeElement("div",{class:"multiPage-frame"});this.pageContainerEl.appendChild(this.pageFrameEl);this.thumbContainer=iws.util.makeElement("div",{class:"iws_thumbnailContainer iws_thumbnailContainer_show"});this.thumbSelectAllEl=iws.util.makeElement("label",{class:"thumb_selectAll_hide"});this.thumbSelectAllEl.innerHTML='<input type="checkbox" class="selectall"> Select all';this.thumbContainer.appendChild(this.thumbSelectAllEl);this.thumbEl=iws.util.makeElement("div",{class:"iws-thumbnail iws-thumbnail_full"});this.thumbContainer.appendChild(this.thumbEl);this.pageFrameEl.appendChild(this.thumbContainer);this.pageEl=iws.util.makeElement("div",{class:"iws-page iws-page_move"});this.pageFrameEl.appendChild(this.pageEl)},_initOptions:function(t){for(var e in t){this[e]=t[e]}},_addThumb:function(){var t={debug:false,direction:"V",path:this.path,beforehandLoad:false,plugin:false,printAutoFit:this.printAutoFit};this.thumb=iwsT.Thumbnail(this.thumbEl,t);this.thumb.setHeight(this.thumbHeight)},_addPage:function(){var t={autoResize:false,fitMode:this.fitMode,path:this.path,visibleToolbar:false,useAnnotation:this.useAnnotation,useFilter:this.useFilter,reSampleUse:this.reSampleUse,reSampleRate:this.reSampleRate,reSampleFilter:this.reSampleFilter};this.page=new iws.PageAnnotation(this.pageEl,t);this.page.pageKey="";this.page.observe("mouseTrackChange",function(t){this.fire("mouseTrackChange",t)}.bind(this));this.page.observe("page:zoom",function(t){this.fire("page:zoom",t)}.bind(this));this.page.observe("page:fitMode",function(t){this.fire("page:fitMode",t)}.bind(this));this.page.observe("page:swipe_left",function(t){this.pageNext()}.bind(this));this.page.observe("page:swipe_right",function(t){this.pagePrev()}.bind(this))},_initEvent:function(){var t=this.thumbSelectAllEl.querySelectorAll(".selectall");var e=this;t.forEach(function(t){t.addEventListener("click",function(){var i=e.thumb.pageCount();for(var n=0;n<i;n++){e.thumb.setSelect(n,t.checked)}})});this.thumb.setCallbackLoad(function(t,e,i){}.bind(this));this.thumb.setCallbackSplit(function(t){this.fire("pageNumberChange",this.pageIndex)}.bind(this));this.thumb.setCallbackClick(function(t,e,i){if(t>=0){var n=this.thumb.findIndex(this.page.pageKey);if(n!==-1){var r=this.thumb.getItem(n);r.annotation=this.page.getAnnotation()}this.page.pageKey=e.uniqueId;this.page.setInfo(e.pageInfo);var o=function(t,e){return function(){t.setAnnotation(e.annotation)}}(this.page,e);if(e.pageSrc&&e.pageSrc!=""){this.page.setSrc(e.pageSrc,e.angle,o)}else if(e.pagebuffer){this.page.setRawData(e.pagebuffer,e.pageInfo.width,e.pageInfo.height,e.angle,o)}}else{this.page.clear()}this.fire("pageNumberChange",t)}.bind(this));var i=this.thumb.getObserver();var n=this;i.observe("loadpage_start",function(t){iws.util.run_waitMe($(n.pageEl),"roundBounce")});i.observe("loadpage_end",function(t){iws.util.hide_waitMe($(n.pageEl))});function r(t){this.fire("mouse:drawRanged",t)}this.page.observe("mouse:drawRanged",r.bind(this))},_reSize:function(){var t=this.fullScreenEl.clientWidth;var e=this.fullScreenEl.clientHeight;var i=t;var n=e;if(this.mainToolbar&&this.mainToolbar.isVisible()){n=e-this.mainToolbar.height()}this.pageContainerEl.style.width=i+"px";this.pageContainerEl.style.height=n+"px";if(t<640||!this.thumbShow){this.thumbContainer.removeClass("iws_thumbnailContainer_show");this.thumbContainer.addClass("iws_thumbnailContainer_hide");this.pageEl.removeClass("iws-page_move");this.pageEl.addClass("iws-page_full")}else{this.thumbContainer.removeClass("iws_thumbnailContainer_hide");this.thumbContainer.addClass("iws_thumbnailContainer_show");this.pageEl.removeClass("iws-page_full");this.pageEl.addClass("iws-page_move")}this.page&&this.page._reSize();this.fire("resize",{width:t,height:e})},clear:function(){this.thumb.init();this.page.clear()},loadFile:function(t){this.thumb.load(t)},appendFile:function(t){this.thumb.append(t)},loadUrl:function(t){iws.util.urlDownload(t,function(t){this.thumb.load(t)}.bind(this))},appendUrl:function(t){iws.util.urlDownload(t,function(t){this.thumb.append(t)}.bind(this))},print:function(){this._backup();this.thumb.print()},loadAnnotation:function(t){this.thumb.annotationLoad(t);var e=this.thumb.findIndex(this.page.pageKey);if(e>=0){var i=this.thumb.getItem(e).annotation;this.page.setAnnotation(i)}},_backup:function(){var t=this.thumb.findIndex(this.page.pageKey);if(t!==-1){var e=this.thumb.getItem(t);e.annotation=this.page.getAnnotation()}},saveAnnotation:function(){this._backup();this.thumb.annotationSave(function(t){var e=t===""?false:true;this.fire("saveAnnotation",{success:e,annotation:t})}.bind(this))},saveImage:function(){var t=function(t,e){this.fire("saveImage",{success:t,byteArray:e})};this.thumb.pageSave(5,t.bind(this))},_zoom:function(t){this.page._zoom(t)},zoomIn:function(){this.page.zoomIn()},zoomOut:function(){this.page.zoomOut()},rotate:function(t){var e=this;this.thumb.rotate(t,function(t,i){if(i.uniqueId===e.page.pageKey){e.page.setRotate(t)}})},setFitMode:function(t){this.page.setFitMode(t)},getFitMode:function(){return this.page.getFitMode()},setTrackMode:function(t){this.page.setTrackMode(t)},pagePrev:function(){this.thumb.pageIndex=this.thumb.pageIndex-1},pageNext:function(){this.thumb.pageIndex=this.thumb.pageIndex+1},pageCount:function(){return this.thumb.pageCount()},showAnnotation:function(t){this.page.visible("annotation",t)},selectVisible:function(t){this.thumb.selectVisible=t;if(t){this.thumbSelectAllEl.removeClass("thumb_selectAll_hide");this.thumbSelectAllEl.addClass("thumb_selectAll");this.thumbEl.removeClass("iws-thumbnail_full");this.thumbEl.addClass("iws-thumbnail_move")}else{this.thumbSelectAllEl.removeClass("thumb_selectAll");this.thumbSelectAllEl.addClass("thumb_selectAll_hide");this.thumbEl.removeClass("iws-thumbnail_move");this.thumbEl.addClass("iws-thumbnail_full")}},showButton:function(t,e){this.fire("toolbar:buttonShow",t,e)},visible:function(t,e){this.page.visible(t,e)},crop:function(t,e){this.page.crop(t,e)},destroy:function(){this.thumb.destroy();this.page.destroy();$(this.fullScreenEl).remove()},refresh:function(){this._reSize()},addAnnotation:function(t){this.page.addAnnotation(t)},removeAnnotation:function(){this.page.removeAnnotation()},setPrintAutoFit:function(t){this.printAutoFit=t;this.thumb.setOption({printAutoFit:t})}});try{if(!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return true}}).x){Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:false,configurable:true,value:function(t,e){Object.defineProperty(this,t,{get:e,enumerable:true,configurable:true})}});Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:false,configurable:true,value:function(t,e){Object.defineProperty(this,t,{set:e,enumerable:true,configurable:true})}})}}catch(t){}iws.multiPage.prototype.__defineGetter__("pageIndex",function(){return this.thumb.pageIndex});iws.multiPage.prototype.__defineSetter__("pageIndex",function(t){this.thumb.pageIndex=t})})();(function(){iws.toolbar.multiPage=function(t){this.viewer=t;this.initialize()};iws.toolbar.multiPage.prototype={toolbarMargin:8,trackModeMap:["move","range","glass","annotSelect","annotPath","annotLine","annotRect","annotText"],trackModeMapping:{move:"trackMove",range:"trackRange",glass:"trackGlass"},initialize:function(){this._makeToolbar()},isVisible:function(){if(this.toolbarContainerEl.style.display!=="none")return true;else return false},height:function(){var t=this.toolbarContainerEl.clientHeight;return t},_makeToolbar:function(){this.toolbarContainerEl=iws.util.makeElement("div",{class:"pageToolbar_Container"});var t=this.viewer.pageContainerEl.parentElement;t.insertBefore(this.toolbarContainerEl,this.viewer.pageContainerEl);this.toolbarFrameEl=iws.util.makeElement("div",{class:"pageToolbar_Frame"});this.toolbarContainerEl.appendChild(this.toolbarFrameEl);this.__makeToolbarCommon(this.toolbarFrameEl);this.__makeToolbarPage(this.toolbarFrameEl);this.__makeToolbarMove(this.toolbarFrameEl);this.__makeToolbarSize(this.toolbarFrameEl);this.__makeToolbarZoom(this.toolbarFrameEl);var e=this;this.viewer.observe("resize",function(t){if(t.width<818){e.toolbarRight.style.display="none"}else{e.toolbarRight.style.display="inline-block"}if(t.width<750){e.toolbarCommon.style.display="none"}else{e.toolbarCommon.style.display="inline-block"}if(t.width<590){e.toolbarPage.style.display="none"}else{e.toolbarPage.style.display="inline-block"}});this.viewer.observe("toolbar:buttonShow",function(t,i){console.log(t+" "+i);switch(t){case"thumbnail":{i?$(e.toolbarCommon).find("#thumbtoggle").css("display","inline-block"):$(e.toolbarCommon).find("#thumbtoggle").css("display","none");i?$(e.toolbarCommon).find("#separator1").css("display","inline-block"):$(e.toolbarCommon).find("#separator1").css("display","none")}break;case"print":{i?$(e.toolbarCommon).find("#print").css("display","inline-block"):$(e.toolbarCommon).find("#print").css("display","none")}break;case"save":{i?$(e.toolbarCommon).find("#save").css("display","inline-block"):$(e.toolbarCommon).find("#save").css("display","none")}break;case"select":{i?$(e.toolbarCommon).find("#checkVisible").css("display","inline-block"):$(e.toolbarCommon).find("#checkVisible").css("display","none")}break;case"delete":{i?$(e.toolbarCommon).find("#delete").css("display","inline-block"):$(e.toolbarCommon).find("#delete").css("display","none")}break;case"move":{i?$(e.toolbarPage).find("#trackMove").css("display","inline-block"):$(e.toolbarPage).find("#trackMove").css("display","none")}break;case"range":{i?$(e.toolbarPage).find("#trackRange").css("display","inline-block"):$(e.toolbarPage).find("#trackRange").css("display","none")}break;case"glass":{i?$(e.toolbarPage).find("#trackGlass").css("display","inline-block"):$(e.toolbarPage).find("#trackGlass").css("display","none");
}break}})},__makeToolbarCommon:function(t){this.toolbarCommon=iws.util.makeElement("div",{class:"pageToolbar common"});t.appendChild(this.toolbarCommon);this.toolbarCommon.innerHTML='<button id="thumbtoggle" type="button" class="pageToolbarButton" title="Show thumbnail"><i class="pageToolbarButton_thumbtoggle"></i></button>'+'<div id="separator1" class="pageToolbarButtonSeparator"></div>'+'<button id="print" type="button" class="pageToolbarButton" title="Print"><i class="pageToolbarButton_print"></i></button>'+'<button id="save" type="button" class="pageToolbarButton" title="Save"><i class="pageToolbarButton_save"></i></button>'+'<button id="checkVisible" type="button" class="pageToolbarButton" title="Show check"><i class="pageToolbarButton_checkVisible"></i></button>'+'<button id="delete" type="button" class="pageToolbarButton" title="Delete"><i class="pageToolbarButton_delete"></i></button>';this.toolbarCommon.querySelector("#thumbtoggle").addEventListener("click",function(){this.viewer.thumbShow=!this.viewer.thumbShow;this.viewer._reSize()}.bind(this),false);this.toolbarCommon.querySelector("#print").addEventListener("click",function(){this.viewer.print()}.bind(this),false);this.toolbarCommon.querySelector("#save").addEventListener("click",function(){if(this.viewer.saveType==="image"){this.viewer.saveImage()}else if(this.viewer.saveType==="annotation"){this.viewer.saveAnnotation()}}.bind(this),false);this.toolbarCommon.querySelector("#checkVisible").addEventListener("click",function(){this.viewer.selectVisible(!this.viewer.thumb.selectVisible)}.bind(this),false);this.toolbarCommon.querySelector("#delete").addEventListener("click",function(){this.viewer.thumb.remove()}.bind(this),false)},__makeToolbarPage:function(t){this.toolbarPage=iws.util.makeElement("div",{class:"pageToolbar page"});t.appendChild(this.toolbarPage);this.toolbarPage.innerHTML='<button id="scalePlus" type="button" class="pageToolbarButton" title="ZoomIn"><i class="pageToolbarButton_scalePlus"></i></button>'+'<button id="scaleMinus" type="button" class="pageToolbarButton" title="ZoomOut"><i class="pageToolbarButton_scaleMinus"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<button id="fitWidth" type="button" class="pageToolbarButton" title="Fix Width"><i class="pageToolbarButton_fitWidth"></i></button>'+'<button id="fitHeight" type="button" class="pageToolbarButton" title="Fix Height"><i class="pageToolbarButton_fitHeight"></i></button>'+'<button id="fitAuto" type="button" class="pageToolbarButton" title="Fix Auto"><i class="pageToolbarButton_fitAuto"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<button id="rotate270" type="button" class="pageToolbarButton" title="Rotate 270"><i class="pageToolbarButton_rotate270"></i></button>'+'<button id="rotate90" type="button" class="pageToolbarButton" title="Rotate 90"><i class="pageToolbarButton_rotate90"></i></button>'+'<button id="rotate180" type="button" class="pageToolbarButton" title="Rotate 180"><i class="pageToolbarButton_rotate180"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<div class="trackModeGroup" style="display:inline-block;"> '+'<button id="trackMove" type="button" class="pageToolbarButton" title="Move Image" value="move"><i class="pageToolbarButton_trackMove"></i> </button>'+'<button id="trackRange" type="button" class="pageToolbarButton" title="Select area" value="range"><i class="pageToolbarButton_trackRange"></i> </button>'+'<button id="trackGlass" type="button" class="pageToolbarButton" title="Magnifying Glass" value="glass"><i class="pageToolbarButton_trackGlass"></i> </button>'+"</div>";this.toolbarPage.querySelector("#scalePlus").addEventListener("click",function(){this.viewer.zoomIn()}.bind(this),false);this.toolbarPage.querySelector("#scaleMinus").addEventListener("click",function(){this.viewer.zoomOut()}.bind(this),false);this.toolbarPage.querySelector("#fitWidth").addEventListener("click",function(){this.viewer.setFitMode({name:"width"})}.bind(this),false);this.toolbarPage.querySelector("#fitHeight").addEventListener("click",function(){this.viewer.setFitMode({name:"height"})}.bind(this),false);this.toolbarPage.querySelector("#fitAuto").addEventListener("click",function(){this.viewer.setFitMode({name:"auto"})}.bind(this),false);this.toolbarPage.querySelector("#rotate270").addEventListener("click",function(){this.viewer.rotate(270)}.bind(this),false);this.toolbarPage.querySelector("#rotate90").addEventListener("click",function(){this.viewer.rotate(90)}.bind(this),false);this.toolbarPage.querySelector("#rotate180").addEventListener("click",function(){this.viewer.rotate(180)}.bind(this),false);this.toolbarPage.querySelector("#trackMove").addEventListener("click",function(){this.viewer.setTrackMode("move")}.bind(this),false);this.toolbarPage.querySelector("#trackRange").addEventListener("click",function(){this.viewer.setTrackMode("range")}.bind(this),false);this.toolbarPage.querySelector("#trackGlass").addEventListener("click",function(){this.viewer.setTrackMode("glass")}.bind(this),false);this.buttonTrackModeGroup=this.toolbarPage.querySelector(".trackModeGroup");this.viewer.observe("mouseTrackChange",function(t){if(this.trackModeMap.indexOf(t)>=0){this.buttonTrackModeGroup.querySelectorAll(".pageToolbarButton").forEach(function(t){t.removeClass("toggled")});var e=this.buttonTrackModeGroup.querySelector("#"+this.trackModeMapping[t]);if(e)e.addClass("toggled")}}.bind(this))},__makeToolbarMove:function(t){this.toolbarMove=iws.util.makeElement("div",{class:"pageToolbar move"});t.appendChild(this.toolbarMove);this.toolbarMove.innerHTML='<button id="prev" type="button" class="pageToolbarButton" title="Go to previous page"><i class="pageToolbarButton_prev"></i></button>'+'<input type="text" id="pageNumber" class="pageToolbarField pageNumber" value="" size="4" />'+'<button id="next" type="button" class="pageToolbarButton" title="Go to next page"><i class="pageToolbarButton_next"></i></button>';this.toolbarMove.querySelector("#prev").addEventListener("click",function(){this.viewer.pagePrev()}.bind(this),false);this.toolbarMove.querySelector("#next").addEventListener("click",function(){this.viewer.pageNext()}.bind(this),false);this.viewer.observe("pageNumberChange",function(t){this.toolbarMove.querySelector("#pageNumber").value=t+1+"/"+this.viewer.pageCount()}.bind(this))},__makeToolbarSize:function(t){this.toolbarRight=iws.util.makeElement("div",{class:"pageToolbar size"});this.toolbarFrameEl.appendChild(this.toolbarRight);this.toolbarRight.innerHTML='<button id="fullDisplay" type="button" class="pageToolbarButton" title="Full screen"><i class="pageToolbarButton_FullScreen"></i></button>';this.toolbarRight.querySelector("#fullDisplay").addEventListener("click",function(){iws.util.fullscreen.toggleFullScreen(this.viewer.fullScreenEl)}.bind(this),false);iws.util.fullscreen.onFullScreenChange(function(t){if(t){$(this.toolbarRight).children("button#fullDisplay").children("i").removeClass("pageToolbarButton_FullScreen");$(this.toolbarRight).children("button#fullDisplay").children("i").addClass("pageToolbarButton_OriginalScreen")}else{$(this.toolbarRight).children("button#fullDisplay").children("i").removeClass("pageToolbarButton_OriginalScreen");$(this.toolbarRight).children("button#fullDisplay").children("i").addClass("pageToolbarButton_FullScreen")}}.bind(this))},__makeToolbarZoom:function(t){this.toolbarZoom=iws.util.makeElement("div",{class:"pageToolbar zoom"});t.appendChild(this.toolbarZoom);this.toolbarZoom.innerHTML='<span id="scaleSelectContainer" class="iws-dropdownToolbarButton">'+'<select id="scaleSelect" title="Zoom" tabindex="23" data-l10n-id="zoom">'+'<option id="pageAutoOption"    title="" value="auto" >Fit auto</option>'+'<option id="pageFitWidthOption" title="" value="width" >Fit Width</option>'+'<option id="pageFitHeightOption" title="" value="height" >Fit Height</option>'+'<option id="pageFitOriginalOption" title="" value="original" >Fit Original</option>'+'<option id="customScaleOption" title="" value="custom">0%</option>'+'<option title="" value="0.25"  >25%</option>'+'<option title="" value="0.5"   >50%</option>'+'<option title="" value="0.75"  >75%</option>'+'<option title="" value="1"     >100%</option>'+'<option title="" value="1.25"  >125%</option>'+'<option title="" value="1.5"   >150%</option>'+'<option title="" value="2"     >200%</option>'+'<option title="" value="3"     >300%</option>'+'<option title="" value="4"     >400%</option>'+"</select>"+"</span>";var e=this;this.toolbarZoom.querySelector("#scaleSelect").addEventListener("change",function(t){switch(this.value){case"auto":case"width":case"height":case"original":e.viewer.setFitMode({name:this.value});break;default:e.viewer._zoom({name:"custom",scale:this.value})}},false);function i(t){var e=this.toolbarZoom.querySelector("#scaleSelect").options;var i=false;for(var n=0,r=e.length;n<r;n++){var o=e[n];if(o.value!==t){o.selected=false;continue}o.selected=true;i=true}return i}function n(){var t=this.toolbarZoom.querySelector("#scaleSelect");var e=this.viewer.getFitMode();var n="";switch(e.name){case"width":case"height":case"auto":n=e.name;break;case"scale":n=e.scale;break}var r=i.call(this,n);if(!r){var o=document.getElementById("customScaleOption");o.textContent="scale";o.selected=true}}this.viewer.observe("page:zoom",n.bind(this));this.viewer.observe("page:fitMode",n.bind(this))}}})();