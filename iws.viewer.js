var iws=iws||{version:"1.0.0"};iws.debug=false;iws.log=function(){var t="";for(var e=0;e<arguments.length;e++){t+=arguments[e]+" >>>> "}console.log(">>>>   iws : "+t)};iws.toolbar={};iws.Observable={observe:function(t,e,i){if(!this.topics){this.topics={}}if(typeof e!=="function"){return false}if(!this.topics.hasOwnProperty(t)){this.topics[t]={}}var n=Math.random().toString(35);this.topics[t][n]=[e,!!i];return n},stopObserving:function(t){if(!this.topics){return}for(var e in this.topics){if(this.topics[e][t]){delete this.topics[e][t];return true}}return false},fire:function(t){if(!this.topics){return}if(this.topics.hasOwnProperty(t)){var e=Array.prototype.slice.call(arguments,1),i=[];for(var n in this.topics[t]){var s=this.topics[t][n];try{s[0].apply(this,e)}catch(t){console.error("viewer fire Error",t.message,t)}if(s[1])i.push(n)}if(i.length)i.forEach(this.unsubscribe)}}};iws.Collection={_objects:[],add:function(){this._objects.push.apply(this._objects,arguments);if(this._onObjectAdded){for(var t=0,e=arguments.length;t<e;t++){this._onObjectAdded(arguments[t])}}this.renderAll();return this},insertAt:function(t,e,i){var n=this.getObjects();if(i){n[e]=t}else{n.splice(e,0,t)}this._onObjectAdded&&this._onObjectAdded(t);this.renderAll();return this},remove:function(){var t=this.getObjects(),e,i=false;for(var n=0,s=arguments.length;n<s;n++){e=t.indexOf(arguments[n]);if(e!==-1){i=true;t.splice(e,1);this._onObjectRemoved&&this._onObjectRemoved(arguments[n])}}i&&this.renderAll();return this},forEachObject:function(t,e){var i=this.getObjects();for(var n=0,s=i.length;n<s;n++){t.call(e,i[n],n,i)}return this},getObjects:function(t){if(typeof t==="undefined"){return this._objects}return this._objects.filter(function(e){return e.type===t})},item:function(t){return this.getObjects()[t]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(t){return this.getObjects().indexOf(t)>-1},complexity:function(){return this.getObjects().reduce(function(t,e){t+=e.complexity?e.complexity():0;return t},0)}};(function(t){"use strict";var e=t.iws||(t.iws={});if(e.Point){e.warn("iws.Point is already defined");return}e.Point=i;function i(t,e){this.x=t;this.y=e}i.prototype={type:"point",constructor:i,add:function(t){return new i(this.x+t.x,this.y+t.y)},addEquals:function(t){this.x+=t.x;this.y+=t.y;return this},scalarAdd:function(t){return new i(this.x+t,this.y+t)},scalarAddEquals:function(t){this.x+=t;this.y+=t;return this},subtract:function(t){return new i(this.x-t.x,this.y-t.y)},subtractEquals:function(t){this.x-=t.x;this.y-=t.y;return this},scalarSubtract:function(t){return new i(this.x-t,this.y-t)},scalarSubtractEquals:function(t){this.x-=t;this.y-=t;return this},multiply:function(t){return new i(this.x*t,this.y*t)},multiplyEquals:function(t){this.x*=t;this.y*=t;return this},divide:function(t){return new i(this.x/t,this.y/t)},divideEquals:function(t){this.x/=t;this.y/=t;return this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,e){if(typeof e==="undefined"){e=.5}e=Math.max(Math.min(1,e),0);return new i(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return this.lerp(t)},min:function(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){this.x=t;this.y=e;return this},setX:function(t){this.x=t;return this},setY:function(t){this.y=t;return this},setFromPoint:function(t){this.x=t.x;this.y=t.y;return this},swap:function(t){var e=this.x,i=this.y;this.x=t.x;this.y=t.y;t.x=e;t.y=i},clone:function(){return new i(this.x,this.y)}}})(typeof exports!=="undefined"?exports:this);(function(t){"use strict";var e=t.iws||(t.iws={});if(e.Intersection){e.warn("iws.Intersection is already defined");return}function i(t){this.status=t;this.points=[]}e.Intersection=i;e.Intersection.prototype={constructor:i,appendPoint:function(t){this.points.push(t);return this},appendPoints:function(t){this.points=this.points.concat(t);return this}};e.Intersection.intersectLineLine=function(t,n,s,o){var r,a=(o.x-s.x)*(t.y-s.y)-(o.y-s.y)*(t.x-s.x),l=(n.x-t.x)*(t.y-s.y)-(n.y-t.y)*(t.x-s.x),h=(o.y-s.y)*(n.x-t.x)-(o.x-s.x)*(n.y-t.y);if(h!==0){var c=a/h,u=l/h;if(0<=c&&c<=1&&0<=u&&u<=1){r=new i("Intersection");r.appendPoint(new e.Point(t.x+c*(n.x-t.x),t.y+c*(n.y-t.y)))}else{r=new i}}else{if(a===0||l===0){r=new i("Coincident")}else{r=new i("Parallel")}}return r};e.Intersection.intersectLinePolygon=function(t,e,n){var s=new i,o=n.length,r,a,l;for(var h=0;h<o;h++){r=n[h];a=n[(h+1)%o];l=i.intersectLineLine(t,e,r,a);s.appendPoints(l.points)}if(s.points.length>0){s.status="Intersection"}return s};e.Intersection.intersectPolygonPolygon=function(t,e){var n=new i,s=t.length;for(var o=0;o<s;o++){var r=t[o],a=t[(o+1)%s],l=i.intersectLinePolygon(r,a,e);n.appendPoints(l.points)}if(n.points.length>0){n.status="Intersection"}return n};e.Intersection.intersectPolygonRectangle=function(t,n,s){var o=n.min(s),r=n.max(s),a=new e.Point(r.x,o.y),l=new e.Point(o.x,r.y),h=i.intersectLinePolygon(o,a,t),c=i.intersectLinePolygon(a,r,t),u=i.intersectLinePolygon(r,l,t),f=i.intersectLinePolygon(l,o,t),d=new i;d.appendPoints(h.points);d.appendPoints(c.points);d.appendPoints(u.points);d.appendPoints(f.points);if(d.points.length>0){d.status="Intersection"}return d}})(typeof exports!=="undefined"?exports:this);(function(t){"use strict";var e=t.iws||(t.iws={});if(e.Color){e.warn("iws.Color is already defined.");return}function i(t){if(!t){this.setSource([0,0,0,1])}else{this._tryParsingColor(t)}}e.Color=i;e.Color.prototype={_tryParsingColor:function(t){var e;if(t in i.colorNameMap){t=i.colorNameMap[t]}if(t==="transparent"){e=[255,255,255,0]}if(!e){e=i.sourceFromHex(t)}if(!e){e=i.sourceFromRgb(t)}if(!e){e=i.sourceFromHsl(t)}if(!e){e=[0,0,0,1]}if(e){this.setSource(e)}},_rgbToHsl:function(t,i,n){t/=255;i/=255;n/=255;var s,o,r,a=e.util.array.max([t,i,n]),l=e.util.array.min([t,i,n]);r=(a+l)/2;if(a===l){s=o=0}else{var h=a-l;o=r>.5?h/(2-a-l):h/(a+l);switch(a){case t:s=(i-n)/h+(i<n?6:0);break;case i:s=(n-t)/h+2;break;case n:s=(t-i)/h+4;break}s/=6}return[Math.round(s*360),Math.round(o*100),Math.round(r*100)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t=this.getSource(),e,i,n;e=t[0].toString(16);e=e.length===1?"0"+e:e;i=t[1].toString(16);i=i.length===1?"0"+i:i;n=t[2].toString(16);n=n.length===1?"0"+n:n;return e.toUpperCase()+i.toUpperCase()+n.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();e[3]=t;this.setSource(e);return this},toGrayscale:function(){var t=this.getSource(),e=parseInt((t[0]*.3+t[1]*.59+t[2]*.11).toFixed(0),10),i=t[3];this.setSource([e,e,e,i]);return this},toBlackWhite:function(t){var e=this.getSource(),i=(e[0]*.3+e[1]*.59+e[2]*.11).toFixed(0),n=e[3];t=t||127;i=Number(i)<Number(t)?0:255;this.setSource([i,i,i,n]);return this},overlayWith:function(t){if(!(t instanceof i)){t=new i(t)}var e=[],n=this.getAlpha(),s=.5,o=this.getSource(),r=t.getSource();for(var a=0;a<3;a++){e.push(Math.round(o[a]*(1-s)+r[a]*s))}e[3]=n;this.setSource(e);return this}};e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;e.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",grey:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"};function n(t,e,i){if(i<0){i+=1}if(i>1){i-=1}if(i<1/6){return t+(e-t)*6*i}if(i<1/2){return e}if(i<2/3){return t+(e-t)*(2/3-i)*6}return t}e.Color.fromRgb=function(t){return i.fromSource(i.sourceFromRgb(t))};e.Color.sourceFromRgb=function(t){var e=t.match(i.reRGBa);if(e){var n=parseInt(e[1],10)/(/%$/.test(e[1])?100:1)*(/%$/.test(e[1])?255:1),s=parseInt(e[2],10)/(/%$/.test(e[2])?100:1)*(/%$/.test(e[2])?255:1),o=parseInt(e[3],10)/(/%$/.test(e[3])?100:1)*(/%$/.test(e[3])?255:1);return[parseInt(n,10),parseInt(s,10),parseInt(o,10),e[4]?parseFloat(e[4]):1]}};e.Color.fromRgba=i.fromRgb;e.Color.fromHsl=function(t){return i.fromSource(i.sourceFromHsl(t))};e.Color.sourceFromHsl=function(t){var e=t.match(i.reHSLa);if(!e){return}var s=(parseFloat(e[1])%360+360)%360/360,o=parseFloat(e[2])/(/%$/.test(e[2])?100:1),r=parseFloat(e[3])/(/%$/.test(e[3])?100:1),a,l,h;if(o===0){a=l=h=r}else{var c=r<=.5?r*(o+1):r+o-r*o,u=r*2-c;a=n(u,c,s+1/3);l=n(u,c,s);h=n(u,c,s-1/3)}return[Math.round(a*255),Math.round(l*255),Math.round(h*255),e[4]?parseFloat(e[4]):1]};e.Color.fromHsla=i.fromHsl;e.Color.fromHex=function(t){return i.fromSource(i.sourceFromHex(t))};e.Color.sourceFromHex=function(t){if(t.match(i.reHex)){var e=t.slice(t.indexOf("#")+1),n=e.length===3||e.length===4,s=e.length===8||e.length===4,o=n?e.charAt(0)+e.charAt(0):e.substring(0,2),r=n?e.charAt(1)+e.charAt(1):e.substring(2,4),a=n?e.charAt(2)+e.charAt(2):e.substring(4,6),l=s?n?e.charAt(3)+e.charAt(3):e.substring(6,8):"FF";return[parseInt(o,16),parseInt(r,16),parseInt(a,16),parseFloat((parseInt(l,16)/255).toFixed(2))]}};e.Color.fromSource=function(t){var e=new i;e.setSource(t);return e}})(typeof exports!=="undefined"?exports:this);(function(){(function(){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")};String.prototype.trimRight=function(){return this.replace(/\s+$/,"")}})();(function(){Node.prototype.hasClass=function(t){if(this.classList){return this.classList.contains(t)}else{return-1<this.className.indexOf(t)}};Node.prototype.addClass=function(t){if(this.classList){this.classList.add(t)}else if(!this.hasClass(t)){var e=this.className.split(" ");e.push(t);this.className=e.join(" ")}return this};Node.prototype.removeClass=function(t){if(this.classList){this.classList.remove(t)}else{var e=this.className.split(" ");e.splice(e.indexOf(t),1);this.className=e.join(" ")}return this};if(!NodeList.prototype.forEach){NodeList.prototype.forEach=Array.prototype.forEach}})();(function(){CanvasRenderingContext2D.prototype.getFontStyle=function(){var t=document.createElement("div");t.style.cssText="font: "+this.font+" !important;";this.canvas.appendChild(t);var e=window.getComputedStyle(t),i={fontFamily:e.fontFamily,fontSize:e.fontSize,fontStyle:e.fontStyle,fontVariant:e.fontVariant,fontWeight:e.fontWeight,lineHeight:e.lineHeight};this.canvas.removeChild(t);return i};CanvasRenderingContext2D.prototype.textArea=function(t,e,i,n,s,o,r){var a=t instanceof Array?t:t.split(/\b(?=\S)|(?=\s)/g),l=this.getFontStyle(),h=this.textBaseline,c=r||0,u=0,f=parseInt(l.fontSize),o=(o||1)*f,d,p,g,m,v,b,w;this.textBaseline="top";for(p=0;p<a.length;++p){if("\n"===a[p]){c=0;u+=o;continue}if(!c&&/^\t+/.test(a[p]))a[p]=a[p].replace(/^\t+/,"");d=this.measureText(a[p]).width;if((g=n-d)<=0){g=Math.abs(g);if(g-n<=0)for(m=a[p].length;m;--m){if(n>this.measureText(a[p].substr(0,m)+"-").width+f){v=m;break}}else for(m=0;m<a[p].length;++m){if(n<this.measureText(a[p].substr(0,m+1)+"-").width+f){v=m;break}}if(v){var b=a[p].substr(0,m+1)+"-",w=a[p].substr(m+1);a[p]=b;a.splice(p+1,0,w);d=this.measureText(b).width}}if(c>0&&c+d>=n){if(u+o*2>=s)return{x:c+e,y:u+i,remainder:a.slice(p)};c=0;u+=o;if(" "===a[p])continue}this.fillText(a[p],c+e,u+i);c+=d}this.textBaseline=h;return{x:c+e,y:u+i,remainder:[]}}})();(function(){var t=/([a-z\d])([A-Z])/g;var e=/\s+/;var i=/^(width|height|left|top|marginLeft|marginTop)$/;var n=/^\s+(.*)\s+$/;var s=Object.prototype;var o=s.toString;var r=s.hasOwnProperty;var a=Array.prototype.slice;function l(t){return o.call(t).slice(8,-1).toLowerCase()}function h(t){return typeof t==="string"}function c(t){return typeof t==="number"&&!isNaN(t)}function u(t){return typeof t==="undefined"}function f(t){return(typeof t==="undefined"?"undefined":_typeof(t))==="object"&&t!==null}function d(t){if(!f(t)){return false}try{var e=t.constructor;var i=e.prototype;return e&&i&&r.call(i,"isPrototypeOf")}catch(t){return false}}function p(t){return l(t)==="function"}function g(t){return Array.isArray?Array.isArray(t):l(t)==="array"}function m(t,e){e=e>=0?e:0;if(Array.from){return Array.from(t).slice(e)}return a.call(t,e)}function v(t,e){var i=-1;if(e.indexOf){return e.indexOf(t)}e.forEach(function(e,n){if(e===t){i=n}});return i}function b(t){if(h(t)){t=t.trim?t.trim():t.replace(n,"1")}return t}function w(t,e){if(t&&p(e)){var i=void 0;if(g(t)||c(t.length)){var n=t.length;for(i=0;i<n;i++){if(e.call(t,t[i],i,t)===false){break}}}else if(f(t)){Object.keys(t).forEach(function(i){e.call(t,t[i],i,t)})}}return t}function y(e){return e.replace(t,"$1-$2").toLowerCase()}function _(t,e){if(f(t[e])){return t[e]}else if(t.dataset){return t.dataset[e]}return t.getAttribute("data-"+y(e))}function x(t,e,i){if(f(i)){t[e]=i}else if(t.dataset){t.dataset[e]=i}else{t.setAttribute("data-"+y(e),i)}}function C(t,e){if(f(t[e])){delete t[e]}else if(t.dataset){try{delete t.dataset[e]}catch(i){t.dataset[e]=null}}else{t.removeAttribute("data-"+y(e))}}function k(t,i,n){var s=b(i).split(e);if(s.length>1){w(s,function(e){k(t,e,n)});return}if(t.removeEventListener){t.removeEventListener(i,n,false)}else if(t.detachEvent){t.detachEvent("on"+i,n)}}function S(t,i,n,s){var o=b(i).split(e);var r=n;if(o.length>1){w(o,function(e){S(t,e,n)});return}if(s){n=function e(){for(var s=arguments.length,o=Array(s),a=0;a<s;a++){o[a]=arguments[a]}k(t,i,n);return r.apply(t,o)}}if(t.addEventListener){t.addEventListener(i,n,false)}else if(t.attachEvent){t.attachEvent("on"+i,n)}}function T(t,e,i){if(t.dispatchEvent){var n=void 0;if(p(Event)&&p(CustomEvent)){if(u(i)){n=new Event(e,{bubbles:true,cancelable:true})}else{n=new CustomEvent(e,{detail:i,bubbles:true,cancelable:true})}}else if(u(i)){n=document.createEvent("Event");n.initEvent(e,true,true)}else{n=document.createEvent("CustomEvent");n.initCustomEvent(e,true,true,i)}return t.dispatchEvent(n)}else if(t.fireEvent){return t.fireEvent("on"+e)}return true}iws.event={addListener:S,removeListener:k,dispatchEvent:T}})();(function(){"use strict";var t=Math.PI/180;iws.util={degreesToRadians:function(e){return e*t},radiansToDegrees:function(e){return e/t},rotatePoint:function(t,e,i){t.subtractEquals(e);var n=iws.util.rotateVector(t,i);return new iws.Point(n.x,n.y).addEquals(e)},rotateVector:function(t,e){var i=Math.sin(e),n=Math.cos(e),s=t.x*n-t.y*i,o=t.x*i+t.y*n;return{x:s,y:o}},falseFunction:function(){return false},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},loadImage:function(t,e,i,n){if(!t){e&&e.call(i,t);return}var s=document.createElement("img");s.onload=function(){e&&e.call(i,s);s=s.onload=s.onerror=null};s.onerror=function(){iws.log("Error loading "+s.src);e&&e.call(i,null,true);s=s.onload=s.onerror=null};if(t.indexOf("data")!==0&&n){s.crossOrigin=n}s.src=t},makeElement:function(t,e){var i=document.createElement(t);for(var n in e){if(n==="class"){i.className=e[n]}else if(n==="for"){i.htmlFor=e[n]}else{i.setAttribute(n,e[n])}}return i},wrapElement:function(t,e,i){if(typeof e==="string"){e=this.makeElement(e,i)}if(t.parentNode){t.parentNode.replaceChild(e,t)}e.appendChild(t);return e},addClass:function(t,e){if(t&&(" "+t.className+" ").indexOf(" "+e+" ")===-1){t.className+=(t.className?" ":"")+e}},drawDashedLine:function(t,e,i,n,s,o){var r=n-e,a=s-i,l=sqrt(r*r+a*a),h=atan2(a,r),c=o.length,u=0,f=true;t.save();t.translate(e,i);t.moveTo(0,0);t.rotate(h);e=0;while(l>e){e+=o[u++%c];if(e>l){e=l}t[f?"lineTo":"moveTo"](e,0);f=!f}t.restore()},clipContext:function(t,e){e.save();e.beginPath();t.clipTo(e);e.clip()},transformPoint:function(t,e,i){if(i){return new iws.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y)}return new iws.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),i=[e*t[3],-e*t[1],-e*t[2],e*t[0]],n=iws.util.transformPoint({x:t[4],y:t[5]},i,true);i[4]=-n.x;i[5]=-n.y;return i},makeBoundingBoxFromPoints:function(t){var e=[t[0].x,t[1].x,t[2].x,t[3].x],i=iws.util.array.min(e),n=iws.util.array.max(e),s=Math.abs(i-n),o=[t[0].y,t[1].y,t[2].y,t[3].y],r=iws.util.array.min(o),a=iws.util.array.max(o),l=Math.abs(r-a);return{left:i,top:r,width:s,height:l}},multiplyTransformMatrices:function(t,e,i){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(e){var i=Math.atan2(e[1],e[0]),n=Math.pow(e[0],2)+Math.pow(e[1],2),s=Math.sqrt(n),o=(e[0]*e[3]-e[2]*e[1])/s,r=Math.atan2(e[0]*e[2]+e[1]*e[3],n);return{angle:i/t,scaleX:s,scaleY:o,skewX:r/t,skewY:0,translateX:e[4],translateY:e[5]}},populateWithProperties:function(t,e,i){if(i&&Object.prototype.toString.call(i)==="[object Array]"){for(var n=0,s=i.length;n<s;n++){if(i[n]in t){e[i[n]]=t[i[n]]}}}},getKlass:function(t,e,i){t=iws.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1));return iws.util.resolveNamespace(e)[i+t]},resolveNamespace:function(t){if(!t){return iws}var e=t.split("."),i=e.length,n,s=global||iws.window;for(n=0;n<i;++n){s=s[e[n]]}return s},enlivenObjects:function(t,e,i,n,s){t=t||[];function o(){if(++a===l){e&&e(r)}}var r=[],a=0,l=t.length;if(!l){e&&e(r);return}t.forEach(function(t,e){if(!t||!t.type){o();return}var a=iws.util.getKlass(t.type,i,n);r[e]=a.fromObject(t);s&&s(t,r[e]);o()})}}})();(function(){function t(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})}function e(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())}function i(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function n(t,e){var i;if(typeof t==="undefined"||t==="")return e;if(t.charAt(t.length-1)==="/"){if(e.charAt(0)==="/"){return t+e.slice(1)}else{return t+e}}else{if(e.charAt(0)==="/"){return t+e}else{return t+"/"+e}}return i}iws.util.string={camelize:t,capitalize:e,escapeXml:i,combinePath:n}})();(function(){"use strict";iws.util.find={getAngleFromPointToPoint:function(t,e,i,n){var s=i-t,o=n-e;var r=Math.atan2(o,s),a=r*180/Math.PI;return{radian:r,angle:a}},distanceOfTwoPoints:function(t,e){var i=Math.pow(t.x-e.x,2);var n=Math.pow(t.y-e.y,2);return Math.sqrt(i+n)},getContainFromCoords:function(t,e){var i=this._getImageLines(t),n=this._findCrossPoints(e,i);var s=n!==0&&n%2===1;return s},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,n,s,o,r,a=0,l;for(var h in e){l=e[h];if(l.o.y<t.y&&l.d.y<t.y){continue}if(l.o.y>=t.y&&l.d.y>=t.y){continue}if(l.o.x===l.d.x&&l.o.x>=t.x){r=l.o.x}else{i=0;n=(l.d.y-l.o.y)/(l.d.x-l.o.x);s=t.y-i*t.x;o=l.o.y-n*l.o.x;r=-(s-o)/(i-n)}if(r>=t.x){a+=1}if(a===2){break}}return a}}})();(function(){"use strict";function t(){}function e(t){var e=this.constructor.superclass.prototype[t];if(arguments.length>1){return e.apply(this,Array.prototype.slice.call(arguments,1))}else{return e.call(this)}}function i(){var i=null,n=Array.prototype.slice.call(arguments,0),s=n.shift();s.subclasses=[];if(typeof n[0]==="function"){i=n.shift();t.prototype=i.prototype;s.prototype=new t;i.subclasses.push(s)}s.superclass=i;for(var o=0,r=n.length;o<r;o++){for(var a in n[o]){var l=n[o];s.prototype[a]=l[a]}}s.prototype.constructor=s;s.prototype.callSuper=e;return s}iws.util.createInheritClass=i})();(function(){var t=document.documentElement.style,e="userSelect"in t?"userSelect":"MozUserSelect"in t?"MozUserSelect":"WebkitUserSelect"in t?"WebkitUserSelect":"KhtmlUserSelect"in t?"KhtmlUserSelect":"";function i(t){if(typeof t.onselectstart!=="undefined"){t.onselectstart=iws.util.falseFunction}if(e){t.style[e]="none"}else if(typeof t.unselectable==="string"){t.unselectable="on"}return t}function n(t){if(typeof t.onselectstart!=="undefined"){t.onselectstart=null}if(e){t.style[e]=""}else if(typeof t.unselectable==="string"){t.unselectable=""}return t}function s(t){var e=0,i=0,n=document.documentElement,s=document.body||{scrollLeft:0,scrollTop:0};while(t&&(t.parentNode||t.host)){t=t.parentNode||t.host;if(t===document){e=s.scrollLeft||n.scrollLeft||0;i=s.scrollTop||n.scrollTop||0}else{e+=t.scrollLeft||0;i+=t.scrollTop||0}if(t.nodeType===1&&iws.util.getElementStyle(t,"position")==="fixed"){break}}return{left:e,top:i}}function o(t){var e,i=t&&t.ownerDocument,n={left:0,top:0},o={left:0,top:0},a,l={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!i){return o}for(var h in l){o[l[h]]+=parseInt(r(t,h),10)||0}e=i.documentElement;if(typeof t.getBoundingClientRect!=="undefined"){n=t.getBoundingClientRect()}a=s(t);return{left:n.left+a.left-(e.clientLeft||0)+o.left,top:n.top+a.top-(e.clientTop||0)+o.top}}var r;if(document.defaultView&&document.defaultView.getComputedStyle){r=function(t,e){var i=document.defaultView.getComputedStyle(t,null);return i?i[e]:undefined}}else{r=function(t,e){var i=t.style[e];if(!i&&t.currentStyle){i=t.currentStyle[e]}return i}}iws.util.makeElementUnselectable=i;iws.util.makeElementSelectable=n;iws.util.getScrollLeftTop=s;iws.util.getElementOffset=o;iws.util.getElementStyle=r;function a(t){t||(t=window.event);var e=t.target||(typeof t.srcElement!==unknown?t.srcElement:null),i=iws.util.getScrollLeftTop(e);return{x:(t.clientX||t.touches[0].clientX)+i.left,y:(t.clientY||t.touches[0].clientY)+i.top}}iws.util.getPointer=a;var l=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function h(t){return toString.call(t).slice(8,-1).toLowerCase()}function c(t){return typeof t==="number"&&!isNaN(t)}function u(t){return(typeof t==="undefined"?"undefined":l(t))==="object"&&t!==null}function f(t){return h(t)==="function"}function d(t){return Array.isArray?Array.isArray(t):h(t)==="array"}function p(t,e){if(t&&f(e)){var i=void 0;if(d(t)||c(t.length)){var n=t.length;for(i=0;i<n;i++){if(e.call(t,t[i],i,t)===false){break}}}else if(u(t)){Object.keys(t).forEach(function(i){e.call(t,t[i],i,t)})}}return t}function g(t){var e=m(t);var i=[];if(e.changedTouches){p(e.changedTouches,function(t){i.push({x:t.pageX,y:t.pageY})})}else{i.push({x:e.pageX,y:e.pageY})}return i}iws.util.getPointers=g;function m(t){var e=t||window.event;if(!e.target){e.target=e.srcElement||document}if(!c(e.pageX)&&c(e.clientX)){var i=t.target.ownerDocument||document;var n=i.documentElement;var s=i.body;e.pageX=e.clientX+((n&&n.scrollLeft||s&&s.scrollLeft||0)-(n&&n.clientLeft||s&&s.clientLeft||0));e.pageY=e.clientY+((n&&n.scrollTop||s&&s.scrollTop||0)-(n&&n.clientTop||s&&s.clientTop||0))}return e}iws.util.getEvent=m;function v(t){var e=document.documentElement;var i=t.getBoundingClientRect();return{left:i.left+((window.scrollX||e&&e.scrollLeft||0)-(e&&e.clientLeft||0)),top:i.top+((window.scrollY||e&&e.scrollTop||0)-(e&&e.clientTop||0))}}iws.util.getOffset=v})();(function(){var t=Array.prototype.slice;function e(e,i){var n=t.call(arguments,2),s=[];for(var o=0,r=e.length;o<r;o++){s[o]=n.length?e[o][i].apply(e[o],n):e[o][i].call(e[o])}return s}function i(t,e){return o(t,e,function(t,e){return t>=e})}function n(t,e){return o(t,e,function(t,e){return t<e})}function s(t,e){var i=t.length;while(i--){t[i]=e}return t}function o(t,e,i){if(!t||t.length===0){return}var n=t.length-1,s=e?t[n][e]:t[n];if(e){while(n--){if(i(t[n][e],s)){s=t[n][e]}}}else{while(n--){if(i(t[n],s)){s=t[n]}}}return s}iws.util.array={fill:s,invoke:e,min:n,max:i}})();(function(){var t={},e={},i={},n=Array.prototype.join;function s(e,i,s,a,l,h,c){var u=n.call(arguments);if(t[u]){return t[u]}var f=Math.PI,d=c*f/180,p=Math.sin(d),g=Math.cos(d),m=0,v=0;s=Math.abs(s);a=Math.abs(a);var b=-g*e*.5-p*i*.5,w=-g*i*.5+p*e*.5,y=s*s,_=a*a,x=w*w,C=b*b,k=y*_-y*x-_*C,S=0;if(k<0){var T=Math.sqrt(1-k/(y*_));s*=T;a*=T}else{S=(l===h?-1:1)*Math.sqrt(k/(y*x+_*C))}var M=S*s*w/a,P=-S*a*b/s,O=g*M-p*P+e*.5,E=p*M+g*P+i*.5,A=r(1,0,(b-M)/s,(w-P)/a),j=r((b-M)/s,(w-P)/a,(-b-M)/s,(-w-P)/a);if(h===0&&j>0){j-=2*f}else if(h===1&&j<0){j+=2*f}var R=Math.ceil(Math.abs(j/f*2)),L=[],F=j/R,I=8/3*Math.sin(F/4)*Math.sin(F/4)/Math.sin(F/2),D=A+F;for(var q=0;q<R;q++){L[q]=o(A,D,g,p,s,a,O,E,I,m,v);m=L[q][4];v=L[q][5];A=D;D+=F}t[u]=L;return L}function o(t,i,s,o,r,a,l,h,c,u,f){var d=n.call(arguments);if(e[d]){return e[d]}var p=Math.cos(t),g=Math.sin(t),m=Math.cos(i),v=Math.sin(i),b=s*r*m-o*a*v+l,w=o*r*m+s*a*v+h,y=u+c*(-s*r*g-o*a*p),_=f+c*(-o*r*g+s*a*p),x=b+c*(s*r*v+o*a*m),C=w+c*(o*r*v-s*a*m);e[d]=[y,_,x,C,b,w];return e[d]}function r(t,e,i,n){var s=Math.atan2(e,t),o=Math.atan2(n,i);if(o>=s){return o-s}else{return 2*Math.PI-(s-o)}}iws.util.drawArc=function(t,e,i,n){var o=n[0],r=n[1],a=n[2],l=n[3],h=n[4],c=n[5],u=n[6],f=[[],[],[],[]],d=s(c-e,u-i,o,r,l,h,a);for(var p=0,g=d.length;p<g;p++){f[p][0]=d[p][0]+e;f[p][1]=d[p][1]+i;f[p][2]=d[p][2]+e;f[p][3]=d[p][3]+i;f[p][4]=d[p][4]+e;f[p][5]=d[p][5]+i;t.bezierCurveTo.apply(t,f[p])}};iws.util.getBoundsOfArc=function(t,e,i,n,o,r,l,h,c){var u=0,f=0,d,p=[],g=s(h-t,c-e,i,n,r,l,o);for(var m=0,v=g.length;m<v;m++){d=a(u,f,g[m][0],g[m][1],g[m][2],g[m][3],g[m][4],g[m][5]);p.push({x:d[0].x+t,y:d[0].y+e});p.push({x:d[1].x+t,y:d[1].y+e});u=g[m][4];f=g[m][5]}return p};function a(t,e,s,o,r,a,l,h){var c=n.call(arguments);if(i[c]){return i[c]}var u=Math.sqrt,f=Math.min,d=Math.max,p=Math.abs,g=[],m=[[],[]],v,b,w,y,_,x,C,k;b=6*t-12*s+6*r;v=-3*t+9*s-9*r+3*l;w=3*s-3*t;for(var S=0;S<2;++S){if(S>0){b=6*e-12*o+6*a;v=-3*e+9*o-9*a+3*h;w=3*o-3*e}if(p(v)<1e-12){if(p(b)<1e-12){continue}y=-w/b;if(0<y&&y<1){g.push(y)}continue}C=b*b-4*w*v;if(C<0){continue}k=u(C);_=(-b+k)/(2*v);if(0<_&&_<1){g.push(_)}x=(-b-k)/(2*v);if(0<x&&x<1){g.push(x)}}var T,M,P=g.length,O=P,E;while(P--){y=g[P];E=1-y;T=E*E*E*t+3*E*E*y*s+3*E*y*y*r+y*y*y*l;m[0][P]=T;M=E*E*E*e+3*E*E*y*o+3*E*y*y*a+y*y*y*h;m[1][P]=M}m[0][O]=t;m[1][O]=e;m[0][O+1]=l;m[1][O+1]=h;var A=[{x:f.apply(null,m[0]),y:f.apply(null,m[1])},{x:d.apply(null,m[0]),y:d.apply(null,m[1])}];i[c]=A;return A}iws.util.getBoundsOfCurve=a})();(function(){function t(t,e){for(var i in e){t[i]=e[i]}return t}function e(e){return t({},e)}iws.util.extend=t;iws.util.clone=e})();(function(){function t(t,e){var i=iws.util.makeElement("div",{class:"resize",style:"position:absolute; width:auto; height:auto; top:0; right:0; bottom:0; left:0; margin:0; padding:0; overflow:hidden; visibility:hidden; z-index:-1"});t.appendChild(i);var n=iws.util.makeElement("iframe",{style:"width:100%; height:0; border:0; visibility:visible; margin:0"});i.appendChild(n);var s=iws.util.makeElement("iframe",{style:"width:0; height:100%; border:0; visibility:visible; margin:0"});i.appendChild(s);this.callback=e;this.resizeData={w:t.offsetWidth,h:t.offsetHeight,t:null,throttle:10};function o(){var i=this.resizeData;if(!i.t||i.w!==t.offsetWidth||i.h!==t.offsetHeight){if(i.t)clearTimeout(i.t);i.t=setTimeout(function(){i.w=t.offsetWidth;i.h=t.offsetHeight;e()}.bind(this),i.throttle)}}n.contentWindow.addEventListener("resize",o.bind(this));s.contentWindow.addEventListener("resize",o.bind(this))}iws.util.resize=t})();(function(){iws.util.regexp={};iws.util.regexp.checkUrlForm=function(t){var e=/^http[s]?\:\/\//i;return e.test(t)};iws.util.regexp.getDigitString=function(t){var e=t.replace(/[^-\d\.]/g,"");return e}})();(function(){iws.util.fullscreen={toggleFullScreen:function(t){if(document.fullScreenElement&&document.fullScreenElement!==null||!document.mozFullScreen&&!document.webkitIsFullScreen){if(t.requestFullScreen){t.requestFullScreen()}else if(t.msRequestFullscreen){t.msRequestFullscreen()}else if(t.mozRequestFullScreen){t.mozRequestFullScreen()}else if(t.webkitRequestFullScreen){t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}}else{if(document.exitFullscreen){document.exitFullscreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}},onFullScreenChange:function(t){$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(e){var i=!(!document.fullscreenElement&&!document.msFullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement);t&&t(i)}.bind(this))}}})();(function(){iws.util.urlDownload=function(t,e){var i=0;var n=new XMLHttpRequest;n.open("GET",t);n.responseType="arraybuffer";n.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");n.onload=function(t){if(i===200)e(n.response)};n.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total}else{}};n.onreadystatechange=function t(){if(n.readyState===4){if(n.status===200){i=n.status}else{alert("There was a problem with the request.\n"+n.statusText)}}};n.send()}})();(function(){iws.util.Unique={prevTimeId:0,prevUniqueId:0,thumbFrameId:0,getUniqueID:function(){try{var t=new Date;var e=t.getTime();if(e==iws.util.Unique.prevTimeId)iws.util.Unique.prevUniqueId=iws.util.Unique.prevUniqueId+1;else{iws.util.Unique.prevTimeId=e;iws.util.Unique.prevUniqueId=0}e=e+""+iws.util.Unique.prevUniqueId;return e}catch(t){console.log("mwUnique.getUniqueID error:"+t.message+".")}},getFrameId:function(){var t=iws.util.Unique.thumbFrameId++;return"thumb_frame_"+t.toString()}}})();(function(){iws.util.ListenDropFile=function(t,e){t.addEventListener("dragover",function(t){t.preventDefault();t.dataTransfer.dropEffect="copy"});t.addEventListener("drop",function(t){t.stopPropagation();t.preventDefault();var i=t.dataTransfer.files;if(i.length>0){var n=i[0];var s=new FileReader;s.onload=function(){e(s)};s.readAsArrayBuffer(n)}})}})();(function(){iws.util.run_waitMe=function(t,e){iws.util.waitMe(t,{effect:e,text:"",bg:"rgba(255,255,255,0.2)",color:"#222222",maxSize:"20px",onClose:function(){}})};iws.util.hide_waitMe=function(t){iws.util.waitMe(t,"hide")};iws.util.waitMe=function(t,e){return function(){var i=t,n="waitMe",s,o,r,a=false,l="background-color",h="",c="",u,f,d;var p={init:function(){var t={effect:"bounce",text:"",bg:"rgba(255,255,255,0.7)",color:"#000",maxSize:"",source:"",onClose:function(){}};f=$.extend(t,e);d=(new Date).getMilliseconds();u=$('<div class="'+n+'" data-waitme_id="'+d+'"></div>');switch(f.effect){case"none":r=0;break;case"bounce":r=3;break;case"rotateplane":r=1;break;case"stretch":r=5;break;case"orbit":r=2;break;case"roundBounce":r=12;break;case"win8":r=5;a=true;break;case"win8_linear":r=5;a=true;break;case"ios":r=12;break;case"facebook":r=3;break;case"rotation":r=1;l="border-color";break;case"timer":r=2;if($.isArray(f.color)){var p=f.color[0]}else{var p=f.color}h="border-color:"+p;break;case"pulse":r=1;l="border-color";break;case"progressBar":r=1;break;case"bouncePulse":r=3;break;case"img":r=1;break}if(h!==""){h+=";"}if(r>0){if(f.effect==="img"){c='<img src="'+f.source+'">'}else{for(var g=1;g<=r;++g){if($.isArray(f.color)){var p=f.color[g];if(p==undefined){p="#000"}}else{var p=f.color}if(a){c+='<div class="'+n+"_progress_elem"+g+'"><div style="'+l+":"+p+'"></div></div>';
}else{c+='<div class="'+n+"_progress_elem"+g+'" style="'+l+":"+p+'"></div>'}}}o=$('<div class="'+n+"_progress "+f.effect+'" style="'+h+'">'+c+"</div>")}if(f.text&&f.maxSize===""){if($.isArray(f.color)){var p=f.color[0]}else{var p=f.color}s=$('<div class="'+n+'_text" style="color:'+p+'">'+f.text+"</div>")}var m=i.find("> ."+n);if(m){m.remove()}var v=$('<div class="'+n+'_content"></div>');v.append(o,s);u.append(v);if(i[0].tagName=="HTML"){i=$("body")}i.addClass(n+"_container").attr("data-waitme_id",d).append(u);m=i.find("> ."+n);var b=i.find("."+n+"_content");m.css({background:f.bg});b.css({marginTop:-b.outerHeight()/2+"px"});if(f.maxSize!==""){var w=o.outerHeight();var y=o.outerWidth();var _=w;if(f.effect==="img"){o.css({height:f.maxSize+"px"});o.find(">img").css({maxHeight:"100%"});b.css({marginTop:-b.outerHeight()/2+"px"})}else{if(f.maxSize<_){v.css({transform:"scale("+f.maxSize/_+")"})}}}function x(t){b.css({top:"auto",transform:"translateY("+t+"px) translateZ(0)"})}if(i.outerHeight()>$(window).height()){var C=$(window).scrollTop(),k=b.outerHeight(),S=i.offset().top,T=i.outerHeight(),M=C-S+$(window).height()/2;if(M<0){M=Math.abs(M)}if(M-k>=0&&M+k<=T){if(S-C>$(window).height()/2){M=k}x(M)}else{if(C>S+T-k){M=C-S-k}else{M=C-S+k}x(M)}$(document).scroll(function(){var t=$(window).scrollTop(),e=t-S+$(window).height()/2;if(e-k>=0&&e+k<=T){x(e)}})}m.on("destroyed",function(){if(f.onClose&&$.isFunction(f.onClose)){f.onClose()}m.trigger("close")});$.event.special.destroyed={remove:function(t){if(t.handler){t.handler()}}};return m},hide:function(){g()}};function g(){var t=i.attr("data-waitme_id");i.removeClass(n+"_container").removeAttr("data-waitme_id");i.find("."+n+'[data-waitme_id="'+t+'"]').remove()}if(p[e]){return p[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return p.init.apply(this,arguments)}}()}})();(function(){iws.util.work={};iws.util.work.Spliter=function(t,e){var i=new Worker(t);i.onerror=function(t){console.log("iwsT.Spliter : "+event.message+" ("+event.filename+":"+event.lineno+")")};var n=false;var s={};var o=function(){};var r=function(t){};return{init:function(){if(n===true){if(i!==null){i.terminate();i=null}n=false}if(i===null){i=new Worker(t)}},postMessage:function(s){n=true;i.onmessage=function(s){o(s);n=false;if(e===true){i.terminate();i=null;i=new Worker(t)}};i.onerror=function(s){console.log("iwsT.Spliter : "+s.message+" ("+s.filename+":"+s.lineno+")");r(s);n=false;if(e===true){i.terminate();i=null;i=new Worker(t)}};i.postMessage(s)},callBackonmessage:function(t){o=t},callBackonerror:function(t){r=t}}};iws.util.work.WorkCrew=function(t,e,i,n){this.filename=t;this.count=this.mincount=e;this.maxcount=i||4;this.queue=[];this.results=[];this.pool=[];this.working={};this.uuid=0;this.fillPool();this.isRunning=false;this.inited=function(){};this.refresh=n||true};iws.util.work.WorkCrew.prototype.onfinish=function(){};iws.util.work.WorkCrew.prototype.onstarted=function(t){};iws.util.work.WorkCrew.prototype.oncomplete=function(t,e){};iws.util.work.WorkCrew.prototype.oncanceled=function(t){};iws.util.work.WorkCrew.prototype.unshiftWork=function(t){if(this.count===0){this.count++;this.addWorker()}this.isRunning=true;var e=this.uuid++;this.queue.unshift({id:e,work:t});this.processQueue();return e};iws.util.work.WorkCrew.prototype.addWork=function(t){if(this.count===0){this.count++;this.addWorker()}this.isRunning=true;var e=this.uuid++;this.queue.push({id:e,work:t});this.processQueue();return e};iws.util.work.WorkCrew.prototype.close=function(){this.mincount=0;this.init();var t=this.pool.length;for(var e=0;e<t;e++){var i=this.pool.shift();i.terminate();i=undefined}};iws.util.work.WorkCrew.prototype.init=function(){this.uuid=0;if(this.isRunning===true){for(var t=this.queue.length-1;t>=0;t--)this.queue.splice(t,1);for(var t in this.working){var e=this.working[t];console.log("<<<<    oncanceled "+e.work.cmd+" : "+e.work.id.index+", uniqueId="+e.work.id.uniqueId);this.oncanceled(e.work);e.terminate();e=undefined;delete this.working[t];this.count--}this.isRunning=false}var i=this.mincount-this.count;for(var t=0;t<i;t++){this.addWorker();this.count++}};iws.util.work.WorkCrew.prototype.clearData=function(t){if(t===null){for(var e=this.queue.length-1;e>=0;e--){this.oncanceled(this.queue[e].work);this.queue.splice(e,1)}}else{for(var e=this.queue.length-1;e>=0;e--){if(t===this.queue[e].work.cmd){this.oncanceled(this.queue[e].work);this.queue.splice(e,1)}}}};iws.util.work.WorkCrew.prototype.initAsync=function(){for(var t=this.queue.length-1;t>=0;t--)this.queue.splice(t,1);this.uuid=0;var e=this;(function(t){function i(){setTimeout(function(){if(e.isRunning===true){i(t)}else t()},0)}i()})(this.inited)};iws.util.work.WorkCrew.prototype.processQueue=function(){if(this.queue.length==0&&this.pool.length==this.count){if(this.onfinish){var t=this.count-this.mincount;if(this.refresh){t=this.count}for(var e=0;e<t;e++){var i=this.pool.shift();i.terminate();i=undefined;this.count--}this.onfinish();this.isRunning=false;this.uuid=0;if(this.refresh){for(var e=0;e<this.mincount;e++){this.addWorker();this.count++}}}}else{while(this.queue.length>0&&this.pool.length>0){var n=this.queue.shift();var i=this.pool.shift();i.id=n.id;i.work=n.work;this.working[i.id]=i;i.postMessage(n.work);this.onstarted(n.work)}}};iws.util.work.WorkCrew.prototype.addWorker=function(){var t=new Worker(this.filename);var e=this;t.onmessage=function(t){var i=this.id;delete e.working[this.id];this.id=null;e.pool.push(this);try{e.oncomplete(i,t)}catch(n){console.log(n);console.log("iwsT.WorkCrew onmessage: "+n.message+" ("+n.filename+":"+n.lineno+")");e.oncomplete(i,t)}if(e.queue.length!==0&&e.count<e.maxcount){e.addWorker();e.count++}e.processQueue()};t.onerror=function(t){console.log(t);console.log("iwsT.WorkCrew onerror: "+t.message+" ("+t.filename+":"+t.lineno+")")};this.pool.push(t)};iws.util.work.WorkCrew.prototype.fillPool=function(){for(var t=0;t<this.count;t++){this.addWorker()}}})();(function(){iws.util.print={};var t=function(e){return{point:function(t,i,n,s){var o=Math.PI/180*e,r=Math.cos(o),a=Math.sin(o),l=r*(n-t)-a*(s-i)+t,h=r*(s-i)+a*(n-t)+i;return{x:l,y:h}},size:function(i,n){var s=t(e).point(0,0,i,n);return{width:Math.round(Math.abs(s.x)),height:Math.round(Math.abs(s.y))}}}};var e=function(e,i,n,s,o){var r=t(o).size(n,s);var a=1;if(i/r.height*r.width<=e){a=i/r.height}else{a=e/r.width}var l=e/2-n/2*a;var h=i/2-s/2*a;var c=l+n*a;var u=h+s*a;var f=Math.round(l+(c-l)/2);var d=Math.round(h+(u-h)/2);return{scale:a,startx:l,starty:h,endx:c,endy:u,centerx:f,centery:d}};var i=function(t,i,n,s,o){var r=o||0;var a=document.createElement("canvas");var l=a.getContext("2d").createImageData(i,n);l.data.set(t);a.width=i;a.height=n;a.getContext("2d").putImageData(l,0,0);var h=document.createElement("canvas");var c=h.getContext("2d");h.width=210*5;h.height=297*5;var u=e(h.width,h.height,l.width,l.height,r);c.clearRect(0,0,h.width,h.height);c.save();c.fillStyle="#fff";c.fillRect(0,0,h.width,h.height);c.translate(u.centerx,u.centery);c.rotate(r*Math.PI/180);c.translate(-u.centerx,-u.centery);c.translate(u.startx,u.starty);c.scale(u.scale,u.scale);c.drawImage(a,0,0);c.restore();return h.toDataURL("image/jpeg",s)};iws.util.print.image=function(t,e,n){iws.util.run_waitMe($("body"),"progressBar");var s="print-"+(new Date).getTime();var o=$("<iframe id='"+s+"' name='printIframe' class='printBody' style='display:none;'/>");o.appendTo("body");var r=$("#"+s).contents();var a=r.contents();var l=a.find("head");var h=a.find("body");var c=s;l.append("<title>"+c+"</title>");l.append('<meta charset="UTF-8">');if(n!==undefined){l.append("<link type='text/css' rel='stylesheet' href='"+n+"'>")}else{l.append("<style> "+'body { margin: 0;\tpadding: 0;\tbackground-color: #FAFAFA;\tfont: 12pt "Tahoma"; }'+"* {\tbox-sizing: border-box;\t-moz-box-sizing: border-box;}"+".page {\twidth: 21cm;\tmin-height: 29.7cm;}"+".subpage {\tmargin: 0cm;\tpadding: 0.2cm;\twidth: 21.0cm;\theight: 29.7cm;\tbackground: #DFDFDF;}"+".printimg{\twidth: 20.6cm;\theight: 29.3cm;}"+"@page {\tsize: A4;\tmargin: 0;}"+"@media print {\t"+"\t.page {\tmargin: 0; border: initial;\tborder-radius: initial;\twidth: initial;\tmin-height: initial; box-shadow: initial; background: initial; page-break-after: always; }"+"}"+"</style> ")}var u=new iws.util.work.WorkCrew(t,1,1,false);u.oncomplete=function(t,e){var n=e.data,o=n.id;var r=i(n.pagearray,n.pageInfo.width,n.pageInfo.height,20,o.angle);var a=new Date;var l="";l+='<div class="page">';l+='<div class="subpage">';l+='<img class="printimg" src="'+r+'"/>';l+="</div>";l+="</div>";var h=$("#"+s).contents();var c=h.contents().find("body");c.append(l)};u.onfinish=function(){setTimeout(function(){var t=o[0].contentWindow.document.execCommand("print",false,null);if(t===false)o[0].contentWindow.print();$("#"+s).remove()},300);u.close();iws.util.hide_waitMe($("body"))};e.forEach(function(t){t.__id=u.addWork(t)})}})();(function(){function t(){this.initialize.apply(this,arguments)}iws.Pattern=iws.util.createInheritClass(t,{repeat:"repeat",offsetX:0,offsetY:0,initialize:function(t){t||(t={});if(t.source){if(typeof t.source==="string"){if(typeof iws.util.getFunctionBody(t.source)!=="undefined"){this.source=new Function(iws.util.getFunctionBody(t.source))}else{var e=this;this.source=document.createElement("img");iws.util.loadImage(t.source,function(t){e.source=t})}}else{this.source=t.source}}if(t.repeat){this.repeat=t.repeat}if(t.offsetX){this.offsetX=t.offsetX}if(t.offsetY){this.offsetY=t.offsetY}},toLive:function(t){var e=typeof this.source==="function"?this.source():this.source;if(!e){return""}if(typeof e.src!=="undefined"){if(!e.complete){return""}if(e.naturalWidth===0||e.naturalHeight===0){return""}}return t.createPattern(e,this.repeat)}})})()})();(function(){"use strict";function t(i){return{point:function(t,e,n,s){var o=Math.PI/180*i,r=Math.cos(o),a=Math.sin(o),l=r*(n-t)-a*(s-e)+t,h=r*(s-e)+a*(n-t)+e;return{x:l,y:h}},rect:function(n,s,o){var r=t(i).point(n,s,o.left,o.top);var a=t(i).point(n,s,o.right,o.top);var l=t(i).point(n,s,o.right,o.bottom);var h=t(i).point(n,s,o.left,o.bottom);return e([r,a,l,h]).getRect()},size:function(e,n){var s=t(i).point(0,0,e,n);return{width:Math.round(Math.abs(s.x)),height:Math.round(Math.abs(s.y))}}}}iws.util.Rotate=t;function e(t){function e(t,e,i,n){if(t>i)i=[t,t=i][0];if(e>n)n=[e,e=n][0];return{left:t,top:e,right:i,bottom:n}}return{getRect:function(){var i,n,s,o;i=s=t[0].x;n=o=t[0].y;for(var r=0;r<t.length;r++){if(i>t[r].x)i=t[r].x;if(n>t[r].y)n=t[r].y;if(s<t[r].x)s=t[r].x;if(o<t[r].y)o=t[r].y}return e(i,n,s,o)}}}function i(t){return{round:function(){return{left:Math.round(t.left),top:Math.round(t.top),right:Math.round(t.right),bottom:Math.round(t.bottom)}},abs:function(){return{left:Math.abs(t.left),top:Math.abs(t.top),right:Math.abs(t.right),bottom:Math.abs(t.bottom)}},size:function(){return{width:t.right-t.left,height:t.bottom-t.top}},width:function(){return Math.abs(t.right-t.left)},height:function(){return Math.abs(t.bottom-t.top)},center:function(){return{x:t.left+(t.right-t.left)/2,y:t.top+(t.bottom-t.top)/2}},normal:function(){var e=t.left;var i=t.top;var n=t.right;var s=t.bottom;if(e>n)n=[e,e=n][0];if(i>s)s=[i,i=s][0];return{left:e,top:i,right:n,bottom:s}}}}iws.util.Rect=i;function n(){this.leftMouseButtonDown=false;this.mouseDownPos={x:0,y:0};this.mouseMovePos={x:0,y:0};this.mousePrevMoveOffset={x:0,y:0};this._mouseType="move";this.magnificationScale=2;this.intersectRect={}}n.prototype={get mouseType(){return this._mouseType},set mouseType(t){this._mouseType=t},isRange:function(){return this.leftMouseButtonDown&&this.mouseType=="range"},isMove:function(){return this.leftMouseButtonDown&&this.mouseType=="move"},isGlass:function(){return this.leftMouseButtonDown&&this.mouseType=="glass"},getRect:function(){return i({left:this.mouseDownPos.x,top:this.mouseDownPos.y,right:this.mouseMovePos.x,bottom:this.mouseMovePos.y}).normal()},getLT:function(){var t=this.getRect();return{x:t.left,y:t.top}},getRB:function(){var t=this.getRect();return{x:t.right,y:t.bottom}},getIntersectRect:function(t){this.intersectRect=this.getRect();if(this.intersectRect.left<t.left)this.intersectRect.left=t.left;else if(this.intersectRect.left>t.right)this.intersectRect.left=t.right;if(this.intersectRect.top<t.top)this.intersectRect.top=t.top;else if(this.intersectRect.top>t.bottom)this.intersectRect.top=t.bottom;if(this.intersectRect.right>t.right)this.intersectRect.right=t.right;else if(this.intersectRect.right<t.left)this.intersectRect.right=this.intersectRect.left;if(this.intersectRect.bottom>t.bottom)this.intersectRect.bottom=t.bottom;else if(this.intersectRect.bottom<t.top)this.intersectRect.bottom=t.top;return this.intersectRect},drawMagnifyGlass:function(t){t.getContext("2d").save();var e={};var i=60;e.x=this.mouseMovePos.x-i;e.y=this.mouseMovePos.y-i;e.width=i*2;e.height=i*2;var n={width:e.width*this.magnificationScale,height:e.height*this.magnificationScale};var s=e.x+e.width/2-n.width/2;var o=e.y+e.height/2-n.height/2;t.getContext("2d").drawImage(t,e.x,e.y,e.width,e.height,s,o,n.width,n.height);t.getContext("2d").lineWidth=2;t.getContext("2d").strokeStyle="#FF0000";t.getContext("2d").strokeRect(s,o,n.width,n.height);t.getContext("2d").restore()},drawRange:function(t,e){var i=t.getContext("2d");this.intersectRect=this.getIntersectRect(e);i.save();this._drawRect(i,this.intersectRect,"red","#FF0000");i.restore()},drawSelect:function(t,e){var i=t.getContext("2d");i.save();this._drawRect(i,e,"blue","#0000FF");i.restore()},_drawRect:function(t,e,i,n){t.beginPath();t.setLineDash([2]);t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top);t.lineWidth=1;t.strokeStyle=i;t.stroke();t.fillStyle=n;t.globalAlpha=.2;t.fill()}};iws.TrackMouse=n;function s(){this.initialize.apply(this,arguments)}s.prototype={get width(){return this.imgCanvas.width},set width(t){this.imgCanvas.width=t},get height(){return this.imgCanvas.height},set height(t){this.imgCanvas.height=t},get angle(){return this.m_angle},set angle(t){this.m_angle=(t||0)%360},get scale(){return this.m_scale},set scale(t){if(t<.1)t=.1;if(t>4)t=4;this.m_scale=t},get fitMode(){if(this.m_fitMode.name==="scale"){this.m_fitMode.scale=this.scale}return this.m_fitMode},set fitMode(t){var e=this.scale;var i=this.getDrawCenter();this.m_fitMode=t;var n=null;if(this.isValid()){switch(this.m_fitMode.name){case"auto":this.fitAuto();break;case"width":this.fitWidth();break;case"height":this.fitHeight();break;case"scale":this.fitScale();break}var s=this.getDrawCenter();n={oldScale:e,changeRate:this.scale/e,oldCenter:i,center:s,offset:{x:s.x-i.x,y:s.y-i.y}}}this.page.fire("page:fitMode",{input:{mode:t},output:n})},initialize:function(t){this.page=t;this.imgCanvas=document.createElement("canvas");this.imgCanvas.getContext("2d").imageSmoothingEnabled=true;this.imgCanvas.width=0;this.imgCanvas.height=0;this.reSampleCanvas=document.createElement("canvas");this.reSampleCanvas.getContext("2d").imageSmoothingEnabled=true;this.reSampleCanvas.width=0;this.reSampleCanvas.height=0;this.m_scale=1;this.m_scaleStep=.1;this.m_angle=0;this.m_fitMode={name:"auto"};this.startPt={x:0,y:0};this.getEndPt=function(){var t=this.startPt.x+this.imgCanvas.width*this.scale;var e=this.startPt.y+this.imgCanvas.height*this.scale;return{x:t,y:e}};this.getRect=function(){var t=this.startPt;var e=this.getEndPt();return{left:t.x,top:t.y,right:e.x,bottom:e.y}};this.fitAuto=function(){var t=this.page.lowerCanvasEl;var e=this.getRotateSize();if(t.clientHeight/e.height*e.width<=t.clientWidth)this.fitHeight();else this.fitWidth()};this.fitHeight=function(){var t=this.page.lowerCanvasEl;var e=this.getRotateSize();this.scale=t.clientHeight/e.height;this._fixPosition(t)};this.fitWidth=function(){var t=this.page.lowerCanvasEl;var e=this.getRotateSize();this.scale=t.clientWidth/e.width;this._fixPosition(t)};this.fitScale=function(){if(this.m_fitMode.scale){this.scale=this.m_fitMode.scale}var t=this.page.lowerCanvasEl;this._fixPosition(t)};this._fixPosition=function(t){var e=this.startPt;var n=this.getDrawRect();if(i(n).height()>t.height){if(n.top>0){this.startPt.y=this.startPt.y-n.top}else if(n.bottom<t.height){this.startPt.y+=t.height-n.bottom}}else{this.startPt.y=t.height/2-this.height/2*this.scale}if(i(n).width()>t.width){if(n.left>0){this.startPt.x=this.startPt.x-n.left}else if(n.right<t.width){this.startPt.x+=t.width-n.right}}else{this.startPt.x=t.width/2-this.width/2*this.scale}return{offsetX:this.startPt.x-e.x,offsetY:this.startPt.y-e.y}}},clear:function(){this.width=0,this.height=0;this.clearResample()},clearResample:function(){this.reSampleCanvas.width=0,this.reSampleCanvas.height=0},isValid:function(){return this.width>0&&this.height>0},isValidResample:function(){return this.reSampleCanvas.width>0&&this.reSampleCanvas.height>0},setRawData:function(t,e,i,n){this.clear();this.width=t,this.height=e,this.angle=n;var s=this.imgCanvas.getContext("2d").createImageData(this.imgCanvas.width,this.imgCanvas.height);s.data.set(i);this.imgCanvas.getContext("2d").putImageData(s,0,0);this.page.fire("page:setRawData");this.fitRefresh()},setRawDataReSample:function(t,e,i){this.reSampleCanvas.width=t;this.reSampleCanvas.height=e;var n=this.reSampleCanvas.getContext("2d").createImageData(t,e);n.data.set(i);this.reSampleCanvas.getContext("2d").putImageData(n,0,0)},getImageData:function(){var t=this.imgCanvas.getContext("2d").getImageData(0,0,this.width,this.height);return t},rotate:function(t){this.m_angle+=t;this.page.fire("page:rotate",{input:{angle:t}});this.fitRefresh()},zoom:function(t,e){var n=this.page.lowerCanvasEl;e=e||{x:n.width/2,y:n.height/2};var s=this.getDrawCenter();var o=this.getDrawRect();var r=this.scale;if(t==="in"){this.scale=this.scale*(1+this.m_scaleStep)}else if(t==="out"){this.scale=this.scale*(1-this.m_scaleStep)}else if(typeof t==="object"){if(t.name==="custom"){this.scale=t.scale}}var a=this.getDrawRect();var l=(e.x-o.left)/(o.right-o.left);var h=(e.y-o.top)/(o.bottom-o.top);var c=e.x-i(a).width()*l;var u=e.y-i(a).height()*h;this.startPt.x+=c-a.left;this.startPt.y+=u-a.top;this._fixPosition(n);this.fitMode={name:"scale",scale:this.scale};var f=this.getDrawCenter();var d={oldScale:r,changeRate:this.scale/r,oldCenter:s,center:f,offset:{x:f.x-s.x,y:f.y-s.y}};this.page.fire("page:zoom",{input:{type:t,point:e},output:d})},move:function(t){var e={x:this.startPt.x,y:this.startPt.y};this.startPt.x+=t.X;this.startPt.y+=t.Y;var i=this.page.lowerCanvasEl;this._fixPosition(i);var n={x:this.startPt.x-e.x,y:this.startPt.y-e.y};this.page.fire("page:move",{input:{delta:t},output:{offset:n}})},fixPosition:function(){var t={x:this.startPt.x,y:this.startPt.y};var e=this.page.lowerCanvasEl;this._fixPosition(e);var i={x:this.startPt.x-t.x,y:this.startPt.y-t.y};this.page.fire("page:move",{input:{orgPt:t},output:{offset:i}})},fitRefresh:function(t){this.fitMode=this.fitMode},render:function(t){if(this.isValid()){t.save();var e=this.getDrawCenter();t.translate(e.x,e.y);t.rotate(this.angle*Math.PI/180);t.translate(-e.x,-e.y);t.translate(this.startPt.x,this.startPt.y);t.scale(this.scale,this.scale);t.drawImage(this.imgCanvas,0,0);t.restore();if(this.isValidResample()){t.save();var e=this.getDrawCenter();t.translate(e.x,e.y);t.rotate(this.angle*Math.PI/180);t.translate(-e.x,-e.y);t.translate(this.startPt.x,this.startPt.y);var i=this.getScaleSize();var n=i.width/this.reSampleCanvas.width;t.scale(n,n);t.drawImage(this.reSampleCanvas,0,0);t.restore()}}},getDrawCenter:function(){var t=this.getRect();var e=i(t).center();return e},getRotateSize:function(){return t(this.angle).size(this.width,this.height)},getScaleSize:function(){return{width:Math.round(this.width*this.scale),height:Math.round(this.height*this.scale)}},getDrawPoints:function(){var e=this.getDrawCenter();var i=this.getRect();var n=t(this.angle).point(e.x,e.y,i.left,i.top);var s=t(this.angle).point(e.x,e.y,i.right,i.top);var o=t(this.angle).point(e.x,e.y,i.right,i.bottom);var r=t(this.angle).point(e.x,e.y,i.left,i.bottom);return[n,s,o,r]},getDrawRect:function(){var t=this.getDrawPoints();var i=e(t).getRect();return i},isInDrawImage:function(t,e){var i=false;var n=this.getDrawPoints();t.save();t.beginPath();t.moveTo(n[0].x,n[0].y);t.lineTo(n[1].x,n[1].y);t.lineTo(n[2].x,n[2].y);t.lineTo(n[3].x,n[3].y);t.closePath();if(t.isPointInPath(e.x,e.y)){i=true}t.restore();return i},getImagePoint:function(t){var e={x:0,y:0};if(this.angle===0){e.x=t.x-this.startPt.x;e.y=t.y-this.startPt.y}else{var i=this.getDrawRect();e.x=t.x-i.left;e.y=t.y-i.top}var n={x:0,y:0};n.x=e.x/this.scale;n.y=e.y/this.scale;return{x:n.x,y:n.y}},getImageRect:function(t){var e=this.getImagePoint({x:t.left,y:t.top});var n=this.getImagePoint({x:t.right,y:t.bottom});var s=i({left:e.x,top:e.y,right:n.x,bottom:n.y}).normal();return s},getBasicPoint:function(){var t=1/this.scale;var e=i(this.getDrawRect()).size();var n={width:e.width*t/2,height:e.height*t/2};var s=this.getDrawCenter();return{x:s.x-n.width,y:s.y-n.height,rate:t}}};iws.ImageControl=s})();(function(t){"use strict";var e=t;var i="1.0";var n;if(typeof exports!=="undefined"){n=exports}else{n=e.iwsT={}}n.getVersion=function(){return i};n.debug=false;n._transform=function(t,e,i,n,s){var o=0,r=0,a=1;var l=i/t;var h=n/e;if(s===90||s===270||s===-90||s===-270){l=n/t,h=i/e}a=Math.min(l,h);o=(i-t)/2;r=(n-e)/2;return{x:o,y:r,ratio:a}};n.defaults={debug:false,direction:"V",path:"./",beforehandLoad:true,plugin:false};n._makeSrc=function(t,e,i,n){if(t.length===0)return"";var s=document.createElement("canvas");var o=s.getContext("2d").createImageData(e,i);o.data.set(t);s.width=e;s.height=i;s.getContext("2d").putImageData(o,0,0);return s.toDataURL("image/jpeg",n)};n._MakeThumbFrame=function(t,e){var i=document.createElement("div");var n=iws.util.Unique.getFrameId();$(i).attr("id",n).addClass("thumb_frame");if(e==="V"){$(i).css("left","0"),$(i).css("right","0")}else if(e==="H"){$(i).css("top","0"),$(i).css("bottom","0"),$(i).css("white-space","nowrap")}t.append(i);return{div:i,id:n,class:"thumb_frame"}};n.Thumbnail=function(t,e){var i=$.extend({},n.defaults,e);"use strict";var s=$(t);iws.util.ListenDropFile(s[0],function(t){E();I(t.result)});var o=function(){return{auto:function(t,e){if(t<e){o().next(e)}if(t>e){o().prev(e)}},prev:function(t){if(i.direction==="V"){var e=$(x.div).children('[uniqueId="'+f.item[t].uniqueId+'"]');var n=e[0].offsetTop;var o=s.scrollTop()-n;if(o>0){s.scrollTop(n-4)}}},next:function(t){if(i.direction==="V"){var e=$(x.div).children('[uniqueId="'+f.item[t].uniqueId+'"]');var n=e[0].offsetTop;var o=e.outerHeight();var r=s.innerHeight();var a=s.scrollTop()+r-(n+o);if(a<0){var l=n+o-r;s.scrollTop(l+4)}}}}};s.attr("tabindex","0").keydown(function(t){console.log("keydown : "+t.keyCode);var e=f.focusIndex;var i=e;switch(t.keyCode){case 39:case 40:if(f.focusIndex+1<f.item.length){i=f.focusIndex+1}break;case 37:case 38:if(f.focusIndex>0){i=f.focusIndex-1}break}if(e!==i){k(f.item[i].uniqueId).trigger("click")}return false});function r(){var t=[];for(var e=0;e<f.item.length;e++){if(f.item[e].imgsrc===""){t.push({cmd:"loadAndMakeThumb",buffer:f.item[e].filebuffer,id:{index:e,uniqueId:f.item[e].uniqueId}})}}t.forEach(function(t){t.__id=m.addWork(t)});return t.length}var a=null;var l=function(t){var e=t.scrollTop();var i=t.innerHeight();if(a!==null)clearTimeout(z);var n=-1;for(var s=0;s<f.item.length;s++){var o=$(x.div).children('[uniqueId="'+f.item[s].uniqueId+'"]');var r=o[0].offsetTop;var l=o.outerHeight();var h=e-(r+l);if(h<0){n=s;break}}var c=[];if(n!==-1){for(var s=n;s<f.item.length;s++){var u=f.item[s].uniqueId;var o=$(x.div).children('[uniqueId="'+u+'"]');var r=o[0].offsetTop;var l=o.outerHeight();var d=e+i-(r+4);if(d>0){if(f.item[s].imgsrc===""){c.push({cmd:"loadAndMakeThumb",buffer:f.item[s].filebuffer,id:{index:s,uniqueId:f.item[s].uniqueId}});console.log("on scroll index=("+s+", "+r+", "+e+i+", "+d+") ")}}}}m.clearData("loadAndMakeThumb");c.forEach(function(t){t.__id=m.addWork(t)})};s.on("focus blur scroll",function(t){switch(t.type){case"focus":n.debug&&console.log("on focused...");break;case"blur":n.debug&&console.log("on blured...");break;case"scroll":n.debug&&console.log("on scroll...("+$(this).scrollTop()+", "+$(this).innerHeight()+")");if(i.direction==="V"){a=setTimeout(l(s),100)}break}});var h=function(t,e){return function(i){i.preventDefault();i.stopPropagation();var n=f.focusIndex;if(t===-1||e===""){f.focusIndex=-1;q(n)}else{var s=O(e);f.focusIndex=s;q(n);q(s);F(s,n);o().auto(n,f.focusIndex)}}};s.click(h(-1,""));s.on("mousemove",function(t){t.preventDefault()});var c=function(t,e,i){this.uniqueId=iws.util.Unique.getUniqueID();this.imgWidth=t||0;this.imgHeight=e||0;this.imgsrc="";this.filebuffer=i;this.pagebuffer=null;this.angle=0;this.angleDisplay=0;this.selected=false;this.pageInfo=null;this.annotation=""};var u=function(t){this.width=80;this.height=80;this.direction=t||"V";this.focusIndex=-1;this.item=[];this.checkVisible=false};var f=new u(i.direction);var d=function(){};var p=function(){};if(typeof Worker==="undefined"){console.log(">>>> \tworker   .")}var g=iws.util.work.Spliter(iws.util.string.combinePath(i.path,"/engine/iws.w.split.js"),false);var m=null;var v=null;var b="";var w=iws.util.string.combinePath(i.path,"/engine/iws.w.loader.js");var y=iws.util.string.combinePath(i.path,"/engine/iws.w.loader.plugin.js");function _(t){if(m!==null)m.close();if(v!==null)v.close();if(t===0){b=w}else if(t===1){b=y}m=new iws.util.work.WorkCrew(b,1,2,false);if(i.beforehandLoad===true){v=new iws.util.work.WorkCrew(b,2,2,false)}m.onstarted=function(t){if(t.cmd==="loadAndMakeThumb"){iws.util.run_waitMe(k(t.id.uniqueId),"facebook")}};m.onfinish=function(){var t=r();if(t===0)p(-1,f.item.length,"loadcomplite")};m.oncanceled=function(t){if(t.cmd==="loadpage"){A=false;var e=t.id;setTimeout(L(),0)}};function e(t){var e=k(f.item[t].uniqueId);var i=e.children("div.thumb_border_wrap").children("div.thumb_border");var s=n._transform(f.item[t].imgWidth,f.item[t].imgHeight,i.width(),i.height(),f.item[t].angle);var o=i.children("div.thumb_img_wrap").children("img");o.attr("src",f.item[t].imgsrc);o.css("transform","translate("+s.x+"px, "+s.y+"px) scale("+s.ratio+") rotate("+f.item[t].angleDisplay+"deg)");iws.util.hide_waitMe(e);p(t,f.item.length,f.item[t]);if(t===0){e.trigger("click")}}m.oncomplete=function(t,i){var s=i.data,o=s.id,r=O(o.uniqueId);if(s.cmd==="loadAndMakeThumb"){f.item[r].imgWidth=s.xsize,f.item[r].imgHeight=s.ysize;f.item[r].imgsrc=n._makeSrc(s.bytearray,s.xsize,s.ysize,20);f.item[r].pagebuffer=s.pagearray;f.item[r].pageInfo=s.pageInfo;e(r)}else if(s.cmd==="loadpage"){A=false;f.item[r].pagebuffer=s.pagearray;f.item[r].pageInfo=s.pageInfo;if(R.length>0){setTimeout(L(),0)}}}}_(i.plugin===true?1:0);var x=n._MakeThumbFrame(s,f.direction);var C=$(x.div);var k=function(t){return C.children('[uniqueId="'+t+'"]').children("div.thumb_layout")};var S={w:C.width(),h:C.height()};function T(){n.debug&&console.log("ChangeSize ... ("+S.w+", "+S.h+")");for(var t=0;t<f.item.length;t++)q(t)}function M(){var t=C.width();var e=C.height();if(i.direction==="V"&&t!=S.w){T();S.w=C.width()}if(i.direction==="H"&&e!=S.h){T();S.h=C.height()}}var P=setInterval(M,1e3);function O(t){for(var e=0;e<f.item.length;e++){if(f.item[e].uniqueId===t){return e}}return-1}function E(){g.init();if(m!==null)m.init();if(v!==null)v.init();$(x.div).empty();f.focusIndex=-1;for(var t=f.item.length-1;t>=0;t--){f.item.splice(t,1)}}var A=false;var j=null;var R=[];var L=function(){var t=R[R.length-1];if(t.thumbinfo.pagebuffer!==null){d(t.index,f.item[t.index],t.oldIndex);if(i.beforehandLoad===true){z=setTimeout(B(t.index,t.oldIndex),10)}else{f.item[t.index].pagebuffer=null}R.splice(0,R.length)}else{if(A===false){A=true;var e=[];e.push({cmd:"loadpage",buffer:f.item[t.index].filebuffer,id:{index:t.index,uniqueId:f.item[t.index].uniqueId}});e.forEach(function(t){t.__id=m.unshiftWork(t)})}}};var F=function(t,e){if(j!==null){clearTimeout(j)}R.push({index:t,oldIndex:e,thumbinfo:f.item[t]});j=setTimeout(L(),0)};function I(t){g.callBackonmessage(function(t){var e=t.data;var i=e.bufferarray;var n=f.item.length;var s=[];for(var o=0;o<i.length;o++){var a=n+o;D(a,i[o].buffer)}r()});g.callBackonerror(function(t){console.log("An splite error occurred.")});g.postMessage({cmd:"split",buffer:t})}function D(t,e){f.item[t]=new c(0,0,e);var i=X(t,f.item[t].uniqueId)}function q(t){if(t<0||t>=f.item.length)return;var e=f.item[t];var i=k(e.uniqueId);if(f.focusIndex==t){i.css("box-shadow","0 0 0 2px white")}else{i.css("box-shadow","")}var s=i.children("div.thumb_border_wrap").children("div.thumb_border");if(e.selected===true){s.css("box-shadow","0 0 0 2px #666666")}else{s.css("box-shadow","")}var o=n._transform(e.imgWidth,e.imgHeight,s.width(),s.height(),e.angle);var r=s.children("div.thumb_img_wrap").children("img");r.css("transform","translate("+o.x+"px, "+o.y+"px) scale("+o.ratio+") rotate("+e.angleDisplay+"deg)")}function W(t,e){var i=$("<div/>",{class:"thumb_border_wrap",id:"thumb_border_wrap_"+t});var s=$("<input/>",{type:"checkbox",class:"thumb_check",id:"thumb_check"+t});s.css("visibility",f.checkVisible===true?"visible":"hidden");s.click(function(t,e){return function(t){var i=O(e);if($(this).is(":checked")==true){f.item[i].selected=true}else{f.item[i].selected=false}q(i);t.stopPropagation()}}(t,e));i.append(s);var o=$("<img/>",{class:"thumb_img",id:"thumb_img_"+t});o.attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAoRJREFUaIHtmb+LE0EUx79vNH9BmqQ67g/QK61O7c+TaLGlEBFskgkxhWWyXHVFiDvZziJic7KgKLlGBEl5ndr5DwgLknASC9Fknk0iOU3uZjP54ZL9QCDsvnnvfZd5810SICFhs6EowcxMvu/vM/MOM1+yKTwYDJ5WKpUvNjmACAKYmZRSr4goZ1t0xAchxPVCofDdJomxgGazeZuZ3zBzpdfrKdd1B/MU9DyvRkRVrfUvInqbzWZzjuMM58kFAMI0kJl3AMCm+TOFhXhARLfCMGxY5TENHO/5RTQPAFLK58x8AKDoeV5x3jzGApaBlLKqtT5i5oZSam+eHJdtGvA8r2YSJ4ToFIvFzt/XiYhbrdb9fr+/pbV+0Wg0dsvl8scoPVgJIKKqSZzWGgA60+7l8/kfnuflhBAnAI7r9fq1KMerlQApZSQfmUWpVPqqlNrTWp+kUqm27/vGx+vKZ4CIGACq1eqZhyel/CyEuAvgynA4PAqCwMgo1zHEnwAgnU4/miLiPTM/jHK8Wm0hpRSbxDGzWyqVagCQyWTaYRi2ARym0+lDpdSsZUUA8qLcVgKY2TWJE0J0xt8dxxkGQXAnDMN9Zr6KKbuAiG4CuGGS20rA+KlGZfTq8Hr0+YfR64aRgLUa2SJYiZGZMMvsLmIlRmbCeWZ3Hv+FkdkQ+xmIvYCVGJkJk2YXhZUYmQmTZheFtRjZItnsGUiMbILEyOJK7AUkRmazfpLEyOJKYmQ26ydJjCyubI4AIvoGAL7vby2vnT9sAzg1CTSeAa31SyHEgdb6nVIqYOaF/NU0hW0iugfgiUlwpCFUSu0CUACm/qa5IE4BPOt2u49d1/25pBoJCWN+AzouHvLW3VsUAAAAAElFTkSuQmCC");o.css("opacity","0.0");var r=$("<div/>",{class:"thumb_img_wrap"});r.append(o);var a=$("<div/>",{class:"thumb_border"});a.append(r);i.append(a);o.load(function(t){return function(e){var i=O(t);if(i>=0){f.item[i].imgWidth=this.width;f.item[i].imgHeight=this.height;var s=k(t).children("div.thumb_border_wrap").children("div.thumb_border");var o=n._transform(this.width,this.height,s.width(),s.height(),f.item[i].angle);var r=s.children("div.thumb_img_wrap").children("img");r.css("transform","translate("+o.x+"px, "+o.y+"px) scale("+o.ratio+") rotate("+f.item[i].angleDisplay+"deg)");r.css("opacity","1.0")}}}(e));var l=$('<div class="thumb_number" id="thumb_number_'+t.toString()+'">'+(t+1)+"</div>");i.append(l);return i}var z=null;var B=function(t,e){if(t===e)return;var n=(new Date).getTime();v.onstarted=function(t){if(i.debug===true){iws.util.run_waitMe(k(t.id.uniqueId),"pulse")}};v.onfinish=function(){var t=(new Date).getTime();console.log("preload.onfinish time is "+(t-n)/1e3)};v.oncomplete=function(t,e){var n=e.data,s=n.id;f.item[s.index].pagebuffer=n.pagearray;f.item[s.index].pageInfo=n.pageInfo;if(i.debug===true){iws.util.hide_waitMe(k(f.item[s.index].uniqueId))}console.log(s.index+".work preload.onfinish complete."+s.index+", maketime = "+n.maketime)};v.oncanceled=function(t){var e=t.id;if(i.debug===true){iws.util.hide_waitMe(k(f.item[e.index].uniqueId))}};if(z!==null)clearTimeout(z);v.initAsync();var s=[];var o=true;if(t<e)o=false;var r=Math.max(t-(o===true?1:3),0);var a=Math.min(t+(o===true?3:1),f.item.length-1);if(o===true){for(var l=t+1;l<=a;l++){
if(f.item[l].pagebuffer===null)s.push({cmd:"loadpage",buffer:f.item[l].filebuffer,id:{index:l,uniqueId:f.item[l].uniqueId}})}for(var l=t-1;l>=r;l--){if(f.item[l].pagebuffer===null)s.push({cmd:"loadpage",buffer:f.item[l].filebuffer,id:{index:l,uniqueId:f.item[l].uniqueId}})}}else{for(var l=t-1;l>=r;l--){if(f.item[l].pagebuffer===null)s.push({cmd:"loadpage",buffer:f.item[l].filebuffer,id:{index:l,uniqueId:f.item[l].uniqueId}})}for(var l=t+1;l<=a;l++){if(f.item[l].pagebuffer===null)s.push({cmd:"loadpage",buffer:f.item[l].filebuffer,id:{index:l,uniqueId:f.item[l].uniqueId}})}}for(var l=0;l<f.item.length;l++){if(l<r||l>a){if(f.item[l].pagebuffer!==null){f.item[l].pagebuffer=null;console.log("pagebuffer = null index="+l)}}}s.forEach(function(t){t.__id=v.addWork(t)})};function X(t,e){var i=$("<div/>",{class:"thumb_layout_wrap",id:"thumb_layout_wrap_"+t.toString()});i.attr("uniqueId",e);i.attr("index",t.toString());var n=$("<div>",{class:"thumb_layout",id:"thumb_layout_"+t});n.click(h(t,e));i.append(n);C.append(i);if(f.direction==="V"){i.css("height",f.height+"px")}else if(f.direction==="H"){i.css("width",f.width+"px"),i.css("height","100%"),i.css("display","inline-block")}var s=W(t,e);n.append(s);return i}var Y=function(t){return(f.checkVisible===true?false:f.focusIndex===t)||f.item[t].selected===true};function H(t){for(var e=0;e<f.item.length;e++){if(Y(e)){f.item[e].angleDisplay=f.item[e].angleDisplay+t;f.item[e].angle=(f.item[e].angle+t)%360;if(f.item[e].angle<0)f.item[e].angle=360+f.item[e].angle;q(e)}}}function U(){for(var t=f.item.length-1;t>=0;t--){if(Y(t)){C.children("div.thumb_layout_wrap").remove('[uniqueId="'+f.item[t].uniqueId+'"]');f.item.splice(t,1)}}for(var t=0;t<f.item.length;t++){var e=k(f.item[t].uniqueId).children("div.thumb_border_wrap").children("div.thumb_number");e.text((t+1).toString())}}return{init:function(){E()},load:function(t){E();I(t)},append:function(t){I(t)},setCallbackClick:function(t){d=t},setCallbackLoad:function(t){p=t},setWidth:function(t){f.width=t},setHeight:function(t){f.height=t},rotate:function(t){H(t)},remove:function(){U();if(f.focusIndex>=0){if(f.focusIndex>=f.item.length){f.focusIndex=f.item.length-1}if(f.focusIndex>=0){k(f.item[f.focusIndex].uniqueId).trigger("click")}else{d(-1,"removeAll",-1)}}},setSelect:function(t,e){f.item[t].selected=e;var i=k(f.item[t].uniqueId).children("div.thumb_border_wrap").children(".thumb_check");i.prop("checked",e);q(t)},getSelect:function(t){return f.item[t].selected},get pageIndex(){return f.focusIndex},set pageIndex(t){if(t>=0&&t<f.item.length){k(f.item[t].uniqueId).trigger("click")}},pageCount:function(){return f.item.length},get selectVisible(){return f.checkVisible},set selectVisible(t){f.checkVisible=t;for(var e=0;e<f.item.length;e++){var i=k(f.item[e].uniqueId).children("div.thumb_border_wrap").children(".thumb_check");if(f.checkVisible===true){i.css("visibility","visible")}else{i.css("visibility","hidden")}}},getItem:function(t){return f.item[t]},setLoadType:function(t){_(t)},print:function(){var t=[];for(var e=0;e<f.item.length;e++){if(Y(e))t.push({cmd:"loadpage",buffer:f.item[e].filebuffer,id:{index:e,uniqueId:f.item[e].uniqueId,angle:f.item[e].angle}})}if(t.length>0){iws.util.print.image(b,t)}},getSrc:function(t,e){var i=[];for(var n=0;n<f.item.length;n++){if(Y(n))i.push({cmd:"loadpage",buffer:f.item[n].filebuffer,id:{index:n,uniqueId:f.item[n].uniqueId,angle:f.item[n].angle}})}var s=new iws.util.work.WorkCrew(b,1,1,false);s.oncomplete=function(e,i){var n=i.data,s=n.id;var o=iwsUtils.makePrintSrc(n.pagearray,n.pageInfo.width,n.pageInfo.height,20,s.angle);t(s.index,o)};s.onfinish=function(){s.close();e()};i.forEach(function(t){t.__id=s.addWork(t)})},pageSave:function(t,e){var i=[];var n=f.focusIndex;i.push({cmd:"savepage",buffer:f.item[n].filebuffer,id:{index:n,uniqueId:f.item[n].uniqueId,angle:f.item[n].angle},format:t});var s=new iws.util.work.WorkCrew(w,1,1,false);s.oncomplete=function(t,i){var n=i.data,s=n.id;e(n.success,n.filearray)};s.onfinish=function(){s.close()};i.forEach(function(t){t.__id=s.addWork(t)})},pageSaveTiff:function(t){var e=3;var i=[];var n=[];for(var s=0;s<f.item.length;s++){if(Y(s))n.push({cmd:"savepage",buffer:f.item[s].filebuffer,id:{index:s,uniqueId:f.item[s].uniqueId,angle:f.item[s].angle},format:e})}var o=new iws.util.work.WorkCrew(w,1,1,false);o.oncomplete=function(t,e){var n=e.data,s=n.id;i.push({id:n.id,filearray:n.filearray})};o.onfinish=function(){o.close();g.init();g.callBackonmessage(function(e){var i=e.data;t(i.success,i.bufferarray)});g.callBackonerror(function(e){console.log("An merge error occurred.");t(false,"exception")});g.postMessage({cmd:"merge",buffer:i})};n.forEach(function(t){t.__id=o.addWork(t)})},annotationSave:function(t){var e=true;var i=new Array;f.item.forEach(function(t){i.push(t.annotation);if(t.annotation!==""){e=false}});var n="";if(!e){n=JSON.stringify(i)}t(n)},annotationLoad:function(t){var e=JSON.parse(t);for(var i=0;i<e.length;i++){if(f.item[i])f.item[i].annotation=e[i]}},findIndex:function(t){return O(t)}}}})(window);(function(){"use strict";function t(){this.initialize.apply(this,arguments)}iws.Page=iws.util.createInheritClass(t,iws.Observable,{log:function(t){},containerClass:"page-container",lowerCanvasEl:null,viewportTransform:[1,0,0,1,0,0],backgroundVpt:true,overlayVpt:true,backgroundColor:"",imageCtrl:null,stopRendering:true,dirty:false,autoResize:true,reSampleUse:true,reSampleRate:.8,reSampleFilter:"convolveFloat32",path:"",initialize:function(t,e){e||(e={});this.imageCtrl=new iws.ImageControl(this);this.trackMouse=new iws.TrackMouse;this._initWrapperElement(t);this._initOptions(e);this._initEventListeners();this._initResample();if(!window.requestAnimationFrame){window.requestAnimationFrame=function(t){var e=(new Date).getTime();var i=Math.max(0,16-(e-s));var n=window.setTimeout(function(){t(e+i)},i);var s=e+i;return n}}this.mainToolbar=new iws.toolbar.page(this);this.setTrackMode("move");if(typeof this.visibleToolbar!=="undefined"){this.fire("toolbar:visible",this.visibleToolbar)}if(typeof this.fitMode!=="undefined"){this.setFitMode(this.fitMode)}if(this.autoResize){this.resizer=new iws.util.resize(this.fullScreenEl,this._reSize.bind(this))}this._reSize();if(typeof window.Hammer!=="undefined"){this.touchInfo=new function(){return{isStarted:false,scale:0,pinchScale:0,timerId:0,center:{x:0,y:0}}};var i=new Hammer(this.lowerCanvasEl,{domEvents:true});i.on("swipeleft",function(){var t=this.imageCtrl.getDrawRect();var e=t.right-t.left;var i=t.bottom-t.top;if(this.getTrackMode()==="move"&&(e<this.width||i<this.height)){this.fire("page:swipe_left")}}.bind(this));i.on("swiperight",function(){var t=this.imageCtrl.getDrawRect();var e=t.right-t.left;var i=t.bottom-t.top;if(this.getTrackMode()==="move"&&(e<this.width||i<this.height)){this.fire("page:swipe_right")}}.bind(this));i.get("pinch").set({enable:true});i.on("pan",function(t){}.bind(this));i.on("panend",function(t){});i.on("pinch",function(t){if(this.getTrackMode()==="move"){this.touchInfo.pinchScale=t.scale;var e=$(this.lowerCanvasEl).offset();this.touchInfo.center={x:t.center.x-e.left,y:t.center.y-e.top};console.log("image scale:"+this.touchInfo.scale+", pinch scale:"+t.scale+", ("+t.center.x+", "+t.center.y+")");clearTimeout(this.touchInfo.timerId);this.touchInfo.timerId=setTimeout(function(){var t=this.touchInfo.scale*this.touchInfo.pinchScale;console.log(">>>>   timeout >>>>    image scale:"+this.touchInfo.scale+", changeScale:"+t);this._zoom({name:"custom",scale:t},this.touchInfo.center)}.bind(this),1)}}.bind(this));i.on("pinchend",function(t){console.log("pinchend")});i.on("doubletap",function(t){console.log("doubletap");if(this.getTrackMode()==="move"){var e=this.getFitMode();if(e.name!=="auto"){this.setFitMode({name:"auto"})}else{var i=$(this.lowerCanvasEl).offset();var n={x:t.center.x-i.left,y:t.center.y-i.top};this._zoom({name:"custom",scale:1},n)}}}.bind(this))}},_initWrapperElement:function(t){this.wrapperEl=t;iws.util.makeElementUnselectable(this.wrapperEl);this.fullScreenEl=iws.util.makeElement("div",{class:"page-fullScreen"});this.fullScreenEl.style.position="relative";this.fullScreenEl.style.width="100%";this.fullScreenEl.style.height="100%";this.wrapperEl.appendChild(this.fullScreenEl);this.pageContainer=iws.util.makeElement("div",{class:"page-container"});this.pageContainer.style.position="relative";this.pageContainer.style.backgroundColor="#666666";this.fullScreenEl.appendChild(this.pageContainer);this._createLowerCanvas(this.pageContainer);this.tooltipBox=iws.util.makeElement("div",{class:"iws-viewer-tooltip"});iws.util.makeElementUnselectable(this.tooltipBox);this.pageContainer.appendChild(this.tooltipBox)},_createLowerCanvas:function(t){this.lowerCanvasEl=iws.util.makeElement("canvas",{class:"lower-canvas"});this.contextContainer=this.lowerCanvasEl.getContext("2d");this.contextContainer.imageSmoothingEnabled=true;t.appendChild(this.lowerCanvasEl)},_reSize:function(){var t=this.fullScreenEl.clientWidth;var e=this.fullScreenEl.clientHeight;var i=t;var n=e;if(this.mainToolbar.isVisible()){n=e-this.mainToolbar.height()}this.pageContainer.style.width=i+"px";this.pageContainer.style.height=n+"px";this.lowerCanvasEl.width=i;this.lowerCanvasEl.height=n;this.lowerCanvasEl.style.width=i+"px";this.lowerCanvasEl.style.height=n+"px";this.width=parseInt(t,10)||0;this.height=parseInt(e,10)||0;this.imageCtrl.fitRefresh();this.renderAll()},_initOptions:function(t){for(var e in t){this[e]=t[e]}this.viewportTransform=this.viewportTransform.slice()},_initEventListeners:function(){$(this.lowerCanvasEl).on("mousedown touchstart",this.onMouseDown.bind(this));$(this.lowerCanvasEl).on("mousemove touchmove",this.onMouseMove.bind(this));$(this.lowerCanvasEl).on("mousewheel DOMMouseScroll",this.onMouseWheel.bind(this));$(this.lowerCanvasEl).on("dblclick",this.onMouseDblclick.bind(this));this.observe("page:zoom",function(){this.tooltip()});this.observe("page:fitMode",function(){this.tooltip()})},_initResample:function(){if(this.reSampleUse){var t=function(){this.initialize.apply(this,arguments)};t.prototype={reSampler:null,reSampler_Queue:[],reSampler_Running:false,lastInfo:{scale:0,width:0,height:0},currentInfo:{scale:0,width:0,height:0},initialize:function(t,e,i){for(var n in t){this[n]=t[n]}this.callback_Resampled=e;this.callback_Canceled=i},setRawData:function(t){this.init();this.reSampler=new Worker(iws.util.string.combinePath(this.path,"/engine/iws.w.resample.js"));if(this.reSampler){this.reSampler.onmessage=this._worker_onmessage.bind(this);this.reSampler.onerror=this._worker_onerror;this.reSampler.postMessage({cmd:"page-set",imageData:t})}},requestResample:function(t,e){this.currentInfo={scale:t,width:e.width,height:e.height};this.timer_Resample&&clearTimeout(this.timer_Resample);if(this._needToResample(t)&&this.reSampler){this.timer_Resample=setTimeout(function(){this.reSampler_Queue.push({scale:t,width:e.width,height:e.height});if(!this.reSampler_Running){this._workLastRequest()}}.bind(this),100)}else{this.callback_Canceled&&this.callback_Canceled()}},init:function(){if(this.reSampler!==null){this.reSampler.terminate();this.reSampler=null}this.reSampler_Running=false;this.lastInfo={scale:0,width:0,height:0};this.currentInfo={scale:0,width:0,height:0};for(var t=this.reSampler_Queue.length-1;t>=0;t--){this.reSampler_Queue.splice(t,1)}},_workLastRequest:function(){var t=this.reSampler_Queue.pop();if(t.scale!==this.lastInfo.scale){this.lastInfo=t;this.reSampler&&this.reSampler.postMessage({cmd:"resampling",w:t.width,h:t.height,filter:this.reSampleFilter});this.reSampler_Running=true}for(var e=this.reSampler_Queue.length-1;e>=0;e--){this.reSampler_Queue.splice(e,1)}},_needToResample:function(t){return t<=this.reSampleRate},_worker_onerror:function(t){console.log(t);console.log("reSampler.onerror : "+t.message+" ("+t.filename+":"+t.lineno+")")},_worker_onmessage:function(t){switch(t.data.cmd){case"page-set":break;case"resampling":if(this._needToResample(this.currentInfo.scale)){this.callback_Resampled(t.data.w,t.data.h,t.data.bytearray)}this.reSampler_Running=false;if(this.reSampler_Queue.length){this._workLastRequest()}break}}};var e=function(t,e,i){this.imageCtrl.setRawDataReSample(t,e,i);this.renderAll()};var i=function(){this.imageCtrl.clearResample();this.renderAll()};this.reSample=new t({path:this.path,reSampleRate:this.reSampleRate,reSampleFilter:this.reSampleFilter},e.bind(this),i.bind(this));this.observe("page:setRawData",function(){this.reSample.setRawData(this.imageCtrl.getImageData())});this.observe("canvas:cleared",function(){this.reSample.init()});this.observe("page:zoom",function(){this.imageCtrl.isValid()&&this.reSample.requestResample(this.imageCtrl.scale,this.imageCtrl.getScaleSize())});this.observe("page:fitMode",function(){this.imageCtrl.isValid()&&this.reSample.requestResample(this.imageCtrl.scale,this.imageCtrl.getScaleSize())})}},setCursor:function(t){this.lowerCanvasEl.style.cursor=t},onMouseDown:function(t){if(this.touchInfo){this.touchInfo.isStarted=true;this.touchInfo.scale=this.imageCtrl.scale}$(this.lowerCanvasEl).off("mousemove touchmove");$(document).on("mousemove touchmove",this.onMouseMove.bind(this));$(document).on("mouseup touchend",this.onMouseUp.bind(this));this._onMouseDown(t.originalEvent||t)},onMouseMove:function(t){this._onMouseMove(t.originalEvent||t)},onMouseUp:function(t){$(document).off("mouseup touchend");$(document).off("mousemove touchmove");$(this.lowerCanvasEl).on("mousemove touchmove",this.onMouseMove.bind(this));this._onMouseUp(t.originalEvent||t)},_onMouseDown:function(t){this.log("_onMouseDown");var e=iws.util.getPointers(t);if(e.length===1){var i=this.getPointer(t);this.trackMouse.mouseMovePos=this.trackMouse.mouseDownPos=i;this.trackMouse.leftMouseButtonDown=true;this.renderAll()}else{console.log("_onMouseDown : ("+e[0].x+", "+e[0].y+"), ("+e[1].x+", "+e[1].y+")")}},_onMouseMove:function(t){var e=iws.util.getPointers(t);if(e.length===1){this.log("_onMouseMove");var i=e[0];var n=this.getPointer(t);var s=this.trackMouse.mousePrevMoveOffset.x=n.x-this.trackMouse.mouseMovePos.x,o=this.trackMouse.mousePrevMoveOffset.y=n.y-this.trackMouse.mouseMovePos.y;if(this.trackMouse.isMove()){this.imageCtrl.move({X:s,Y:o})}if(this.imageCtrl.isInDrawImage(this.contextContainer,n)){if(this.trackMouse.mouseType=="move")this.setCursor("move");else if(this.trackMouse.mouseType=="range")this.setCursor("crosshair");else if(this.trackMouse.mouseType=="glass"){if(this.trackMouse.leftMouseButtonDown){this.setCursor("none")}else this.setCursor("pointer")}}else{this.setCursor("default")}this.trackMouse.mouseMovePos=n;this.renderAll()}},_onMouseUp:function(t){this.log("_onMouseUp");if(this.trackMouse.isRange()&&this.imageCtrl.isValid()){var e=this.trackMouse.getIntersectRect(this.imageCtrl.getDrawRect());var i=this.imageCtrl.getImageRect(e);var n=iws.util.Rect(i);if(n.width()>4&&n.height()>4){this.fire("mouse:drawRanged",n.round())}}this.trackMouse.leftMouseButtonDown=false;this.renderAll()},onMouseWheel:function(t){t.preventDefault();t.stopPropagation();var e=$(this.lowerCanvasEl).offset(),i=(t.pageX||t.originalEvent.pageX)-e.left,n=(t.pageY||t.originalEvent.pageY)-e.top;var s=this.getPointer(t.originalEvent||t);if(t.originalEvent.detail<0||t.originalEvent.wheelDelta>0){this._zoom("out",s)}else{this._zoom("in",s)}},onMouseDblclick:function(t){t.preventDefault();t.stopPropagation();if(this.getTrackMode()==="move"){this.setFitMode({name:"auto"})}},tooltip:function(){if(!this.imageCtrl.isValid())return;const t=this;const e=true;const i=t.tooltipBox;const n=t.imageCtrl.scale;function s(t){return typeof t==="undefined"}function o(t,e){if(!s(t.textContent)){t.textContent=e}else{t.innerText=e}}o(i,Math.round(n*100)+"%");clearTimeout(t.tooltiping);if(!t.tooltiping){if(e){if(t.fading){iws.event.dispatchEvent(i,"transitionend")}i.addClass("iws-viewer-show");i.addClass("iws-viewer-fade");i.addClass("iws-viewer-transition");i.addClass("iws-viewer-in")}else{i.addClass("iws-viewer-show")}}else{clearTimeout(t.tooltiping)}t.tooltiping=setTimeout(function(){if(e){iws.event.addListener(i,"transitionend",function(){i.removeClass("iws-viewer-show");i.removeClass("iws-viewer-fade");i.removeClass("iws-viewer-transition");t.fading=false},true);i.removeClass("iws-viewer-in");t.fading=true}else{i.removeClass("iws-viewer-show")}t.tooltiping=false},1e3)},clearContext:function(t){t.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this.clearContext(this.contextContainer);this.imageCtrl.clear();this.fire("canvas:cleared");this.renderAll();this.stopRendering=true;return this},setRawData:function(t,e,i,n){this.imageCtrl.setRawData(e,i,new Uint8Array(t),n);this.renderAll()},setFitMode:function(t){this.imageCtrl.fitMode=t;this.renderAll()},getFitMode:function(){return this.imageCtrl.fitMode},_zoom:function(t,e){this.imageCtrl.zoom(t,e);this.renderAll()},zoomIn:function(){this._zoom("in")},zoomOut:function(){this._zoom("out")},setRotate:function(t){this.imageCtrl.rotate(t);this.renderAll()},setTrackMode:function(t){this.trackMouse.mouseType=t;this.fire("mouseTrackChange",t)},getTrackMode:function(){return this.trackMouse.mouseType},renderAll:function(){if(iws.debug){this._renderCanvas(this.contextContainer)}else{this.dirty=true;if(this.stopRendering){this.stopRendering=false;var t=this;var e=function(){if(t.dirty){t.dirty=false;var i=t.contextContainer;t._renderCanvas(i)}if(!t.stopRendering)window.requestAnimationFrame(e)};e()}}return this},_renderCanvas:function(t){this._renderBefore(t);this.imageCtrl.render(t);this._renderTracking(t);this._renderAfter(t)},_renderBefore:function(t){this.clearContext(t);this.fire("before:render");this._renderBackgroundOrOverlay(t,"background")},_renderTracking:function(t){if(this.trackMouse.isGlass()){this.trackMouse.drawMagnifyGlass(this.lowerCanvasEl)}if(this.trackMouse.isRange()&&this.imageCtrl.isValid()){this.trackMouse.drawRange(this.lowerCanvasEl,this.imageCtrl.getDrawRect())}},_renderAfter:function(t){this._renderBackgroundOrOverlay(t,"overlay");this.fire("after:render")},_renderBackgroundOrOverlay:function(t,e){var i=this[e+"Color"];if(i){t.fillStyle=i.toLive?i.toLive(t):i;t.fillRect(i.offsetX||0,i.offsetY||0,this.width,this.height)}i=this[e+"Image"];if(i){if(this[e+"Vpt"]){t.save();t.transform.apply(t,this.viewportTransform)}i.render(t);this[e+"Vpt"]&&t.restore()}},setBackgroundColor:function(t){return this.__setBgOverlayColor("backgroundColor",t,this.renderAll.bind(this))},__setBgOverlayColor:function(t,e,i){if(e&&e.source){var n=this;iws.util.loadImage(e.source,function(s){n[t]=new iws.Pattern({source:s,repeat:e.repeat,offsetX:e.offsetX,offsetY:e.offsetY});i&&i()})}else{this[t]=e;i&&i()}return this},restorePointerVpt:function(t){return iws.util.transformPoint(t,iws.util.invertTransform(this.viewportTransform))},getPointer:function(t,e){var i=iws.util.getPointer(t),n=this.lowerCanvasEl.getBoundingClientRect(),s=n.width||0,o=n.height||0,r;if(!s||!o){if("top"in n&&"bottom"in n){o=Math.abs(n.top-n.bottom)}if("right"in n&&"left"in n){s=Math.abs(n.right-n.left)}}this._offset=iws.util.getElementOffset(this.lowerCanvasEl);i.x=i.x-this._offset.left;i.y=i.y-this._offset.top;if(!e){i=this.restorePointerVpt(i)}if(s===0||o===0){r={width:1,height:1}}else{r={width:this.lowerCanvasEl.width/s,height:this.lowerCanvasEl.height/o}}return{x:i.x*r.width,y:i.y*r.height}}})})();(function(){(function(){"use strict";function t(){this.initialize.apply(this,arguments)}iws.PageAnnotation=iws.util.createInheritClass(t,iws.Page,iws.Collection,{hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",useAnnotation:false,initialize:function(t,e){this.callSuper("initialize",t,e);this.annotToolbar=new iws.toolbar.annotation(this);this._initEvent();this.fire("annotation:use",this.useAnnotation);this.showAnnotation(this.useAnnotation?"show":"hide")},_reSize:function(){var t=window.matchMedia("(max-width: 800px)");if(t&&t.matches){this.showAnnotation("hide")}else{this.showAnnotation(this.useAnnotation?"show":"hide")}this.callSuper("_reSize")},keydownControl:false,_initEvent:function(){this.observe("page:zoom",this._eventPageZoom);this.observe("page:fitMode",this._eventPageZoom);this.observe("page:rotate",this._eventPageRotate);this.observe("page:move",this._eventPageMove);document.addEventListener("keydown",function(t){const e=t.key;if(e==="Control"){this.keydownControl=true;return}if(e==="Shift"){return}if(this.isSelectMode()){if(t.which===46){var i=[];this._objects.forEach(function(t){if(t.active){i.push(t)}});this.discardActiveObject();this.remove.apply(this,i)}else if(t.which===65&&t.shiftKey){this._objects.forEach(function(t){t.set("active",true)});this.renderAll()}}}.bind(this),false);document.addEventListener("keyup",function(t){const e=t.key;if(e==="Control"){this.keydownControl=false;return}}.bind(this),false)},_eventPageZoom:function(t){$.each(this.getObjects(),function(e,i){t.output&&this._objectSizeChangeScale(t.output.changeRate,t.output.offset,t.output.center,i)}.bind(this))},_eventPageRotate:function(t){var e=t.input.angle;var i=this.imageCtrl.getDrawCenter();$.each(this.getObjects(),function(t,n){var s=iws.util.Rotate(e).point(i.x,i.y,n.left,n.top);n.set({angle:(n.angle+e)%360,left:s.x,top:s.y});n.setCoords()})},_eventPageMove:function(t){var e=t.output.offset;$.each(this.getObjects(),function(t,i){i.set({left:i.get("left")+e.x,top:i.get("top")+e.y});i.setCoords()})},_objectSizeChangeScale:function(t,e,i,n){var s=function(t,e,i,n){var s={width:e.x-t.x,height:e.y-t.y};return{x:i.x-s.width*n,y:i.y-s.height*n}};var o={x:n.get("left")+n.get("width")/2,y:n.get("top")+n.get("height")/2};var r={x:i.x-e.x,y:i.y-e.y};var a=s(o,r,i,t);switch(n.type){case"path":for(var l=0;l<n.path.length;l++){var h=n.path[l];if(h.length>=3){var c=s({x:h[1],y:h[2]},r,i,t);h[1]=c.x;h[2]=c.y;if(h.length==5){c=s({x:h[3],y:h[4]},r,i,t);h[3]=c.x;h[4]=c.y}}}n.pathOffset=s({x:n.pathOffset.x,y:n.pathOffset.y},r,i,t);n.set({left:a.x-t*(n.get("width")/2),top:a.y-t*(n.get("height")/2),width:t*n.get("width"),height:t*n.get("height")});break;case"line":var u=s({x:n.x1,y:n.y1},r,i,t);var f=s({x:n.x2,y:n.y2},r,i,t);n.set({left:a.x-t*(n.width/2),top:a.y-t*(n.height/2),x1:u.x,y1:u.y,x2:f.x,y2:f.y,width:t*n.get("width"),height:t*n.get("height")});break;case"rect":n.set({left:a.x-t*(n.width/2),top:a.y-t*(n.height/2),width:t*n.get("width"),height:t*n.get("height")});break;case"text":n.set({left:a.x-t*(n.get("width")/2),top:a.y-t*(n.get("height")/2)});break}n.setCoords()},clear:function(t){this._objects.length=0;if(t==="onlyAnn")return;this.callSuper("clear")},showAnnotation:function(t){this.fire("annotation:popup-visible",t)},toJSON:function(t){var e={objects:this.getObjects().filter(function(t){return!t.excludeFromExport}).map(function(e){return e["toObject"](t)},this)};return e},loadFromJSON:function(t,e,i){if(!t){return}var n=typeof t==="string"?JSON.parse(t):iws.util.object.clone(t);var s=this;this._enlivenObjects(n.objects,function(){},i);return this},_enlivenObjects:function(t,e,i){var n=this;if(!t||t.length===0){e&&e();return}iws.util.enlivenObjects(t,function(t){t.forEach(function(t,e){n.insertAt(t,e)});e&&e()},null,"object",i)},_renderCanvas:function(t){this._renderBefore(t);this.imageCtrl.render(t);this._renderObjects(t);this._drawObjectsControls(t);this._renderTracking(t);this._renderAfter(t)},_renderTracking:function(t){this.callSuper("_renderTracking",t);if(this.trackMouse.leftMouseButtonDown){this.trackMouse.leftMouseButtonDown=this.trackMouse.leftMouseButtonDown}if(this.trackMouse.leftMouseButtonDown&&this.isSelectMode()&&!this._currentTransform){this.trackMouse.drawSelect(this.lowerCanvasEl,this.trackMouse.getRect())}},_renderObjects:function(t){t.save();t.transform.apply(t,this.viewportTransform);for(var e=0,i=this._objects.length;e<i;++e){this._objects[e]&&this._objects[e].render(t)}t.restore()},_drawObjectsControls:function(t){for(var e=0,i=this._objects.length;e<i;++e){if(!this._objects[e]||!this._objects[e].active){continue}this._objects[e]._renderControls(t)}},_onObjectAdded:function(t){t._set("canvas",this);t.setCoords();this.fire("object:added",{target:t});t.fire("added")},_onObjectRemoved:function(t){this.fire("object:removed",{target:t});t.fire("removed");delete t.canvas},_setActiveObject:function(t){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=t;t.set("active",true)},setActiveObject:function(t,e){this._setActiveObject(t);this.renderAll();this.fire("object:selected",{target:t,e:e});t.fire("selected",{e:e});return this},getActiveObject:function(){return this._activeObject},_shouldClearSelection:function(t,e){if(!e)return true;var i=this._selectedObjects();if(i.indexOf(e)===-1)return true;var n=this.getActiveObject();return e&&!e.selectable&&n&&n!==e},_discardActiveObject:function(){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=null},discardActiveObject:function(t){var e=this._activeObject;this.fire("before:selection:cleared",{target:e,e:t});this._discardActiveObject();this.fire("selection:cleared",{e:t});e&&e.fire("deselected",{e:t});return this},deactivateAll:function(){var t=this.getObjects(),e=0,i=t.length;for(;e<i;e++){t[e].set("active",false)}this._discardActiveObject();return this},_clearSelection:function(t,e,i){this.discardActiveObject();this.deactivateAll();if(e&&e.selectable){this.setActiveObject(e,t)}},_onMouseDown:function(t){this.callSuper("_onMouseDown",t);if(this.isAnnotationMode()){this.__onMouseDown_AnnotationControl(t)}},_onMouseMove:function(t){this.callSuper("_onMouseMove",t);if(this.isAnnotationMode()){this.__onMouseMove_AnnotationControl(t)}},_onMouseUp:function(t){if(this.isAnnotationMode()){this.__onMouseUp_AnnotationControl(t)}this.callSuper("_onMouseUp",t)},getAnnotation:function(){var t=[];var e=this.imageCtrl.getBasicPoint();this.getObjects().forEach(function(i){var n=i.clone();this._objectSizeChangeScale(e.rate,{x:0,y:0},this.imageCtrl.getDrawCenter(),n);n.left-=e.x;n.top-=e.y;if(n.type=="line"){n.x1-=e.x;n.y1-=e.y;n.x2-=e.x;n.y2-=e.y}t.push(n)}.bind(this));var i={objects:t.filter(function(t){return!t.excludeFromExport}).map(function(t){return t["toObject"](null)},this)};return i.objects.length>0?JSON.stringify(i):""},setAnnotation:function(t){this.clear("onlyAnn");if(this.loadFromJSON(t)){var e=this.imageCtrl.getBasicPoint();this.getObjects().forEach(function(t){t.left+=e.x;t.top+=e.y;this._objectSizeChangeScale(this.imageCtrl.scale,{x:0,y:0},this.imageCtrl.getDrawCenter(),t)}.bind(this))}this.renderAll()}})})();(function(){iws.util.extend(iws.PageAnnotation.prototype,{createObject:null,annotationMap:["annotSelect","annotDrawFree","annotDrawLine","annotDrawRect","annotDrawText"],isAnnotationMode:function(){var t=this.getTrackMode();var e=this.annotationMap.indexOf(t);return e>=0},isSelectMode:function(){return this.getTrackMode()===this.annotationMap[0]},_handleEvent:function(t,e,i){var n=typeof i===undefined?this.findTarget(t):i,s={e:t,target:n};n&&n.fire("mouse"+e,s)},_makeText:function(t){var e=$('<textarea placeholder="Input memo ... " class="annotText"></textarea>');var i=this.getPointer(t);var n=this.annotToolbar.getInitParam(this.getTrackMode());e.css({left:i.x,top:i.y,width:200,height:n["fontSize"]+10,"font-family":"Times New Roman","font-size":n["fontSize"]+"px",color:n["fill"],background:n["backgroundColor"],position:"absolute","line-height":1.2,border:"0 none white",padding:0,outline:"none","IME-MODE":"active"}).appendTo($(this.pageContainer));var s=this;e.on("focusout",function(t){if($(this).val()!=""){s.setTrackMode(s.annotationMap[0],true);n["left"]=i.x;n["top"]=i.y;n["width"]=e.width();s.createObject=new iws.objectText($(this).val(),n);s.add(s.createObject);s.setActiveObject(s.createObject);s.createObject=null}$(this).remove()});e.on("input",function(){e.css({height:"auto","overflow-y":"hidden"}).height(e[0].scrollHeight)});return e},__onMouseDown_AnnotationControl:function(t){if(this.isSelectMode()){var e=this.findTarget(t),i=this.getPointer(t,true);if(this._shouldClearSelection(t,e)){this._clearSelection(t,e,i)}if(e){if(e.selectable){this._setupCurrentTransform(t,e)}if(this._selectedObjects().length<=1){if(e!==this.getActiveObject()){this.discardActiveObject();e.selectable&&this.setActiveObject(e,t)}this.renderAll()}this._handleEvent(t,"down",e)}}else{this.discardActiveObject();var n=this.annotToolbar.getInitParam(this.getTrackMode());switch(this.getTrackMode()){case"annotDrawFree":this.createObject=new iws.objectPath([],n);this.add(this.createObject);break;case"annotDrawLine":this.createObject=new iws.objectLine(n);this.add(this.createObject);break;case"annotDrawRect":this.createObject=new iws.objectRect(n);this.add(this.createObject);break;case"annotDrawText":{var s=$(this.wrapperEl).find(".annotText");if(s.length!=0)return;var o=this._makeText(t);setTimeout(function(){o.select()},1)}break}this.createObject&&this.createObject._onCreateMouseDown(t)}this.renderAll()},__onMouseMove_AnnotationControl:function(t){if(this.isSelectMode()){var e;if(!this._currentTransform){e=this.findTarget(t);this._setCursorFromEvent(t,e)}else{var i=this._selectedObjects();if(i.length>1){var n=this.getPointer(t);i.forEach(function(t){t.set({left:t.get("left")+this.trackMouse.mousePrevMoveOffset.x,top:t.get("top")+this.trackMouse.mousePrevMoveOffset.y});t.setCoords()}.bind(this));this.renderAll()}else{this._transformObject(t)}}this._handleEvent(t,"move",e?e:null)}else{this.createObject&&this.createObject._onCreateMouseMove(t);this.renderAll()}},__onMouseUp_AnnotationControl:function(t){if(this.isSelectMode()){var e,i=true,n=this._currentTransform;if(n){this._finalizeCurrentTransform();i=!n.actionPerformed;this._currentTransform=null;e=i?this.findTarget(t,true):n.target;if(e){e.isMoving=false}}else{this._collectObjects()}this._handleEvent(t,"up",e?e:null)}else{if(this.createObject){if(!this.keydownControl){this.setTrackMode(this.annotationMap[0],true)}this.setActiveObject(this.createObject);this.createObject._onCreateMouseUp(t);this.createObject=null}}},_selectedObjects:function(){var t=[];for(var e=0;e<this._objects.length;e++){if(this._objects[e].get("active"))t.push(this._objects[e])}return t},_collectObjects:function(){var t=[],e,i=this.trackMouse.getLT(),n=this.trackMouse.getRB(),s=new iws.Point(i.x,i.y),o=new iws.Point(n.x,n.y),r=i.x===n.x&&i.y===n.y;for(var a=this._objects.length;a--;){e=this._objects[a];if(!e||!e.selectable||!e.visible){continue}if(e.isContainedWithinRect(s,o)){t.push(e);if(r){break}}}if(t.length===1){this.setActiveObject(t[0])}else{t.forEach(function(t){t.set("active",true)})}}})})();(function(){iws.util.extend(iws.PageAnnotation.prototype,{cursorOffset:{mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],findTarget:function(t){var e=this.getPointer(t,true),i=this.getActiveObject();if(i&&i._findTargetCorner(e)){return i}if(i&&this._checkTarget(e,i)){return i}var n=this._searchPossibleTargets(this._objects,e);return n},_checkTarget:function(t,e){if(e&&e.visible&&e.evented&&this.containsPoint(null,e,t)){return true}},_searchPossibleTargets:function(t,e){var i,n=t.length,s,o;while(n--){if(this._checkTarget(e,t[n])){i=t[n]}}return i},containsPoint:function(t,e,i){var n=true,s=i||this.getPointer(t,n),o;o={x:s.x,y:s.y};return e.containsPoint(o)||e._findTargetCorner(s)},_setCursorFromEvent:function(t,e){if(!e){this.setCursor(this.defaultCursor);return false}var i=e.hoverCursor||this.hoverCursor;if(!e.selectable){this.setCursor(i)}else{var n=e._findTargetCorner&&e._findTargetCorner(this.getPointer(t,true));if(!n){this.setCursor(i)}else{this._setCornerCursor(n,e,t)}}return true},_setCornerCursor:function(t,e,i){if(t in this.cursorOffset){this.setCursor(this._getRotatedCornerCursor(t,e,i))}else if(t==="mtr"&&e.hasRotatingPoint){this.setCursor(this.rotationCursor)}else{
this.setCursor(this.defaultCursor);return false}},_getRotatedCornerCursor:function(t,e,i){var n=Math.round(e.get("angle")%360/45);if(n<0){n+=8}n+=this.cursorOffset[t];if(i[this.altActionKey]&&this.cursorOffset[t]%2===0){n+=2}n%=8;return this.cursorMap[n]}})})();(function(){iws.util.extend(iws.PageAnnotation.prototype,{_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=false;i.target.isMoving=true;this._beforeScaleTransform(t,i);this._performTransformAction(t,i,e);i.actionPerformed&&this.renderAll()},_beforeScaleTransform:function(t,e){if(e.action==="scale"||e.action==="scaleX"||e.action==="scaleY"){var i=this._shouldCenterTransform(e.target);if(i&&(e.originX!=="center"||e.originY!=="center")||!i&&e.originX==="center"&&e.originY==="center"){this._resetCurrentTransform();e.reset=true}}},_performTransformAction:function(t,e,i){var n=i.x,s=i.y,o=e.target,r=e.action,a=false;if(r==="rotate"){(a=this._rotateObject(n,s))&&this.fire("object:rotating",{target:o,e:t})}else if(r==="scale"){(a=this._onScale(t,e,n,s))&&this.fire("object:scaling",{target:o,e:t})}else if(r==="scaleX"){(a=this._scaleObject(n,s,"x"))&&this.fire("object:scaling",{target:o,e:t})}else if(r==="scaleY"){(a=this._scaleObject(n,s,"y"))&&this.fire("object:scaling",{target:o,e:t})}else{a=this._translateObject(n,s);if(a){this.renderAll();this.fire("object:moving",{target:o,e:t});this.setCursor(o.moveCursor||this.moveCursor)}}e.actionPerformed=a},_rotateObject:function(t,e){var i=this._currentTransform;if(i.target.get("lockRotation")){return false}var n=Math.atan2(i.ey-i.top,i.ex-i.left),s=Math.atan2(e-i.top,t-i.left),o=iws.util.radiansToDegrees(s-n+i.theta);if(o<0){o=360+o}i.target.angle=o%360;return true},_translateObject:function(t,e){var i=this._currentTransform,n=i.target;return n.translateOffset(t,e,i.offsetX,i.offsetY)},_finalizeCurrentTransform:function(){var t=this._currentTransform,e=t.target;if(e._scaling){e._scaling=false}e.setCoords();if(this._previousOriginX&&this._previousOriginY){e.restoreOriginXY(this._previousOriginX,this._previousOriginY);this._previousOriginX=null;this._previousOriginY=null}this.renderAll();if(t.actionPerformed||this.stateful&&e.hasStateChanged()){this.fire("object:modified",{target:e});e.fire("modified")}},_restoreOriginXY:function(t){if(this._previousOriginX&&this._previousOriginY){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX;t.originY=this._previousOriginY;t.left=e.x;t.top=e.y;if(t instanceof iws.objectLine){t.fixPoint()}this._previousOriginX=null;this._previousOriginY=null}},_onScale:function(t,e,i,n){if((t[this.uniScaleKey]||this.uniScaleTransform)&&!e.target.get("lockUniScaling")){e.currentAction="scale";return this._scaleObject(i,n)}else{if(!e.reset&&e.currentAction==="scale"){this._resetCurrentTransform()}e.currentAction="scaleEqually";return this._scaleObject(i,n,"equally")}},_scaleObject:function(t,e,i){var n=this._currentTransform,s=n.target,o=s.get("lockScalingX"),r=s.get("lockScalingY"),a=s.get("lockScalingFlip");if(o&&r){return false}var l=s.translateToOriginPoint(s.getCenterPoint(),n.originX,n.originY),h=s.toLocalPoint(new iws.Point(t,e),n.originX,n.originY),c=s._getTransformedDimensions(),u=false;this._setLocalMouse(h,n);if(s instanceof iws.objectText){var f=s.width*(h.x/s.scaleX/(s.width+s.strokeWidth));if(f>=s.getMinWidth()){s.set("width",f);u=true}}else if(s instanceof iws.objectLine){s._cornerMove(t,e);u=true}else{u=this._setObjectScale(h,n,o,r,i,a,c)}s.setPositionByOrigin(l,n.originX,n.originY);return u},_setLocalMouse:function(t,e){var i=e.target;if(e.originX==="right"){t.x*=-1}else if(e.originX==="center"){t.x*=e.mouseXSign*2;if(t.x<0){e.mouseXSign=-e.mouseXSign}}if(e.originY==="bottom"){t.y*=-1}else if(e.originY==="center"){t.y*=e.mouseYSign*2;if(t.y<0){e.mouseYSign=-e.mouseYSign}}if(Math.abs(t.x)>i.padding){if(t.x<0){t.x+=i.padding}else{t.x-=i.padding}}else{t.x=0}if(Math.abs(t.y)>i.padding){if(t.y<0){t.y+=i.padding}else{t.y-=i.padding}}else{t.y=0}},_setObjectScale:function(t,e,i,n,s,o,r){var a=e.target,l=false,h=false,c=false,u,f,d,p;d=t.x*a.scaleX/r.x;p=t.y*a.scaleY/r.y;u=a.scaleX!==d;f=a.scaleY!==p;if(o&&d<=0&&d<a.scaleX){l=true}if(o&&p<=0&&p<a.scaleY){h=true}if(s==="equally"&&!i&&!n){l||h||(c=this._scaleObjectEqually(t,a,e,r))}else if(!s){l||i||a.set("scaleX",d)&&(c=c||u);h||n||a.set("scaleY",p)&&(c=c||f)}else if(s==="x"&&!a.get("lockUniScaling")){l||i||a.set("scaleX",d)&&(c=c||u)}else if(s==="y"&&!a.get("lockUniScaling")){h||n||a.set("scaleY",p)&&(c=c||f)}e.newScaleX=d;e.newScaleY=p;l||h||this._flipObject(e,s);return c},_scaleObjectEqually:function(t,e,i,n){var s=t.y+t.x,o=n.y*i.original.scaleY/e.scaleY+n.x*i.original.scaleX/e.scaleX,r;i.newScaleX=i.original.scaleX*s/o;i.newScaleY=i.original.scaleY*s/o;r=i.newScaleX!==e.scaleX||i.newScaleY!==e.scaleY;e.set("scaleX",i.newScaleX);e.set("scaleY",i.newScaleY);return r},_flipObject:function(t,e){if(t.newScaleX<0&&e!=="y"){if(t.originX==="left"){t.originX="right"}else if(t.originX==="right"){t.originX="left"}}if(t.newScaleY<0&&e!=="x"){if(t.originY==="top"){t.originY="bottom"}else if(t.originY==="bottom"){t.originY="top"}}},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};if(e==="ml"||e==="tl"||e==="bl"){i.x="right"}else if(e==="mr"||e==="tr"||e==="br"){i.x="left"}if(e==="tl"||e==="mt"||e==="tr"){i.y="bottom"}else if(e==="bl"||e==="mb"||e==="br"){i.y="top"}return i},_getActionFromCorner:function(t,e,i){if(!e){return"drag"}switch(e){case"mtr":return"rotate";case"ml":case"mr":return"scaleX";case"mt":case"mb":return"scaleY";default:return"scale"}},_setupCurrentTransform:function(t,e){if(!e){return}var i=this.getPointer(t),n=e._findTargetCorner(this.getPointer(t,true)),s=this._getActionFromCorner(e,n,t),o=this._getOriginFromCorner(e,n);this._currentTransform={target:e,action:s,corner:n,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:i.x-e.left,offsetY:i.y-e.top,originX:o.x,originY:o.y,ex:i.x,ey:i.y,lastX:i.x,lastY:i.y,left:e.left,top:e.top,theta:iws.util.degreesToRadians(e.angle),width:e.width*e.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:t.shiftKey,altKey:t[this.centeredKey]};this._currentTransform.original={left:e.left,top:e.top,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,originX:o.x,originY:o.y};this._resetCurrentTransform()},_resetCurrentTransform:function(){var t=this._currentTransform;if(this._shouldCenterTransform(t.target)){if(t.action==="rotate"){this._setOriginToCenter(t.target)}else{if(t.originX!=="center"){if(t.originX==="right"){t.mouseXSign=-1}else{t.mouseXSign=1}}if(t.originY!=="center"){if(t.originY==="bottom"){t.mouseYSign=-1}else{t.mouseYSign=1}}t.originX="center";t.originY="center"}}else{t.originX=t.original.originX;t.originY=t.original.originY}},_setOriginToCenter:function(t){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var e=t.getCenterPoint();t.originX="center";t.originY="center";t.left=e.x;t.top=e.y;this._currentTransform.left=t.left;this._currentTransform.top=t.top},_shouldCenterTransform:function(t){if(!t){return}var e=this._currentTransform,i;if(e.action==="scale"||e.action==="scaleX"||e.action==="scaleY"){i=this.centeredScaling||t.centeredScaling}else if(e.action==="rotate"){i=this.centeredRotation||t.centeredRotation}return i?!e.altKey:e.altKey}})})()})();(function(){function t(){this.initialize.apply(this,arguments)}iws.Object=iws.util.createInheritClass(t,iws.Observable,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:true,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:false,centeredRotation:true,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:true,evented:true,visible:true,hasControls:true,hasBorders:true,hasRotatingPoint:true,rotatingPointOffset:40,perPixelTargetFind:false,includeDefaultValues:true,clipTo:null,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,lockScalingY:false,lockUniScaling:false,lockSkewingX:false,lockSkewingY:false,lockScalingFlip:false,excludeFromExport:false,stateProperties:("top left width height scaleX scaleY flipX flipY originX originY transformMatrix "+"stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit "+"angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor "+"skewX skewY").split(" "),initialize:function(t){if(t){this.setOptions(t)}},_initGradient:function(t){if(t.fill&&t.fill.colorStops&&!(t.fill instanceof fabric.Gradient)){this.set("fill",new fabric.Gradient(t.fill))}if(t.stroke&&t.stroke.colorStops&&!(t.stroke instanceof fabric.Gradient)){this.set("stroke",new fabric.Gradient(t.stroke))}},_initPattern:function(t){if(t.fill&&t.fill.source&&!(t.fill instanceof fabric.Pattern)){this.set("fill",new fabric.Pattern(t.fill))}if(t.stroke&&t.stroke.source&&!(t.stroke instanceof fabric.Pattern)){this.set("stroke",new fabric.Pattern(t.stroke))}},_initClipping:function(t){if(!t.clipTo||typeof t.clipTo!=="string"){return}var e=fabric.util.getFunctionBody(t.clipTo);if(typeof e!=="undefined"){this.clipTo=new Function("ctx",e)}},setOptions:function(t){for(var e in t){this.set(e,t[e])}this._initGradient(t);this._initPattern(t);this._initClipping(t)},transform:function(t,e){if(this.group&&!this.group._transformDone&&this.group===this.canvas._activeGroup){this.group.transform(t)}var i=this.left;var n=this.top;var s=e?this._getLeftTopCoords():this.getCenterPoint();t.translate(s.x,s.y);t.rotate(iws.util.degreesToRadians(this.angle));var o=this.scaleX*(this.flipX?-1:1);var r=this.scaleY*(this.flipY?-1:1);t.scale(o,r);var a=Math.tan(iws.util.degreesToRadians(this.skewX));var l=Math.tan(iws.util.degreesToRadians(this.skewY));t.transform(1,0,a,1,0,0);t.transform(1,l,0,1,0,0)},toObject:function(t){var e=2,i={type:this.type,originX:this.originX,originY:this.originY,left:parseFloat(Number(this.left).toFixed(e)),top:parseFloat(Number(this.top).toFixed(e)),width:parseFloat(Number(this.width).toFixed(e)),height:parseFloat(Number(this.height).toFixed(e)),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:parseFloat(Number(this.strokeWidth).toFixed(e)),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:parseFloat(Number(this.strokeMiterLimit).toFixed(e)),scaleX:parseFloat(Number(this.scaleX).toFixed(e)),scaleY:parseFloat(Number(this.scaleY).toFixed(e)),angle:parseFloat(Number(this.angle).toFixed(e)),flipX:this.flipX,flipY:this.flipY,opacity:parseFloat(Number(this.opacity).toFixed(e)),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:parseFloat(Number(this.skewX).toFixed(e)),skewY:parseFloat(Number(this.skewY).toFixed(e))};iws.util.populateWithProperties(this,i,t);return i},toDatalessObject:function(t){return this.toObject(t)},toString:function(){return"#<fabric."+capitalize(this.type)+">"},get:function(t){return this[t]},getObjectScaling:function(){var t=this.scaleX,e=this.scaleY;if(this.group){var i=this.group.getObjectScaling();t*=i.scaleX;e*=i.scaleY}return{scaleX:t,scaleY:e}},_setObject:function(t){for(var e in t){this._set(e,t[e])}},set:function(t,e){if(typeof t==="object"){this._setObject(t)}else{if(typeof e==="function"&&t!=="clipTo"){this._set(t,e(this.get(t)))}else{this._set(t,e)}}return this},_set:function(t,e){var i=t==="scaleX"||t==="scaleY";if(i){e=this._constrainScale(e)}if(t==="scaleX"&&e<0){this.flipX=!this.flipX;e*=-1}else if(t==="scaleY"&&e<0){this.flipY=!this.flipY;e*=-1}this[t]=e;if(t==="width"||t==="height"){this.minScaleLimit=Math.min(.1,1/Math.max(this.width,this.height))}return this},translateOffset:function(t,e,i,n){var s=t-i,o=e-n,r=!this.get("lockMovementX")&&this.left!==s,a=!this.get("lockMovementY")&&this.top!==o;r&&this.set("left",s);a&&this.set("top",o);return r||a},setOnGroup:function(){},toggle:function(t){var e=this.get(t);if(typeof e==="boolean"){this.set(t,!e)}return this},setSourcePath:function(t){this.sourcePath=t;return this},getViewportTransform:function(){if(this.canvas&&this.canvas.viewportTransform){return this.canvas.viewportTransform}return[1,0,0,1,0,0]},render:function(t,e){if(this.width===0&&this.height===0||!this.visible){return}t.save();this._setupCompositeOperation(t);this.drawSelectionBackground(t);if(!e){this.transform(t)}this._setOpacity(t);this._setShadow(t);this._renderBackground(t);this._setStrokeStyles(t);this._setFillStyles(t);if(this.transformMatrix){t.transform.apply(t,this.transformMatrix)}this.clipTo&&iws.util.clipContext(this,t);this._render(t,e);this.clipTo&&t.restore();t.restore()},_renderBackground:function(t){if(!this.backgroundColor){return}t.fillStyle=this.backgroundColor;t.fillRect(-this.width/2,-this.height/2,this.width,this.height);this._removeShadow(t)},_setOpacity:function(t){if(this.group){this.group._setOpacity(t)}t.globalAlpha*=this.opacity},_setStrokeStyles:function(t){if(this.stroke){t.lineWidth=this.strokeWidth;t.lineCap=this.strokeLineCap;t.lineJoin=this.strokeLineJoin;t.miterLimit=this.strokeMiterLimit;t.strokeStyle=this.stroke.toLive?this.stroke.toLive(t,this):this.stroke}},_setFillStyles:function(t){if(this.fill){t.fillStyle=this.fill.toLive?this.fill.toLive(t,this):this.fill}},_setLineDash:function(t,e,i){if(!e){return}if(1&e.length){e.push.apply(e,e)}if(supportsLineDash){t.setLineDash(e)}else{i&&i(t)}},_renderControls:function(t,e){if(!this.active||e||this.group&&this.group!==this.canvas.getActiveGroup()){return}var i=this.getViewportTransform(),n=this.calcTransformMatrix(),s;n=iws.util.multiplyTransformMatrices(i,n);s=iws.util.qrDecompose(n);t.save();t.translate(s.translateX,s.translateY);t.lineWidth=1*this.borderScaleFactor;t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;t.rotate(iws.util.degreesToRadians(this.angle));this.drawBorders(t);this.drawControls(t);t.restore()},_setShadow:function(t){if(!this.shadow){return}var e=this.canvas&&this.canvas.viewportTransform[0]||1,i=this.canvas&&this.canvas.viewportTransform[3]||1,n=this.getObjectScaling();t.shadowColor=this.shadow.color;t.shadowBlur=this.shadow.blur*(e+i)*(n.scaleX+n.scaleY)/4;t.shadowOffsetX=this.shadow.offsetX*e*n.scaleX;t.shadowOffsetY=this.shadow.offsetY*i*n.scaleY},_removeShadow:function(t){if(!this.shadow){return}t.shadowColor="";t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0},_renderFill:function(t){if(!this.fill){return}t.save();if(this.fill.gradientTransform){var e=this.fill.gradientTransform;t.transform.apply(t,e)}if(this.fill.toLive){t.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)}if(this.fillRule==="evenodd"){t.fill("evenodd")}else{t.fill()}t.restore()},_renderStroke:function(t){if(!this.stroke||this.strokeWidth===0){return}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(t)}t.save();this._setLineDash(t,this.strokeDashArray,this._renderDashedStroke);if(this.stroke.gradientTransform){var e=this.stroke.gradientTransform;t.transform.apply(t,e)}if(this.stroke.toLive){t.translate(-this.width/2+this.stroke.offsetX||0,-this.height/2+this.stroke.offsetY||0)}t.stroke();t.restore()},clone:function(t,e){if(this.constructor.fromObject){return this.constructor.fromObject(this.toObject(e),t)}return new iws.Object(this.toObject(e))},cloneAsImage:function(t,e){var i=this.toDataURL(e);iws.util.loadImage(i,function(e){if(t){t(new iws.Image(e))}});return this},isType:function(t){return this.type===t},complexity:function(){return 0},toJSON:function(t){return this.toObject(t)},setColor:function(t){this.set("fill",t);return this},setAngle:function(t){var e=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;if(e){this._setOriginToCenter()}this.set("angle",t);if(e){this._resetOrigin()}return this},centerH:function(){this.canvas&&this.canvas.centerObjectH(this);return this},viewportCenterH:function(){this.canvas&&this.canvas.viewportCenterObjectH(this);return this},centerV:function(){this.canvas&&this.canvas.centerObjectV(this);return this},viewportCenterV:function(){this.canvas&&this.canvas.viewportCenterObjectV(this);return this},center:function(){this.canvas&&this.canvas.centerObject(this);return this},viewportCenter:function(){this.canvas&&this.canvas.viewportCenterObject(this);return this},remove:function(){this.canvas&&this.canvas.remove(this);return this},getLocalPointer:function(t,e){e=e||this.canvas.getPointer(t);var i=new iws.Point(e.x,e.y),n=this._getLeftTopCoords();if(this.angle){i=iws.util.rotatePoint(i,n,iws.util.degreesToRadians(-this.angle))}return{x:i.x-n.x,y:i.y-n.y}},_setupCompositeOperation:function(t){if(this.globalCompositeOperation){t.globalCompositeOperation=this.globalCompositeOperation}}})})();(function(){var t=iws.util.degreesToRadians,e={left:-.5,center:0,right:.5},i={top:-.5,center:0,bottom:.5};iws.util.extend(iws.Object.prototype,{translateToGivenOrigin:function(t,n,s,o,r){var a=t.x,l=t.y,h,c,u;if(typeof n==="string"){n=e[n]}else{n-=.5}if(typeof o==="string"){o=e[o]}else{o-=.5}h=o-n;if(typeof s==="string"){s=i[s]}else{s-=.5}if(typeof r==="string"){r=i[r]}else{r-=.5}c=r-s;if(h||c){u=this._getTransformedDimensions();a=t.x+h*u.x;l=t.y+c*u.y}return new iws.Point(a,l)},translateToCenterPoint:function(e,i,n){var s=this.translateToGivenOrigin(e,i,n,"center","center");if(this.angle){return iws.util.rotatePoint(s,e,t(this.angle))}return s},translateToOriginPoint:function(e,i,n){var s=this.translateToGivenOrigin(e,"center","center",i,n);if(this.angle){return iws.util.rotatePoint(s,e,t(this.angle))}return s},getCenterPoint:function(){var t=new iws.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(e,i,n){var s=this.getCenterPoint(),o,r;if(typeof i!=="undefined"&&typeof n!=="undefined"){o=this.translateToGivenOrigin(s,"center","center",i,n)}else{o=new iws.Point(this.left,this.top)}r=new iws.Point(e.x,e.y);if(this.angle){r=iws.util.rotatePoint(r,s,-t(this.angle))}return r.subtractEquals(o)},setPositionByOrigin:function(t,e,i){var n=this.translateToCenterPoint(t,e,i),s=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",s.x);this.set("top",s.y)},adjustPosition:function(i){var n=t(this.angle),s=this.getWidth(),o=Math.cos(n)*s,r=Math.sin(n)*s,a,l;if(typeof this.originX==="string"){a=e[this.originX]}else{a=this.originX-.5}if(typeof i==="string"){l=e[i]}else{l=i-.5}this.left+=o*(l-a);this.top+=r*(l-a);this.setCoords();this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center";this.originY="center";this.left=t.x;this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=t.x;this.top=t.y;this._originalOriginX=null;this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})})();(function(){function t(t){return[new fabric.Point(t.tl.x,t.tl.y),new fabric.Point(t.tr.x,t.tr.y),new fabric.Point(t.br.x,t.br.y),new fabric.Point(t.bl.x,t.bl.y)]}var e=iws.util.degreesToRadians,i=iws.util.multiplyTransformMatrices;iws.util.extend(iws.Object.prototype,{oCoords:null,intersectsWithRect:function(e,i){var n=t(this.oCoords),s=fabric.Intersection.intersectPolygonRectangle(n,e,i);return s.status==="Intersection"},intersectsWithObject:function(e){var i=fabric.Intersection.intersectPolygonPolygon(t(this.oCoords),t(e.oCoords));return i.status==="Intersection"||e.isContainedWithinObject(this)||this.isContainedWithinObject(e)},isContainedWithinObject:function(e){var i=t(this.oCoords),n=0;for(;n<4;n++){if(!e.containsPoint(i[n])){return false}}return true},isContainedWithinRect:function(t,e){var i=this.getBoundingRect();return i.left>=t.x&&i.left+i.width<=e.x&&i.top>=t.y&&i.top+i.height<=e.y},containsPoint:function(t){if(!this.oCoords){this.setCoords()}var e=iws.util.find.getContainFromCoords(this.oCoords,t);if(e){e=e}return e},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();return iws.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){if(Math.abs(t)<this.minScaleLimit){if(t<0){return-this.minScaleLimit}else{return this.minScaleLimit}}return t},scale:function(t){t=this._constrainScale(t);if(t<0){this.flipX=!this.flipX;this.flipY=!this.flipY;t*=-1}this.scaleX=t;this.scaleY=t;this.setCoords();return this},scaleToWidth:function(t){var e=this.getBoundingRect().width/this.getWidth();return this.scale(t/this.width/e)},scaleToHeight:function(t){var e=this.getBoundingRect().height/this.getHeight();return this.scale(t/this.height/e)},setCoords:function(){var t=e(this.angle),i=this.getViewportTransform(),n=this._calculateCurrentDimensions(),s=n.x,o=n.y;if(s<0){s=Math.abs(s)}var r=Math.sin(t),a=Math.cos(t),l=s>0?Math.atan(o/s):0,h=s/Math.cos(l)/2,c=Math.cos(l+t)*h,u=Math.sin(l+t)*h,f=iws.util.transformPoint(this.getCenterPoint(),i),d=new iws.Point(f.x-c,f.y-u),p=new iws.Point(d.x+s*a,d.y+s*r),g=new iws.Point(d.x-o*r,d.y+o*a),m=new iws.Point(f.x+c,f.y+u),v=new iws.Point((d.x+g.x)/2,(d.y+g.y)/2),b=new iws.Point((p.x+d.x)/2,(p.y+d.y)/2),w=new iws.Point((m.x+p.x)/2,(m.y+p.y)/2),y=new iws.Point((m.x+g.x)/2,(m.y+g.y)/2),_=new iws.Point(b.x+r*this.rotatingPointOffset,b.y-a*this.rotatingPointOffset);this.oCoords={tl:d,tr:p,br:m,bl:g,ml:v,mt:b,mr:w,mb:y,mtr:_};this._setCornerCoords&&this._setCornerCoords(this.oCoords);return this},_calcRotateMatrix:function(){if(this.angle){var t=e(this.angle),i=Math.cos(t),n=Math.sin(t);return[i,n,-n,i,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var t=this.getCenterPoint(),e=[1,0,0,1,t.x,t.y],n=this._calcRotateMatrix(),s=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,true),o=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0];o=i(o,e);o=i(o,n);o=i(o,s);return o},_calcDimensionsTransformMatrix:function(t,n,s){var o=[1,0,Math.tan(e(t)),1],r=[1,Math.tan(e(n)),0,1],a=this.scaleX*(s&&this.flipX?-1:1),l=this.scaleY*(s&&this.flipY?-1:1),h=[a,0,0,l],c=i(h,o,true);return i(c,r,true)}})})();(function(){var t=iws.util.degreesToRadians,e=function(){return typeof G_vmlCanvasManager!=="undefined"};iws.util.extend(iws.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||!this.active){return false}var e=t.x,i=t.y,n,s;this.__corner=0;for(var o in this.oCoords){if(!this.isControlVisible(o)){continue}if(o==="mtr"&&!this.hasRotatingPoint){continue}if(this.get("lockUniScaling")&&(o==="mt"||o==="mr"||o==="mb"||o==="ml")){continue}var r=iws.util.find.getContainFromCoords(this.oCoords[o].corner,{x:e,y:i});if(r){this.__corner=o;return o}}return false},_setCornerCoords:function(e){var i=t(45-this.angle),n=this.cornerSize*.707106,s=n*Math.cos(i),o=n*Math.sin(i),r,a;for(var l in e){r=e[l].x;a=e[l].y;e[l].corner={tl:{x:r-o,y:a-s},tr:{x:r+s,y:a-o},bl:{x:r-s,y:a+o},br:{x:r+o,y:a+s}}}},_getNonTransformedDimensions:function(){var t=this.strokeWidth,e=this.width,i=this.height,n=true,s=true;if(this.type==="line"&&this.strokeLineCap==="butt"){s=e;n=i}if(s){i+=i<0?-t:t}if(n){e+=e<0?-t:t}return{x:e,y:i}},_getTransformedDimensions:function(t,e){if(typeof t==="undefined"){t=this.skewX}if(typeof e==="undefined"){e=this.skewY}var i=this._getNonTransformedDimensions(),n=i.x/2,s=i.y/2,o=[{x:-n,y:-s},{x:n,y:-s},{x:-n,y:s},{x:n,y:s}],r,a=this._calcDimensionsTransformMatrix(t,e,false),l;for(r=0;r<o.length;r++){o[r]=iws.util.transformPoint(o[r],a)}l=iws.util.makeBoundingBoxFromPoints(o);return{x:l.width,y:l.height}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),e=this._getTransformedDimensions(),i=e.x,n=e.y,s=iws.util.transformPoint(new iws.Point(i,n),t,true);return s.scalarAdd(2*this.padding)},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.group||!this.active){return this}e.save();var i=this.getCenterPoint(),n=this._calculateCurrentDimensions(),s=this.canvas.viewportTransform;e.translate(i.x,i.y);e.scale(1/s[0],1/s[3]);e.rotate(t(this.angle));e.fillStyle=this.selectionBackgroundColor;e.fillRect(-n.x/2,-n.y/2,n.x,n.y);e.restore();return this},drawBorders:function(t){if(!this.hasBorders){return this}var e=this._calculateCurrentDimensions(),i=1/this.borderScaleFactor,n=e.x+i,s=e.y+i;t.save();t.strokeStyle=this.borderColor;this._setLineDash(t,this.borderDashArray,null);t.strokeRect(-n/2,-s/2,n,s);if(this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var o=-s/2;t.beginPath();t.moveTo(0,o);t.lineTo(0,o-this.rotatingPointOffset);t.closePath();t.stroke()}t.restore();return this},drawBordersInGroup:function(t,e){if(!this.hasBorders){return this}var i=this._getNonTransformedDimensions(),n=fabric.util.customTransformMatrix(e.scaleX,e.scaleY,e.skewX),s=fabric.util.transformPoint(i,n),o=1/this.borderScaleFactor,r=s.x+o+2*this.padding,a=s.y+o+2*this.padding;t.save();this._setLineDash(t,this.borderDashArray,null);t.strokeStyle=this.borderColor;t.strokeRect(-r/2,-a/2,r,a);t.restore();return this},drawControls:function(t){if(!this.hasControls){return this}var e=this._calculateCurrentDimensions(),i=e.x,n=e.y,s=this.cornerSize,o=-(i+s)/2,r=-(n+s)/2,a=this.transparentCorners?"stroke":"fill";t.save();t.strokeStyle=t.fillStyle=this.cornerColor;if(!this.transparentCorners){t.strokeStyle=this.cornerStrokeColor}this._setLineDash(t,this.cornerDashArray,null);this._drawControl("tl",t,a,o,r);this._drawControl("tr",t,a,o+i,r);this._drawControl("bl",t,a,o,r+n);this._drawControl("br",t,a,o+i,r+n);if(!this.get("lockUniScaling")){this._drawControl("mt",t,a,o+i/2,r);this._drawControl("mb",t,a,o+i/2,r+n);this._drawControl("mr",t,a,o+i,r+n/2);this._drawControl("ml",t,a,o,r+n/2)}if(this.hasRotatingPoint){this._drawControl("mtr",t,a,o+i/2,r-this.rotatingPointOffset)}t.restore();return this},_drawControl:function(t,i,n,s,o){if(!this.isControlVisible(t)){return}var r=this.cornerSize,a=!this.transparentCorners&&this.cornerStrokeColor;switch(this.cornerStyle){case"circle":i.beginPath();i.arc(s+r/2,o+r/2,r/2,0,2*Math.PI,false);i[n]();if(a){i.stroke()}break;default:e()||this.transparentCorners||i.clearRect(s,o,r,r);i[n+"Rect"](s,o,r,r);if(a){i.strokeRect(s,o,r,r)}}},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){this._getControlsVisibility()[t]=e;return this},setControlsVisibility:function(t){t||(t={});for(var e in t){this.setControlVisible(e,t[e])}return this},_getControlsVisibility:function(){if(!this._controlsVisibility){this._controlsVisibility={tl:true,tr:true,br:true,bl:true,ml:true,mt:true,mr:true,mb:true,mtr:true}}return this._controlsVisibility}})})();(function(){iws.util.extend(iws.Object.prototype,{_onCreateMouseDown:function(t){},_onCreateMouseMove:function(t){var e=this.canvas.trackMouse.getRect();this.set({left:e.left}).set({top:e.top});this.set("width",Math.abs(e.right-e.left)).set("height",Math.abs(e.bottom-e.top))},_onCreateMouseUp:function(t){this.setCoords()},restoreOriginXY:function(t,e){var i=this.translateToOriginPoint(this.getCenterPoint(),t,e);this.originX=t;this.originY=e;this.left=i.x;this.top=i.y}})})();(function(t){"use strict";var e=t.iws||(t.iws={}),i=e.util.extend,n={left:1,top:1,x1:1,x2:1,y1:1,y2:1,angle:1};if(e.objectLine){e.warn("iws.Line is already defined");return}function s(){this.initialize.apply(this,arguments)}e.objectLine=e.util.createInheritClass(s,e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,lineHeight:14,initialize:function(t){t=t||{};this.callSuper("initialize",t);this.setControlsVisibility({tl:false,tr:false,br:false,bl:false,ml:true,mt:false,mr:true,mb:false,mtr:true});this._initValue(t);this.setCoords();this.originX="left";this.originY="top"},_initValue:function(t){t||(t={});this.width=this.width||e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.height=this.height||this.lineHeight;this.angle=this.angle||e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle;this.left=this.left||this.x1;this.top=this.top||this.y1-this.lineHeight/2},_changeWidthHeight:function(){this.width=e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.height=this.lineHeight;this.angle=e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle;this.left=this.x1;this.top=this.y1-this.lineHeight/2},_cornerMove:function(t,i){if(this.__corner==="mr"){this.set("x2",t).set("y2",i);this.width=e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.angle=e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle}else if(this.__corner==="ml"){this.set("x1",t).set("y1",i);this.width=e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.angle=e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle;this.left=this.x1;this.top=this.y1-this.lineHeight/2}},_set:function(t,e){this.callSuper("_set",t,e);if(typeof n[t]!=="undefined"){}return this},translateOffset:function(t,e,i,n){var s=t-i,o=e-n,r=!this.get("lockMovementX")&&this.left!==s,a=!this.get("lockMovementY")&&this.top!==o;var l=this.x2-this.x1;this.x1=s;this.x2=l+this.x1;var h=this.y2-this.y1;this.y1=o+this.lineHeight/2;this.y2=h+this.y1;this.left=this.x1;this.top=o;return r||a},_render:function(t,e){t.beginPath();if(e){var i=this.getCenterPoint();t.translate(i.x-this.strokeWidth/2,i.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&supportsLineDash){t.moveTo(-this.width/2,0);t.lineTo(this.width/2,0)}t.lineWidth=this.strokeWidth;var n=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle;this.stroke&&this._renderStroke(t);t.strokeStyle=n},toObject:function(t){var e=2;return i(this.callSuper("toObject",t),{x1:parseFloat(Number(this.x1).toFixed(e)),y1:parseFloat(Number(this.y1).toFixed(e)),x2:parseFloat(Number(this.x2).toFixed(e)),y2:parseFloat(Number(this.y2).toFixed(e))})},complexity:function(){return 1},setCoords:function(){this.callSuper("setCoords");this.x1=this.oCoords.ml.x;this.y1=this.oCoords.ml.y;this.x2=this.oCoords.mr.x;this.y2=this.oCoords.mr.y;return this}});e.objectLine.fromObject=function(t,i){var n=new e.objectLine(t);i&&i(n);return n}})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectLine.prototype,{_onCreateMouseDown:function(t){var e=this.canvas.getPointer(t);this.set({x1:e.x,y1:e.y,x2:e.x,y2:e.y})},_onCreateMouseMove:function(t){var e=this.canvas.getPointer(t);this.set({x2:e.x}).set({y2:e.y});this._changeWidthHeight()},_onCreateMouseUp:function(t){
this.callSuper("_onCreateMouseUp",t)}})})();(function(){iws.util.extend(iws.objectLine.prototype,{})})();(function(t){"use strict";var e=t.iws||(t.iws={}),i=e.util.array.min,n=e.util.array.max,s=e.util.extend,o=Object.prototype.toString,r=e.util.drawArc,a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};if(e.objectPath){e.warn("iws.Path is already defined");return}function h(){this.initialize.apply(this,arguments)}e.objectPath=e.util.createInheritClass(h,e.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(t,e){e=e||{};this.setOptions(e);if(!t){t=[]}var i=o.call(t)==="[object Array]";this.path=i?t:t.match&&t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path){return}if(!i){this.path=this._parsePath()}this._setPositionDimensions(e);if(e.sourcePath){this.setSourcePath(e.sourcePath)}},_setPositionDimensions:function(t){var e=this._parseDimensions();this.minX=e.left;this.minY=e.top;this.width=e.width;this.height=e.height;if(typeof t.left==="undefined"){this.left=e.left+(this.originX==="center"?this.width/2:this.originX==="right"?this.width:0)}if(typeof t.top==="undefined"){this.top=e.top+(this.originY==="center"?this.height/2:this.originY==="bottom"?this.height:0)}if(e.width>0){e.width=e.width}this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_renderPathCommands:function(t){var e,i=null,n=0,s=0,o=0,a=0,l=0,h=0,c,u,f=-this.pathOffset.x,d=-this.pathOffset.y;if(this.group&&this.group.type==="path-group"){f=0;d=0}t.beginPath();for(var p=0,g=this.path.length;p<g;++p){e=this.path[p];switch(e[0]){case"l":o+=e[1];a+=e[2];t.lineTo(o+f,a+d);break;case"L":o=e[1];a=e[2];t.lineTo(o+f,a+d);break;case"h":o+=e[1];t.lineTo(o+f,a+d);break;case"H":o=e[1];t.lineTo(o+f,a+d);break;case"v":a+=e[1];t.lineTo(o+f,a+d);break;case"V":a=e[1];t.lineTo(o+f,a+d);break;case"m":o+=e[1];a+=e[2];n=o;s=a;t.moveTo(o+f,a+d);break;case"M":o=e[1];a=e[2];n=o;s=a;t.moveTo(o+f,a+d);break;case"c":c=o+e[5];u=a+e[6];l=o+e[3];h=a+e[4];t.bezierCurveTo(o+e[1]+f,a+e[2]+d,l+f,h+d,c+f,u+d);o=c;a=u;break;case"C":o=e[5];a=e[6];l=e[3];h=e[4];t.bezierCurveTo(e[1]+f,e[2]+d,l+f,h+d,o+f,a+d);break;case"s":c=o+e[3];u=a+e[4];if(i[0].match(/[CcSs]/)===null){l=o;h=a}else{l=2*o-l;h=2*a-h}t.bezierCurveTo(l+f,h+d,o+e[1]+f,a+e[2]+d,c+f,u+d);l=o+e[1];h=a+e[2];o=c;a=u;break;case"S":c=e[3];u=e[4];if(i[0].match(/[CcSs]/)===null){l=o;h=a}else{l=2*o-l;h=2*a-h}t.bezierCurveTo(l+f,h+d,e[1]+f,e[2]+d,c+f,u+d);o=c;a=u;l=e[1];h=e[2];break;case"q":c=o+e[3];u=a+e[4];l=o+e[1];h=a+e[2];t.quadraticCurveTo(l+f,h+d,c+f,u+d);o=c;a=u;break;case"Q":c=e[3];u=e[4];t.quadraticCurveTo(e[1]+f,e[2]+d,c+f,u+d);o=c;a=u;l=e[1];h=e[2];break;case"t":c=o+e[1];u=a+e[2];if(i[0].match(/[QqTt]/)===null){l=o;h=a}else{l=2*o-l;h=2*a-h}t.quadraticCurveTo(l+f,h+d,c+f,u+d);o=c;a=u;break;case"T":c=e[1];u=e[2];if(i[0].match(/[QqTt]/)===null){l=o;h=a}else{l=2*o-l;h=2*a-h}t.quadraticCurveTo(l+f,h+d,c+f,u+d);o=c;a=u;break;case"a":r(t,o+f,a+d,[e[1],e[2],e[3],e[4],e[5],e[6]+o+f,e[7]+a+d]);o+=e[6];a+=e[7];break;case"A":r(t,o+f,a+d,[e[1],e[2],e[3],e[4],e[5],e[6]+f,e[7]+d]);o=e[6];a=e[7];break;case"z":case"Z":o=n;a=s;t.closePath();break}i=e}},_render:function(t){this._renderPathCommands(t);this._renderFill(t);this._renderStroke(t)},toObject:function(t){var e=s(this.callSuper("toObject",t),{path:this.path.map(function(t){return t.slice()}),pathOffset:this.pathOffset});if(this.sourcePath){e.sourcePath=this.sourcePath}if(this.transformMatrix){e.transformMatrix=this.transformMatrix}return e},toDatalessObject:function(t){var e=this.toObject(t);if(this.sourcePath){e.path=this.sourcePath}delete e.sourcePath;return e},_parsePath:function(){var t=[],e=[],i,n,s=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,o,r;for(var h=0,c,u=this.path.length;h<u;h++){i=this.path[h];r=i.slice(1).trim();e.length=0;while(o=s.exec(r)){e.push(o[0])}c=[i.charAt(0)];for(var f=0,d=e.length;f<d;f++){n=parseFloat(e[f]);if(!isNaN(n)){c.push(n)}}var p=c[0],g=a[p.toLowerCase()],m=l[p]||p;if(c.length-1>g){for(var v=1,b=c.length;v<b;v+=g){t.push([p].concat(c.slice(v,v+g)));p=m}}else{t.push(c)}}return t},_parseDimensions:function(){var t=[],s=[],o,r=null,a=0,l=0,h=0,c=0,u=0,f=0,d,p,g;for(var m=0,v=this.path.length;m<v;++m){o=this.path[m];switch(o[0]){case"l":h+=o[1];c+=o[2];g=[];break;case"L":h=o[1];c=o[2];g=[];break;case"h":h+=o[1];g=[];break;case"H":h=o[1];g=[];break;case"v":c+=o[1];g=[];break;case"V":c=o[1];g=[];break;case"m":h+=o[1];c+=o[2];a=h;l=c;g=[];break;case"M":h=o[1];c=o[2];a=h;l=c;g=[];break;case"c":d=h+o[5];p=c+o[6];u=h+o[3];f=c+o[4];g=e.util.getBoundsOfCurve(h,c,h+o[1],c+o[2],u,f,d,p);h=d;c=p;break;case"C":h=o[5];c=o[6];u=o[3];f=o[4];g=e.util.getBoundsOfCurve(h,c,o[1],o[2],u,f,h,c);break;case"s":d=h+o[3];p=c+o[4];if(r[0].match(/[CcSs]/)===null){u=h;f=c}else{u=2*h-u;f=2*c-f}g=e.util.getBoundsOfCurve(h,c,u,f,h+o[1],c+o[2],d,p);u=h+o[1];f=c+o[2];h=d;c=p;break;case"S":d=o[3];p=o[4];if(r[0].match(/[CcSs]/)===null){u=h;f=c}else{u=2*h-u;f=2*c-f}g=e.util.getBoundsOfCurve(h,c,u,f,o[1],o[2],d,p);h=d;c=p;u=o[1];f=o[2];break;case"q":d=h+o[3];p=c+o[4];u=h+o[1];f=c+o[2];g=e.util.getBoundsOfCurve(h,c,u,f,u,f,d,p);h=d;c=p;break;case"Q":u=o[1];f=o[2];g=e.util.getBoundsOfCurve(h,c,u,f,u,f,o[3],o[4]);h=o[3];c=o[4];break;case"t":d=h+o[1];p=c+o[2];if(r[0].match(/[QqTt]/)===null){u=h;f=c}else{u=2*h-u;f=2*c-f}g=e.util.getBoundsOfCurve(h,c,u,f,u,f,d,p);h=d;c=p;break;case"T":d=o[1];p=o[2];if(r[0].match(/[QqTt]/)===null){u=h;f=c}else{u=2*h-u;f=2*c-f}g=e.util.getBoundsOfCurve(h,c,u,f,u,f,d,p);h=d;c=p;break;case"a":g=e.util.getBoundsOfArc(h,c,o[1],o[2],o[3],o[4],o[5],o[6]+h,o[7]+c);h+=o[6];c+=o[7];break;case"A":g=e.util.getBoundsOfArc(h,c,o[1],o[2],o[3],o[4],o[5],o[6],o[7]);h=o[6];c=o[7];break;case"z":case"Z":h=a;c=l;break}r=o;g.forEach(function(e){t.push(e.x);s.push(e.y)});t.push(h);s.push(c)}var b=i(t)||0,w=i(s)||0,y=n(t)||0,_=n(s)||0,x=y-b,C=_-w,k={left:b,top:w,width:x,height:C};return k}});e.objectPath.fromObject=function(t,i){var n=new e.objectPath(t.path,t);i&&i(n);return n};e.objectPath.async=true})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectPath.prototype,{_onCreateMouseDown:function(t){this.set({fill:null});var e=this.canvas.getPointer(t);this._addPoint(["M",e.x,e.y])},_onCreateMouseMove:function(t){var e=this.canvas.getPointer(t);this._addPoint(["L",e.x,e.y]);this.canvas.renderAll()},_onCreateMouseUp:function(t){this.callSuper("_onCreateMouseUp",t)},_addPoint:function(t){this.path.push(t);this._setPositionDimensions({})}})})();(function(t){"use strict";var e=iws.Object.prototype.stateProperties.concat();e.push("rx","ry","x","y");function i(){this.initialize.apply(this,arguments)}iws.objectRect=iws.util.createInheritClass(i,iws.Object,{stateProperties:e,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(t){t=t||{};this.callSuper("initialize",t);this._initRxRy()},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx}else if(this.ry&&!this.rx){this.rx=this.ry}},_render:function(t,e){if(this.width===1&&this.height===1){t.fillRect(-.5,-.5,1,1);return}var i=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0,s=this.width,o=this.height,r=e?this.left:-this.width/2,a=e?this.top:-this.height/2,l=i!==0||n!==0,h=1-.5522847498;t.beginPath();t.moveTo(r+i,a);t.lineTo(r+s-i,a);l&&t.bezierCurveTo(r+s-h*i,a,r+s,a+h*n,r+s,a+n);t.lineTo(r+s,a+o-n);l&&t.bezierCurveTo(r+s,a+o-h*n,r+s-h*i,a+o,r+s-i,a+o);t.lineTo(r+i,a+o);l&&t.bezierCurveTo(r+h*i,a+o,r,a+o-h*n,r,a+o-n);t.lineTo(r,a+n);l&&t.bezierCurveTo(r,a+h*n,r+h*i,a,r+i,a);t.closePath();this._renderFill(t);this._renderStroke(t)},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,n=this.width,s=this.height;t.beginPath();iws.util.drawDashedLine(t,e,i,e+n,i,this.strokeDashArray);iws.util.drawDashedLine(t,e+n,i,e+n,i+s,this.strokeDashArray);iws.util.drawDashedLine(t,e+n,i+s,e,i+s,this.strokeDashArray);iws.util.drawDashedLine(t,e,i+s,e,i,this.strokeDashArray);t.closePath()},toObject:function(t){var e=iws.util.extend(this.callSuper("toObject",t),{rx:this.get("rx")||0,ry:this.get("ry")||0});return e},complexity:function(){return 1}});iws.objectRect.fromObject=function(t,e){var i=new iws.objectRect(t);e&&e(i);return i}})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectRect.prototype,{_onCreateMouseDown:function(t){var e=this.canvas.getPointer(t);this.set({left:e.x,top:e.y,originX:"left",originY:"top",width:10,height:10})},_onCreateMouseMove:function(t){this.callSuper("_onCreateMouseMove",t)},_onCreateMouseUp:function(t){this.callSuper("_onCreateMouseUp",t)}})})();(function(t){"use strict";var e=t.iws||(t.iws={}),i=e.util.extend,n=e.util.clone,s=e.util.toFixed,o=e.Object.NUM_FRACTION_DIGITS,r=2;if(e.objectText){e.warn("iws.Text is already defined");return}var a=e.Object.prototype.stateProperties.concat();a.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight");function l(){this.initialize.apply(this,arguments)}e.objectText=e.util.createInheritClass(l,e.Object,{_dimensionAffectingProps:{fontSize:true,fontWeight:true,fontFamily:true,fontStyle:true,lineHeight:true,text:true,charSpacing:true,textAlign:true,strokeWidth:true,width:true},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.2,stateProperties:a,stroke:null,shadow:null,charSpacing:0,minWidth:20,dynamicMinWidth:2,__cachedLines:null,initialize:function(t,e){e=e||{};this.text=t;this.__skipDimension=true;this.setOptions(e);this.__skipDimension=false;this.ctx=document.createElement("canvas").getContext("2d");this._initDimensions(this.ctx);this.initBehavior();this.setControlsVisibility({tl:false,tr:false,br:false,bl:false,ml:true,mt:false,mr:true,mb:false,mtr:true})},_initDimensions:function(t){if(this.__skipDimension){return}this._setTextStyles(this.ctx);this.dynamicMinWidth=0;this._textLines=this._splitTextIntoLines();if(this.dynamicMinWidth>this.width){this._set("width",this.dynamicMinWidth)}this._clearCache();this.height=this._getTextHeight(this.ctx)+5},_render:function(t){this.clipTo&&e.util.clipContext(this,t);this._setOpacity(t);this._setShadow(t);this._setupCompositeOperation(t);this._renderBackground(t);this._setStrokeStyles(t);this._setFillStyles(t);this._renderText(t);this._renderTextDecoration(t);this.clipTo&&t.restore()},_renderText:function(t){this._renderTextFill(t);this._renderTextStroke(t)},_setTextStyles:function(t){t.textBaseline="alphabetic";t.font=this._getFontDeclaration()},_getTextHeight:function(t){var e,i=0;for(var n=0,s=this._textLines.length;n<s;n++){e=this._getHeightOfLine(t,n);i+=n===s-1?e/this.lineHeight:e}return i},_getTextWidth:function(t){var e=this._getLineWidth(t,0);for(var i=1,n=this._textLines.length;i<n;i++){var s=this._getLineWidth(t,i);if(s>e){e=s}}return e},_getNonTransformedDimensions:function(){return{x:this.width,y:this.height}},_renderChars:function(t,e,i,n,s){var o=t.slice(0,-4),r,a;if(this[o].toLive){var l=-this.width/2+this[o].offsetX||0,h=-this.height/2+this[o].offsetY||0;e.save();e.translate(l,h);n-=l;s-=h}if(this.charSpacing!==0){var c=this._getWidthOfCharSpacing();i=i.split("");for(var u=0,f=i.length;u<f;u++){r=i[u];a=e.measureText(r).width+c;e[t](r,n,s);n+=a>0?a:0}}else{e[t](i,n,s)}this[o].toLive&&e.restore()},_renderTextLine:function(t,e,i,n,s,o){var r=this._getLineWidth(e,o);if(this.textAlign!=="justify"||this.width<r){this._renderChars(t,e,i,n,s,o);return}var a=i.split(/\s+/),l=0,h=this._getWidthOfWords(e,a.join(""),o,0),c=this.width-h,u=a.length-1,f=u>0?c/u:0,d=0,p;for(var g=0,m=a.length;g<m;g++){while(i[l]===" "&&l<i.length){l++}p=a[g];this._renderChars(t,e,p,n+d,s,o,l);d+=this._getWidthOfWords(e,p,o,l)+f;l+=p.length}},_getWidthOfWords:function(t,e){var i=t.measureText(e).width,n,s;if(this.charSpacing!==0){n=e.split("").length;s=n*this._getWidthOfCharSpacing();i+=s}return i>0?i:0},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},isEmptyStyles:function(){return true},_renderTextCommon:function(t,e){var i=0,n=this._getLeftOffset(),s=this._getTopOffset();for(var o=0,r=this._textLines.length;o<r;o++){var a=this._getHeightOfLine(t,o),l=a/this.lineHeight,h=this._getLineWidth(t,o),c=this._getLineLeftOffset(h);this._renderTextLine(e,t,this._textLines[o],n+c,s+i+l,o);i+=a}},_renderTextFill:function(t){if(!this.fill&&this.isEmptyStyles()){return}this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){if((!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()){return}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(t)}t.save();this._setLineDash(t,this.strokedashArray);t.beginPath();this._renderTextCommon(t,"strokeText");t.closePath();t.restore()},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_getLineLeftOffset:function(t){if(this.textAlign==="center"){return(this.width-t)/2}if(this.textAlign==="right"){return this.width-t}return 0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[]},_shouldClearCache:function(){var t=false;if(this._forceClearCache){this._forceClearCache=false;return true}for(var e in this._dimensionAffectingProps){if(this["__"+e]!==this[e]){this["__"+e]=this[e];t=true}}return t},_getLineWidth:function(t,e){if(this.__lineWidths[e]){return this.__lineWidths[e]===-1?this.width:this.__lineWidths[e]}var i,n,s=this._textLines[e];if(s===""){i=0}else{i=this._measureLine(t,e)}this.__lineWidths[e]=i;if(i&&this.textAlign==="justify"){n=s.split(/\s+/);if(n.length>1){this.__lineWidths[e]=-1}}return i},_getWidthOfCharSpacing:function(){if(this.charSpacing!==0){return this.fontSize*this.charSpacing/1e3}return 0},_measureLine:function(t,e){var i=this._textLines[e],n=t.measureText(i).width,s=0,o,r;if(this.charSpacing!==0){o=i.split("").length;s=(o-1)*this._getWidthOfCharSpacing()}r=n+s;return r>0?r:0},_renderTextDecoration:function(t){if(!this.textDecoration){return}var e=this.height/2,i=this,n=[];function s(n){var s,o=0,r,a,l,h,c,u;for(s=0,r=i._textLines.length;s<r;s++){h=i._getLineWidth(t,s);c=i._getLineLeftOffset(h);u=i._getHeightOfLine(t,s);for(a=0,l=n.length;a<l;a++){t.fillRect(i._getLeftOffset()+c,o+n[a]*i.fontSize-e,h,i.fontSize/15)}o+=u}}if(this.textDecoration.indexOf("underline")>-1){n.push(.85)}if(this.textDecoration.indexOf("line-through")>-1){n.push(.43)}if(this.textDecoration.indexOf("overline")>-1){n.push(-.12)}if(n.length>0){s(n)}},_getFontDeclaration:function(){return[e.isLikelyNode?this.fontWeight:this.fontStyle,e.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",e.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(t,e){if(!this.visible){return}t.save();this._setTextStyles(t);if(this._shouldClearCache()){this._initDimensions(t)}this.drawSelectionBackground(t);if(!e){this.transform(t)}if(this.transformMatrix){t.transform.apply(t,this.transformMatrix)}if(this.group&&this.group.type==="path-group"){t.translate(this.left,this.top)}this._render(t);t.restore()},_getWidthOfSpace:function(t,e){if(this.__widthOfSpace[e]){return this.__widthOfSpace[e]}var i=this._textLines[e],n=this._getWidthOfWords(t,i,e,0),s=this.width-n,o=i.length-i.replace(this._reSpacesAndTabs,"").length,r=Math.max(s/o,t.measureText(" ").width);this.__widthOfSpace[e]=r;return r},_wrapText:function(t,e){var i=e.split(this._reNewline),n=[],s;for(s=0;s<i.length;s++){n=n.concat(this._wrapLine(t,i[s],s))}return n},_getWidthOfChar:function(t,e,i,n){if(!this._isMeasuring&&this.textAlign==="justify"&&this._reSpacesAndTabs.test(e)){return this._getWidthOfSpace(t,i)}t.save();var s=this._applyCharStylesGetWidth(t,e,i,n);if(this.charSpacing!==0){s+=this._getWidthOfCharSpacing()}t.restore();return s>0?s:0},_measureText:function(t,e,i,n){var s=0;n=n||0;for(var o=0,r=e.length;o<r;o++){s+=this._getWidthOfChar(t,e[o],i,o+n)}return s},_wrapLine:function(t,e,i){var n=0,s=[],o="",r=e.split(" "),a="",l=0,h=" ",c=0,u=0,f=0,d=true,p=this._getWidthOfCharSpacing();for(var g=0;g<r.length;g++){a=r[g];c=t.measureText(a).width;l+=a.length;n+=u+c-p;if(n>=this.width&&!d){s.push(o);o="";n=c;d=true}else{n+=p}if(!d){o+=h}o+=a;u=t.measureText(h).width;l++;d=false;if(c>f){f=c}}g&&s.push(o);if(f>this.dynamicMinWidth){this.dynamicMinWidth=f-p}return s},_splitTextIntoLines:function(){var t=this.textAlign;this.ctx.save();this._setTextStyles(this.ctx);this.textAlign="left";var e=this._wrapText(this.ctx,this.text);this.textAlign=t;this.ctx.restore();this._textLines=e;this._styleMap=this._generateStyleMap();return e},_generateStyleMap:function(){var t=0,e=0,i=0,n={};for(var s=0;s<this._textLines.length;s++){if(this.text[i]==="\n"&&s>0){e=0;i++;t++}else if(this.text[i]===" "&&s>0){e++;i++}n[s]={line:t,offset:e};i+=this._textLines[s].length;e+=this._textLines[s].length}return n},toObject:function(t){var e=i(this.callSuper("toObject",t),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,charSpacing:this.charSpacing,minWidth:this.minWidth});return e},_set:function(t,e){this.callSuper("_set",t,e);if(t in this._dimensionAffectingProps){this._initDimensions();this.setCoords()}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)}});e.objectText.fromObject=function(t,i){var s=new e.objectText(t.text,n(t));i&&i(s);return s}})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectText.prototype,{initBehavior:function(){this.initSelect();this.initDeselect();this.initMousedownHandler();this.initMouseupHandler();this.initDoubleClickSimulation();this.initTextClickHandler()},initSelect:function(){this.observe("selected",function(t){setTimeout(function(){this.selected=true}.bind(this),100)})},initDeselect:function(){this.observe("deselected",function(t){this.selected=false})},initMousedownHandler:function(){this.observe("mousedown",function(t){t.target;var e=this.canvas.getPointer(t.e);this.__mousedownX=e.x;this.__mousedownY=e.y;this.__isMousedown=true;this.__lastSelected=this.selected})},_isObjectMoved:function(t){var e=this.canvas.getPointer(t);return this.__mousedownX!==e.x||this.__mousedownY!==e.y},initMouseupHandler:function(){this.observe("mouseup",function(t){this.__isMousedown=false;if(this._isObjectMoved(t.e)){return}if(this.__lastSelected&&!this.__corner){this.fire("textClick",t)}this.selected=true})},initTextClickHandler:function(){this.observe("textClick",function(){this.visible=false;this.active=false;this.canvas.renderAll();var t=$('<textarea class="annotText"></textarea>');t.val(this.text);t.css({left:this.left,top:this.top,width:this.width,height:this.height+2,"font-family":"Times New Roman","font-size":this.fontSize+"px",color:this.fill,background:this.backgroundColor,position:"absolute","line-height":1.2,border:"0 none white",padding:0,outline:"none","IME-MODE":"active"}).appendTo($(this.canvas.pageContainer));var e=this;t.on("focusout",function(t){if($(this).val()!=""){e.set("text",$(this).val())}e.visible=true;e.active=true;e.canvas.renderAll();$(this).remove()});t.on("input",function(){t.css({height:"auto","overflow-y":"hidden"}).height(t[0].scrollHeight)});setTimeout(function(){t.select()},1)})},initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.observe("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(t){this.__newClickTime=+new Date;var e=this.canvas.getPointer(t.e);if(this.isTripleClick(e)){this.fire("tripleclick",t);this._stopEvent(t.e)}else if(this.isDoubleClick(e)){this.fire("dblclick",t);this._stopEvent(t.e)}this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=e},isDoubleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault();t.stopPropagation&&t.stopPropagation()}})})();(function(){iws.toolbar.annotation=function(t){this.page=t;this.initialize()};iws.toolbar.annotation.prototype={mappingParam:{fillColor:"fill",strokeColor:"stroke",fontColor:"fill"},mappingObject:{path:"annotDrawFree",line:"annotDrawLine",rect:"annotDrawRect",text:"annotDrawText"},configProperty:{strokeWidth:{value:".js-selected-properties-stroke-width-value",parent:".js-selected-properties-stroke-width"},strokeColor:{value:".js-selected-properties-stroke-color-value",parent:".js-selected-properties-stroke-color"},fillColor:{value:".js-selected-properties-fill-color-value",parent:".js-selected-properties-fill-color"},backgroundColor:{value:".js-selected-properties-background-color-value",parent:".js-selected-properties-background-color"},fontFamily:{value:".js-selected-properties-font-family-value",parent:".js-selected-properties-font-family"},fontColor:{value:".js-selected-properties-font-color-value",parent:".js-selected-properties-font-color"},fontSize:{value:".js-selected-properties-font-size-value",parent:".js-selected-properties-font-size"},fontStyle:{value:".js-selected-properties-font-style-value",parent:".js-selected-properties-font-style"},fontWeight:{value:".js-selected-properties-font-weight-value",parent:".js-selected-properties-font-weight"}},initialize:function(){this._makeProperties();this._makeToolbar();this._eventListen();var t=function(t){return function(e){var i=this._getDomElementValue($(e.target));var n=this.properties[t](i);var s=this.page.getActiveObject();if(s){s.set(this.mappingParam[t]||t,n);this.page.renderAll()}}};this._eachPropertyConfig(function(e,i){var n=$(i.value);var s=this.properties[e]();n.change(t(e).bind(this));this._setDomElementValue(n,s)}.bind(this));this._updateProperty("",[])},getInitParam:function(t){var e=this._toolProperties(t);var i={};e.forEach(function(t){var e=this.mappingParam[t]||t;var n=this.properties[t]();i[e]=n}.bind(this));return i},_makeProperties:function(){var t=function(t){this.parser=t.parser||function(t){return t};this.initial=t.initial};var e={};var i={fillColor:new t({initial:"rgba(0, 0, 200, 0.5)"}),strokeColor:new t({initial:"red"}),strokeWidth:new t({initial:2,parser:function(t){return parseInt(t,10)}}),fontFamily:new t({initial:"sans-serif"}),fontSize:new t({initial:16,parser:function(t){return parseInt(t,10)}}),fontStyle:new t({initial:"normal"}),fontWeight:new t({initial:"normal"}),fontColor:new t({initial:"black"}),backgroundColor:new t({initial:"rgba(240, 240, 240, 0.9)"})};for(var n in i){if(i.hasOwnProperty(n)){var s=i[n];e[n]=function(t,e){var i=e.initial;return function(n){if(typeof n!="undefined"){i=e.parser(n);this.fire("property:change",t)}return i}}(n,s).bind(this)}}this.properties=e},_setDomElementValue:function(t,e){if(e===null||e=="none"){return}if(t.is('[type="checkbox"]')){t.prop("checked",e==t.val())}else{t.val((e||"").toString())}t.trigger("change")},_getDomElementValue:function(t){if(t.is('[type="checkbox"]')){if(t.prop("checked")){return t.val()}else{return"normal"}}else{return t.val()}},_toolProperties:function(t){switch(t){case"annotDrawFree":case"annotDrawLine":return["strokeColor","strokeWidth"];case"annotDrawRect":return["fillColor","strokeColor","strokeWidth"];case"annotDrawText":return["fontColor","backgroundColor","fontFamily","fontStyle","fontSize","fontWeight"];default:return[]}},_eachPropertyConfig:function(t){for(var e in this.configProperty){if(this.configProperty.hasOwnProperty(e)){t(e,this.configProperty[e])}}},_updateDOM:function(t){var e=this.mappingObject[t.target.type]||"";var i={};var n=this._toolProperties(e);n.forEach(function(e){var n=this.mappingParam[e]||e;i[e]=t.target.get(n)}.bind(this));this._updateProperty(e,i)},_updateProperty:function(t,e){var i=this._toolProperties(t);this._eachPropertyConfig(function(t,n){if(i.indexOf(t)>=0){this.property.querySelectorAll(n.parent).forEach(function(t){t.style.display=""});if(typeof e!=="undefined")this._setDomElementValue($(n.value),e[t])}else{this.property.querySelectorAll(n.parent).forEach(function(t){t.style.display="none"})}}.bind(this))},_makeToolbar:function(){this.annotToolbarEl=iws.util.makeElement("div",{class:"pop-annotation"});this.page.pageContainer.appendChild(this.annotToolbarEl);this.__makeDomTool();this.__makeDomProperty()},__makeDomTool:function(){this.poptool=iws.util.makeElement("div",{class:"pop-tool",id:"pop-tool",draggable:"false"});this.annotToolbarEl.appendChild(this.poptool);this.poptool.innerHTML='<div id="pop-command">'+"<h3>Tool</h3>"+'<div class="popbtn-group-v">'+'<button class="popbtn" id="annotSelect" title="Select annotation"><i class="vIcon-Select"></i></button>'+'<button class="popbtn" id="annotDrawFree" title="Draw freely"><i class="vIcon-DrawFree"></i></button>'+'<button class="popbtn" id="annotDrawLine" title="Draw line"><i class="vIcon-DrawLine"></i></button>'+'<button class="popbtn" id="annotDrawRect" title="Draw rectangle"><i class="vIcon-DrawRect"></i></button>'+'<button class="popbtn" id="annotDrawText" title="Write memo"><i class="vIcon-DrawText"></i></button>'+"</div>"+"</div>"},__makeDomProperty:function(){this.property=iws.util.makeElement("div",{class:"pop-property"});this.annotToolbarEl.appendChild(this.property);this.property.innerHTML="<h3>Property</h3>"+"<dl>"+'<dt class="js-selected-properties-stroke-width">Stroke width</dt>'+'<dd class="js-selected-properties-stroke-width">'+'<select class="js-selected-properties-stroke-width-value property-span">'+'<option value="1">1</option>'+'<option value="2">2</option>'+'<option value="3">3</option>'+'<option value="4">4</option>'+'<option value="5">5</option>'+"</select>"+"</dd>"+'<dt class="js-selected-properties-fill-color">Fill color</dt>'+'<dd class="js-selected-properties-fill-color">'+'<input type="text" class="js-selected-properties-fill-color-value property-span js-color"/>'+"</dd>"+'<dt class="js-selected-properties-stroke-color">Stroke color</dt>'+'<dd class="js-selected-properties-stroke-color">'+'<input type="text" class="js-selected-properties-stroke-color-value property-span js-color"/>'+"</dd>"+'<dt class="js-selected-properties-font-color">font Color</dt>'+'<dd class="js-selected-properties-font-color">'+'<input type="text" class="js-selected-properties-font-color-value property-span js-color"/>'+"</dd>"+'<dt class="js-selected-properties-background-color">background</dt>'+'<dd class="js-selected-properties-background-color">'+'<input type="text" class="js-selected-properties-background-color-value property-span js-color"/>'+"</dd>"+'<dt class="js-selected-properties-font-size">Font Size</dt>'+'<dd class="js-selected-properties-font-size">'+'<select type="text" class="js-selected-properties-font-size-value property-span">'+'<option value="16">16</option>'+'<option value="24">24</option>'+'<option value="36">36</option>'+'<option value="48">48</option>'+'<option value="64">64</option>'+'<option value="72">72</option>'+"</select>"+"</dd>"+'<dt class="js-selected-properties-font-style">Italic</dt>'+'<dd class="js-selected-properties-font-style">'+'<input class="popbtn js-selected-properties-font-style-value" type="checkbox" value="italic"/><i class="icon-italic"></i>'+"</dd>"+'<dt class="js-selected-properties-font-weight">Bold</dt>'+'<dd class="js-selected-properties-font-weight">'+'<input class="popbtn js-selected-properties-font-weight-value" type="checkbox" value="bold"/><i class="icon-bold"></i>'+"</dd>"+"</dl>";$(this.property).find(".js-color").each(function(t,e){var i=$(e);if(typeof i.spectrum=="function"){i.spectrum({showPalette:true,palette:[["white","black"],["blue","CornflowerBlue"],["red","Coral"],["yellow","Chartreuse"],["Grey","Green"],["Peru","Pink"],["rgb(255, 128, 0)","hsv 100 70 50"]],showAlpha:true,preferredFormat:"rgb"})}i.change(function(){var t=i.val();if(typeof i.spectrum=="function"){if(i.spectrum("get")!=t){i.spectrum("set",t)}}})})},_eventListen:function(){var t=this.poptool.querySelectorAll(".popbtn");var e=this;t.forEach(function(t){t.addEventListener("click",function(){e.page.setTrackMode(t.id,true)})});this.page.observe("after:render",function(){if(this.page.imageCtrl.isValid()){this.annotToolbarEl.querySelectorAll("*").forEach(function(t){t.removeAttribute("disabled")})}else{this.annotToolbarEl.querySelectorAll("*").forEach(function(t){t.setAttribute("disabled",true)})}}.bind(this));this.page.observe("annotation:popup-visible",function(t){if(t==="show"){this.annotToolbarEl.style.display="block"}if(t==="hide"){this.annotToolbarEl.style.display="none"}}.bind(this));this.page.observe("mouseTrackChange",function(t){this.poptool.querySelectorAll(".popbtn").forEach(function(t){t.removeClass("toggled")});var e=this.poptool.querySelector("#"+t);if(e)e.addClass("toggled");this.fire("tool:change",t)}.bind(this));this.observe("tool:change",function(t){if(t!=="annotSelect"){this.page.discardActiveObject();this.page.renderAll()}this._updateProperty(t)});this.page.observe("object:selected",function(t){this._updateDOM(t)}.bind(this));this.page.observe("selection:cleared",function(t){this._updateProperty("")}.bind(this))}};iws.util.extend(iws.toolbar.annotation.prototype,iws.Observable)})();(function(){iws.toolbar.page=function(t){this.page=t;this.initialize()};iws.toolbar.page.prototype={toolbarMargin:8,trackModeMap:["move","range","glass","annotSelect","annotPath","annotLine","annotRect","annotText"],trackModeMapping:{move:"trackMove",range:"trackRange",glass:"trackGlass"},showAnnotationMap:["pageToolbarButton_AnnotationShow","pageToolbarButton_AnnotationHide"],initialize:function(){this._makeToolbar();this.page.observe("toolbar:visible",function(t){if(t){this.toolbarContainerEl.style.display="block"}else{this.toolbarContainerEl.style.display="none"}}.bind(this))},isVisible:function(){if(this.toolbarContainerEl.style.display!=="none")return true;else return false},height:function(){var t=this.toolbarContainerEl.clientHeight;return t},_makeToolbar:function(){this.toolbarContainerEl=iws.util.makeElement("div",{class:"pageToolbar_Container"});var t=this.page.pageContainer.parentElement;t.insertBefore(this.toolbarContainerEl,this.page.pageContainer);this.toolbarFrameEl=iws.util.makeElement("div",{class:"pageToolbar_Frame"});this.toolbarContainerEl.appendChild(this.toolbarFrameEl);this.__makeToolbarLeft();this.__makeToolbarZoom();this.__makeToolbarRight()},__makeToolbarLeft:function(){this.toolbarLeft=iws.util.makeElement("div",{class:"pageToolbar"});this.leftOffset=1;this.toolbarLeft.style.left=this.leftOffset+"px";this.toolbarFrameEl.appendChild(this.toolbarLeft);this.toolbarLeft.innerHTML='<button id="scalePlus" type="button" class="pageToolbarButton" title="ZoomIn"><i class="pageToolbarButton_scalePlus"></i></button>'+'<button id="scaleMinus" type="button" class="pageToolbarButton" title="ZoomOut"><i class="pageToolbarButton_scaleMinus"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<button id="fitWidth" type="button" class="pageToolbarButton" title="Fix Width"><i class="pageToolbarButton_fitWidth"></i></button>'+'<button id="fitHeight" type="button" class="pageToolbarButton" title="Fix Height"><i class="pageToolbarButton_fitHeight"></i></button>'+'<button id="fitAuto" type="button" class="pageToolbarButton" title="Fix Auto"><i class="pageToolbarButton_fitAuto"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<button id="rotate270" type="button" class="pageToolbarButton" title="Rotate 270"><i class="pageToolbarButton_rotate270"></i></button>'+'<button id="rotate90" type="button" class="pageToolbarButton" title="Rotate 90"><i class="pageToolbarButton_rotate90"></i></button>'+'<button id="rotate180" type="button" class="pageToolbarButton" title="Rotate 180"><i class="pageToolbarButton_rotate180"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<div class="trackModeGroup" style="display:inline-block;"> '+'<button id="trackMove" type="button" class="pageToolbarButton" title="Move Image" value="move"><i class="pageToolbarButton_trackMove"></i> </button>'+'<button id="trackRange" type="button" class="pageToolbarButton" title="Select area" value="range"><i class="pageToolbarButton_trackRange"></i> </button>'+'<button id="trackGlass" type="button" class="pageToolbarButton" title="Magnifying Glass" value="glass"><i class="pageToolbarButton_trackGlass"></i> </button>'+"</div>";
this.toolbarLeft.querySelector("#scalePlus").addEventListener("click",function(){this.page.zoomIn()}.bind(this),false);this.toolbarLeft.querySelector("#scaleMinus").addEventListener("click",function(){this.page.zoomOut()}.bind(this),false);this.toolbarLeft.querySelector("#fitWidth").addEventListener("click",function(){this.page.setFitMode({name:"width"})}.bind(this),false);this.toolbarLeft.querySelector("#fitHeight").addEventListener("click",function(){this.page.setFitMode({name:"height"})}.bind(this),false);this.toolbarLeft.querySelector("#fitAuto").addEventListener("click",function(){this.page.setFitMode({name:"auto"})}.bind(this),false);this.toolbarLeft.querySelector("#rotate270").addEventListener("click",function(){this.page.setRotate(270)}.bind(this),false);this.toolbarLeft.querySelector("#rotate90").addEventListener("click",function(){this.page.setRotate(90)}.bind(this),false);this.toolbarLeft.querySelector("#rotate180").addEventListener("click",function(){this.page.setRotate(180)}.bind(this),false);this.toolbarLeft.querySelector("#trackMove").addEventListener("click",function(){this.page.setTrackMode("move")}.bind(this),false);this.toolbarLeft.querySelector("#trackRange").addEventListener("click",function(){this.page.setTrackMode("range")}.bind(this),false);this.toolbarLeft.querySelector("#trackGlass").addEventListener("click",function(){this.page.setTrackMode("glass")}.bind(this),false);this.buttonTrackModeGroup=this.toolbarLeft.querySelector(".trackModeGroup");this.page.observe("mouseTrackChange",function(t){if(this.trackModeMap.indexOf(t)>=0){this.buttonTrackModeGroup.querySelectorAll(".pageToolbarButton").forEach(function(t){t.removeClass("toggled")});var e=this.buttonTrackModeGroup.querySelector("#"+this.trackModeMapping[t]);if(e)e.addClass("toggled")}}.bind(this))},__makeToolbarZoom:function(){this.toolbarZoom=iws.util.makeElement("div",{class:"pageToolbar"});this.leftOffset+=this.toolbarLeft.clientWidth+this.toolbarMargin;this.toolbarZoom.style.left=this.leftOffset+"px";this.toolbarFrameEl.appendChild(this.toolbarZoom);this.toolbarZoom.innerHTML='<span id="scaleSelectContainer" class="iws-dropdownToolbarButton">'+'<select id="scaleSelect" title="Zoom" tabindex="23" data-l10n-id="zoom">'+'<option id="pageAutoOption"    title="" value="auto" >Fit auto</option>'+'<option id="pageFitWidthOption" title="" value="width" >Fit Width</option>'+'<option id="pageFitHeightOption" title="" value="height" >Fit Height</option>'+'<option id="customScaleOption" title="" value="custom">0%</option>'+'<option title="" value="0.25"  >25%</option>'+'<option title="" value="0.5"   >50%</option>'+'<option title="" value="0.75"  >75%</option>'+'<option title="" value="1"     >100%</option>'+'<option title="" value="1.25"  >125%</option>'+'<option title="" value="1.5"   >150%</option>'+'<option title="" value="2"     >200%</option>'+'<option title="" value="3"     >300%</option>'+'<option title="" value="4"     >400%</option>'+"</select>"+"</span>";var t=this;this.toolbarZoom.querySelector("#scaleSelect").addEventListener("change",function(e){switch(this.value){case"auto":case"width":case"height":t.page.setFitMode({name:this.value});break;default:t.page._zoom({name:"custom",scale:this.value})}},false);function e(t){var e=this.toolbarZoom.querySelector("#scaleSelect").options;var i=false;for(var n=0,s=e.length;n<s;n++){var o=e[n];if(o.value!==t){o.selected=false;continue}o.selected=true;i=true}return i}function i(){var t=this.toolbarZoom.querySelector("#scaleSelect");var i=this.page.getFitMode();var n="";switch(i.name){case"width":case"height":case"auto":n=i.name;break;case"scale":n=i.scale;break}var s=e.call(this,n);if(!s){var o=document.getElementById("customScaleOption");o.textContent="scale";o.selected=true}}this.page.observe("page:zoom",i.bind(this));this.page.observe("page:fitMode",i.bind(this))},__makeToolbarRight:function(){this.toolbarRight=iws.util.makeElement("div",{class:"pageToolbar"});this.toolbarRight.style.right="1px";this.toolbarFrameEl.appendChild(this.toolbarRight);this.toolbarRight.innerHTML='<button id="showAnnotation" type="button" class="pageToolbarButton" title="Show annotation tool" value="show"><i class="pageToolbarButton_AnnotationHide"></i></button>'+'<button id="fullDisplay" type="button" class="pageToolbarButton" title="Full screen"><i class="pageToolbarButton_FullScreen"></i></button>';this.page.observe("annotation:use",function(t){var e=this.toolbarRight.querySelector("#showAnnotation");if(t===true){e.style.visibility="visible"}else{e.style.visibility="hidden"}}.bind(this));this.page.observe("annotation:popup-visible",function(t){var e=this.toolbarRight.querySelector("#showAnnotation");var i=e.querySelector("i");if(t==="show"){i.removeClass(this.showAnnotationMap[0]);i.addClass(this.showAnnotationMap[1])}if(t==="hide"){i.removeClass(this.showAnnotationMap[1]);i.addClass(this.showAnnotationMap[0])}}.bind(this));this.toolbarRight.querySelector("#showAnnotation").addEventListener("click",function(){var t=this.toolbarRight.querySelector("#showAnnotation").value;if(t==="show"){this.page.showAnnotation("hide");this.toolbarRight.querySelector("#showAnnotation").value="hide"}else{this.page.showAnnotation("show");this.toolbarRight.querySelector("#showAnnotation").value="show"}}.bind(this),false);this.toolbarRight.querySelector("#fullDisplay").addEventListener("click",function(){iws.util.fullscreen.toggleFullScreen(this.page.fullScreenEl)}.bind(this),false)}}})();(function(){"use strict";function t(){this.initialize.apply(this,arguments)}iws.multiPage=iws.util.createInheritClass(t,iws.Observable,{thumb:null,page:null,thumbShow:true,thumbWidth:200,thumbHeight:160,saveType:"annotation",useAnnotation:true,reSampleUse:true,reSampleRate:.8,reSampleFilter:"convolveFloat32",initialize:function(t,e){e||(e={});this._initOptions(e);this._initWrapperElement(t);this._addThumb();this._addPage();this.mainToolbar=new iws.toolbar.multiPage(this);this.setTrackMode("move");this.fire("annotation:use",this.useAnnotation);this.showAnnotation(this.useAnnotation?"show":"hide");this._initEvent();this.resizer=new iws.util.resize(this.fullScreenEl,this._reSize.bind(this));this._reSize()},_initWrapperElement:function(t){this.wrapperEl=t;iws.util.makeElementUnselectable(this.wrapperEl);this.fullScreenEl=iws.util.makeElement("div",{class:"multiPage-fullScreen"});this.fullScreenEl.style.position="relative";this.fullScreenEl.style.width="100%";this.fullScreenEl.style.height="100%";this.fullScreenEl.style.backgroundColor="rgba(240,240,240,0.9)";this.wrapperEl.appendChild(this.fullScreenEl);this.pageContainerEl=iws.util.makeElement("div",{class:"multiPage-container"});this.pageContainerEl.style.position="relative";this.pageContainerEl.style.backgroundColor="#f1f1f1";this.fullScreenEl.appendChild(this.pageContainerEl);this.thumbEl=iws.util.makeElement("div",{class:"iws-thumbnail"});this.thumbEl.style.position="absolute";this.thumbEl.style.backgroundColor="#444444";this.thumbEl.style.top=this.thumbEl.style.bottom=this.thumbEl.style.left="0";this.thumbEl.style.width=this.thumbWidth+"px";this.thumbEl.style.overflow="auto";this.thumbEl.style.outline="none";this.pageContainerEl.appendChild(this.thumbEl);this.pageEl=iws.util.makeElement("div",{class:"page"});this.pageEl.style.position="absolute";this.pageEl.style.backgroundColor="#777777";this.pageEl.style.top=this.pageEl.style.bottom=this.pageEl.style.right=0;this.pageEl.style.left=this.thumbWidth+"px";this.pageContainerEl.appendChild(this.pageEl);this._thumbShow()},_initOptions:function(t){for(var e in t){this[e]=t[e]}},_addThumb:function(){var t={debug:false,direction:"V",path:this.path,beforehandLoad:false,plugin:false};this.thumb=iwsT.Thumbnail(this.thumbEl,t);this.thumb.setHeight(this.thumbHeight)},_addPage:function(){var t={autoResize:false,fitMode:this.fitMode,path:this.path,visibleToolbar:false,useAnnotation:this.useAnnotation,reSampleUse:this.reSampleUse,reSampleRate:this.reSampleRate,reSampleFilter:this.reSampleFilter};this.page=new iws.PageAnnotation(this.pageEl,t);var e=iws.util.string.combinePath(this.path,"img/iws.viewer.background.png");this.page.setBackgroundColor({source:e});this.page.pageKey="";this.page.observe("mouseTrackChange",function(t){this.fire("mouseTrackChange",t)}.bind(this));this.page.observe("page:zoom",function(t){this.fire("page:zoom",t)}.bind(this));this.page.observe("page:fitMode",function(t){this.fire("page:fitMode",t)}.bind(this));this.page.observe("page:swipe_left",function(t){this.pageNext()}.bind(this));this.page.observe("page:swipe_right",function(t){this.pagePrev()}.bind(this))},_initEvent:function(){this.thumb.setCallbackLoad(function(t,e,i){});this.thumb.setCallbackClick(function(t,e,i){if(t>=0){var n=this.thumb.findIndex(this.page.pageKey);if(n!==-1){var s=this.thumb.getItem(n);s.annotation=this.page.getAnnotation()}this.fire("pageNumberChange",t);this.page.pageKey=e.uniqueId;this.page.setRawData(e.pagebuffer,e.pageInfo.width,e.pageInfo.height,e.angle);this.page.setAnnotation(e.annotation)}else{this.page.clear()}}.bind(this));function t(t){this.fire("mouse:drawRanged",t)}this.page.observe("mouse:drawRanged",t.bind(this))},_thumbShow:function(){if(this.thumbShow){this.thumbEl.style.width=this.thumbWidth+"px";this.pageEl.style.left=this.thumbWidth+"px"}else{this.thumbEl.style.width="0";this.pageEl.style.left="0"}this._reSize()},_reSize:function(){var t=this.fullScreenEl.clientWidth;var e=this.fullScreenEl.clientHeight;var i=t;var n=e;if(this.mainToolbar&&this.mainToolbar.isVisible()){n=e-this.mainToolbar.height()}this.pageContainerEl.style.width=i+"px";this.pageContainerEl.style.height=n+"px";var s=window.matchMedia("(max-width: 640px)");if(s&&s.matches){this.thumbEl.style.width="0";this.pageEl.style.left="0"}else{if(this.thumbShow){this.thumbEl.style.width=this.thumbWidth+"px";this.pageEl.style.left=this.thumbWidth+"px"}else{this.thumbEl.style.width="0";this.pageEl.style.left="0"}}this.page&&this.page._reSize()},clear:function(){this.thumb.init();this.page.clear()},loadFile:function(t){this.thumb.load(t)},appendFile:function(t){this.thumb.append(t)},loadUrl:function(t){iws.util.urlDownload(t,function(t){this.thumb.load(t)}.bind(this))},appendUrl:function(t){iws.util.urlDownload(t,function(t){this.thumb.append(t)}.bind(this))},loadAnnotation:function(t){this.thumb.annotationLoad(t);var e=this.thumb.findIndex(this.page.pageKey);if(e>=0){var i=this.thumb.getItem(e).annotation;this.page.setAnnotation(i)}},saveAnnotation:function(){var t=this.thumb.findIndex(this.page.pageKey);if(t!==-1){var e=this.thumb.getItem(t);e.annotation=this.page.getAnnotation()}this.thumb.annotationSave(function(t){var e=t===""?false:true;this.fire("saveAnnotation",{success:e,annotation:t})}.bind(this))},saveImage:function(){var t=function(t,e){this.fire("saveImage",{success:t,byteArray:e})};this.thumb.pageSave(5,t)},_zoom:function(t){this.page._zoom(t)},zoomIn:function(){this.page.zoomIn()},zoomOut:function(){this.page.zoomOut()},rotate:function(t){this.thumb.rotate(t);this.page.setRotate(t)},setFitMode:function(t){this.page.setFitMode(t)},getFitMode:function(){return this.page.getFitMode()},setTrackMode:function(t){this.page.setTrackMode(t)},pagePrev:function(){this.thumb.pageIndex=this.thumb.pageIndex-1},pageNext:function(){this.thumb.pageIndex=this.thumb.pageIndex+1},pageCount:function(){return this.thumb.pageCount()},showAnnotation:function(t){this.page.fire("annotation:popup-visible",t);this.fire("annotation:popup-visible",t)}});iws.multiPage.prototype.__defineGetter__("pageIndex",function(){return this.thumb.pageIndex});iws.multiPage.prototype.__defineSetter__("pageIndex",function(t){this.thumb.pageIndex=t})})();(function(){iws.toolbar.multiPage=function(t){this.viewer=t;this.initialize()};iws.toolbar.multiPage.prototype={toolbarMargin:8,trackModeMap:["move","range","glass","annotSelect","annotPath","annotLine","annotRect","annotText"],trackModeMapping:{move:"trackMove",range:"trackRange",glass:"trackGlass"},showAnnotationMap:["pageToolbarButton_AnnotationShow","pageToolbarButton_AnnotationHide"],initialize:function(){this._makeToolbar()},isVisible:function(){if(this.toolbarContainerEl.style.display!=="none")return true;else return false},height:function(){var t=this.toolbarContainerEl.clientHeight;return t},_makeToolbar:function(){this.toolbarContainerEl=iws.util.makeElement("div",{class:"pageToolbar_Container"});var t=this.viewer.pageContainerEl.parentElement;t.insertBefore(this.toolbarContainerEl,this.viewer.pageContainerEl);this.toolbarFrameEl=iws.util.makeElement("div",{class:"pageToolbar_Frame"});this.toolbarContainerEl.appendChild(this.toolbarFrameEl);this.__makeToolbarCommon(this.toolbarFrameEl);this.__makeToolbarPage(this.toolbarFrameEl);this.__makeToolbarMove(this.toolbarFrameEl);this.__makeToolbarSize(this.toolbarFrameEl);this.__makeToolbarZoom(this.toolbarFrameEl)},__makeToolbarCommon:function(t){this.toolbarCommon=iws.util.makeElement("div",{class:"pageToolbar common"});t.appendChild(this.toolbarCommon);this.toolbarCommon.innerHTML='<button id="thumbtoggle" type="button" class="pageToolbarButton" title="Show thumbnail"><i class="pageToolbarButton_thumbtoggle"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<button id="print" type="button" class="pageToolbarButton" title="Print"><i class="pageToolbarButton_print"></i></button>'+'<button id="save" type="button" class="pageToolbarButton" title="Save"><i class="pageToolbarButton_save"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<button id="checkVisible" type="button" class="pageToolbarButton" title="Show check"><i class="pageToolbarButton_checkVisible"></i></button>'+'<button id="delete" type="button" class="pageToolbarButton" title="Delete"><i class="pageToolbarButton_delete"></i></button>';this.toolbarCommon.querySelector("#thumbtoggle").addEventListener("click",function(){this.viewer.thumbShow=!this.viewer.thumbShow;this.viewer._thumbShow()}.bind(this),false);this.toolbarCommon.querySelector("#print").addEventListener("click",function(){this.viewer.thumb.print()}.bind(this),false);this.toolbarCommon.querySelector("#save").addEventListener("click",function(){if(this.viewer.saveType==="image"){this.viewer.saveImage()}else if(this.viewer.saveType==="annotation"){this.viewer.saveAnnotation()}}.bind(this),false);this.toolbarCommon.querySelector("#checkVisible").addEventListener("click",function(){this.viewer.thumb.selectVisible=!this.viewer.thumb.selectVisible}.bind(this),false);this.toolbarCommon.querySelector("#delete").addEventListener("click",function(){this.viewer.thumb.remove()}.bind(this),false)},__makeToolbarPage:function(t){this.toolbarPage=iws.util.makeElement("div",{class:"pageToolbar page"});t.appendChild(this.toolbarPage);this.toolbarPage.innerHTML='<button id="scalePlus" type="button" class="pageToolbarButton" title="ZoomIn"><i class="pageToolbarButton_scalePlus"></i></button>'+'<button id="scaleMinus" type="button" class="pageToolbarButton" title="ZoomOut"><i class="pageToolbarButton_scaleMinus"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<button id="fitWidth" type="button" class="pageToolbarButton" title="Fix Width"><i class="pageToolbarButton_fitWidth"></i></button>'+'<button id="fitHeight" type="button" class="pageToolbarButton" title="Fix Height"><i class="pageToolbarButton_fitHeight"></i></button>'+'<button id="fitAuto" type="button" class="pageToolbarButton" title="Fix Auto"><i class="pageToolbarButton_fitAuto"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<button id="rotate270" type="button" class="pageToolbarButton" title="Rotate 270"><i class="pageToolbarButton_rotate270"></i></button>'+'<button id="rotate90" type="button" class="pageToolbarButton" title="Rotate 90"><i class="pageToolbarButton_rotate90"></i></button>'+'<button id="rotate180" type="button" class="pageToolbarButton" title="Rotate 180"><i class="pageToolbarButton_rotate180"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<div class="trackModeGroup" style="display:inline-block;"> '+'<button id="trackMove" type="button" class="pageToolbarButton" title="Move Image" value="move"><i class="pageToolbarButton_trackMove"></i> </button>'+'<button id="trackRange" type="button" class="pageToolbarButton" title="Select area" value="range"><i class="pageToolbarButton_trackRange"></i> </button>'+'<button id="trackGlass" type="button" class="pageToolbarButton" title="Magnifying Glass" value="glass"><i class="pageToolbarButton_trackGlass"></i> </button>'+"</div>";this.toolbarPage.querySelector("#scalePlus").addEventListener("click",function(){this.viewer.zoomIn()}.bind(this),false);this.toolbarPage.querySelector("#scaleMinus").addEventListener("click",function(){this.viewer.zoomOut()}.bind(this),false);this.toolbarPage.querySelector("#fitWidth").addEventListener("click",function(){this.viewer.setFitMode({name:"width"})}.bind(this),false);this.toolbarPage.querySelector("#fitHeight").addEventListener("click",function(){this.viewer.setFitMode({name:"height"})}.bind(this),false);this.toolbarPage.querySelector("#fitAuto").addEventListener("click",function(){this.viewer.setFitMode({name:"auto"})}.bind(this),false);this.toolbarPage.querySelector("#rotate270").addEventListener("click",function(){this.viewer.rotate(270)}.bind(this),false);this.toolbarPage.querySelector("#rotate90").addEventListener("click",function(){this.viewer.rotate(90)}.bind(this),false);this.toolbarPage.querySelector("#rotate180").addEventListener("click",function(){this.viewer.rotate(180)}.bind(this),false);this.toolbarPage.querySelector("#trackMove").addEventListener("click",function(){this.viewer.setTrackMode("move")}.bind(this),false);this.toolbarPage.querySelector("#trackRange").addEventListener("click",function(){this.viewer.setTrackMode("range")}.bind(this),false);this.toolbarPage.querySelector("#trackGlass").addEventListener("click",function(){this.viewer.setTrackMode("glass")}.bind(this),false);this.buttonTrackModeGroup=this.toolbarPage.querySelector(".trackModeGroup");this.viewer.observe("mouseTrackChange",function(t){if(this.trackModeMap.indexOf(t)>=0){this.buttonTrackModeGroup.querySelectorAll(".pageToolbarButton").forEach(function(t){t.removeClass("toggled")});var e=this.buttonTrackModeGroup.querySelector("#"+this.trackModeMapping[t]);if(e)e.addClass("toggled")}}.bind(this))},__makeToolbarMove:function(t){this.toolbarMove=iws.util.makeElement("div",{class:"pageToolbar move"});t.appendChild(this.toolbarMove);this.toolbarMove.innerHTML='<button id="prev" type="button" class="pageToolbarButton" title="Go to previous page"><i class="pageToolbarButton_prev"></i></button>'+'<input type="text" id="pageNumber" class="pageToolbarField pageNumber" value="" size="4" />'+'<button id="next" type="button" class="pageToolbarButton" title="Go to next page"><i class="pageToolbarButton_next"></i></button>';this.toolbarMove.querySelector("#prev").addEventListener("click",function(){this.viewer.pagePrev()}.bind(this),false);this.toolbarMove.querySelector("#next").addEventListener("click",function(){this.viewer.pageNext()}.bind(this),false);this.viewer.observe("pageNumberChange",function(t){this.toolbarMove.querySelector("#pageNumber").value=t+1+"/"+this.viewer.pageCount()}.bind(this))},__makeToolbarSize:function(t){this.toolbarRight=iws.util.makeElement("div",{class:"pageToolbar size"});this.toolbarFrameEl.appendChild(this.toolbarRight);this.toolbarRight.innerHTML='<button id="showAnnotation" type="button" class="pageToolbarButton" title="Show annotation tool" value="show"><i class="pageToolbarButton_AnnotationHide"></i></button>'+'<button id="fullDisplay" type="button" class="pageToolbarButton" title="Full screen"><i class="pageToolbarButton_FullScreen"></i></button>';this.viewer.observe("annotation:use",function(t){var e=this.toolbarRight.querySelector("#showAnnotation");if(t===true){e.style.display="inline-block"}else{e.style.display="none"}}.bind(this));this.viewer.observe("annotation:popup-visible",function(t){var e=this.toolbarRight.querySelector("#showAnnotation");var i=e.querySelector("i");if(t==="show"){i.removeClass(this.showAnnotationMap[0]);i.addClass(this.showAnnotationMap[1])}if(t==="hide"){i.removeClass(this.showAnnotationMap[1]);i.addClass(this.showAnnotationMap[0])}}.bind(this));this.toolbarRight.querySelector("#showAnnotation").addEventListener("click",function(){var t=this.toolbarRight.querySelector("#showAnnotation").value;if(t==="show"){this.viewer.showAnnotation("hide");this.toolbarRight.querySelector("#showAnnotation").value="hide"}else{this.viewer.showAnnotation("show");this.toolbarRight.querySelector("#showAnnotation").value="show"}}.bind(this),false);this.toolbarRight.querySelector("#fullDisplay").addEventListener("click",function(){iws.util.fullscreen.toggleFullScreen(this.viewer.fullScreenEl)}.bind(this),false)},__makeToolbarZoom:function(t){this.toolbarZoom=iws.util.makeElement("div",{class:"pageToolbar zoom"});t.appendChild(this.toolbarZoom);this.toolbarZoom.innerHTML='<span id="scaleSelectContainer" class="iws-dropdownToolbarButton">'+'<select id="scaleSelect" title="Zoom" tabindex="23" data-l10n-id="zoom">'+'<option id="pageAutoOption"    title="" value="auto" >Fit auto</option>'+'<option id="pageFitWidthOption" title="" value="width" >Fit Width</option>'+'<option id="pageFitHeightOption" title="" value="height" >Fit Height</option>'+'<option id="customScaleOption" title="" value="custom">0%</option>'+'<option title="" value="0.25"  >25%</option>'+'<option title="" value="0.5"   >50%</option>'+'<option title="" value="0.75"  >75%</option>'+'<option title="" value="1"     >100%</option>'+'<option title="" value="1.25"  >125%</option>'+'<option title="" value="1.5"   >150%</option>'+'<option title="" value="2"     >200%</option>'+'<option title="" value="3"     >300%</option>'+'<option title="" value="4"     >400%</option>'+"</select>"+"</span>";var e=this;this.toolbarZoom.querySelector("#scaleSelect").addEventListener("change",function(t){switch(this.value){case"auto":case"width":case"height":e.viewer.setFitMode({name:this.value});break;default:e.viewer._zoom({name:"custom",scale:this.value})}},false);function i(t){var e=this.toolbarZoom.querySelector("#scaleSelect").options;var i=false;for(var n=0,s=e.length;n<s;n++){var o=e[n];if(o.value!==t){o.selected=false;continue}o.selected=true;i=true}return i}function n(){var t=this.toolbarZoom.querySelector("#scaleSelect");var e=this.viewer.getFitMode();var n="";switch(e.name){case"width":case"height":case"auto":n=e.name;break;case"scale":n=e.scale;break}var s=i.call(this,n);if(!s){var o=document.getElementById("customScaleOption");o.textContent="scale";o.selected=true}}this.viewer.observe("page:zoom",n.bind(this));this.viewer.observe("page:fitMode",n.bind(this))}}})();