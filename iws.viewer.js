(function(t){var e=t.iws||(t.iws={});e.viewer={version:"1.3.2"};console.log("iws viewer version = "+e.viewer.version);e.debug=false;e.useAnimationFrame=true;e.mask=true;e.log=function(){var t="";for(var e=0;e<arguments.length;e++){t+=arguments[e]+" >>>> "}console.log(">>>>   iws : "+t)};e.warn=function(){var t="";for(var e=0;e<arguments.length;e++){t+=arguments[e]+" >>>> "}console.log(">>>>   iws warn!!!: "+t)};e.logger=function(e,i){function n(n,r){if(e&&t.console){r=Array.prototype.slice.call(r);r.unshift(i);console[n].apply(console,r)}}return{_log:function(){n("log",arguments)},_warn:function(){n("warn",arguments)}}};e.msie=function(){var t;var e="N/A";var i=navigator.userAgent.toLowerCase();var n=navigator.appName;if(n=="Microsoft Internet Explorer"){t="msie "}else{if(i.search("trident")>-1)t="trident/.*rv:";else if(i.search("edge/")>-1)t="edge/"}var r=new RegExp(t+"([0-9]{1,})(\\.{0,}[0-9]{0,1})");if(r.exec(i)!=null)e=RegExp.$1+RegExp.$2;return t=="msie"}();e.toolbar={};e.Observable={observe:function(t,e,i){if(!this.topics){this.topics={}}if(typeof e!=="function"){return false}if(!this.topics.hasOwnProperty(t)){this.topics[t]={}}var n=Math.random().toString(35);this.topics[t][n]=[e,!!i];return n},stopObserving:function(t){if(!this.topics){return}for(var e in this.topics){if(this.topics[e][t]){delete this.topics[e][t];return true}}return false},fire:function(t){if(!this.topics){return}if(this.topics.hasOwnProperty(t)){var e=Array.prototype.slice.call(arguments,1),i=[];for(var n in this.topics[t]){var r=this.topics[t][n];try{r[0].apply(this,e)}catch(t){console.error("viewer fire Error",t.message,t)}if(r[1])i.push(n)}if(i.length)i.forEach(this.unsubscribe)}}};e.Collection={_objects:[],add:function(){this._objects.push.apply(this._objects,arguments);if(this._onObjectAdded){for(var t=0,e=arguments.length;t<e;t++){this._onObjectAdded(arguments[t])}}this.renderAll();return this},insertAt:function(t,e,i){var n=this.getObjects();if(i){n[e]=t}else{n.splice(e,0,t)}this._onObjectAdded&&this._onObjectAdded(t);this.renderAll();return this},remove:function(){var t=this.getObjects(),e,i=false;for(var n=0,r=arguments.length;n<r;n++){e=t.indexOf(arguments[n]);if(e!==-1){i=true;t.splice(e,1);this._onObjectRemoved&&this._onObjectRemoved(arguments[n])}}i&&this.renderAll();return this},forEachObject:function(t,e){var i=this.getObjects();for(var n=0,r=i.length;n<r;n++){t.call(e,i[n],n,i)}return this},getObjects:function(t){if(typeof t==="undefined"){return this._objects}return this._objects.filter(function(e){return e.type===t})},item:function(t){return this.getObjects()[t]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(t){return this.getObjects().indexOf(t)>-1},complexity:function(){return this.getObjects().reduce(function(t,e){t+=e.complexity?e.complexity():0;return t},0)}};(function(t){"use strict";var e=t.iws||(t.iws={});if(e.Point){e.warn("iws.Point is already defined");return}e.Point=i;function i(t,e){this.x=t;this.y=e}i.prototype={type:"point",constructor:i,add:function(t){return new i(this.x+t.x,this.y+t.y)},addEquals:function(t){this.x+=t.x;this.y+=t.y;return this},scalarAdd:function(t){return new i(this.x+t,this.y+t)},scalarAddEquals:function(t){this.x+=t;this.y+=t;return this},subtract:function(t){return new i(this.x-t.x,this.y-t.y)},subtractEquals:function(t){this.x-=t.x;this.y-=t.y;return this},scalarSubtract:function(t){return new i(this.x-t,this.y-t)},scalarSubtractEquals:function(t){this.x-=t;this.y-=t;return this},multiply:function(t){return new i(this.x*t,this.y*t)},multiplyEquals:function(t){this.x*=t;this.y*=t;return this},divide:function(t){return new i(this.x/t,this.y/t)},divideEquals:function(t){this.x/=t;this.y/=t;return this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,e){if(typeof e==="undefined"){e=.5}e=Math.max(Math.min(1,e),0);return new i(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return this.lerp(t)},min:function(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){this.x=t;this.y=e;return this},setX:function(t){this.x=t;return this},setY:function(t){this.y=t;return this},setFromPoint:function(t){this.x=t.x;this.y=t.y;return this},swap:function(t){var e=this.x,i=this.y;this.x=t.x;this.y=t.y;t.x=e;t.y=i},clone:function(){return new i(this.x,this.y)}}})(t);(function(t){"use strict";var e=t.iws||(t.iws={});if(e.Intersection){e.warn("iws.Intersection is already defined");return}function i(t){this.status=t;this.points=[]}e.Intersection=i;e.Intersection.prototype={constructor:i,appendPoint:function(t){this.points.push(t);return this},appendPoints:function(t){this.points=this.points.concat(t);return this}};e.Intersection.intersectLineLine=function(t,n,r,s){var o,a=(s.x-r.x)*(t.y-r.y)-(s.y-r.y)*(t.x-r.x),l=(n.x-t.x)*(t.y-r.y)-(n.y-t.y)*(t.x-r.x),h=(s.y-r.y)*(n.x-t.x)-(s.x-r.x)*(n.y-t.y);if(h!==0){var u=a/h,c=l/h;if(0<=u&&u<=1&&0<=c&&c<=1){o=new i("Intersection");o.appendPoint(new e.Point(t.x+u*(n.x-t.x),t.y+u*(n.y-t.y)))}else{o=new i}}else{if(a===0||l===0){o=new i("Coincident")}else{o=new i("Parallel")}}return o};e.Intersection.intersectLinePolygon=function(t,e,n){var r=new i,s=n.length,o,a,l;for(var h=0;h<s;h++){o=n[h];a=n[(h+1)%s];l=i.intersectLineLine(t,e,o,a);r.appendPoints(l.points)}if(r.points.length>0){r.status="Intersection"}return r};e.Intersection.intersectPolygonPolygon=function(t,e){var n=new i,r=t.length;for(var s=0;s<r;s++){var o=t[s],a=t[(s+1)%r],l=i.intersectLinePolygon(o,a,e);n.appendPoints(l.points)}if(n.points.length>0){n.status="Intersection"}return n};e.Intersection.intersectPolygonRectangle=function(t,n,r){var s=n.min(r),o=n.max(r),a=new e.Point(o.x,s.y),l=new e.Point(s.x,o.y),h=i.intersectLinePolygon(s,a,t),u=i.intersectLinePolygon(a,o,t),c=i.intersectLinePolygon(o,l,t),f=i.intersectLinePolygon(l,s,t),d=new i;d.appendPoints(h.points);d.appendPoints(u.points);d.appendPoints(c.points);d.appendPoints(f.points);if(d.points.length>0){d.status="Intersection"}return d}})(t);(function(t){"use strict";var e=t.iws||(t.iws={});if(e.Color){e.warn("iws.Color is already defined.");return}function i(t){if(!t){this.setSource([0,0,0,1])}else{this._tryParsingColor(t)}}e.Color=i;e.Color.prototype={_tryParsingColor:function(t){var e;if(t in i.colorNameMap){t=i.colorNameMap[t]}if(t==="transparent"){e=[255,255,255,0]}if(!e){e=i.sourceFromHex(t)}if(!e){e=i.sourceFromRgb(t)}if(!e){e=i.sourceFromHsl(t)}if(!e){e=[0,0,0,1]}if(e){this.setSource(e)}},_rgbToHsl:function(t,i,n){t/=255;i/=255;n/=255;var r,s,o,a=e.util.array.max([t,i,n]),l=e.util.array.min([t,i,n]);o=(a+l)/2;if(a===l){r=s=0}else{var h=a-l;s=o>.5?h/(2-a-l):h/(a+l);switch(a){case t:r=(i-n)/h+(i<n?6:0);break;case i:r=(n-t)/h+2;break;case n:r=(t-i)/h+4;break}r/=6}return[Math.round(r*360),Math.round(s*100),Math.round(o*100)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t=this.getSource(),e,i,n;e=t[0].toString(16);e=e.length===1?"0"+e:e;i=t[1].toString(16);i=i.length===1?"0"+i:i;n=t[2].toString(16);n=n.length===1?"0"+n:n;return e.toUpperCase()+i.toUpperCase()+n.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();e[3]=t;this.setSource(e);return this},toGrayscale:function(){var t=this.getSource(),e=parseInt((t[0]*.3+t[1]*.59+t[2]*.11).toFixed(0),10),i=t[3];this.setSource([e,e,e,i]);return this},toBlackWhite:function(t){var e=this.getSource(),i=(e[0]*.3+e[1]*.59+e[2]*.11).toFixed(0),n=e[3];t=t||127;i=Number(i)<Number(t)?0:255;this.setSource([i,i,i,n]);return this},overlayWith:function(t){if(!(t instanceof i)){t=new i(t)}var e=[],n=this.getAlpha(),r=.5,s=this.getSource(),o=t.getSource();for(var a=0;a<3;a++){e.push(Math.round(s[a]*(1-r)+o[a]*r))}e[3]=n;this.setSource(e);return this}};e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;e.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",grey:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"};function n(t,e,i){if(i<0){i+=1}if(i>1){i-=1}if(i<1/6){return t+(e-t)*6*i}if(i<1/2){return e}if(i<2/3){return t+(e-t)*(2/3-i)*6}return t}e.Color.fromRgb=function(t){return i.fromSource(i.sourceFromRgb(t))};e.Color.sourceFromRgb=function(t){var e=t.match(i.reRGBa);if(e){var n=parseInt(e[1],10)/(/%$/.test(e[1])?100:1)*(/%$/.test(e[1])?255:1),r=parseInt(e[2],10)/(/%$/.test(e[2])?100:1)*(/%$/.test(e[2])?255:1),s=parseInt(e[3],10)/(/%$/.test(e[3])?100:1)*(/%$/.test(e[3])?255:1);return[parseInt(n,10),parseInt(r,10),parseInt(s,10),e[4]?parseFloat(e[4]):1]}};e.Color.fromRgba=i.fromRgb;e.Color.fromHsl=function(t){return i.fromSource(i.sourceFromHsl(t))};e.Color.sourceFromHsl=function(t){var e=t.match(i.reHSLa);if(!e){return}var r=(parseFloat(e[1])%360+360)%360/360,s=parseFloat(e[2])/(/%$/.test(e[2])?100:1),o=parseFloat(e[3])/(/%$/.test(e[3])?100:1),a,l,h;if(s===0){a=l=h=o}else{var u=o<=.5?o*(s+1):o+s-o*s,c=o*2-u;a=n(c,u,r+1/3);l=n(c,u,r);h=n(c,u,r-1/3)}return[Math.round(a*255),Math.round(l*255),Math.round(h*255),e[4]?parseFloat(e[4]):1]};e.Color.fromHsla=i.fromHsl;e.Color.fromHex=function(t){return i.fromSource(i.sourceFromHex(t))};e.Color.sourceFromHex=function(t){if(t.match(i.reHex)){var e=t.slice(t.indexOf("#")+1),n=e.length===3||e.length===4,r=e.length===8||e.length===4,s=n?e.charAt(0)+e.charAt(0):e.substring(0,2),o=n?e.charAt(1)+e.charAt(1):e.substring(2,4),a=n?e.charAt(2)+e.charAt(2):e.substring(4,6),l=r?n?e.charAt(3)+e.charAt(3):e.substring(6,8):"FF";return[parseInt(s,16),parseInt(o,16),parseInt(a,16),parseFloat((parseInt(l,16)/255).toFixed(2))]}};e.Color.fromSource=function(t){var e=new i;e.setSource(t);return e}})(t)})(typeof exports!=="undefined"?exports:this);(function(){(function(t){"use strict";var e=void 0;var i=1e5;function n(t){switch(typeof t){case"undefined":return"undefined";case"boolean":return"boolean";case"number":return"number";case"string":return"string";default:return t===null?"null":"object"}}function r(t){return Object.prototype.toString.call(t).replace(/^\[object *|\]$/g,"")}function s(t){return typeof t==="function"}function o(t){if(t===null||t===e)throw TypeError();return Object(t)}function a(t){return t>>0}function l(t){return t>>>0}var h=Math.LN2,u=Math.abs,c=Math.floor,f=Math.log,d=Math.max,g=Math.min,p=Math.pow,v=Math.round;(function(){var t=Object.defineProperty;var e=!function(){try{return Object.defineProperty({},"x",{})}catch(t){return false}}();if(!t||e){Object.defineProperty=function(e,i,n){if(t)try{return t(e,i,n)}catch(t){}if(e!==Object(e))throw TypeError("Object.defineProperty called on non-object");if(Object.prototype.__defineGetter__&&"get"in n)Object.prototype.__defineGetter__.call(e,i,n.get);if(Object.prototype.__defineSetter__&&"set"in n)Object.prototype.__defineSetter__.call(e,i,n.set);if("value"in n)e[i]=n.value;return e}}})();function m(e){if("TYPED_ARRAY_POLYFILL_NO_ARRAY_ACCESSORS"in t)return;if(e.length>i)throw RangeError("Array too large for polyfill");function n(t){Object.defineProperty(e,t,{get:function(){return e._getter(t)},set:function(i){e._setter(t,i)},enumerable:true,configurable:false})}var r;for(r=0;r<e.length;r+=1){n(r)}}function b(t,e){var i=32-e;return t<<i>>i}function w(t,e){var i=32-e;return t<<i>>>i}function y(t){return[t&255]}function x(t){return b(t[0],8)}function k(t){return[t&255]}function _(t){return w(t[0],8)}function C(t){t=v(Number(t));return[t<0?0:t>255?255:t&255]}function S(t){return[t&255,t>>8&255]}function T(t){return b(t[1]<<8|t[0],16)}function A(t){return[t&255,t>>8&255]}function M(t){return w(t[1]<<8|t[0],16)}function E(t){return[t&255,t>>8&255,t>>16&255,t>>24&255]}function O(t){return b(t[3]<<24|t[2]<<16|t[1]<<8|t[0],32)}function P(t){return[t&255,t>>8&255,t>>16&255,t>>24&255]}function j(t){return w(t[3]<<24|t[2]<<16|t[1]<<8|t[0],32)}function I(t,e,i){var n=(1<<e-1)-1;function r(t){var e=c(t),i=t-e;if(i<.5)return e;if(i>.5)return e+1;return e%2?e+1:e}var s,o,a;if(t!==t){o=(1<<e)-1;a=p(2,i-1);s=0}else if(t===Infinity||t===-Infinity){o=(1<<e)-1;a=0;s=t<0?1:0}else if(t===0){o=0;a=0;s=1/t===-Infinity?1:0}else{s=t<0;t=u(t);if(t>=p(2,1-n)){o=g(c(f(t)/h),1023);var l=t/p(2,o);if(l<1){o-=1;l*=2}if(l>=2){o+=1;l/=2}var d=p(2,i);a=r(l*d)-d;o+=n;if(a/d>=1){o+=1;a=0}if(o>2*n){o=(1<<e)-1;a=0}}else{o=0;a=r(t/p(2,1-n-i))}}var v=[],m;for(m=i;m;m-=1){v.push(a%2?1:0);a=c(a/2)}for(m=e;m;m-=1){v.push(o%2?1:0);o=c(o/2)}v.push(s?1:0);v.reverse();var b=v.join("");var w=[];while(b.length){w.unshift(parseInt(b.substring(0,8),2));b=b.substring(8)}return w}function F(t,e,i){var n=[],r,s,o,a,l,h,u,c;for(r=0;r<t.length;++r){o=t[r];for(s=8;s;s-=1){n.push(o%2?1:0);o=o>>1}}n.reverse();a=n.join("");l=(1<<e-1)-1;h=parseInt(a.substring(0,1),2)?-1:1;u=parseInt(a.substring(1,1+e),2);c=parseInt(a.substring(1+e),2);if(u===(1<<e)-1){return c!==0?NaN:h*Infinity}else if(u>0){return h*p(2,u-l)*(1+c/p(2,i))}else if(c!==0){return h*p(2,-(l-1))*(c/p(2,i))}else{return h<0?-0:0}}function D(t){return F(t,11,52)}function R(t){return I(t,11,52)}function B(t){return F(t,8,23)}function L(t){return I(t,8,23)}(function(){function i(t){t=a(t);if(t<0)throw RangeError("ArrayBuffer size is not a small enough positive integer.");Object.defineProperty(this,"byteLength",{value:t});Object.defineProperty(this,"_bytes",{value:Array(t)});for(var e=0;e<t;e+=1)this._bytes[e]=0}t.ArrayBuffer=t.ArrayBuffer||i;function h(){if(!arguments.length||typeof arguments[0]!=="object"){return function(t){t=a(t);if(t<0)throw RangeError("length is not a small enough positive integer.");Object.defineProperty(this,"length",{value:t});Object.defineProperty(this,"byteLength",{value:t*this.BYTES_PER_ELEMENT});Object.defineProperty(this,"buffer",{value:new i(this.byteLength)});Object.defineProperty(this,"byteOffset",{value:0})}.apply(this,arguments)}if(arguments.length>=1&&n(arguments[0])==="object"&&arguments[0]instanceof h){return function(t){if(this.constructor!==t.constructor)throw TypeError();var e=t.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new i(e)});Object.defineProperty(this,"byteLength",{value:e});Object.defineProperty(this,"byteOffset",{value:0});Object.defineProperty(this,"length",{value:t.length});for(var n=0;n<this.length;n+=1)this._setter(n,t._getter(n))}.apply(this,arguments)}if(arguments.length>=1&&n(arguments[0])==="object"&&!(arguments[0]instanceof h)&&!(arguments[0]instanceof i||r(arguments[0])==="ArrayBuffer")){return function(t){var e=t.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new i(e)});Object.defineProperty(this,"byteLength",{value:e});Object.defineProperty(this,"byteOffset",{value:0});Object.defineProperty(this,"length",{value:t.length});for(var n=0;n<this.length;n+=1){var r=t[n];this._setter(n,Number(r))}}.apply(this,arguments)}if(arguments.length>=1&&n(arguments[0])==="object"&&(arguments[0]instanceof i||r(arguments[0])==="ArrayBuffer")){return function(t,i,n){i=l(i);if(i>t.byteLength)throw RangeError("byteOffset out of range");if(i%this.BYTES_PER_ELEMENT)throw RangeError("buffer length minus the byteOffset is not a multiple of the element size.");if(n===e){var r=t.byteLength-i;if(r%this.BYTES_PER_ELEMENT)throw RangeError("length of buffer minus byteOffset not a multiple of the element size");n=r/this.BYTES_PER_ELEMENT}else{n=l(n);r=n*this.BYTES_PER_ELEMENT}if(i+r>t.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:t});Object.defineProperty(this,"byteLength",{value:r});Object.defineProperty(this,"byteOffset",{value:i});Object.defineProperty(this,"length",{value:n})}.apply(this,arguments)}throw TypeError()}Object.defineProperty(h,"from",{value:function(t){return new this(t)}});Object.defineProperty(h,"of",{value:function(){return new this(arguments)}});var f={};h.prototype=f;Object.defineProperty(h.prototype,"_getter",{value:function(t){if(arguments.length<1)throw SyntaxError("Not enough arguments");t=l(t);if(t>=this.length)return e;var i=[],n,r;for(n=0,r=this.byteOffset+t*this.BYTES_PER_ELEMENT;n<this.BYTES_PER_ELEMENT;n+=1,r+=1){i.push(this.buffer._bytes[r])}return this._unpack(i)}});Object.defineProperty(h.prototype,"get",{value:h.prototype._getter});Object.defineProperty(h.prototype,"_setter",{value:function(t,e){if(arguments.length<2)throw SyntaxError("Not enough arguments");t=l(t);if(t>=this.length)return;var i=this._pack(e),n,r;for(n=0,r=this.byteOffset+t*this.BYTES_PER_ELEMENT;n<this.BYTES_PER_ELEMENT;n+=1,r+=1){this.buffer._bytes[r]=i[n]}}});Object.defineProperty(h.prototype,"constructor",{value:h});Object.defineProperty(h.prototype,"copyWithin",{value:function(t,i){var n=arguments[2];var r=o(this);var s=r.length;var h=l(s);h=d(h,0);var u=a(t);var c;if(u<0)c=d(h+u,0);else c=g(u,h);var f=a(i);var p;if(f<0)p=d(h+f,0);else p=g(f,h);var v;if(n===e)v=h;else v=a(n);var m;if(v<0)m=d(h+v,0);else m=g(v,h);var b=g(m-p,h-c);var w;if(p<c&&c<p+b){w=-1;p=p+b-1;c=c+b-1}else{w=1}while(b>0){r._setter(c,r._getter(p));p=p+w;c=c+w;b=b-1}return r}});Object.defineProperty(h.prototype,"every",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(!s(t))throw TypeError();var r=arguments[1];for(var o=0;o<n;o++){if(!t.call(r,i._getter(o),o,i))return false}return true}});Object.defineProperty(h.prototype,"fill",{value:function(t){var i=arguments[1],n=arguments[2];var r=o(this);var s=r.length;var h=l(s);h=d(h,0);var u=a(i);var c;if(u<0)c=d(h+u,0);else c=g(u,h);var f;if(n===e)f=h;else f=a(n);var p;if(f<0)p=d(h+f,0);else p=g(f,h);while(c<p){r._setter(c,t);c+=1}return r}});Object.defineProperty(h.prototype,"filter",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(!s(t))throw TypeError();var r=[];var o=arguments[1];for(var a=0;a<n;a++){var h=i._getter(a);if(t.call(o,h,a,i))r.push(h)}return new this.constructor(r)}});Object.defineProperty(h.prototype,"find",{value:function(t){var i=o(this);var n=i.length;var r=l(n);if(!s(t))throw TypeError();var a=arguments.length>1?arguments[1]:e;var h=0;while(h<r){var u=i._getter(h);var c=t.call(a,u,h,i);if(Boolean(c))return u;++h}return e}});Object.defineProperty(h.prototype,"findIndex",{value:function(t){var i=o(this);var n=i.length;var r=l(n);if(!s(t))throw TypeError();var a=arguments.length>1?arguments[1]:e;var h=0;while(h<r){var u=i._getter(h);var c=t.call(a,u,h,i);if(Boolean(c))return h;++h}return-1}});Object.defineProperty(h.prototype,"forEach",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(!s(t))throw TypeError();var r=arguments[1];for(var o=0;o<n;o++)t.call(r,i._getter(o),o,i)}});Object.defineProperty(h.prototype,"indexOf",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(n===0)return-1;var r=0;if(arguments.length>0){r=Number(arguments[1]);if(r!==r){r=0}else if(r!==0&&r!==1/0&&r!==-(1/0)){r=(r>0||-1)*c(u(r))}}if(r>=n)return-1;var s=r>=0?r:d(n-u(r),0);for(;s<n;s++){if(i._getter(s)===t){return s}}return-1}});Object.defineProperty(h.prototype,"join",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);var r=Array(n);for(var s=0;s<n;++s)r[s]=i._getter(s);return r.join(t===e?",":t)}});Object.defineProperty(h.prototype,"lastIndexOf",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(n===0)return-1;var r=n;if(arguments.length>1){r=Number(arguments[1]);if(r!==r){r=0}else if(r!==0&&r!==1/0&&r!==-(1/0)){r=(r>0||-1)*c(u(r))}}var s=r>=0?g(r,n-1):n-u(r);for(;s>=0;s--){if(i._getter(s)===t)return s}return-1}});Object.defineProperty(h.prototype,"map",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(!s(t))throw TypeError();var r=[];r.length=n;var o=arguments[1];for(var a=0;a<n;a++)r[a]=t.call(o,i._getter(a),a,i);return new this.constructor(r)}});Object.defineProperty(h.prototype,"reduce",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(!s(t))throw TypeError();if(n===0&&arguments.length===1)throw TypeError();var r=0;var o;if(arguments.length>=2){o=arguments[1]}else{o=i._getter(r++)}while(r<n){o=t.call(e,o,i._getter(r),r,i);r++}return o}});Object.defineProperty(h.prototype,"reduceRight",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(!s(t))throw TypeError();if(n===0&&arguments.length===1)throw TypeError();var r=n-1;var o;if(arguments.length>=2){o=arguments[1]}else{o=i._getter(r--)}while(r>=0){o=t.call(e,o,i._getter(r),r,i);r--}return o}});Object.defineProperty(h.prototype,"reverse",{value:function(){if(this===e||this===null)throw TypeError();var t=Object(this);var i=l(t.length);var n=c(i/2);for(var r=0,s=i-1;r<n;++r,--s){var o=t._getter(r);t._setter(r,t._getter(s));t._setter(s,o)}return t}});Object.defineProperty(h.prototype,"set",{value:function(t,e){if(arguments.length<1)throw SyntaxError("Not enough arguments");var i,n,r,s,o,a,h,u,c,f;if(typeof arguments[0]==="object"&&arguments[0].constructor===this.constructor){i=arguments[0];r=l(arguments[1]);if(r+i.length>this.length){throw RangeError("Offset plus length of array is out of range")}u=this.byteOffset+r*this.BYTES_PER_ELEMENT;c=i.length*this.BYTES_PER_ELEMENT;if(i.buffer===this.buffer){f=[];for(o=0,a=i.byteOffset;o<c;o+=1,a+=1){f[o]=i.buffer._bytes[a]}for(o=0,h=u;o<c;o+=1,h+=1){this.buffer._bytes[h]=f[o]}}else{for(o=0,a=i.byteOffset,h=u;o<c;o+=1,a+=1,h+=1){this.buffer._bytes[h]=i.buffer._bytes[a]}}}else if(typeof arguments[0]==="object"&&typeof arguments[0].length!=="undefined"){n=arguments[0];s=l(n.length);r=l(arguments[1]);if(r+s>this.length){throw RangeError("Offset plus length of array is out of range")}for(o=0;o<s;o+=1){a=n[o];this._setter(r+o,Number(a))}}else{throw TypeError("Unexpected argument type(s)")}}});Object.defineProperty(h.prototype,"slice",{value:function(t,i){var n=o(this);var r=n.length;var s=l(r);var h=a(t);var u=h<0?d(s+h,0):g(h,s);var c=i===e?s:a(i);var f=c<0?d(s+c,0):g(c,s);var p=f-u;var v=n.constructor;var m=new v(p);var b=0;while(u<f){var w=n._getter(u);m._setter(b,w);++u;++b}return m}});Object.defineProperty(h.prototype,"some",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);if(!s(t))throw TypeError();var r=arguments[1];for(var o=0;o<n;o++){if(t.call(r,i._getter(o),o,i)){return true}}return false}});Object.defineProperty(h.prototype,"sort",{value:function(t){if(this===e||this===null)throw TypeError();var i=Object(this);var n=l(i.length);var r=Array(n);for(var s=0;s<n;++s)r[s]=i._getter(s);if(t)r.sort(t);else r.sort();for(s=0;s<n;++s)i._setter(s,r[s]);return i}});Object.defineProperty(h.prototype,"subarray",{value:function(t,e){function i(t,e,i){return t<e?e:t>i?i:t}t=a(t);e=a(e);if(arguments.length<1){t=0}if(arguments.length<2){e=this.length}if(t<0){t=this.length+t}if(e<0){e=this.length+e}t=i(t,0,this.length);e=i(e,0,this.length);var n=e-t;if(n<0){n=0}return new this.constructor(this.buffer,this.byteOffset+t*this.BYTES_PER_ELEMENT,n)}});function p(t,e,i){var n=function(){Object.defineProperty(this,"constructor",{value:n});h.apply(this,arguments);m(this)};if("__proto__"in n){n.__proto__=h}else{n.from=h.from;n.of=h.of}n.BYTES_PER_ELEMENT=t;var r=function(){};r.prototype=f;n.prototype=new r;Object.defineProperty(n.prototype,"BYTES_PER_ELEMENT",{value:t});Object.defineProperty(n.prototype,"_pack",{value:e});Object.defineProperty(n.prototype,"_unpack",{value:i});return n}var v=p(1,y,x);var b=p(1,k,_);var w=p(1,C,_);var I=p(2,S,T);var F=p(2,A,M);var z=p(4,E,O);var q=p(4,P,j);var Y=p(4,L,B);var W=p(8,R,D);t.Int8Array=t.Int8Array||v;t.Uint8Array=t.Uint8Array||b;t.Uint8ClampedArray=t.Uint8ClampedArray||w;t.Int16Array=t.Int16Array||I;t.Uint16Array=t.Uint16Array||F;t.Int32Array=t.Int32Array||z;t.Uint32Array=t.Uint32Array||q;t.Float32Array=t.Float32Array||Y;t.Float64Array=t.Float64Array||W})();(function(){function i(t,e){return s(t.get)?t.get(e):t[e]}var n=function(){var t=new Uint16Array([4660]),e=new Uint8Array(t.buffer);return i(e,0)===18}();function o(t,i,n){if(!(t instanceof ArrayBuffer||r(t)==="ArrayBuffer"))throw TypeError();i=l(i);if(i>t.byteLength)throw RangeError("byteOffset out of range");if(n===e)n=t.byteLength-i;else n=l(n);if(i+n>t.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:t});Object.defineProperty(this,"byteLength",{value:n});Object.defineProperty(this,"byteOffset",{value:i})}function a(t){return function e(r,s){r=l(r);if(r+t.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");r+=this.byteOffset;var o=new Uint8Array(this.buffer,r,t.BYTES_PER_ELEMENT),a=[];for(var h=0;h<t.BYTES_PER_ELEMENT;h+=1)a.push(i(o,h));if(Boolean(s)===Boolean(n))a.reverse();return i(new t(new Uint8Array(a).buffer),0)}}Object.defineProperty(o.prototype,"getUint8",{value:a(Uint8Array)});Object.defineProperty(o.prototype,"getInt8",{value:a(Int8Array)});Object.defineProperty(o.prototype,"getUint16",{value:a(Uint16Array)});Object.defineProperty(o.prototype,"getInt16",{value:a(Int16Array)});Object.defineProperty(o.prototype,"getUint32",{value:a(Uint32Array)});Object.defineProperty(o.prototype,"getInt32",{value:a(Int32Array)});Object.defineProperty(o.prototype,"getFloat32",{value:a(Float32Array)});Object.defineProperty(o.prototype,"getFloat64",{value:a(Float64Array)});function h(t){return function e(r,s,o){r=l(r);if(r+t.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");var a=new t([s]),h=new Uint8Array(a.buffer),u=[],c,f;for(c=0;c<t.BYTES_PER_ELEMENT;c+=1)u.push(i(h,c));if(Boolean(o)===Boolean(n))u.reverse();f=new Uint8Array(this.buffer,r,t.BYTES_PER_ELEMENT);f.set(u)}}Object.defineProperty(o.prototype,"setUint8",{value:h(Uint8Array)});Object.defineProperty(o.prototype,"setInt8",{value:h(Int8Array)});Object.defineProperty(o.prototype,"setUint16",{value:h(Uint16Array)});Object.defineProperty(o.prototype,"setInt16",{value:h(Int16Array)});Object.defineProperty(o.prototype,"setUint32",{value:h(Uint32Array)});Object.defineProperty(o.prototype,"setInt32",{value:h(Int32Array)});Object.defineProperty(o.prototype,"setFloat32",{value:h(Float32Array)});Object.defineProperty(o.prototype,"setFloat64",{value:h(Float64Array)});t.DataView=t.DataView||o})()})(self);(function(){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")};String.prototype.trimRight=function(){return this.replace(/\s+$/,"")}})();(function(){Node.prototype.hasClass=function(t){if(this.classList){return this.classList.contains(t)}else{return-1<this.className.indexOf(t)}};Node.prototype.addClass=function(t){if(this.classList){this.classList.add(t)}else if(!this.hasClass(t)){var e=this.className.split(" ");e.push(t);this.className=e.join(" ")}return this};Node.prototype.removeClass=function(t){if(this.classList){this.classList.remove(t)}else{var e=this.className.split(" ");e.splice(e.indexOf(t),1);this.className=e.join(" ")}return this};if(!NodeList.prototype.forEach){NodeList.prototype.forEach=Array.prototype.forEach}})();(function(){CanvasRenderingContext2D.prototype.getFontStyle=function(){var t=document.createElement("div");t.style.cssText="font: "+this.font+" !important;";this.canvas.appendChild(t);var e=window.getComputedStyle(t),i={fontFamily:e.fontFamily,fontSize:e.fontSize,fontStyle:e.fontStyle,fontVariant:e.fontVariant,fontWeight:e.fontWeight,lineHeight:e.lineHeight};this.canvas.removeChild(t);return i};CanvasRenderingContext2D.prototype.textArea=function(t,e,i,n,r,s,o){var a=t instanceof Array?t:t.split(/\b(?=\S)|(?=\s)/g),l=this.getFontStyle(),h=this.textBaseline,u=o||0,c=0,f=parseInt(l.fontSize),s=(s||1)*f,d,g,p,v,m,b,w;this.textBaseline="top";for(g=0;g<a.length;++g){if("\n"===a[g]){u=0;c+=s;continue}if(!u&&/^\t+/.test(a[g]))a[g]=a[g].replace(/^\t+/,"");d=this.measureText(a[g]).width;if((p=n-d)<=0){p=Math.abs(p);if(p-n<=0)for(v=a[g].length;v;--v){if(n>this.measureText(a[g].substr(0,v)+"-").width+f){m=v;break}}else for(v=0;v<a[g].length;++v){if(n<this.measureText(a[g].substr(0,v+1)+"-").width+f){m=v;break}}if(m){var b=a[g].substr(0,v+1)+"-",w=a[g].substr(v+1);a[g]=b;a.splice(g+1,0,w);d=this.measureText(b).width}}if(u>0&&u+d>=n){if(c+s*2>=r)return{x:u+e,y:c+i,remainder:a.slice(g)};u=0;c+=s;if(" "===a[g])continue}this.fillText(a[g],u+e,c+i);u+=d}this.textBaseline=h;return{x:u+e,y:c+i,remainder:[]}}})();(function(){var t=/([a-z\d])([A-Z])/g;var e=/\s+/;var i=/^(width|height|left|top|marginLeft|marginTop)$/;var n=/^\s+(.*)\s+$/;var r=Object.prototype;var s=r.toString;var o=r.hasOwnProperty;var a=Array.prototype.slice;function l(t){return t===+t&&t!==(t|0)}function h(t){return t===+t&&t===(t|0)}function u(t){return s.call(t).slice(8,-1).toLowerCase()}function c(t){return typeof t==="string"}function f(t){return typeof t==="number"&&!isNaN(t)}function d(t){return typeof t==="undefined"}function g(t){return(typeof t==="undefined"?"undefined":_typeof(t))==="object"&&t!==null}function p(t){if(!g(t)){return false}try{var e=t.constructor;var i=e.prototype;return e&&i&&o.call(i,"isPrototypeOf")}catch(t){return false}}function v(t){return u(t)==="function"}function m(t){return Array.isArray?Array.isArray(t):u(t)==="array"}function b(t,e){e=e>=0?e:0;if(Array.from){return Array.from(t).slice(e)}return a.call(t,e)}function w(t,e){var i=-1;if(e.indexOf){return e.indexOf(t)}e.forEach(function(e,n){if(e===t){i=n}});return i}function y(t){if(c(t)){t=t.trim?t.trim():t.replace(n,"1")}return t}function x(t,e){if(t&&v(e)){var i=void 0;if(m(t)||f(t.length)){var n=t.length;for(i=0;i<n;i++){if(e.call(t,t[i],i,t)===false){break}}}else if(g(t)){Object.keys(t).forEach(function(i){e.call(t,t[i],i,t)})}}return t}function k(e){return e.replace(t,"$1-$2").toLowerCase()}function _(t,e){if(g(t[e])){return t[e]}else if(t.dataset){return t.dataset[e]}return t.getAttribute("data-"+k(e))}function C(t,e,i){if(g(i)){t[e]=i}else if(t.dataset){t.dataset[e]=i}else{t.setAttribute("data-"+k(e),i)}}function S(t,e){if(g(t[e])){delete t[e]}else if(t.dataset){try{delete t.dataset[e]}catch(i){t.dataset[e]=null}}else{t.removeAttribute("data-"+k(e))}}function T(t,i,n){var r=y(i).split(e);if(r.length>1){x(r,function(e){T(t,e,n)});return}if(t.removeEventListener){t.removeEventListener(i,n,false)}else if(t.detachEvent){t.detachEvent("on"+i,n)}}function A(t,i,n,r){var s=y(i).split(e);var o=n;if(s.length>1){x(s,function(e){A(t,e,n)});return}if(r){n=function e(){for(var r=arguments.length,s=Array(r),a=0;a<r;a++){s[a]=arguments[a]}T(t,i,n);return o.apply(t,s)}}if(t.addEventListener){t.addEventListener(i,n,false);
}else if(t.attachEvent){t.attachEvent("on"+i,n)}}function M(t,e,i){if(t.dispatchEvent){var n=void 0;if(v(Event)&&v(CustomEvent)){if(d(i)){n=new Event(e,{bubbles:true,cancelable:true})}else{n=new CustomEvent(e,{detail:i,bubbles:true,cancelable:true})}}else if(d(i)){n=document.createEvent("Event");n.initEvent(e,true,true)}else{n=document.createEvent("CustomEvent");n.initCustomEvent(e,true,true,i)}return t.dispatchEvent(n)}else if(t.fireEvent){return t.fireEvent("on"+e)}return true}iws.event={addListener:A,removeListener:T,dispatchEvent:M}})();(function(){"use strict";var t=Math.PI/180;iws.util={compareObjects:function(t,e){if(typeof t!==typeof e){console.log("two objects not the same type");return}if(typeof t!=="object"){console.log('arguments are not typeof === "object"');return}for(var i in e){if(e.hasOwnProperty(i)){if(!t.hasOwnProperty(i)){}}}},degreesToRadians:function(e){return e*t},radiansToDegrees:function(e){return e/t},rotatePoint:function(t,e,i){t.subtractEquals(e);var n=iws.util.rotateVector(t,i);return new iws.Point(n.x,n.y).addEquals(e)},rotateVector:function(t,e){var i=Math.sin(e),n=Math.cos(e),r=t.x*n-t.y*i,s=t.x*i+t.y*n;return{x:r,y:s}},falseFunction:function(){return false},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},loadImage:function(t,e,i,n){if(!t){e&&e.call(i,t);return}var r=document.createElement("img");r.onload=function(){e&&e.call(i,r);r=r.onload=r.onerror=null};r.onerror=function(){iws.log("Error loading "+r.src);e&&e.call(i,null,true);r=r.onload=r.onerror=null};if(t.indexOf("data")!==0&&n){r.crossOrigin=n}r.src=t},makeElement:function(t,e){var i=document.createElement(t);for(var n in e){if(n==="class"){i.className=e[n]}else if(n==="for"){i.htmlFor=e[n]}else{i.setAttribute(n,e[n])}}return i},wrapElement:function(t,e,i){if(typeof e==="string"){e=this.makeElement(e,i)}if(t.parentNode){t.parentNode.replaceChild(e,t)}e.appendChild(t);return e},addClass:function(t,e){if(t&&(" "+t.className+" ").indexOf(" "+e+" ")===-1){t.className+=(t.className?" ":"")+e}},drawDashedLine:function(t,e,i,n,r,s){var o=n-e,a=r-i,l=sqrt(o*o+a*a),h=atan2(a,o),u=s.length,c=0,f=true;t.save();t.translate(e,i);t.moveTo(0,0);t.rotate(h);e=0;while(l>e){e+=s[c++%u];if(e>l){e=l}t[f?"lineTo":"moveTo"](e,0);f=!f}t.restore()},clipContext:function(t,e){e.save();e.beginPath();t.clipTo(e);e.clip()},transformPoint:function(t,e,i){if(i){return new iws.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y)}return new iws.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),i=[e*t[3],-e*t[1],-e*t[2],e*t[0]],n=iws.util.transformPoint({x:t[4],y:t[5]},i,true);i[4]=-n.x;i[5]=-n.y;return i},makeBoundingBoxFromPoints:function(t){var e=[t[0].x,t[1].x,t[2].x,t[3].x],i=iws.util.array.min(e),n=iws.util.array.max(e),r=Math.abs(i-n),s=[t[0].y,t[1].y,t[2].y,t[3].y],o=iws.util.array.min(s),a=iws.util.array.max(s),l=Math.abs(o-a);return{left:i,top:o,width:r,height:l}},multiplyTransformMatrices:function(t,e,i){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(e){var i=Math.atan2(e[1],e[0]),n=Math.pow(e[0],2)+Math.pow(e[1],2),r=Math.sqrt(n),s=(e[0]*e[3]-e[2]*e[1])/r,o=Math.atan2(e[0]*e[2]+e[1]*e[3],n);return{angle:i/t,scaleX:r,scaleY:s,skewX:o/t,skewY:0,translateX:e[4],translateY:e[5]}},populateWithProperties:function(t,e,i){if(i&&Object.prototype.toString.call(i)==="[object Array]"){for(var n=0,r=i.length;n<r;n++){if(i[n]in t){e[i[n]]=t[i[n]]}}}},getKlass:function(t,e,i){t=iws.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1));return iws.util.resolveNamespace(e)[i+t]},resolveNamespace:function(t){if(!t){return iws}var e=t.split("."),i=e.length,n,r=global||iws.window;for(n=0;n<i;++n){r=r[e[n]]}return r}};function e(t){return typeof t=="function"}function i(t,n){if(t===n)return true;if(t===null||n===null)return false;if(t!==t&&n!==n)return true;var r=typeof t,s=typeof n,o,a,l;if(r==s){if(r=="object"){if(Array.isArray(t)){if((o=t.length)==n.length){for(a=0;a<o;a++){if(!i(t[a],n[a]))return false}return true}}else{l={};o=0;for(a in t){if(a.charAt(0)==="$")continue;if(!e(t[a])&&!i(t[a],n[a]))return false;o++;l[a]=true}for(a in n){if(a.charAt(0)==="$"){continue}if(!l[a]&&!e(n[a]))return false;o--}return o===0}}}return false}iws.util.equals=i})();(function(){function t(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})}function e(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())}function i(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function n(t,e){var i;if(typeof t==="undefined"||t==="")return e;if(t.charAt(t.length-1)==="/"){if(e.charAt(0)==="/"){return t+e.slice(1)}else{return t+e}}else{if(e.charAt(0)==="/"){return t+e}else{return t+"/"+e}}return i}iws.util.string={camelize:t,capitalize:e,escapeXml:i,combinePath:n}})();(function(){"use strict";iws.util.find={getAngleFromPointToPoint:function(t,e,i,n){var r=i-t,s=n-e;var o=Math.atan2(s,r),a=o*180/Math.PI;return{radian:o,angle:a}},distanceOfTwoPoints:function(t,e){var i=Math.pow(t.x-e.x,2);var n=Math.pow(t.y-e.y,2);return Math.sqrt(i+n)},getContainFromCoords:function(t,e){var i=this._getImageLines(t),n=this._findCrossPoints(e,i);var r=n!==0&&n%2===1;return r},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,n,r,s,o,a=0,l;for(var h in e){l=e[h];if(l.o.y<t.y&&l.d.y<t.y){continue}if(l.o.y>=t.y&&l.d.y>=t.y){continue}if(l.o.x===l.d.x&&l.o.x>=t.x){o=l.o.x}else{i=0;n=(l.d.y-l.o.y)/(l.d.x-l.o.x);r=t.y-i*t.x;s=l.o.y-n*l.o.x;o=-(r-s)/(i-n)}if(o>=t.x){a+=1}if(a===2){break}}return a}}})();(function(){"use strict";function t(){}function e(t){var e=this.constructor.superclass.prototype[t];if(arguments.length>1){return e.apply(this,Array.prototype.slice.call(arguments,1))}else{return e.call(this)}}function i(){var i=null,n=Array.prototype.slice.call(arguments,0),r=n.shift();r.subclasses=[];if(typeof n[0]==="function"){i=n.shift();t.prototype=i.prototype;r.prototype=new t;i.subclasses.push(r)}r.superclass=i;for(var s=0,o=n.length;s<o;s++){for(var a in n[s]){var l=n[s];r.prototype[a]=l[a]}}r.prototype.constructor=r;r.prototype.callSuper=e;return r}iws.util.createInheritClass=i})();(function(){var t=document.documentElement.style,e="userSelect"in t?"userSelect":"MozUserSelect"in t?"MozUserSelect":"WebkitUserSelect"in t?"WebkitUserSelect":"KhtmlUserSelect"in t?"KhtmlUserSelect":"";function i(t){$(t).attr("unselectable","on").css({"-moz-user-select":"-moz-none","-moz-user-select":"none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"}).bind("selectstart",function(){return false});return t}function n(t){if(typeof t.onselectstart!=="undefined"){t.onselectstart=null}if(e){t.style[e]=""}else if(typeof t.unselectable==="string"){t.unselectable=""}return t}function r(t){var e=0,i=0,n=document.documentElement,r=document.body||{scrollLeft:0,scrollTop:0};while(t&&(t.parentNode||t.host)){t=t.parentNode||t.host;if(t===document){e=r.scrollLeft||n.scrollLeft||0;i=r.scrollTop||n.scrollTop||0}else{e+=t.scrollLeft||0;i+=t.scrollTop||0}if(t.nodeType===1&&iws.util.getElementStyle(t,"position")==="fixed"){break}}return{left:e,top:i}}function s(t){var e,i=t&&t.ownerDocument,n={left:0,top:0},s={left:0,top:0},a,l={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!i){return s}for(var h in l){s[l[h]]+=parseInt(o(t,h),10)||0}e=i.documentElement;if(typeof t.getBoundingClientRect!=="undefined"){n=t.getBoundingClientRect()}a=r(t);return{left:n.left+a.left-(e.clientLeft||0)+s.left,top:n.top+a.top-(e.clientTop||0)+s.top}}var o;if(document.defaultView&&document.defaultView.getComputedStyle){o=function(t,e){var i=document.defaultView.getComputedStyle(t,null);return i?i[e]:undefined}}else{o=function(t,e){var i=t.style[e];if(!i&&t.currentStyle){i=t.currentStyle[e]}return i}}iws.util.makeElementUnselectable=i;iws.util.makeElementSelectable=n;iws.util.getScrollLeftTop=r;iws.util.getElementOffset=s;iws.util.getElementStyle=o;function a(t){t||(t=window.event);var e=t.target||(typeof t.srcElement!==unknown?t.srcElement:null),i=iws.util.getScrollLeftTop(e);return{x:(t.clientX||t.touches[0].clientX)+i.left,y:(t.clientY||t.touches[0].clientY)+i.top}}iws.util.getPointer=a;var l=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function h(t){return toString.call(t).slice(8,-1).toLowerCase()}function u(t){return typeof t==="number"&&!isNaN(t)}function c(t){return(typeof t==="undefined"?"undefined":l(t))==="object"&&t!==null}function f(t){return h(t)==="function"}function d(t){return Array.isArray?Array.isArray(t):h(t)==="array"}function g(t,e){if(t&&f(e)){var i=void 0;if(d(t)||u(t.length)){var n=t.length;for(i=0;i<n;i++){if(e.call(t,t[i],i,t)===false){break}}}else if(c(t)){Object.keys(t).forEach(function(i){e.call(t,t[i],i,t)})}}return t}function p(t){var e=v(t);var i=[];if(e.changedTouches){g(e.changedTouches,function(t){i.push({x:t.pageX,y:t.pageY})})}else{i.push({x:e.pageX,y:e.pageY})}return i}iws.util.getPointers=p;function v(t){var e=t||window.event;if(!e.target){e.target=e.srcElement||document}if(!u(e.pageX)&&u(e.clientX)){var i=t.target.ownerDocument||document;var n=i.documentElement;var r=i.body;e.pageX=e.clientX+((n&&n.scrollLeft||r&&r.scrollLeft||0)-(n&&n.clientLeft||r&&r.clientLeft||0));e.pageY=e.clientY+((n&&n.scrollTop||r&&r.scrollTop||0)-(n&&n.clientTop||r&&r.clientTop||0))}return e}iws.util.getEvent=v;function m(t){var e=document.documentElement;var i=t.getBoundingClientRect();return{left:i.left+((window.scrollX||e&&e.scrollLeft||0)-(e&&e.clientLeft||0)),top:i.top+((window.scrollY||e&&e.scrollTop||0)-(e&&e.clientTop||0))}}iws.util.getOffset=m})();(function(){var t=Array.prototype.slice;function e(e,i){var n=t.call(arguments,2),r=[];for(var s=0,o=e.length;s<o;s++){r[s]=n.length?e[s][i].apply(e[s],n):e[s][i].call(e[s])}return r}function i(t,e){return s(t,e,function(t,e){return t>=e})}function n(t,e){return s(t,e,function(t,e){return t<e})}function r(t,e){var i=t.length;while(i--){t[i]=e}return t}function s(t,e,i){if(!t||t.length===0){return}var n=t.length-1,r=e?t[n][e]:t[n];if(e){while(n--){if(i(t[n][e],r)){r=t[n][e]}}}else{while(n--){if(i(t[n],r)){r=t[n]}}}return r}iws.util.array={fill:r,invoke:e,min:n,max:i}})();(function(){var t={},e={},i={},n=Array.prototype.join;function r(e,i,r,a,l,h,u){var c=n.call(arguments);if(t[c]){return t[c]}var f=Math.PI,d=u*f/180,g=Math.sin(d),p=Math.cos(d),v=0,m=0;r=Math.abs(r);a=Math.abs(a);var b=-p*e*.5-g*i*.5,w=-p*i*.5+g*e*.5,y=r*r,x=a*a,k=w*w,_=b*b,C=y*x-y*k-x*_,S=0;if(C<0){var T=Math.sqrt(1-C/(y*x));r*=T;a*=T}else{S=(l===h?-1:1)*Math.sqrt(C/(y*k+x*_))}var A=S*r*w/a,M=-S*a*b/r,E=p*A-g*M+e*.5,O=g*A+p*M+i*.5,P=o(1,0,(b-A)/r,(w-M)/a),j=o((b-A)/r,(w-M)/a,(-b-A)/r,(-w-M)/a);if(h===0&&j>0){j-=2*f}else if(h===1&&j<0){j+=2*f}var I=Math.ceil(Math.abs(j/f*2)),F=[],D=j/I,R=8/3*Math.sin(D/4)*Math.sin(D/4)/Math.sin(D/2),B=P+D;for(var L=0;L<I;L++){F[L]=s(P,B,p,g,r,a,E,O,R,v,m);v=F[L][4];m=F[L][5];P=B;B+=D}t[c]=F;return F}function s(t,i,r,s,o,a,l,h,u,c,f){var d=n.call(arguments);if(e[d]){return e[d]}var g=Math.cos(t),p=Math.sin(t),v=Math.cos(i),m=Math.sin(i),b=r*o*v-s*a*m+l,w=s*o*v+r*a*m+h,y=c+u*(-r*o*p-s*a*g),x=f+u*(-s*o*p+r*a*g),k=b+u*(r*o*m+s*a*v),_=w+u*(s*o*m-r*a*v);e[d]=[y,x,k,_,b,w];return e[d]}function o(t,e,i,n){var r=Math.atan2(e,t),s=Math.atan2(n,i);if(s>=r){return s-r}else{return 2*Math.PI-(r-s)}}iws.util.drawArc=function(t,e,i,n){var s=n[0],o=n[1],a=n[2],l=n[3],h=n[4],u=n[5],c=n[6],f=[[],[],[],[]],d=r(u-e,c-i,s,o,l,h,a);for(var g=0,p=d.length;g<p;g++){f[g][0]=d[g][0]+e;f[g][1]=d[g][1]+i;f[g][2]=d[g][2]+e;f[g][3]=d[g][3]+i;f[g][4]=d[g][4]+e;f[g][5]=d[g][5]+i;t.bezierCurveTo.apply(t,f[g])}};iws.util.getBoundsOfArc=function(t,e,i,n,s,o,l,h,u){var c=0,f=0,d,g=[],p=r(h-t,u-e,i,n,o,l,s);for(var v=0,m=p.length;v<m;v++){d=a(c,f,p[v][0],p[v][1],p[v][2],p[v][3],p[v][4],p[v][5]);g.push({x:d[0].x+t,y:d[0].y+e});g.push({x:d[1].x+t,y:d[1].y+e});c=p[v][4];f=p[v][5]}return g};function a(t,e,r,s,o,a,l,h){var u=n.call(arguments);if(i[u]){return i[u]}var c=Math.sqrt,f=Math.min,d=Math.max,g=Math.abs,p=[],v=[[],[]],m,b,w,y,x,k,_,C;b=6*t-12*r+6*o;m=-3*t+9*r-9*o+3*l;w=3*r-3*t;for(var S=0;S<2;++S){if(S>0){b=6*e-12*s+6*a;m=-3*e+9*s-9*a+3*h;w=3*s-3*e}if(g(m)<1e-12){if(g(b)<1e-12){continue}y=-w/b;if(0<y&&y<1){p.push(y)}continue}_=b*b-4*w*m;if(_<0){continue}C=c(_);x=(-b+C)/(2*m);if(0<x&&x<1){p.push(x)}k=(-b-C)/(2*m);if(0<k&&k<1){p.push(k)}}var T,A,M=p.length,E=M,O;while(M--){y=p[M];O=1-y;T=O*O*O*t+3*O*O*y*r+3*O*y*y*o+y*y*y*l;v[0][M]=T;A=O*O*O*e+3*O*O*y*s+3*O*y*y*a+y*y*y*h;v[1][M]=A}v[0][E]=t;v[1][E]=e;v[0][E+1]=l;v[1][E+1]=h;var P=[{x:f.apply(null,v[0]),y:f.apply(null,v[1])},{x:d.apply(null,v[0]),y:d.apply(null,v[1])}];i[u]=P;return P}iws.util.getBoundsOfCurve=a})();(function(){function t(t,e){for(var i in e){t[i]=e[i]}return t}function e(e){return t({},e)}iws.util.extend=t;iws.util.clone=e})();(function(){function t(t,e){var i=iws.util.makeElement("div",{class:"resize",style:"position:absolute; width:auto; height:auto; top:0; right:0; bottom:0; left:0; margin:0; padding:0; overflow:hidden; visibility:hidden; z-index:-1"});t.appendChild(i);var n=iws.util.makeElement("iframe",{style:"width:100%; height:0; border:0; visibility:visible; margin:0"});i.appendChild(n);var r=iws.util.makeElement("iframe",{style:"width:0; height:100%; border:0; visibility:visible; margin:0"});i.appendChild(r);this.callback=e;this.resizeData={w:t.offsetWidth,h:t.offsetHeight,t:null,throttle:10};function s(){var i=this.resizeData;if(!i.t||i.w!==t.offsetWidth||i.h!==t.offsetHeight){if(i.t)clearTimeout(i.t);i.t=setTimeout(function(){i.w=t.offsetWidth;i.h=t.offsetHeight;e()}.bind(this),i.throttle)}}n.contentWindow.addEventListener("resize",s.bind(this));r.contentWindow.addEventListener("resize",s.bind(this))}iws.util.resize=t})();(function(){iws.util.regexp={};iws.util.regexp.checkUrlForm=function(t){var e=/^http[s]?\:\/\//i;return e.test(t)};iws.util.regexp.getDigitString=function(t){var e=t.replace(/[^-\d\.]/g,"");return e}})();(function(){iws.util.fullscreen={toggleFullScreen:function(t){var e=t.webkitRequestFullScreen!==undefined;var i=t.mozRequestFullScreen!==undefined;var n=t.msRequestFullscreen!==undefined;var r=e||i||n;if(!r)return;function s(){if(i){return document.mozFullScreen}else if(e){return document.webkitIsFullScreen}else if(n){return document.msFullscreenElement!==null}}var s=s();if(!s){if(t.requestFullScreen){t.requestFullScreen()}else if(t.msRequestFullscreen){t.msRequestFullscreen()}else if(t.mozRequestFullScreen){t.mozRequestFullScreen()}else if(t.webkitRequestFullScreen){t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}}else{if(document.exitFullscreen){document.exitFullscreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}},onFullScreenChange:function(t){$(document).on("webkitfullscreenchange mozfullscreenchange MSFullscreenChange fullscreenchange",function(e){var i=!(!document.fullscreenElement&&!document.msFullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement);t&&t(i)}.bind(this))}}})();(function(){iws.util.urlDownload=function(t,e,i,n){function r(t,e,i,n){var r=0;var s=new XMLHttpRequest;s.open("GET",t);s.responseType=n&&n.responseType||"arraybuffer";s.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");s.onload=function(t){if(r===200)e(s.response)};s.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total}else{}};s.onreadystatechange=function t(){if(s.readyState===4){if(s.status===200){r=s.status}else{if(i){i("There was a problem with the request.\n"+s.statusText)}else{alert("There was a problem with the request.\n"+s.statusText)}}}};s.send();return s}return r(t,e,i,n)}})();(function(){iws.util.Unique={prevTimeId:0,prevUniqueId:0,thumbFrameId:0,getUniqueID:function(){try{var t=new Date;var e=t.getTime();if(e==iws.util.Unique.prevTimeId)iws.util.Unique.prevUniqueId=iws.util.Unique.prevUniqueId+1;else{iws.util.Unique.prevTimeId=e;iws.util.Unique.prevUniqueId=0}e=e+""+iws.util.Unique.prevUniqueId;return e}catch(t){console.log("mwUnique.getUniqueID error:"+t.message+".")}},getFrameId:function(){var t=iws.util.Unique.thumbFrameId++;return"thumb_frame_"+t.toString()}}})();(function(){iws.util.ListenDropFile=function(t,e){t.addEventListener("dragover",function(t){t.preventDefault();t.dataTransfer.dropEffect="copy"});t.addEventListener("drop",function(t){t.stopPropagation();t.preventDefault();var i=t.dataTransfer.files;if(i.length>0){var n=[];var r=new iws.util.sync({callback:function(){console.log("File loaded.");e&&e(n)}});Array.prototype.forEach.call(i,function(t){console.log(escape(t.name)+"("+t.type+") - "+(t.size/1024).toFixed(2).toString()+" kb, last modified: "+t.lastModifiedDate.toLocaleDateString()+"\n");var e={file:t,callback:function(e){var i=new FileReader;i.onload=function(){var i={type:"image",buffer:this.result,caption:t.name+" ("+t.type+") - "+(t.size/1024).toFixed(2).toString()+" kb"};n.push(i);e&&e()};i.readAsArrayBuffer(this.file)}};r.addWork(e)})}})};iws.util.RemoveDropFile=function(t){t.removeEventListener("dragover");t.removeEventListener("drop")}})();(function(){iws.util.run_waitMe=function(t,e){iws.util.waitMe(t,{effect:e,text:"",bg:"rgba(255,255,255,0.2)",color:"#222222",maxSize:"20px",onClose:function(){}})};iws.util.hide_waitMe=function(t){iws.util.waitMe(t,"hide")};iws.util.waitMe=function(t,e){return function(){var i=t,n="waitMe",r,s,o,a=false,l="background-color",h="",u="",c,f,d;var g={init:function(){var t={effect:"bounce",text:"",bg:"rgba(255,255,255,0.7)",color:"#000",maxSize:"",source:"",onClose:function(){}};f=$.extend(t,e);d=(new Date).getMilliseconds();c=$('<div class="'+n+'" data-waitme_id="'+d+'"></div>');switch(f.effect){case"none":o=0;break;case"bounce":o=3;break;case"rotateplane":o=1;break;case"stretch":o=5;break;case"orbit":o=2;break;case"roundBounce":o=12;break;case"win8":o=5;a=true;break;case"win8_linear":o=5;a=true;break;case"ios":o=12;break;case"facebook":o=3;break;case"rotation":o=1;l="border-color";break;case"timer":o=2;if($.isArray(f.color)){var g=f.color[0]}else{var g=f.color}h="border-color:"+g;break;case"pulse":o=1;l="border-color";break;case"progressBar":o=1;break;case"bouncePulse":o=3;break;case"img":o=1;break}if(h!==""){h+=";"}if(o>0){if(f.effect==="img"){u='<img src="'+f.source+'">'}else{for(var p=1;p<=o;++p){if($.isArray(f.color)){var g=f.color[p];if(g==undefined){g="#000"}}else{var g=f.color}if(a){u+='<div class="'+n+"_progress_elem"+p+'"><div style="'+l+":"+g+'"></div></div>'}else{u+='<div class="'+n+"_progress_elem"+p+'" style="'+l+":"+g+'"></div>'}}}s=$('<div class="'+n+"_progress "+f.effect+'" style="'+h+'">'+u+"</div>")}if(f.text&&f.maxSize===""){if($.isArray(f.color)){var g=f.color[0]}else{var g=f.color}r=$('<div class="'+n+'_text" style="color:'+g+'">'+f.text+"</div>")}var v=i.find("> ."+n);if(v){v.remove()}var m=$('<div class="'+n+'_content"></div>');m.append(s,r);c.append(m);if(i[0]&&i[0].tagName=="HTML"){i=$("body")}i.addClass(n+"_container").attr("data-waitme_id",d).append(c);v=i.find("> ."+n);var b=i.find("."+n+"_content");v.css({background:f.bg});b.css({marginTop:-b.outerHeight()/2+"px"});if(f.maxSize!==""){var w=s.outerHeight();var y=s.outerWidth();var x=w;if(f.effect==="img"){s.css({height:f.maxSize+"px"});s.find(">img").css({maxHeight:"100%"});b.css({marginTop:-b.outerHeight()/2+"px"})}else{if(f.maxSize<x){m.css({transform:"scale("+f.maxSize/x+")"})}}}function k(t){b.css({top:"auto",transform:"translateY("+t+"px) translateZ(0)"})}if(i.outerHeight()>$(window).height()){var _=$(window).scrollTop(),C=b.outerHeight(),S=i.offset().top,T=i.outerHeight(),A=_-S+$(window).height()/2;if(A<0){A=Math.abs(A)}if(A-C>=0&&A+C<=T){if(S-_>$(window).height()/2){A=C}k(A)}else{if(_>S+T-C){A=_-S-C}else{A=_-S+C}k(A)}$(document).scroll(function(){var t=$(window).scrollTop(),e=t-S+$(window).height()/2;if(e-C>=0&&e+C<=T){k(e)}})}v.on("destroyed",function(){if(f.onClose&&$.isFunction(f.onClose)){f.onClose()}v.trigger("close")});$.event.special.destroyed={remove:function(t){if(t.handler){t.handler()}}};return v},hide:function(){p()}};function p(){var t=i.attr("data-waitme_id");i.removeClass(n+"_container").removeAttr("data-waitme_id");i.find("."+n+'[data-waitme_id="'+t+'"]').remove()}if(g[e]){return g[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return g.init.apply(this,arguments)}}()}})();(function(t){t.fn.tabSlideOut=function(e){function i(t,e){return parseInt(t.css("border-"+e+"-width"),10)}function n(){return s.hasClass("ui-slideouttab-open")}function r(){var e=t(s).parent().height();if(a==="top"||a==="bottom"){e=t(s).parent().width()}return e-parseInt(o.otherOffset)-parseInt(o.offset)}var s=this;if(typeof e=="string"){switch(e){case"open":if(!n())this.children(".ui-slideouttab-handle").click();break;case"close":if(n())this.children(".ui-slideouttab-handle").click();break;case"isOpen":return n();break;case"toggle":this.children(".ui-slideouttab-handle").click();break;case"bounce":this.children(".ui-slideouttab-handle").trigger("bounce");break;case"resize":this.trigger("resize");break;default:throw"Invalid tabSlideOut command"}}else{var o=t.extend({tabLocation:"left",tabHandle:".handle",speed:300,action:"click",offset:"200px",offsetReverse:false,otherOffset:null,handleOffset:null,handleOffsetReverse:false,bounceDistance:"50px",bounceTimes:4,tabImage:null,tabImageHeight:null,tabImageWidth:null,onLoadSlideOut:false,clickScreenToClose:true,toggleButton:".tab-opener",onOpen:function(){},onClose:function(){},onOpenStart:function(){}},e||{});var a=o.tabLocation;var l=o.tabHandle=t(o.tabHandle,s);s.addClass("ui-slideouttab-panel");s.addClass("ui-slideouttab-"+a);if(o.offsetReverse)s.addClass("ui-slideouttab-panel-reverse");l.addClass("ui-slideouttab-handle");if(o.handleOffsetReverse)l.addClass("ui-slideouttab-handle-reverse");o.toggleButton=t(o.toggleButton);if(o.tabImage!==null){var h=0;var u=0;if(o.tabImageHeight!==null&&o.tabImageWidth!==null){h=o.tabImageHeight;u=o.tabImageWidth}else{var c=new Image;c.src=o.tabImage;h=c.naturalHeight;u=c.naturalWidth}l.addClass("ui-slideouttab-handle-image");l.css({background:"url("+o.tabImage+") no-repeat",width:u,height:h})}l.css({display:"block",position:"absolute"});s.css({position:"absolute"});if(a==="top"||a==="bottom"){o.panelOffsetFrom=o.offsetReverse?"right":"left";o.handleOffsetFrom=o.handleOffsetReverse?"right":"left"}else{o.panelOffsetFrom=o.offsetReverse?"bottom":"top";o.handleOffsetFrom=o.handleOffsetReverse?"bottom":"top"}if(o.handleOffset===null){o.handleOffset="-"+i(s,o.handleOffsetFrom)+"px"}function f(){return{panelWidth:parseInt(s.outerWidth()+1,10)+"px",panelHeight:parseInt(s.outerHeight()+1,10)+"px",handleWidth:parseInt(l.outerWidth(),10)+"px",handleHeight:parseInt(l.outerHeight()+1,10)+"px"}}if(a==="top"||a==="bottom"){s.css(o.panelOffsetFrom,o.offset);l.css(o.handleOffsetFrom,o.handleOffset);if(o.otherOffset!==null){s.css("width",r()+"px");s.on("resize",function(){s.css("width",r()+"px")})}var d=f();if(a==="top"){s.css({top:"-"+d.panelHeight});l.css({bottom:"-"+d.handleHeight})}else{s.css({bottom:"-"+d.panelHeight});l.css({top:"-"+d.handleHeight})}}if(a==="left"||a==="right"){s.css(o.panelOffsetFrom,o.offset);l.css(o.handleOffsetFrom,o.handleOffset);if(o.otherOffset!==null){s.css("height",r()+"px");s.on("resize",function(){s.css("height",r()+"px")})}var d=f();if(a==="left"){s.css({left:"-"+d.panelWidth});l.css({right:"0"})}else{s.css({right:"-"+d.panelWidth});l.css({left:"0"})}}l.click(function(t){t.preventDefault()});o.toggleButton.click(function(t){t.preventDefault()});var g=function(){var t=f();var e;switch(a){case"top":case"bottom":e=t.panelHeight;break;case"left":case"right":e=t.panelWidth}var i=[];i[a]="-"+e;s.removeClass("ui-slideouttab-open").animate(i,o.speed,function(){s.trigger("slideouttabclose");o.onClose()})};var p=function(){o.onOpenStart();var t=[];t[a]="-"+i(s,a)+"px";s.animate(t,o.speed,function(){s.addClass("ui-slideouttab-open").trigger("slideouttabopen");o.onOpen()})};var v=[];v[a]="-="+o.bounceDistance;var m=[];m[a]="+="+o.bounceDistance;var b=function(){var t=s;for(var e=0;e<o.bounceTimes;e++){t=t.animate(v,o.speed).animate(m,o.speed)}s.trigger("slideouttabbounce")};var w=function(){var t=s;for(var e=0;e<o.bounceTimes;e++){t=t.animate(m,o.speed).animate(v,o.speed)}s.trigger("slideouttabbounce")};var y=function(){s.click(function(t){t.stopPropagation()});o.toggleButton.click(function(t){t.stopPropagation()});t(document).click(function(){if(n()){g()}})};var x=function(){l.click(function(t){if(n()){g()}else{p()}});o.toggleButton.click(function(t){if(n()){g()}else{p()}});if(o.clickScreenToClose)y()};var k=function(){s.hover(function(){if(!n()){p()}},function(){if(n()){setTimeout(g,1e3)}});l.click(function(t){if(n()){g()}});o.toggleButton.click(function(t){if(n()){g()}else{p()}});if(o.clickScreenToClose)y()};var _=function(){g();setTimeout(p,500)};if(o.action==="click"){x()}if(o.action==="hover"){k()}if(o.onLoadSlideOut){_()}l.on("bounce",function(t){if(n()){b()}else{w()}})}return this}})(jQuery);(function(){iws.util.work={};if(typeof Worker==="undefined"){console.log(">>>> \tworker   .")}iws.util.work.Spliter=function(t,e){var i=new Worker(t);i.onerror=function(t){console.log("iwsT.Spliter : "+event.message+" ("+event.filename+":"+event.lineno+")")};var n=false;var r={};var s=function(){};var o=function(t){};return{init:function(){if(n===true){if(i!==null){i.terminate();i=null}n=false}if(i===null){i=new Worker(t)}},close:function(){if(i!==null){i.terminate();i=null}},postMessage:function(r){n=true;i.onmessage=function(r){s(r);n=false;if(e===true){i.terminate();i=null;i=new Worker(t)}};i.onerror=function(r){console.log("iwsT.Spliter : "+r.message+" ("+r.filename+":"+r.lineno+")");o(r);n=false;if(e===true){i.terminate();i=null;i=new Worker(t)}};i.postMessage(r)},callBackonmessage:function(t){s=t},callBackonerror:function(t){o=t}}};iws.util.work.WorkCrew=function(t,e,i,n){this.filename=t;this.count=this.mincount=e;this.maxcount=i||4;this.queue=[];this.results=[];this.pool=[];this.working={};this.uuid=0;this.fillPool();this.isRunning=false;this.inited=function(){};this.refresh=n||true};iws.util.work.WorkCrew.prototype.onfinish=function(){};iws.util.work.WorkCrew.prototype.onstarted=function(t){};iws.util.work.WorkCrew.prototype.oncomplete=function(t,e){};iws.util.work.WorkCrew.prototype.oncanceled=function(t){};iws.util.work.WorkCrew.prototype.unshiftWork=function(t){if(this.count===0){this.count++;this.addWorker()}this.isRunning=true;var e=this.uuid++;this.queue.unshift({id:e,work:t});this.processQueue();return e};iws.util.work.WorkCrew.prototype.addWork=function(t){if(this.count===0){this.count++;this.addWorker()}this.isRunning=true;var e=this.uuid++;this.queue.push({id:e,work:t});this.processQueue();return e};iws.util.work.WorkCrew.prototype.close=function(){this.mincount=0;this.init();var t=this.pool.length;for(var e=0;e<t;e++){var i=this.pool.shift();i.terminate();i=undefined}};iws.util.work.WorkCrew.prototype.init=function(){this.uuid=0;if(this.isRunning===true){for(var t=this.queue.length-1;t>=0;t--)this.queue.splice(t,1);for(var t in this.working){var e=this.working[t];console.log("<<<<    oncanceled "+e.work.cmd+" : "+e.work.id.index+", uniqueId="+e.work.id.uniqueId);this.oncanceled(e.work);e.terminate();e=undefined;delete this.working[t];this.count--}this.isRunning=false}var i=this.mincount-this.count;for(var t=0;t<i;t++){this.addWorker();this.count++}};iws.util.work.WorkCrew.prototype.clearData=function(t){if(t===null){for(var e=this.queue.length-1;e>=0;e--){this.oncanceled(this.queue[e].work);this.queue.splice(e,1)}}else{for(var e=this.queue.length-1;e>=0;e--){if(t===this.queue[e].work.cmd){this.oncanceled(this.queue[e].work);this.queue.splice(e,1)}}}};iws.util.work.WorkCrew.prototype.initAsync=function(){for(var t=this.queue.length-1;t>=0;t--)this.queue.splice(t,1);this.uuid=0;var e=this;(function(t){function i(){setTimeout(function(){if(e.isRunning===true){i(t)}else t()},0)}i()})(this.inited)};iws.util.work.WorkCrew.prototype.processQueue=function(){if(this.queue.length==0&&this.pool.length==this.count){if(this.onfinish){var t=this.count-this.mincount;if(this.refresh){t=this.count}for(var e=0;e<t;e++){var i=this.pool.shift();i.terminate();i=undefined;this.count--}this.onfinish();this.isRunning=false;this.uuid=0;if(this.refresh){for(var e=0;e<this.mincount;e++){this.addWorker();this.count++}}}}else{while(this.queue.length>0&&this.pool.length>0){var n=this.queue.shift();var i=this.pool.shift();i.id=n.id;i.work=n.work;this.working[i.id]=i;i.postMessage(n.work);this.onstarted(n.work)}}};iws.util.work.WorkCrew.prototype.addWorker=function(){var t=new Worker(this.filename);var e=this;t.onmessage=function(t){var i=this.id;delete e.working[this.id];this.id=null;e.pool.push(this);try{e.oncomplete(i,t)}catch(n){console.log(n);console.log("iwsT.WorkCrew onmessage: "+n.message+" ("+n.filename+":"+n.lineno+")");e.oncomplete(i,t)}if(e.queue.length!==0&&e.count<e.maxcount){e.addWorker();e.count++}e.processQueue()};t.onerror=function(t){console.log("iwsT.WorkCrew onerror: "+t.message+" ("+t.filename+":"+t.lineno+")")};this.pool.push(t)};iws.util.work.WorkCrew.prototype.fillPool=function(){for(var t=0;t<this.count;t++){this.addWorker()}};iws.util.sync=function(t){this.option=t;this.uuid=0;this.sendQueue=[];this.working=null;this.finishedCallback=[];this.processQueue=function(){var t=this;if(this.sendQueue.length===0&&this.working===null){this.onfinish()}else if(this.sendQueue.length>0&&this.working===null){var e=this.working=this.sendQueue.shift();e.callback&&e.callback(function(){setTimeout(function(){t.working=null;t.processQueue()},10)})}}};iws.util.sync.prototype.getCurrentWork=function(){return this.working};iws.util.sync.prototype.clear=function(t){for(var e=this.sendQueue.length-1;e>=0;e--)this.sendQueue.splice(e,1);if(this.working!==null){this.addFinishCallback(t);this.working.quit&&this.working.quit();this.working.quit=null}else{t&&t()}};iws.util.sync.prototype.addWork=function(t){t.__id=this.uuid++;this.sendQueue.push(t);this.processQueue();return t.__id};iws.util.sync.prototype.addFinishCallback=function(t){this.finishedCallback.push(t)};iws.util.sync.prototype.onfinish=function(){this.uuid=0;this.option&&this.option.callback&&this.option.callback();var t=[];for(var e=this.finishedCallback.length-1;e>=0;e--)t.push(this.finishedCallback.shift());t.forEach(function(t){t&&t()})}})();(function(){iws.util.print={};var t=function(t,e,i,n,r,s){var o=iws.util.Rotate(s).size(n,r);var a={W:t-i*2,H:e-i*2};var l=1;var h="";if(a.H/o.height*o.width<=a.W){l=a.H/o.height;h="H"}else{l=a.W/o.width;h="W"}var u=a.W/2-n/2*l+i;var c=a.H/2-r/2*l+i;var f=u+n*l;var d=c+r*l;var g=Math.round(u+(f-u)/2);var p=Math.round(c+(d-c)/2);var v=Math.round(o.width*l/2);var m=Math.round(o.height*l/2);return{scale:l,start:{x:u,y:c},end:{x:f,y:d},center:{x:g,y:p},offset:{x:g-v,y:p-m},fit:h}};var e=function(t,e,i,n,r){var s=iws.util.Rotate(r).size(i,n);var o=1;var a="";if(e/s.height*s.width<=t){o=e/s.height;a="H"}else{o=t/s.width;a="W"}var l=t/2-i/2*o;var h=e/2-n/2*o;var u=l+i*o;var c=h+n*o;var f=Math.round(l+(u-l)/2);var d=Math.round(h+(c-h)/2);var g=Math.round(s.width*o/2);var p=Math.round(s.height*o/2);return{scale:o,start:{x:l,y:h},end:{x:u,y:c},center:{x:f,y:d},offset:{x:f-g,y:d-p},fit:a}};var i=function(t,e,i,n){var r={
width:i,height:n};var s=1;var o="";if(e/r.height*r.width<=t){s=e/r.height;o="H"}else{s=t/r.width;o="W"}var a=t/2-i/2*s;var l=e/2-n/2*s;var h=a+i*s;var u=l+n*s;var c=Math.round(a+(h-a)/2);var f=Math.round(l+(u-l)/2);var d=Math.round(r.width*s/2);var g=Math.round(r.height*s/2);return{scale:s,start:{x:a,y:l},end:{x:h,y:u},center:{x:c,y:f},offset:{x:c-d,y:f-g},fit:o}};var n=function(t){var e=[];var i=iws.util.clone(t);Object.keys(i).map(function(t,n){var r=i[t];var s=iws.util.getKlass(r.type,null,"object");e[n]=s.fromObject(r)});return e};var r=function(t,e,i){var r=iws.util.Rotate(i).size(t.width,t.height);var o=document.createElement("canvas");o.width=r.width;o.height=r.height;var a={x:t.width/2,y:t.height/2};o.getContext("2d").save();o.getContext("2d").translate(a.x,a.y);o.getContext("2d").rotate(i*Math.PI/180);o.getContext("2d").translate(-a.x,-a.y);var l={left:0,top:0,right:t.width,bottom:t.height};var h=iws.util.Rotate(i).point(a.x,a.y,l.left,l.top);var u=iws.util.Rotate(i).point(a.x,a.y,l.right,l.top);var c=iws.util.Rotate(i).point(a.x,a.y,l.right,l.bottom);var f=iws.util.Rotate(i).point(a.x,a.y,l.left,l.bottom);var d=iws.util.Points([h,u,c,f]).getRect();var g=iws.util.Rotate(-i).point(0,0,d.left,d.top);o.getContext("2d").drawImage(t,-g.x,-g.y);o.getContext("2d").restore();s(o.getContext("2d"),o.width,o.height,e.filter);o.getContext("2d").save();var p=n(e.annotation);p.forEach(function(t){t.setControlVisible("mrdel",false);var i=e.pageinfo.xres<96?96:e.pageinfo.xres;t.render(o.getContext("2d"),null,1*i/96)}.bind(this));var v=n(e.masking);v.forEach(function(t){t.setControlVisible("mrdel",false);var i=e.pageinfo.xres<96?96:e.pageinfo.xres;t.render(o.getContext("2d"),null,1*i/96)}.bind(this));o.getContext("2d").restore();var m=o.toDataURL("image/jpeg",20);return o};var s=function(t,e,i,n){if(n.hasOwnProperty("brightness")&&n.hasOwnProperty("contrast")&&n.hasOwnProperty("gamma")){if(n.brightness!=iws.util.filter.defaultValue.brightness||n.contrast!=iws.util.filter.defaultValue.contrast){var r=t.getImageData(0,0,e,i);var s=iws.util.filter.brightness_contrast(r,n.brightness,n.contrast);t.putImageData(s,0,0)}else if(n.gamma!=iws.util.filter.defaultValue.gamma){var r=t.getImageData(0,0,e,i);var s=iws.util.filter.gamma(r,n.gamma/100);t.putImageData(s,0,0)}}};function o(e,i,n){var s=n.angle||0;var o=r(e,n,s);var a=document.createElement("canvas");var l=a.getContext("2d");a.width=210*5;a.height=297*5;var h=0;if(i&&i.printAutoFit){var u=a.width/a.height;var c={width:o.width,height:o.height};var f=iws.util.Rotate(90).size(o.width,o.height);var d=Math.abs(u-c.width/c.height);var g=Math.abs(u-f.width/f.height);h=d>g?90:0}var p=0;var v=8;if(n.printString.message.length>0){l.save();l.textBaseline="Bottom";l.font=n.printString.font;l.fillStyle=n.printString.fillStyle;p=parseInt(l.font);l.restore()}var m=t(a.width,a.height,p+v,o.width,o.height,h);l.clearRect(0,0,a.width,a.height);l.save();l.fillStyle="#fff";l.fillRect(0,0,a.width,a.height);l.translate(m.center.x,m.center.y);l.rotate(h*Math.PI/180);l.translate(-m.center.x,-m.center.y);l.translate(m.start.x,m.start.y);l.scale(m.scale,m.scale);l.drawImage(o,0,0);l.restore();l.save();if(n.printString.message.length>0){l.scale(1,1);l.textBaseline="Bottom";l.font=n.printString.font;l.fillStyle=n.printString.fillStyle;var b={width:l.measureText(n.printString.message).width,height:parseInt(l.font)};switch(n.printString.position){case"left":{var w=90;l.rotate(w*Math.PI/180);l.fillText(n.printString.message,a.height/2-b.width/2,0-v)}break;case"top":{var y=a.width/2-b.width/2;var x=b.height;l.fillText(n.printString.message,y,x)}break;case"right":{var w=90;l.rotate(w*Math.PI/180);l.fillText(n.printString.message,a.height/2-b.width/2,-a.width+b.height)}break;default:{var y=a.width/2-b.width/2;var x=a.height;l.fillText(n.printString.message,y,x-v)}break}}l.restore();return a.toDataURL("image/jpeg",i.quality)}var a=function(t,e,i,n,r){var s=document.createElement("canvas");var a=s.getContext("2d").createImageData(e,i);a.data.set(t);s.width=e;s.height=i;s.getContext("2d").putImageData(a,0,0);return o(s,n,r)};function l(t,e,i,n){var r=new Image;r.onload=function(t){n&&n(o(this,e,i))};r.src=t}iws.util.print.image_didenUseWorker=function(t,e){iws.util.run_waitMe($("body"),"progressBar");var i="print-"+(new Date).getTime();var n=$("<iframe/>",{id:i,class:"printBody",name:"printIframe",style:"display:none;",load:function(){console.log("laod the iframe")}});n.appendTo("body");var r=n.contents();var s=r.contents();var o=s.find("head");var a=s.find("body");var l=i;o.append("<title>"+l+"</title>");o.append('<meta charset="UTF-8">');o.append("<style> "+'body { margin: 0;\tpadding: 0;\tbackground-color: #FAFAFA;\tfont: 12pt "Tahoma"; }'+"* {\tbox-sizing: border-box;\t-moz-box-sizing: border-box;}"+".page {\twidth: 21cm;\tmin-height: 29.7cm;}"+".subpage {\tmargin: 0cm;\tpadding: 0.2cm;\twidth: 21.0cm;\theight: 29.7cm;\tbackground: #DFDFDF;}"+".printimg{\twidth: 20.6cm;\theight: 29.3cm;}"+"@page {\tsize: A4;\tmargin: 0;}"+"@media print {\t"+"\t.page {\tmargin: 0; border: initial;\tborder-radius: initial;\twidth: initial;\tmin-height: initial; box-shadow: initial; background: initial; page-break-after: always; }"+"}"+"</style> ")};iws.util.print.image=function(t,e,i){iws.util.run_waitMe($("body"),"progressBar");var n=i.printMark&&i.printMark.css||"";var r="print-"+(new Date).getTime();var s=$("<iframe/>",{id:r,class:"printBody",name:"printIframe",style:"display:none;",load:function(){console.log("load the iframe")}});s.appendTo("body");var o=s.contents();var h=o.contents();var u=h.find("head");var c=h.find("body");var f=0;u.append("<title>"+r+"</title>");u.append('<meta charset="UTF-8">');u.append("<style> "+'body { margin: 0;\tpadding: 0;\tbackground-color: #FAFAFA;\tfont: 12pt "Tahoma"; }'+"* {\tbox-sizing: border-box;\t-moz-box-sizing: border-box;}"+".page {\twidth: 21cm;\tmin-height: 29.7cm; padding: 0.9cm; background-color:red}"+".subpage {\tmargin: 0cm; /*border:1px solid #888888;*/\tbackground-color: #DFDFDF;}"+".printimg{\twidth: 19.0cm;\theight: 27.7cm; /*border:1px solid #888888;*/}"+".printmark{"+n+"}"+"@page {\tsize: A4;\tmargin: 0;}"+"@media print {\t"+"\t.page {\tmargin: 0; border: initial;\tborder-radius: initial;\twidth: initial;\tmin-height: initial; box-shadow: initial; background: initial; page-break-after: always; }"+"}"+"</style> ");function d(){function t(){console.log(" ");var t=s[0].contentWindow.document.execCommand("print",false,null);if(t===false)s[0].contentWindow.print();$("#"+r).remove()}var i=Date.now();var n=function(){var r=(Date.now()-i)/1e3;if(e.length==f){console.log(" loaded "+r+"seconds");setTimeout(function(){t()},500);return}if(r>5){console.log("  ."+r+"seconds");t();return}setTimeout(function(){n()},10)};setTimeout(function(){n()},10);iws.util.hide_waitMe($("body"))}var g=new iws.util.work.WorkCrew(t,0,1,false);g.oncomplete=function(t,e){var n=e.data,r=n.id;var s=new Date;var o="";o+='<div class="page" id="'+r.index.toString()+'">';o+='<div class="subpage">';o+='<img class="printimg"/>';if(i.printMark&&i.printMark.src){o+='<img class="printmark" src='+i.printMark.src+"/>"}o+="</div>";o+="</div>";$output=$(o);c.append($output);console.log("  "+r.index);if(n.src&&n.src!=""){l(n.src,i,r.page,function(t,e){return function(i){e.find(".printimg").each(function(){this.onload=function(e){console.log("  "+t.index);f++};this.src=i})}}(r,$output))}else{var h=a(n.pagearray,n.pageInfo.width,n.pageInfo.height,i,r.page);$output.find(".printimg").each(function(){this.onload=function(t){console.log("  "+r.index);f++};this.src=h})}};g.onfinish=function(){d()};e.forEach(function(t){t.__id=g.addWork(t)})}})();(function(){function t(){this.initialize.apply(this,arguments)}iws.Pattern=iws.util.createInheritClass(t,{repeat:"repeat",offsetX:0,offsetY:0,initialize:function(t){t||(t={});if(t.source){if(typeof t.source==="string"){if(typeof iws.util.getFunctionBody(t.source)!=="undefined"){this.source=new Function(iws.util.getFunctionBody(t.source))}else{var e=this;this.source=document.createElement("img");iws.util.loadImage(t.source,function(t){e.source=t})}}else{this.source=t.source}}if(t.repeat){this.repeat=t.repeat}if(t.offsetX){this.offsetX=t.offsetX}if(t.offsetY){this.offsetY=t.offsetY}},toLive:function(t){var e=typeof this.source==="function"?this.source():this.source;if(!e){return""}if(typeof e.src!=="undefined"){if(!e.complete){return""}if(e.naturalWidth===0||e.naturalHeight===0){return""}}return t.createPattern(e,this.repeat)}})})();(function(){var t=function(t){var e=new Uint8Array(t);if(!(e&&e.length>1)){return null}var i=function(t,i){if(!i){i={offset:0}}for(var n=0;n<t.length;n++){if(t[n]!==e[n+i.offset]){return false}}return true};if(i([255,216,255])){return{ext:"jpg",mime:"image/jpeg"}}if(i([137,80,78,71,13,10,26,10])){return{ext:"png",mime:"image/png"}}if(i([71,73,70])){return{ext:"gif",mime:"image/gif"}}if(i([87,69,66,80],{offset:8})){return{ext:"webp",mime:"image/webp"}}if((i([73,73,42,0])||i([77,77,0,42]))&&i([67,82],{offset:8})){return{ext:"cr2",mime:"image/x-canon-cr2"}}if(i([73,73,42,0])||i([77,77,0,42])){return{ext:"tif",mime:"image/tiff"}}if(i([66,77])){return{ext:"bmp",mime:"image/bmp"}}if(i([73,73,188])){return{ext:"jxr",mime:"image/vnd.ms-photo"}}if(i([56,66,80,83])){return{ext:"psd",mime:"image/vnd.adobe.photoshop"}}if(i([37,80,68,70])){return{ext:"pdf",mime:"application/pdf"}}if(i([80,75])&&(e[2]===3||e[2]===5||e[2]===7)&&(e[3]===4||e[3]===6||e[3]===8)){return{ext:"zip",mime:"application/zip"}}if(i([117,115,116,97,114],{offset:257})){return{ext:"tar",mime:"application/x-tar"}}if(i([82,97,114,33,26,7])&&(e[6]===0||e[6]===1)){return{ext:"rar",mime:"application/x-rar-compressed"}}if(i([31,139,8])){return{ext:"gz",mime:"application/gzip"}}if(i([66,90,104])){return{ext:"bz2",mime:"application/x-bzip2"}}if(i([55,122,188,175,39,28])){return{ext:"7z",mime:"application/x-7z-compressed"}}if(i([0,0,0])&&(e[3]===24||e[3]===32)&&i([102,116,121,112],{offset:4})||i([51,103,112,53])||i([0,0,0,28,102,116,121,112,109,112,52,50])&&i([109,112,52,49,109,112,52,50,105,115,111,109],{offset:16})||i([0,0,0,28,102,116,121,112,105,115,111,109])||i([0,0,0,28,102,116,121,112,109,112,52,50,0,0,0,0])){return{ext:"mp4",mime:"video/mp4"}}if(i([77,90])){return{ext:"exe",mime:"application/x-msdownload"}}return null};var e=["jpg","png","gif","bmp"];function i(i){var n=t(i);if(e.indexOf(n&&n.ext)!=-1){return n}else{return null}}iws.util.WebImageType=i})();(function(){var t=function(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var i="";var n;var r=0;while(t.length>=r+3){n=(t[r++]&255)<<16|(t[r++]&255)<<8|t[r++]&255;i+=e.charAt((n&16515072)>>18)+e.charAt((n&258048)>>12)+e.charAt((n&4032)>>6)+e.charAt(n&63)}if(t.length-r>0&&t.length-r<3){var s=Boolean(t.length-r-1);n=(t[r++]&255)<<16|(s?(t[r]&255)<<8:0);i+=e.charAt((n&16515072)>>18)+e.charAt((n&258048)>>12)+(s?e.charAt((n&4032)>>6):"=")+"="}return i};function e(t,e){var i=new Blob([t],{type:"application/octet-binary"});var n=new FileReader;n.onload=function(t){var i=t.target.result;e(i.substr(i.indexOf(",")+1))};n.readAsDataURL(i)}function i(t,e,i){var n=new Blob([e],{type:t});var r=new FileReader;r.onload=function(t){var e=t.target.result;i(t.target.result)};r.readAsDataURL(n)}function n(t){var e=atob(t);var i=e.length;var n=new Uint8Array(i);for(var r=0;r<i;r++){n[r]=e.charCodeAt(r)}return n.buffer}iws.util.byteArrayToBase64=t;iws.util.arrayBufferToBase64=e;iws.util.arrayBufferToImageBase64=i;iws.util.base64ToArrayBuffer=n;(function(){"use strict";var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var e=new Uint8Array(256);for(var i=0;i<t.length;i++){e[t.charCodeAt(i)]=i}var n=function(e){var i=new Uint8Array(e),n,r=i.length,s="";for(n=0;n<r;n+=3){s+=t[i[n]>>2];s+=t[(i[n]&3)<<4|i[n+1]>>4];s+=t[(i[n+1]&15)<<2|i[n+2]>>6];s+=t[i[n+2]&63]}if(r%3===2){s=s.substring(0,s.length-1)+"="}else if(r%3===1){s=s.substring(0,s.length-2)+"=="}return s};var r=function(t){var i=t.length*.75,n=t.length,r,s=0,o,a,l,h;if(t[t.length-1]==="="){i--;if(t[t.length-2]==="="){i--}}var u=new ArrayBuffer(i),c=new Uint8Array(u);for(r=0;r<n;r+=4){o=e[t.charCodeAt(r)];a=e[t.charCodeAt(r+1)];l=e[t.charCodeAt(r+2)];h=e[t.charCodeAt(r+3)];c[s++]=o<<2|a>>4;c[s++]=(a&15)<<4|l>>2;c[s++]=(l&3)<<6|h&63}return u};iws.util.base64={decode:r,encode:n}})()})();(function(){iws.util.showError=function(t,e){var i=350;var n=$(t).width()/2-i/2;var r=$("<div/>",{id:"iws-message0",class:"iws-message",style:"z-index: 1500;top: 0px;width: "+i+"px;left: "+n+"px;height: 170px;transition: 0s;transform: translateY(0px);",onmousedown:function(){event.stopPropagation()}});var s=$('<div class="iws-message-body"> '+'<div class="iws-centered">'+e+"</div>"+"</div>");r.append(s);var o=$('<div class="iws-message-buttons"></div>');var a=$("<button/>",{class:"iws-btn",click:function(){$(r).remove()}});a.text("OK");o.append(a);r.append(o);$(t).append(r)}})();(function(){iws.util.filter={defaultValue:{brightness:0,contrast:0,gamma:100},brightness_contrast:function(t,e,i,n){var r=new Uint8Array(256);var s=i/100+1;var o=128*(1-s);var a=e;var l=o+a;for(var h=0;h<r.length;h++){var u=h*s+l;r[h]=u<0?0:u>255?255:u}var c=document.createElement("canvas");var f=c.getContext("2d").createImageData(t.width,t.height);var d=t.data;for(var h=0,g=d.length;h<g;h+=4){f.data[h]=r[d[h]];f.data[h+1]=r[d[h+1]];f.data[h+2]=r[d[h+2]];f.data[h+3]=d[h+3]}return f},brightness:function(t,e){var i=new Uint8Array(256);for(var n=0;n<i.length;n++){var r=n+e;i[n]=r<0?0:r>255?255:r}var s=document.createElement("canvas");var o=s.getContext("2d").createImageData(t.width,t.height);var a=t.data;for(var n=0,l=a.length;n<l;n+=4){o.data[n]=i[a[n]];o.data[n+1]=i[a[n+1]];o.data[n+2]=i[a[n+2]];o.data[n+3]=a[n+3]}return o},contrast:function(t,e){var i=new Uint8Array(256);var n=e/100+1;var r=128*(1-n);for(var s=0;s<i.length;s++){var o=s*n+r;i[s]=o<0?0:o>255?255:o}var a=document.createElement("canvas");var l=a.getContext("2d").createImageData(t.width,t.height);var h=t.data;for(var s=0,u=h.length;s<u;s+=4){l.data[s]=i[h[s]];l.data[s+1]=i[h[s+1]];l.data[s+2]=i[h[s+2]];l.data[s+3]=h[s+3]}return l},gamma:function(t,e){var i=new Uint8Array(256);for(var n=0;n<i.length;n++){var r=Math.pow(n/255,1/e)*255;i[n]=r<0?0:r>255?255:r}var s=document.createElement("canvas");var o=s.getContext("2d").createImageData(t.width,t.height);var a=t.data;for(var n=0,l=a.length;n<l;n+=4){o.data[n]=i[a[n]];o.data[n+1]=i[a[n+1]];o.data[n+2]=i[a[n+2]];o.data[n+3]=a[n+3]}return o}}})()})();(function(){(function(t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t()}else if(typeof define==="function"&&define.amd){define([],t)}else{var e;if(typeof window!=="undefined"){e=window}else if(typeof global!=="undefined"){e=global}else if(typeof self!=="undefined"){e=self}else{e=this}e.Promise=t()}})(function(){var t,e,i;return function t(e,i,n){function r(o,a){if(!i[o]){if(!e[o]){var l=typeof require=="function"&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[o]={exports:{}};e[o][0].call(u.exports,function(t){var i=e[o][1][t];return r(i?i:t)},u,u.exports,t,e,i,n)}return i[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){(function(t){"use strict";var i=t.MutationObserver||t.WebKitMutationObserver;var n;{if(i){var r=0;var s=new i(u);var o=t.document.createTextNode("");s.observe(o,{characterData:true});n=function(){o.data=r=++r%2}}else if(!t.setImmediate&&typeof t.MessageChannel!=="undefined"){var a=new t.MessageChannel;a.port1.onmessage=u;n=function(){a.port2.postMessage(0)}}else if("document"in t&&"onreadystatechange"in t.document.createElement("script")){n=function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u();e.onreadystatechange=null;e.parentNode.removeChild(e);e=null};t.document.documentElement.appendChild(e)}}else{n=function(){setTimeout(u,0)}}}var l;var h=[];function u(){l=true;var t,e;var i=h.length;while(i){e=h;h=[];t=-1;while(++t<i){e[t]()}i=h.length}l=false}e.exports=c;function c(t){if(h.push(t)===1&&!l){n()}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],2:[function(t,e,i){"use strict";var n=t(1);function r(){}var s={};var o=["REJECTED"];var a=["FULFILLED"];var l=["PENDING"];e.exports=h;function h(t){if(typeof t!=="function"){throw new TypeError("resolver must be a function")}this.state=l;this.queue=[];this.outcome=void 0;if(t!==r){d(this,t)}}h.prototype["catch"]=function(t){return this.then(null,t)};h.prototype.then=function(t,e){if(typeof t!=="function"&&this.state===a||typeof e!=="function"&&this.state===o){return this}var i=new this.constructor(r);if(this.state!==l){var n=this.state===a?t:e;c(i,n,this.outcome)}else{this.queue.push(new u(i,t,e))}return i};function u(t,e,i){this.promise=t;if(typeof e==="function"){this.onFulfilled=e;this.callFulfilled=this.otherCallFulfilled}if(typeof i==="function"){this.onRejected=i;this.callRejected=this.otherCallRejected}}u.prototype.callFulfilled=function(t){s.resolve(this.promise,t)};u.prototype.otherCallFulfilled=function(t){c(this.promise,this.onFulfilled,t)};u.prototype.callRejected=function(t){s.reject(this.promise,t)};u.prototype.otherCallRejected=function(t){c(this.promise,this.onRejected,t)};function c(t,e,i){n(function(){var n;try{n=e(i)}catch(e){return s.reject(t,e)}if(n===t){s.reject(t,new TypeError("Cannot resolve promise with itself"))}else{s.resolve(t,n)}})}s.resolve=function(t,e){var i=g(f,e);if(i.status==="error"){return s.reject(t,i.value)}var n=i.value;if(n){d(t,n)}else{t.state=a;t.outcome=e;var r=-1;var o=t.queue.length;while(++r<o){t.queue[r].callFulfilled(e)}}return t};s.reject=function(t,e){t.state=o;t.outcome=e;var i=-1;var n=t.queue.length;while(++i<n){t.queue[i].callRejected(e)}return t};function f(t){var e=t&&t.then;if(t&&(typeof t==="object"||typeof t==="function")&&typeof e==="function"){return function i(){e.apply(t,arguments)}}}function d(t,e){var i=false;function n(e){if(i){return}i=true;s.reject(t,e)}function r(e){if(i){return}i=true;s.resolve(t,e)}function o(){e(r,n)}var a=g(o);if(a.status==="error"){n(a.value)}}function g(t,e){var i={};try{i.value=t(e);i.status="success"}catch(t){i.status="error";i.value=t}return i}h.resolve=p;function p(t){if(t instanceof this){return t}return s.resolve(new this(r),t)}h.reject=v;function v(t){var e=new this(r);return s.reject(e,t)}h.all=m;function m(t){var e=this;if(Object.prototype.toString.call(t)!=="[object Array]"){return this.reject(new TypeError("must be an array"))}var i=t.length;var n=false;if(!i){return this.resolve([])}var o=new Array(i);var a=0;var l=-1;var h=new this(r);while(++l<i){u(t[l],l)}return h;function u(t,r){e.resolve(t).then(l,function(t){if(!n){n=true;s.reject(h,t)}});function l(t){o[r]=t;if(++a===i&&!n){n=true;s.resolve(h,o)}}}}h.race=b;function b(t){var e=this;if(Object.prototype.toString.call(t)!=="[object Array]"){return this.reject(new TypeError("must be an array"))}var i=t.length;var n=false;if(!i){return this.resolve([])}var o=-1;var a=new this(r);while(++o<i){l(t[o])}return a;function l(t){e.resolve(t).then(function(t){if(!n){n=true;s.resolve(a,t)}},function(t){if(!n){n=true;s.reject(a,t)}})}}},{1:1}]},{},[2])(2)});(function(){var t=100;function e(t,e){this.create=t;this.available=[];this.acquired={};this.lastId=1;this.timeoutId=0;this.idle=e||2e3}e.prototype.acquire=function(){var t=this;var e=void 0;if(this.available.length!==0){e=this.available.pop()}else{e=this.create();e.id=this.lastId++;e.release=function(){return t.release(e)}}this.acquired[e.id]=e;return e};e.prototype.release=function(e){var i=this;delete this.acquired[e.id];e.lastUsed=Date.now();this.available.push(e);if(this.timeoutId===0){this.timeoutId=setTimeout(function(){return i.gc()},t)}};e.prototype.gc=function(){var e=this;var i=Date.now();this.available=this.available.filter(function(t){if(i-t.lastUsed>e.idle){t.destroy();return false}return true});if(this.available.length!==0){this.timeoutId=setTimeout(function(){return e.gc()},t)}else{this.timeoutId=0}};iws.Pool=e})();(function(){iws.limiter=function(t){var e=0,i=[];function n(){if(e<t&&i.length){e++;var n=i.shift();n()}}return function t(r){return new Promise(function(t,s){i.push(function(){r().then(function(i){t(i);e--;n()},function(t){s(t);e--;n()})});n()})}}})();(function(){var t=function(){onmessage=function t(e){var i=e.data.opts;var n=[{win:.5,filter:function(t){return t>=-.5&&t<.5?1:0}},{win:1,filter:function(t){if(t<=-1||t>=1){return 0}if(t>-1.1920929e-7&&t<1.1920929e-7){return 1}var e=t*Math.PI;return Math.sin(e)/e*(.54+.46*Math.cos(e/1))}},{win:2,filter:function(t){if(t<=-2||t>=2){return 0}if(t>-1.1920929e-7&&t<1.1920929e-7){return 1}var e=t*Math.PI;return Math.sin(e)/e*Math.sin(e/2)/(e/2)}},{win:3,filter:function(t){if(t<=-3||t>=3){return 0}if(t>-1.1920929e-7&&t<1.1920929e-7){return 1}var e=t*Math.PI;return Math.sin(e)/e*Math.sin(e/3)/(e/3)}}];var r=14;function s(t){return Math.round(t*((1<<r)-1))}var o=function t(e,i,r,o,a){var l=n[e].filter;var h=1/o;var u=Math.min(1,o);var c=n[e].win/u;var f,d,g,p,v,m,b,w,y,x,k,_,C;var S,T,A,M;var E=Math.floor((c+1)*2);var O=new Int16Array((E+2)*r);var P=0;var j=!O.subarray||!O.set;for(f=0;f<r;f++){d=(f+.5)*h+a;g=Math.max(0,Math.floor(d-c));p=Math.min(i-1,Math.ceil(d+c));v=p-g+1;m=new Float32Array(v);b=new Int16Array(v);w=0;for(y=g,x=0;y<=p;y++,x++){k=l((y+.5-d)*u);w+=k;m[x]=k}_=0;for(x=0;x<m.length;x++){C=m[x]/w;_+=C;b[x]=s(C)}b[r>>1]+=s(1-_);S=0;while(S<b.length&&b[S]===0){S++}if(S<b.length){T=b.length-1;while(T>0&&b[T]===0){T--}A=g+S;M=T-S+1;O[P++]=A;O[P++]=M;if(!j){O.set(b.subarray(S,T+1),P);P+=M}else{for(x=S;x<=T;x++){O[P++]=b[x]}}}else{O[P++]=0;O[P++]=0}}return O};function a(t){return t<0?0:t>255?255:t}function l(t,e,i,n,r,s){var o,l,h,u;var c,f,d;var g,p,v,m;var b=0,w=0;for(p=0;p<n;p++){c=0;for(v=0;v<r;v++){f=s[c++];d=s[c++];g=b+f*4|0;o=l=h=u=0;for(;d>0;d--){m=s[c++];u=u+m*t[g+3]|0;h=h+m*t[g+2]|0;l=l+m*t[g+1]|0;o=o+m*t[g]|0;g=g+4|0}e[w+3]=a(u+(1<<13)>>14);e[w+2]=a(h+(1<<13)>>14);e[w+1]=a(l+(1<<13)>>14);e[w]=a(o+(1<<13)>>14);w=w+n*4|0}w=(p+1)*4|0;b=(p+1)*i*4|0}}function h(t,e,i,n,r,s){var o,l,h,u;var c,f,d;var g,p,v,m;var b=0,w=0;for(p=0;p<n;p++){c=0;for(v=0;v<r;v++){f=s[c++];d=s[c++];g=b+f*4|0;o=l=h=u=0;for(;d>0;d--){m=s[c++];u=u+m*t[g+3]|0;h=h+m*t[g+2]|0;l=l+m*t[g+1]|0;o=o+m*t[g]|0;g=g+4|0}e[w+3]=a(u+(1<<13)>>14);e[w+2]=a(h+(1<<13)>>14);e[w+1]=a(l+(1<<13)>>14);e[w]=a(o+(1<<13)>>14);w=w+n*4|0}w=(p+1)*4|0;b=(p+1)*i*4|0}}function u(t,e,i){var n=3,r=e*i*4|0;while(n<r){t[n]=255;n=n+4|0}}function c(t){var e=t.src;var i=t.width;var n=t.height;var r=t.toWidth;var s=t.toHeight;var a=t.scaleX||t.toWidth/t.width;var c=t.scaleY||t.toHeight/t.height;var f=t.offsetX||0;var d=t.offsetY||0;var g=t.dest||new Uint8Array(r*s*4);var p=typeof t.quality==="undefined"?3:t.quality;var v=t.alpha||false;var m=o(p,i,r,a,f),b=o(p,n,s,c,d);var w=new Uint8Array(r*n*4);l(e,w,i,n,r,m);h(w,g,n,r,s,b);if(!v)u(g,r,s);return g}var f,d,g,p,v,m,b,w;function y(t){if(t<.5){t=.5}var e=Math.exp(.726*.726)/t,i=Math.exp(-e),n=Math.exp(-2*e),r=(1-i)*(1-i)/(1+2*e*i-n);f=r;d=r*(e-1)*i;g=r*(e+1)*i;p=-r*n;v=2*i;m=-n;b=(f+d)/(1-v-m);w=(g+p)/(1-v-m);return new Float32Array([f,d,g,p,v,m,b,w])}function x(t,e,i,n,r,s){var o,a,l,h,u;var c,f,d;var g,p;var v,m,b,w;for(g=0;g<s;g++){c=g*r;f=g;d=0;o=t[c];u=o*n[6];h=u;v=n[0];m=n[1];b=n[4];w=n[5];for(p=0;p<r;p++){a=t[c];l=a*v+o*m+h*b+u*w;u=h;h=l;o=a;i[d]=h;d++;c++}c--;d--;f+=s*(r-1);o=t[c];u=o*n[7];h=u;a=o;v=n[2];m=n[3];for(p=r-1;p>=0;p--){l=a*v+o*m+h*b+u*w;u=h;h=l;o=a;a=t[c];e[f]=i[d]+h;c--;d--;f-=s}}}var k=function t(e,i,n,r){if(!r){return}var s=new Uint16Array(e.length),o=new Float32Array(Math.max(i,n));var a=y(r);x(e,s,o,a,i,n,r);x(s,e,o,a,n,i,r)};function _(t,e,i){var n=e*i;var r=new Uint16Array(n);var s,o,a,l,h;for(var u=0;u<n;u++){s=t[4*u];o=t[4*u+1];a=t[4*u+2];h=s>=o&&s>=a?s:o>=a&&o>=s?o:a;l=s<=o&&s<=a?s:o<=a&&o<=s?o:a;r[u]=(h+l)*257>>1}return r}function C(t,e,i,n,r,s){var o,a,l;var h,u,c;var f,d;var g,p,v;var m,b;if(n===0||r<.5){return}if(r>2){r=2}var w=_(t,e,i);var y=new Uint16Array(w);k(y,e,i,r);var x=n/100*4096+.5|0;var C=s*257|0;var S=e*i;for(var T=0;T<S;T++){m=2*(w[T]-y[T]);if(Math.abs(m)>=C){b=T*4;o=t[b];a=t[b+1];l=t[b+2];d=o>=a&&o>=l?o:a>=o&&a>=l?a:l;f=o<=a&&o<=l?o:a<=o&&a<=l?a:l;c=(d+f)*257>>1;if(f===d){h=u=0}else{u=c<=32767?(d-f)*4095/(d+f)|0:(d-f)*4095/(2*255-d-f)|0;h=o===d?(a-l)*65535/(6*(d-f))|0:a===d?21845+((l-o)*65535/(6*(d-f))|0):43690+((o-a)*65535/(6*(d-f))|0)}c+=x*m+2048>>12;if(c>65535){c=65535}else if(c<0){c=0}if(u===0){o=a=l=c>>8}else{p=c<=32767?c*(4096+u)+2048>>12:c+((65535-c)*u+2048>>12);g=2*c-p>>8;p>>=8;v=h+21845&65535;o=v>=43690?g:v>=32767?g+((p-g)*6*(43690-v)+32768>>16):v>=10922?p:g+((p-g)*6*v+32768>>16);v=h&65535;a=v>=43690?g:v>=32767?g+((p-g)*6*(43690-v)+32768>>16):v>=10922?p:g+((p-g)*6*v+32768>>16);v=h-21845&65535;l=v>=43690?g:v>=32767?g+((p-g)*6*(43690-v)+32768>>16):v>=10922?p:g+((p-g)*6*v+32768>>16)}t[b]=o;t[b+1]=a;t[b+2]=l}}}var S=function t(e){var i=c(e);if(e.unsharpAmount){C(i,e.toWidth,e.toHeight,e.unsharpAmount,e.unsharpRadius,e.unsharpThreshold)}return i};var T=S(i);postMessage({result:T},[T.buffer])}};var e=function(e){e=e||t;var i=e.toString();var n=window.URL||window.webkitURL||window.mozURL||window.msURL;var r=new Blob(["(",i,")()"],{type:"text/javascript"});var s=n.createObjectURL(r);var o=new Worker(s);o.objectURL=s;return o};iws.workerBlobURL=e})();(function(){"use strict";var t=1e-5;function e(e){var i=Math.round(e);if(Math.abs(e-i)<t){return i}return Math.floor(e)}function i(e){var i=Math.round(e);if(Math.abs(e-i)<t){return i}return Math.ceil(e)}iws.tileRegions=function(t){var n=t.toWidth/t.width;var r=t.toHeight/t.height;var s=e(t.srcTileSize*n)-2*t.destTileBorder;var o=e(t.srcTileSize*r)-2*t.destTileBorder;var a,l;var h,u,c,f;var d=[];var g;for(u=0;u<t.toHeight;u+=o){for(h=0;h<t.toWidth;h+=s){a=h-t.destTileBorder;if(a<0){a=0}c=h+s+t.destTileBorder-a;if(a+c>=t.toWidth){c=t.toWidth-a}l=u-t.destTileBorder;if(l<0){l=0}f=u+o+t.destTileBorder-l;if(l+f>=t.toHeight){f=t.toHeight-l}g={toX:a,toY:l,toWidth:c,toHeight:f,toInnerX:h,toInnerY:u,toInnerWidth:s,toInnerHeight:o,offsetX:a/n-e(a/n),offsetY:l/r-e(l/r),scaleX:n,scaleY:r,x:e(a/n),y:e(l/r),width:i(c/n),height:i(f/r)};d.push(g)}}return d}})();(function(){var t={};var e=false;try{if(typeof navigator!=="undefined"&&navigator.userAgent){e=navigator.userAgent.indexOf("Safari")>=0}}catch(t){}var i=1;if(typeof navigator!=="undefined"){i=Math.min(navigator.hardwareConcurrency||1,4)}var n={tile:1024,concurrency:i,idle:2e3};var r={quality:0,alpha:false,unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0};function s(){return{value:iws.workerBlobURL(),destroy:function t(){this.value.terminate();if(typeof window!=="undefined"){var e=window.URL||window.webkitURL||window.mozURL||window.msURL;if(e&&e.revokeObjectURL&&this.value.objectURL){e.revokeObjectURL(this.value.objectURL)}}}}}function o(t){this.options=$.extend(n,t||{});this.__limit=iws.limiter(this.options.concurrency)}o.prototype.init=function(){var e="wp_"+JSON.stringify(this.options);if(t[e]){this.__workersPool=t[e]}else{this.__workersPool=new iws.Pool(s,this.options.idle);t[e]=this.__workersPool}return Promise.resolve(true).then(function(t){return"abc"})};o.prototype.resize=function(t,i,n){var s=this;this.debug("Start resize...");var o=$.extend(r,n);o.toWidth=i.width;o.toHeigth=i.height;o.width=t.naturalWidth||t.width;o.height=t.naturalHeight||t.height;var a=false;var l=null;if(o.cancelToken){l=o.cancelToken.then(function(t){a=true;throw t},function(t){a=true;throw t})}var h=i.getContext("2d",{alpha:Boolean(o.alpha)});return this.init().then(function(n){if(a)return l;var r=t.getContext("2d",{alpha:Boolean(o.alpha)});var u=function t(e){return new Promise(function(t,i){var n=s.__workersPool.acquire();if(l)l.catch(function(t){return i(t)});n.value.onmessage=function(e){n.release();if(e.data.err)i(e.data.err);else t(e.data.result)};n.value.postMessage({opts:e},[e.src.buffer])})};var c=function t(i){var n=function(){if(a)return l;var t=r.getImageData(i.x,i.y,i.width,i.height);var n={src:t.data,width:i.width,height:i.height,toWidth:i.toWidth,toHeight:i.toHeight,scaleX:i.scaleX,scaleY:i.scaleY,offsetX:i.offsetX,offsetY:i.offsetY,quality:o.quality,alpha:o.alpha,unsharpAmount:o.unsharpAmount,unsharpRadius:o.unsharpRadius,unsharpThreshold:o.unsharpThreshold};s.debug("Invoke resize math");return Promise.resolve().then(function(){return u(n)}).then(function(t){if(a)return l;s.debug("Convert raw rgba tile result to ImageData");var n=h.createImageData(i.toWidth,i.toHeight);n.data.set(t);s.debug("Draw tile");if(e){h.putImageData(n,i.toX,i.toY,i.toInnerX-i.toX,i.toInnerY-i.toY,i.toInnerWidth+1e-5,i.toInnerHeight+1e-5)}else{h.putImageData(n,i.toX,i.toY,i.toInnerX-i.toX,i.toInnerY-i.toY,i.toInnerWidth,i.toInnerHeight)}return"success"})};return s.__limit(n)};return Promise.resolve().then(function(){if(a)return l;s.debug("Calculate tiles");var t=3;var e=iws.tileRegions({width:o.width,height:o.height,srcTileSize:s.options.tile,toWidth:o.toWidth,toHeight:o.toHeigth,destTileBorder:Math.ceil(Math.max(t,2.5*o.unsharpRadius|0))});var n=e.map(function(t,e){return c(t)});function r(){}s.debug("Process tiles");return Promise.all(n).then(function(){s.debug("Finished!");r();return i},function(t){r();throw t})})})};o.prototype.debug=function(){};iws.resizer=o})()})();(function(){"use strict";function t(i){return{point:function(t,e,n,r){var s=Math.PI/180*i,o=Math.cos(s),a=Math.sin(s),l=o*(n-t)-a*(r-e)+t,h=o*(r-e)+a*(n-t)+e;return{x:l,y:h}},rect:function(n,r,s){var o=t(i).point(n,r,s.left,s.top);var a=t(i).point(n,r,s.right,s.top);var l=t(i).point(n,r,s.right,s.bottom);var h=t(i).point(n,r,s.left,s.bottom);return e([o,a,l,h]).getRect()},size:function(e,n){var r=t(i).point(0,0,e,n);return{width:Math.round(Math.abs(r.x)),height:Math.round(Math.abs(r.y))}}}}iws.util.Rotate=t;function e(t){function e(t,e,i,n){if(t>i)i=[t,t=i][0];if(e>n)n=[e,e=n][0];return{left:t,top:e,right:i,bottom:n}}return{getRect:function(){var i,n,r,s;i=r=t[0].x;n=s=t[0].y;for(var o=0;o<t.length;o++){if(i>t[o].x)i=t[o].x;if(n>t[o].y)n=t[o].y;if(r<t[o].x)r=t[o].x;if(s<t[o].y)s=t[o].y}return e(i,n,r,s)}}}iws.util.Points=e;function i(t){return{round:function(){return{left:Math.round(t.left),top:Math.round(t.top),right:Math.round(t.right),bottom:Math.round(t.bottom)}},abs:function(){return{left:Math.abs(t.left),top:Math.abs(t.top),right:Math.abs(t.right),bottom:Math.abs(t.bottom)}},size:function(){return{width:t.right-t.left,height:t.bottom-t.top}},width:function(){return Math.abs(t.right-t.left)},height:function(){return Math.abs(t.bottom-t.top)},center:function(){return{x:t.left+(t.right-t.left)/2,y:t.top+(t.bottom-t.top)/2}},normal:function(){var e=t.left;var i=t.top;var n=t.right;var r=t.bottom;if(e>n)n=[e,e=n][0];if(i>r)r=[i,i=r][0];return{left:e,top:i,right:n,bottom:r}}}}iws.util.Rect=i;function n(){this.leftMouseButtonDown=false;this.mouseDownPos={x:0,y:0};this.mouseMovePos={x:0,y:0};this.mousePrevMoveOffset={x:0,y:0};this._mouseType="move";this.magnificationScale=2;this.intersectRect={}}n.prototype={get mouseType(){return this._mouseType},set mouseType(t){this._mouseType=t},isRange:function(){return this.leftMouseButtonDown&&this.mouseType=="range"},isMove:function(){return this.leftMouseButtonDown&&this.mouseType=="move"},isGlass:function(){return this.leftMouseButtonDown&&this.mouseType=="glass"},getRect:function(){return i({left:this.mouseDownPos.x,top:this.mouseDownPos.y,right:this.mouseMovePos.x,bottom:this.mouseMovePos.y}).normal()},getLT:function(){var t=this.getRect();return{x:t.left,y:t.top}},getRB:function(){var t=this.getRect();return{x:t.right,y:t.bottom}},getIntersectRect:function(t){this.intersectRect=this.getRect();if(this.intersectRect.left<t.left)this.intersectRect.left=t.left;else if(this.intersectRect.left>t.right)this.intersectRect.left=t.right;
if(this.intersectRect.top<t.top)this.intersectRect.top=t.top;else if(this.intersectRect.top>t.bottom)this.intersectRect.top=t.bottom;if(this.intersectRect.right>t.right)this.intersectRect.right=t.right;else if(this.intersectRect.right<t.left)this.intersectRect.right=this.intersectRect.left;if(this.intersectRect.bottom>t.bottom)this.intersectRect.bottom=t.bottom;else if(this.intersectRect.bottom<t.top)this.intersectRect.bottom=t.top;return this.intersectRect},drawMagnifyGlass:function(t){t.getContext("2d").save();var e={};var i=60;e.x=this.mouseMovePos.x-i;e.y=this.mouseMovePos.y-i;e.width=i*2;e.height=i*2;var n={width:e.width*this.magnificationScale,height:e.height*this.magnificationScale};var r=e.x+e.width/2-n.width/2;var s=e.y+e.height/2-n.height/2;e.x=e.x<0?0:e.x;e.x=e.x>t.width-i*2?t.width-i*2:e.x;e.y=e.y<0?0:e.y;e.y=e.y>t.height-i*2?t.height-i*2:e.y;r=r<0?0:r;r=r>t.width-n.width?t.width-n.width:r;s=s<0?0:s;s=s>t.height-n.height?t.height-n.height:s;t.getContext("2d").drawImage(t,e.x,e.y,e.width,e.height,r,s,n.width,n.height);t.getContext("2d").lineWidth=2;t.getContext("2d").strokeStyle="#FF0000";t.getContext("2d").strokeRect(r,s,n.width,n.height);t.getContext("2d").restore()},drawRange:function(t,e){var i=t.getContext("2d");this.intersectRect=this.getIntersectRect(e);i.save();this._drawRect(i,this.intersectRect,"red","#FF0000");i.restore()},drawSelect:function(t,e,i,n){i=i||"blue";n=n||"#0000FF";var r=t.getContext("2d");r.save();this._drawRect(r,e,i,n);r.restore()},_drawRect:function(t,e,i,n){t.beginPath();t.setLineDash([2]);t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top);t.lineWidth=1;t.strokeStyle=i;t.stroke();t.fillStyle=n;t.globalAlpha=.2;t.fill()}};iws.TrackMouse=n;function r(){this.initialize.apply(this,arguments)}r.prototype={get width(){return this.imgCanvas.width},set width(t){this.imgCanvas.width=t},get height(){return this.imgCanvas.height},set height(t){this.imgCanvas.height=t},get angle(){return this.m_angle},set angle(t){this.m_angle=(t||0)%360},get scale(){return this.m_scale},set scale(t){if(t<.1)t=.1;if(t>4)t=4;this.m_scale=t},get fitMode(){if(this.m_fitMode.name==="scale"){this.m_fitMode.scale=this.scale}return this.m_fitMode},set fitMode(t){var e=this.scale;var i=this.getDrawCenter();this.m_fitMode=t;var n=null;if(this.isValid()){switch(this.m_fitMode.name){case"auto":this.fitAuto();break;case"width":this.fitWidth();break;case"height":this.fitHeight();break;case"scale":this.fitScale();break;case"original":this.fitOriginal();break}var r=this.getDrawCenter();n={oldScale:e,changeRate:this.scale/e,oldCenter:i,center:r,offset:{x:r.x-i.x,y:r.y-i.y}}}this.page.fire("page:fitMode",{input:{mode:t},output:n})},initialize:function(t){this.page=t;if(iws.mask){this.maskImage=new Image;this.maskImage.onload=function(t){iws.log("mask ready!")};this.maskImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVMAAAAgCAYAAACvipuvAAAJ0klEQVR42u2c34tVVRTHzx0HTSYzyx9MYv6AUFGkMH8OlSRjRXilC5F5Y3y41BBCdg0TQ0O0JApNE0Eis3yY0MAMBxIMDTEcJIbwQQaffBJ68GX+gdvetA5tN9+199r3njuMuL6wQO4c1z1n//jstdfa52aZSqVSqVQqlUqlUsVUNdYAVtWmUT1kWmjsbzAXThibrM2jUpiqVApTlcJUpVKYqhSmKpXCVKVSqRSmClOVSqV6aGF6GDzEz8ameteVjO0A114y1g389oJr7xqrM58vBz5W0t/ca0eNrQfXPmXsCvC9m57H/9w+90TPxyRjR8G1p4x1ge/sB9f+aWxuAdv85eDZrZWBr/nGhsC1NXDtFGOnBe1h22IdtcdVane3D67S39YY64g8qx0784x9aOxXY3eAr4P0fdLJ85ixzcZ+Mjbi+Buhz7YYm5kwD1r1xwGhh9rnJWM/OM9u/R6idilKtu02GDtu7Lp3H/lz2DE7h/okJnvfS40d8MZA3mf28xXGOscIprOMnWfmzRDda8hflfx94PTxcJEwRdC7aWyRd900Y+fAtQhutqP2gGvtJH6GgV6fEN7W9hub4F3f4014a7eNLWOgZxeBGUIo3TK2BAzcE+Dag+DemoEpB719YCJUGF9oEeAGWq9zje2jC4xPZCdBW7rw/hz0DWc3jK0NTHYL+a0ekDm7R4t3CNBF+ePa9TVj30R8bhbCLbRYraW2k7TxKPXJlIDPBcbOCP3ZsfJsm2HaRYtEDKQhf7afd4HPC1M3gSUWAXGRUoPAWRJEPzUCzX5BZDSViSit/WZsuiBKzGGyhIAYi4bLgQFTFUTCXNTcDEwzaq/YrmEis7to0IBaKFg83d3FbGOXE0Ca2zEAmRnMOIjZHYrkfHURBFL9HWd2FkX64ybw3RaeVwrSinAxkLbLGuZZ2vUMMZh2MhDMQbpY6O8kaKfRImHKRZF+BFQPNKQPN/QwbnSHokg/UgzBe5R8xKLEWuTvfUIooS0H9wzdBcIUtaO/a5hLqQXJIsD1tRvp15hFKX8uuy0dEOxQOpsEVW6XCezuvW9vwd9Ob8dQtL+FTQDItbO0+0vVMhAopNi73jy3/XutSV9DtKspEqZdlGIZFYI0tS8uFZ03RblJNwKaEokwfLiVIzBCKQM/UuyPNIIbDSOg+FFZJRINczlXzl9dEKG3ClMuh1uORJpcu6No3++7vYKFdSW19ymCr82bPenlTlcyi6H9vm2Uo8x3Rtz2rSaYIDbSeMeJYDYyUZqfqhkrfw0a6wuofVYzqaSUXU1sfFgbJNB20HO87uWCUQAwgWoMyN8APUOJrv82IQXXLEztd7yXCNJUmO4oGqYIbm4EtIzyjxK4cdFPRZAP7RPC24+GUZR4lAZbKB/qRsO9goavBiLduwSQrECYcotADrcJlKNtCBcBNMjOeRHRXmaiDxDceqgQECsUcTuZ3WCyzabCgi2QfESFqFleYaNfGFmV6DN0bb2N/rgJfIvmjyTHvTtx3nK7EpTeKVH/2cLRlxTtWRg9Kiji+ruEUDpIWoCVwO8fBqSWRc814S+H8Apqj2mg0F6I6oEIqB8MkKsM3FD0M0Qwi+Vg80gRwXswEFHVI/DmtvF5NIygdBMM1DzKQ4P4XOI2TQpT9F35rgEN/j9A21UDO4YdHjzWJxSLbL9+bOxpYXHuNgCLRI8w0SvnbxH1HxelF+0vNIFPg0KPxJ9EPUy/SIugvlYzfY/8lWhRbzAnGIqAaUp6QupvTF6KQUWafTQQToEcWoWBG3oQ1BldwG8eKdYAvF8B4NhDfvyJe4VA4wuBoo8pwu2n7Sha8VEk3J/Y3lKYooJdvmvwn8f++w0Q1ee5pz0CeNho/tPEgW0r0u87kSRXPGwmagn54/qZi7DyRahof9KKtFuYu5TJjiSGVBZEzFkB/rixzUX35TGAaSg/y/lDp5TaIgQ327mrwI31MxGTnaybEnJBNRApvgDgeJpycodBNPw8uA8ub4OgaX2+DODYy0TPVRAJo6NTRcGUWwQ2ATjmMKiDRWAVAAh3fnYSwTGlQjxK95SnjQYz2XG0hxGmnL+LNM6leovpi76HAKYNKnB2JvhLbd+WVAUkP8REM2jbfJGOH0gr3Oihv2bgjTrbTuADCfBG+dzfQTI9n1Ro0p2hyqsESkXBdDotHP4xj4vMDgAtAofA1rIWucdOqu5uoW3xcGRw51va8brNP06+ivan2/z759/qgmE6woy9OxRMSf2hvmibuEPr3A2VBatHqMIdqkaiAR47BsSdQc0EVWZu8NQTClNcAadBnzcL09ALDOjgfeiMbqhIIdFkasOBwMrPFSG5XJet7H+f/Xf4+xOqPM/3wFIvoGDU30Z/RRSg3HEnGUfcd6KCkZV9O+ovWgTQKQxufqUUoNzonrs/f+zFCkaL6d5HmYq/9MzvmL6eKoFbXVBNTKlwVyLf526lYmdBUUHFF/cmF7dNWR6Br19cawdMJYuAn4+MLQL+aYccHFNp8Nrc62cEyO/AgH0xw8dxpkUKWTaayI8elWhSfpXF3+BCOf3c30aKolOOMhXtLwSEQcrvdRDAuIClkjiOUGoOHWWy8+ZV5v7cnRz3Qk0OrW4nXSY5GtUqTN3jT9yzuumlcQXTWLTpnwWNwU1S4Y4BuZ54f5LjSfUEKMWiPB9K7YJp7D78N8hii0BFWITMB+x2B2zcZHInkh20x5rIg7nfucErxO1swd92b5Et2l+rh/avZfe/py8dRz1Zc28/5fZj9v+Z34ygP1TQM7QKUx9+3AJtf+9h5niEKfd6KQfHcgIIkUKrIYJjCL7SaigHDS5iqwuj2HbCFBXsQnAMwZerqrcCGFRdDf0wRcx2geJCs69/HsmKfZ30SMLWUrpwbPHgLB1HpYx/Q0jSZ+jgezOvk47QbiVrI0xDkbibnhk3MA3BDeU/ObilFBu4FQflP0PRsPR4UqhTEMy4KA9Vf9sJU24R4PKf9SYKFJOpn1Mm54WMP6byhLEvEvzZSfl2xv8SkV3o7JG1e5nsyNY2sDi2w1+ognw+4nMreF7pOMqBak+k3MjSItI5gXZZlMl/7OZCho8cFQ3TECvcxXxc/aQfOkfpv3YYy7OmVLhRtTpUvKoIcljNVNM5KHF5VnQEq50w5ark3CBJ+QlDf3LOocXJvpV0HQDAFh8O0ELTIfRnj1v9AiqzwzRe3vS2nCHFfjJvc4KvIvyFJvDjlLM860B7mNpvHuMvBabu+FhH8/Gyt0DcI7Db/79U0GdZJvsJvpCvdsA0FAjlR6X0x6ZVqgdYOoFVKpVKYapSqVQKU5VKpVKYqlQqlUphqlKpVApTlUqlUqlUKpVK9SDpX8bUI9HUwnSFAAAAAElFTkSuQmCC"}this.imgCanvas=document.createElement("canvas");this.imgCanvas.getContext("2d").imageSmoothingEnabled=true;this.imgCanvas.width=0;this.imgCanvas.height=0;this.reSampleCanvas=document.createElement("canvas");this.reSampleCanvas.getContext("2d").imageSmoothingEnabled=true;this.reSampleCanvas.width=0;this.reSampleCanvas.height=0;this.originalImageData=null;this.m_scale=1;this.m_scaleStep=.1;this.m_angle=0;this.m_fitMode={name:"auto"};this.startPt={x:0,y:0};this.getEndPt=function(){var t=this.startPt.x+this.imgCanvas.width*this.scale;var e=this.startPt.y+this.imgCanvas.height*this.scale;return{x:t,y:e}};this.getRect=function(){var t=this.startPt;var e=this.getEndPt();return{left:t.x,top:t.y,right:e.x,bottom:e.y}};this.fitAuto=function(){var t=this.page.lowerCanvasEl;var e=this.getRotateSize();if(t.clientHeight/e.height*e.width<=t.clientWidth)this.fitHeight();else this.fitWidth()};this.fitHeight=function(){var t=this.page.lowerCanvasEl;var e=this.getRotateSize();this.scale=t.clientHeight/e.height;this._fixPosition(t)};this.fitWidth=function(){var t=this.page.lowerCanvasEl;var e=this.getRotateSize();this.scale=t.clientWidth/e.width;this._fixPosition(t)};this.fitScale=function(){if(this.m_fitMode.scale){this.scale=this.m_fitMode.scale}var t=this.page.lowerCanvasEl;this._fixPosition(t)};this.fitOriginal=function(){this.scale=96/this.xres;this.scaleX=96/this.xres;this.scaleY=96/this.yres;var t=this.width*96/this.xres;var e=this.height*96/this.yres;this.fitScale()};this._fixPosition=function(t){var e=this.startPt;var n=this.getDrawRect();if(i(n).height()>t.height){if(n.top>0){this.startPt.y=this.startPt.y-n.top}else if(n.bottom<t.height){this.startPt.y+=t.height-n.bottom}}else{this.startPt.y=t.height/2-this.height/2*this.scale}if(i(n).width()>t.width){if(n.left>0){this.startPt.x=this.startPt.x-n.left}else if(n.right<t.width){this.startPt.x+=t.width-n.right}}else{this.startPt.x=t.width/2-this.width/2*this.scale}return{offsetX:this.startPt.x-e.x,offsetY:this.startPt.y-e.y}};this.ImageProps={xres:true,yres:true}},clear:function(){this.width=0,this.height=0;this.clearResample();this.originalImageData=null},clearResample:function(){this.reSampleCanvas.width=0,this.reSampleCanvas.height=0},isValid:function(){return this.width>0&&this.height>0},isValidResample:function(){return this.reSampleCanvas.width>0&&this.reSampleCanvas.height>0},setSrc:function(t,e,i){var n=this;var r=new Image;r.onload=function(){n.clear();n.width=this.width,n.height=this.height,n.angle=e;var t=n.imgCanvas.getContext("2d");n.imgCanvas.width=this.width;n.imgCanvas.height=this.height;t.drawImage(this,0,0,this.width,this.height);if(n.maskImage){t.globalAlpha=.5;t.drawImage(n.maskImage,0,this.height-n.maskImage.height);t.globalAlpha=1}n.page.fire("page:setRawData");n.fitRefresh();i&&i()};r.src=t},setRawData:function(t,e,i,n,r){this.clear();this.width=t,this.height=e,this.angle=n;var s=this.imgCanvas.getContext("2d").createImageData(this.imgCanvas.width,this.imgCanvas.height);s.data.set(i);this.imgCanvas.getContext("2d").putImageData(s,0,0);this.page.fire("page:setRawData");this.fitRefresh();r&&r()},setSizeResample:function(t,e){this.reSampleCanvas.width=t;this.reSampleCanvas.height=e},setRawDataReSample:function(t,e,i){this.reSampleCanvas.width=t;this.reSampleCanvas.height=e;var n=this.reSampleCanvas.getContext("2d").createImageData(t,e);n.data.set(i);this.reSampleCanvas.getContext("2d").putImageData(n,0,0)},setRawDataReSampleRange:function(t,e,i,n,r){var s=this.reSampleCanvas.getContext("2d").createImageData(t,e);s.data.set(i);this.reSampleCanvas.getContext("2d").putImageData(s,n,r)},getCanvas:function(){return this.imgCanvas},getCanvasResample:function(){return this.reSampleCanvas},getImageData:function(t,e,i,n){if(!this.isValid())return null;t=t||0;e=e||0;i=i||this.width;n=n||this.height;var r=this.imgCanvas.getContext("2d").getImageData(t,e,i,n);return r},getOriginalImageData:function(){if(!this.originalImageData){this.originalImageData=this.getImageData()}return this.originalImageData},putImageData:function(t){this.imgCanvas.getContext("2d").putImageData(t,0,0)},rotate:function(t){this.m_angle+=t;this.page.fire("page:rotate",{input:{angle:t}});this.fitRefresh()},setAngle:function(t){var e=(t-this.m_angle+360)%360;this.m_angle=t;this.page.fire("page:rotate",{input:{angle:e}});this.fitRefresh()},zoom:function(t,e){var n=this.page.lowerCanvasEl;e=e||{x:n.width/2,y:n.height/2};var r=this.getDrawCenter();var s=this.getDrawRect();var o=this.scale;if(t==="in"){this.scale=this.scale*(1+this.m_scaleStep)}else if(t==="out"){this.scale=this.scale*(1-this.m_scaleStep)}else if(typeof t==="object"){if(t.name==="custom"){this.scale=t.scale}}if(o===this.scale)return;var a=this.getDrawRect();var l=(e.x-s.left)/(s.right-s.left);var h=(e.y-s.top)/(s.bottom-s.top);var u=e.x-i(a).width()*l;var c=e.y-i(a).height()*h;this.startPt.x+=u-a.left;this.startPt.y+=c-a.top;this._fixPosition(n);this.fitMode={name:"scale",scale:this.scale};var f=this.getDrawCenter();var d={oldScale:o,changeRate:this.scale/o,oldCenter:r,center:f,offset:{x:f.x-r.x,y:f.y-r.y}};this.page.fire("page:zoom",{input:{type:t,point:e},output:d})},move:function(t){var e={x:this.startPt.x,y:this.startPt.y};this.startPt.x+=t.X;this.startPt.y+=t.Y;var i=this.page.lowerCanvasEl;this._fixPosition(i);var n={x:this.startPt.x-e.x,y:this.startPt.y-e.y};this.page.fire("page:move",{input:{delta:t},output:{offset:n}})},fixPosition:function(){var t={x:this.startPt.x,y:this.startPt.y};var e=this.page.lowerCanvasEl;this._fixPosition(e);var i={x:this.startPt.x-t.x,y:this.startPt.y-t.y};this.page.fire("page:move",{input:{orgPt:t},output:{offset:i}})},fitRefresh:function(t){this.fitMode=this.fitMode},render:function(t){if(this.isValid()){t.save();var e=this.getDrawCenter();t.translate(e.x,e.y);t.rotate(this.angle*Math.PI/180);t.translate(-e.x,-e.y);t.translate(this.startPt.x,this.startPt.y);t.scale(this.scale,this.scale);t.drawImage(this.imgCanvas,0,0);t.restore();if(this.isValidResample()){t.save();var e=this.getDrawCenter();t.translate(e.x,e.y);t.rotate(this.angle*Math.PI/180);t.translate(-e.x,-e.y);t.translate(this.startPt.x,this.startPt.y);var i=this.getScaleSize();var n=i.width/this.reSampleCanvas.width;t.scale(n,n);t.drawImage(this.reSampleCanvas,0,0);t.restore()}this.page.fire("page:render",{})}},getDrawCenter:function(){var t=this.getRect();var e=i(t).center();return e},getRotateSize:function(){return t(this.angle).size(this.width,this.height)},getScaleSize:function(){return{width:Math.round(this.width*this.scale),height:Math.round(this.height*this.scale)}},getScaleSizeCustom:function(t,e){return{width:Math.round(t*this.scale),height:Math.round(e*this.scale)}},getDrawPoints:function(){var e=this.getDrawCenter();var i=this.getRect();var n=t(this.angle).point(e.x,e.y,i.left,i.top);var r=t(this.angle).point(e.x,e.y,i.right,i.top);var s=t(this.angle).point(e.x,e.y,i.right,i.bottom);var o=t(this.angle).point(e.x,e.y,i.left,i.bottom);return[n,r,s,o]},getDrawRect:function(){var t=this.getDrawPoints();var i=e(t).getRect();return i},isInDrawImage:function(t,e){var i=false;var n=this.getDrawPoints();t.save();t.beginPath();t.moveTo(n[0].x,n[0].y);t.lineTo(n[1].x,n[1].y);t.lineTo(n[2].x,n[2].y);t.lineTo(n[3].x,n[3].y);t.closePath();if(t.isPointInPath(e.x,e.y)){i=true}t.restore();return i},getImagePoint:function(t){var e={x:0,y:0};if(this.angle===0){e.x=t.x-this.startPt.x;e.y=t.y-this.startPt.y}else{var i=this.getDrawRect();e.x=t.x-i.left;e.y=t.y-i.top}var n={x:0,y:0};n.x=e.x/this.scale;n.y=e.y/this.scale;return{x:n.x,y:n.y}},getImageRect:function(t){var e=this.getImagePoint({x:t.left,y:t.top});var n=this.getImagePoint({x:t.right,y:t.bottom});var r=i({left:e.x,top:e.y,right:n.x,bottom:n.y}).normal();return r},getBasicPoint:function(){var t=1/this.scale;var e=i(this.getDrawRect()).size();var n={width:e.width*t/2,height:e.height*t/2};var r=this.getDrawCenter();return{x:r.x-n.width,y:r.y-n.height,rate:t}}};iws.ImageControl=r})();(function(t){"use strict";var e=t;var i="1.0";var n;if(typeof exports!=="undefined"){n=exports}else{n=e.iwsT={}}n.getVersion=function(){return i};n.debug=false;n._transform=function(t,e,i,n,r){var s=0,o=0,a=1;var l=i/t;var h=n/e;if(r===90||r===270||r===-90||r===-270){l=n/t,h=i/e}a=Math.min(l,h);s=(i-t)/2;o=(n-e)/2;return{x:s,y:o,ratio:a}};n.defaults={debug:false,direction:"V",useBookMark:false,useBookMarkClick:false,quality:20,useThumbNumber:true,authority:{annotation:"editable",masking:"editable"},readOnlyOne:false};n._makeSrc=function(t,e,i,n){if(t.length===0)return"";var r=document.createElement("canvas");var s=r.getContext("2d").createImageData(e,i);s.data.set(t);r.width=e;r.height=i;r.getContext("2d").putImageData(s,0,0);return r.toDataURL("image/jpeg",n)};n._getDimension=function(t,e,i,n){var r=0,s=0,o=0,a=0,l=t/i,h=e/n,u=Math.max(l,h);if(u>1){r=t/u;s=e/u}else{r=t;s=e}o=(i-r)/2;a=(n-s)/2;return{w:r,h:s,x:o,y:a}};n._makeSrcFromImage=function(t,e,i,n){var r=document.createElement("canvas");r.width=e;r.height=i;var s=r.getContext("2d");s.fillStyle="white";s.fillRect(0,0,r.width,r.height);s.drawImage(t,0,0,e,i);return r.toDataURL("image/png",n)};n._makeThumbnail=function(t,e){var i=new Image;i.onload=e(index);i.src=data.src};n._MakeThumbFrame=function(t,e){var i=document.createElement("div");var n=iws.util.Unique.getFrameId();$(i).attr("id",n).addClass("thumb_frame");if(e==="V"){$(i).css("left","0"),$(i).css("right","0")}else if(e==="H"){$(i).css("top","0"),$(i).css("bottom","0"),$(i).css("white-space","nowrap")}t.append(i);return{div:i,id:n,class:"thumb_frame"}};n.Thumbnail=function(e,i){var r=$.extend({},n.defaults,i);"use strict";var s=$(e);iws.util.ListenDropFile(s[0],function(t){z(t,function(){console.log("Load complete!")})});var o=function(){return{auto:function(t,e){if(t<e){o().next(e)}if(t>e){o().prev(e)}},prev:function(t){if(r.direction==="V"){var e=d.item[t].layout_wrap$;var i=e[0].offsetTop;var n=s.scrollTop()-i;if(n>0){s.scrollTop(i-4)}}},next:function(t){if(r.direction==="V"){var e=d.item[t].layout_wrap$;var i=e[0].offsetTop;var n=e.outerHeight();var o=s.innerHeight();var a=s.scrollTop()+o-(i+n);if(a<0){var l=i+n-o;s.scrollTop(l+4)}}}}};s.attr("tabindex","0").keydown(function(t){var e=d.focusIndex;var i=e;switch(t.keyCode){case 39:case 40:if(d.focusIndex+1<d.item.length){i=d.focusIndex+1}break;case 37:case 38:if(d.focusIndex>0){i=d.focusIndex-1}break}if(e!==i){A(d.item[i].uniqueId).trigger("click")}return false});function a(){var t=[];for(var e=0;e<d.item.length;e++){if(d.item[e].started===false){t.push({cmd:"loadAndMakeThumb",buffer:d.item[e].filebuffer,id:{index:e,uniqueId:d.item[e].uniqueId}})}}t.forEach(function(t){t.__id=b.addWork(t)});return t.length}var l=null;var h=function(t){var e=t.scrollTop();var i=t.innerHeight();var n=-1;for(var r=0;r<d.item.length;r++){var s=$(S.div).children('[uniqueId="'+d.item[r].uniqueId+'"]');var o=s[0].offsetTop;var a=s.outerHeight();var l=e-(o+a);if(l<0){n=r;break}}var h=[];if(n!==-1){for(var r=n;r<d.item.length;r++){var u=d.item[r].uniqueId;var s=$(S.div).children('[uniqueId="'+u+'"]');var o=s[0].offsetTop;var a=s.outerHeight();var c=e+i-(o+4);if(c>0){if(d.item[r].imgsrc===""){h.push({cmd:"loadAndMakeThumb",buffer:d.item[r].filebuffer,id:{index:r,uniqueId:d.item[r].uniqueId}})}}}}b.clearData("loadAndMakeThumb");h.forEach(function(t){t.__id=b.addWork(t)})};s.on("focus blur scroll",function(t){switch(t.type){case"focus":n.debug&&console.log("on focused...");break;case"blur":n.debug&&console.log("on blured...");break;case"scroll":n.debug&&console.log("on scroll...("+$(this).scrollTop()+", "+$(this).innerHeight()+")");if(r.direction==="V"){l=setTimeout(h(s),100)}break}});var u=function(t,e){return function(i){i.preventDefault();i.stopPropagation();var n=d.focusIndex;if(t===-1||e===""){d.focusIndex=-1;W(n)}else{var r=j(e);d.focusIndex=r;if(i.ctrlKey){var s=d.item[r];s.selected=!s.selected;var a=s.layout_wrap$.find(".thumb_check");a.prop("checked",s.selected)}else{L(r,n)}W(n);W(r);o().auto(n,d.focusIndex)}}};s.click(u(-1,""));s.on("mousemove",function(t){t.preventDefault()});var c=function(t,e,i){this.type="image";this.key=this.uniqueId=iws.util.Unique.getUniqueID();this.imgWidth=t||0;this.imgHeight=e||0;this.imgsrc="";this.imgsrcOriginal="";this.filebuffer=i;this.pagebuffer=null;this.angle=0;this.angleDisplay=0;this.selected=false;this.pageInfo=null;this.pageSrc="";this.caption="";this.nextLine="";this.errorMsg="";this.setError=function(t){this.errorMsg=t;this.layout_wrap$&&this.layout_wrap$.find(".thumb_bookmark").css("display","none")};this.mediaSource=null;var n=this;this.bookmark=function(){var t=false;return{getData:function(){return t},setData:function(e){t=e;var i=A(n.uniqueId);if(t===true){i.children("div.thumb_border_wrap").children(".thumb_bookmark").addClass("thumb_bookmark_check").removeClass("thumb_bookmark_uncheck")}else{i.children("div.thumb_border_wrap").children(".thumb_bookmark").addClass("thumb_bookmark_uncheck").removeClass("thumb_bookmark_check")}}}}();this.annotation=function(){var t=[];return{getData:function(){return t},setData:function(e){var i=iws.util.equals(t,e);t=e;n._checkAnnotation(i)}}}();this.masking=function(){var t=[];return{getData:function(){return t},setData:function(e){var i=iws.util.equals(t,e);t=e;n._checkAnnotation(i)}}}();this._checkAnnotation=function(t){var e=A(n.uniqueId);if(this.annotation.getData().length>0||this.masking.getData().length>0){e.children("div.thumb_border_wrap").children(".thumb_annotation").css("display","block")}else{e.children("div.thumb_border_wrap").children(".thumb_annotation").css("display","none")}!t&&_(n);if(!t){console.log("isEquals : "+t)}};this.filter={};this.printString={message:"",position:"bottom",font:"14px Jeju Gothic",fillStyle:"#fff"};this.started=false};var f=function(t){this.width=200;this.height=160;this.direction=t||"V";this.focusIndex=-1;this.item=[];this.checkVisible=false;this.icon={image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAoRJREFUaIHtmb+LE0EUx79vNH9BmqQ67g/QK61O7c+TaLGlEBFskgkxhWWyXHVFiDvZziJic7KgKLlGBEl5ndr5DwgLknASC9Fknk0iOU3uZjP54ZL9QCDsvnnvfZd5810SICFhs6EowcxMvu/vM/MOM1+yKTwYDJ5WKpUvNjmACAKYmZRSr4goZ1t0xAchxPVCofDdJomxgGazeZuZ3zBzpdfrKdd1B/MU9DyvRkRVrfUvInqbzWZzjuMM58kFAMI0kJl3AMCm+TOFhXhARLfCMGxY5TENHO/5RTQPAFLK58x8AKDoeV5x3jzGApaBlLKqtT5i5oZSam+eHJdtGvA8r2YSJ4ToFIvFzt/XiYhbrdb9fr+/pbV+0Wg0dsvl8scoPVgJIKKqSZzWGgA60+7l8/kfnuflhBAnAI7r9fq1KMerlQApZSQfmUWpVPqqlNrTWp+kUqm27/vGx+vKZ4CIGACq1eqZhyel/CyEuAvgynA4PAqCwMgo1zHEnwAgnU4/miLiPTM/jHK8Wm0hpRSbxDGzWyqVagCQyWTaYRi2ARym0+lDpdSsZUUA8qLcVgKY2TWJE0J0xt8dxxkGQXAnDMN9Zr6KKbuAiG4CuGGS20rA+KlGZfTq8Hr0+YfR64aRgLUa2SJYiZGZMMvsLmIlRmbCeWZ3Hv+FkdkQ+xmIvYCVGJkJk2YXhZUYmQmTZheFtRjZItnsGUiMbILEyOJK7AUkRmazfpLEyOJKYmQ26ydJjCyubI4AIvoGAL7vby2vnT9sAzg1CTSeAa31SyHEgdb6nVIqYOaF/NU0hW0iugfgiUlwpCFUSu0CUACm/qa5IE4BPOt2u49d1/25pBoJCWN+AzouHvLW3VsUAAAAAElFTkSuQmCC",video:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAACxklEQVR42u3aX0hTURwH8D30GgU9+BJI0D+C/jz10HsPCS116Nru7rzb3XXb9c/MhxVF2EuPEfTQQ4hUpsmdm1vpcMIghloERaWrpi2ozbncYLWWTm392q8SrLapadxz5R74wtg9B36f8TtnZzCFIj8qqrXlDMt7OL51ssFmj4gRtY6LqlS6Y4q1DiVF7aNN/IeR0Ue5eDwOYsXhcD7XMeaZytq62jUBaMY6+iAwDGIWj/H7/Y89nntgqG9KqDTshVUD1JQpE5ueJgLg8/nA6/VCU+u5ZI3WeKutrW3LioBaLTsndvFj40FotNlTCFjKxUuXU2qdKaBUKrcSD3jy9BnU82fSywGYK1evZfIdEjpRTe2UJABzo71jIY+YqqxhjkgSgOnq7gENbZ45paIriAS8GBsHo7n5czEAxtXnBtbSPGUy2cqIA2A0deas2+2BUohf8QuCsI04gMvdn+WsLbO9TteKiMHBweDAwEA5UQCMb8i/wFlaPmE7NdrOpkulodmepA3Wu0QBlhKNRuF1aKJkxoMvIV97mkjAapEyQAbIgP8AeBhOwPmRDBzvX4SDvbkfwdf4Hj4jFhCJxcE+/AX2CN9gtwAFg89wDs4lCoAFqYfmixb+Z3DuehEbCsBPdbXFLwXXEAHAvi7UNvsdAAd6oWQ7rWdPbBgAN2ehAl+lAJJZgKbR4ghcKzoAT5hCxS0f3vcARz1/z8G1ogPwmFwJgGN6FuCw6/c5uFYygMQcwCESAZJvoWKbOPRRIpu42DGKR+hehwSOUcl/kW2Kq4TkL3Ob4jot/yKTATJABsgAGSAD/glAsZlIJCI5QCg0AVSdJabQGa0BZ9/9nNQAN+/0LNIGa5fiZA29S0tzqc5u4Ws4/Jb4wicn30B7x+3503ouXlWl3/HzHytKTZneyHfSBj6q1denSQ7N8u9o1nqdYZjtWPt3zvlBAjtPgwAAAAAASUVORK5CYII=",audio:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAADdElEQVR42u2ZW0hTcRzH99Bz0EO9BEWQEUVRQi9B9VRhSqXM29mObs55meLQsrCIUQ8FQTfyJU1EScq7rulUbGpqZmleMLVNU+eubt7mfc79+v+PGd7yAoH/E+fAF/Y//B++n9/5Xf7jz+Ohx4emD4RKYwulsgRdjPzW4E4oiI4w8PnCc7ztPj4U5SEUR1s/1ta7LBYL7JRy8/JbBKIom1+QiNoWAC2W1VZV17p30jyWRqNpVCrfQ1hknI1PhSm2DBAokEyYTCYgAaC8vBxKS0tBnpBkDwiWZCkUil2bAgRQkpmdNt/xvRNi5ImjGGBJivsPRwMF4fVeXoLdxAO0tLZBeJTcsRwA6+nz5KkAQbgWNxlWAmClvE6fR2lu8vMTerISAOvtuxwIoqVD1/khPsTWgFgaN/k3AKyCwiIMaQyJit9PHABWsChyFpvcCAKrrKysSqVS7SEOoEhZMociPI0G2qYQarW6S6lUHiIKAKuiUuOURsePo2E2ESu/7dhIsrjEYaE4KpcogCUZDAbo/qHdUJ1d3eBPSaaIBNiKTGYzB8ABEAtgRnrW5IALynk4XbAAUs0MtA8MsQfgyVcHHM6BFbqomge9iSUA55WuNQBYqu4RMgG+9dsgtHIGanR2Zr2eeazU1vE1e4kAeNm8mDL3Pk1uCJDSMr5mLxEAL36bulu/OcDqvRzAvwBIbh5nTN2snWLWx/Pc6wJktI/B4y8TzG9FA0EAOR2jjKmraiezDqyYXWXeDR5ITX02kKCZgN9haGIAdAYrHM11wxFk8oPWDg29NjhT6FoBgCPfjDrQifzFr9P400bWHHjUuJgaePp+Rua0g1ZIbRljhlo1apl4EnuXOpk98R+nyBtkRrMFrqnnGIPHUA3cQPWQ1joGmSjv76CCPZm/8Aewz2glcxL3Gy1Md8H5vl4Rx9ZMM+lG/FGirtcODxommLrAxpPqJqFSO8yew5wJpVMPivRS2rT1D4HBzJLj9ABKo7PFaw9znuhY3aEfIh8AR9q3bA5OIcPLdbnEyXQm7h8ZB8ABcAAcAAfAAfxXAPiiW6/Xsw5Aq+uBYDrCyhOKojW5+cULbAPIzMp20SJZNu+KH3UwiI4YQS/me3p6WRH5tPQ3Thx9L3//vcw92SVfeh8dJstAX8NAhUQ4SJZQLNMjr6+8vSnmpvIXeEJwddSzQnIAAAAASUVORK5CYII=",error_network:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAO/ElEQVR4Xu1de5BkVXn/fec+elkWyDLdPQsERCIF6yZCKSDUWpXEGMAyQRFXEUmV4bFggBgSIixs997pmeUVLCMbAwgprKIwGAFFUQuRSilG1ggVKVhZeSU+9tW3e5d1l2XmPs6XurPTM7d7enf6Tt/bc/v2uX9On/ud7/f7fvc77zME9Qw0AzTQ6BV4KAEMuAiUAJQABpyBAYevMoASwIAzMODwVQZQAhhwBgYcvsoASgADzsCAw1cZQAlgwBkYcPgqAygBDDgDAw5fZQAlgAFnYMDhqwygBDDgDAw4fJUBlAAGnIEBh68ygBLAgDMw4PBVBlACGHAGBhy+ygBKAAPOwIDDVxlACWDAGRhw+CoDKAEMOAMDDl9lACWAPmPAYn2Y3dNY0vtY0HJmPklIPpYFHwZgCSQ0CYwLQXUGbQXxK0LSC6xh4xF1/aevbqCJPkOcqLt9kQHecQ3nfjfkf4glXwzIDwAiCHbkR0K+SRA/ANNDi/Zqj/32C/RWZCMZeyHVAli2hgu+4V0LyCsBsTRO7knKnVIT9xHpX7At2h6n7X6ylUoBFCxewuyVmOU1AuKQJAmVUo4LTfyzN67fuus22p1kXWm0nToBFC3voyz5TgDHHIgwKeV2DfSfTNhIRL9k8l8zndyuLTnsASCPBBZrPFEUrL1NMq8gxhkM+lMIHH3gIMhtJLSrq5b+aBoDlZRPqRHA71/LhziH+l9kwZe3ByvrIPEggx+ojRjPAcTRSGEaKrmnaUSfZMhPH6hJkURfyZF21VaL9kWz35+lUyGAI2/iYwV5j5PAu9rQuAXMtxuacV9cQQnENrHEvRRMa9plBR94noV+3i6Lft2fYe3c6wUXwNDaieVC0BMAHdvstnQBcYfYp6/fcQe92TmkzksOX8eHysXeGkh5PYTQm96U2Cp0ec4OK/di5xb7r+SCCiAIPoF/RELLN1HHeJnAH6+Oms/3gtKC5ZwKSV8FsDxcH0u/phP9yfbR3KZ2fiy9no8wcv77AV4pmU+RUpxAmj8sgMUAPAB7AVED5MtMYhOBfshvaU/Xbqegr5KKZ8EEEKR9TXP/a9aXz3iUJ/RP95qkYOQhpfcVAVzQmgk8XT9rujlYxVpxhf+XLP3LIHHOrMwxR1gl5ARYfFsIut8e0b4XvS8Tr24WRABBGzx+qLextc1n0F21l7Rr8HXy44XZoTWLRUH6dwJ8VfiNoE9g7NNX+ov98wg8AuDEDi0etJgEXhBEFXtEe2ShhLAgAiiu9b7c2ttnortrI9rfLBQRM5FiKpT9Da0ikPBtAa0QR+BbbTD4KSJ5pT2y6NUk7B/MZs8FMDXOf6SlzX/U3qx/fMG+/FaGJjOB9zCA8zsIyCsgfA9MPxHC3zQB87dvbMIerIB2zAQOc3T3OIZYDsL7AJxL4Le3syml3EukXVEb1YO+SM+engog/zk+jBZ5LzVN8jBe5gn9tF63+XMxHPQJ4Hs/A+HkWWWl9AB6UBK+VB81nu08azEVLe8seHw1gz8BIUQbP9bbFb3Uuc25kBz8994KYJ17GzE+N+OSdInp9F719qNSVSw5pzDzs00dPZaPQ/C13abrIWviZCHpToD+fHaTQHfVKtpVvRBBzwQwvI6LHjv/1zK3f4tdMW6MGpheli+U3TEAN0kp92mkfaY6qj0QX2CY8mX3smDqWwixqAkX4WZ7xLgpaaw9E0BhnbsejHCwt4h9+klJTfLERdzUZNEPifnSpDJVfp1zGrP87uxOJl1oV/SvxYWlnZ2eCCBYz9+91NnWNP/O/Fl71AwWfdL/WKzDomBiJ7EnaBLI46fDk2JBx1ADn1odW/RaUhX3RACze/6ybgjzuLjm9pMip9d2h0rO6SB+WkDkGnVLyCfqFfOD8TU7zah6IoBC2Q2WWGeGVIQ77RHjs70muB/qy5edKwh0d9hXEnR+1dK/mYT/yQtgNRtDRWenEGJJAwATn14bMZ9NAlD/25zsGD5JoD9rYPElfr5zTH93ElkgcQEMr3POlEzPTKc0KbfXx8yjkwDT/8Hfj2ByhRR4MTxPQIRzqiPG9+PGmLgAiiX3Oib8U8Nxkvzv1THzoriBZM1eYa3zEAR9YhoX8UP2iPnJuHEmLoDCOu/fwHzJtOP91PuPm+0I9ooldyUTfhzKnOOHvGkeGfdO5sQFkC+7PyZg5XQGAM6tVownInCRaNFghOJL725IwZourkiqsxUdBNPQTe7rQqPjQ9ydXa0YT0a3deA3EhdAca3zKxZ03Ewq80/sdho1TgIK5YkaIIYCm8GKX72yqBin/W5sFcve3Qy+ImRjvV0x1nZjs/XdxAVQKE/sDE8Ama6e33IL1eME0Y2tQtlt2lxqV4zEOenU32LJu5iJHwiV/4ZdMT7a6fudlEscbKE84QDCaDhjCz0Hi5xOnOtFmTQLIF9y3kNE08NlYvyiOmqsiJOXHgig5QsTugaLZJwgurGVZgFMnYyqTncEwTvqFXNZN3h72gQss9463pfiVUBojYrFPn1JmhaA0iyA/Wso3vhM0KSr++aJ29bTr+ISQSIZoHgjD7Phj4H9vw4HP3Ba9/Xj4wTQLRFpFgAs1gvSc5swSukRtPshtVL1ZtrRLf7YBVAse3/FCPbUiSPaOifwx7Zl/Khbx+N6P80COGYNDzmGV2uLVco3WGhX1yr6g91wEZ8ALDYLnv+vEHxpe4fkHhB9xyce3WnlftGN03G+m3YBuJq7gcEfghCHt8VNdJ9N2lXz7VjHIoBg04R/iPtNIvpAGydfAfOthmY8lMbl3zQLoMHl0RYvdnz3IiZxgwD/wWyO+UlDGB+ZD79dCyDoqLyx1P1OePUqcDA4dq2RKFV36F/El6m5HYvzE+7SVj8IYBqixWbR9/7OJ1kJ7xnY/zs/aQvjL6Jmgq4FMGuuf3JGjV4z2P/wgY5UdRmzWF/vKwFMIS+um3iX79Fj4Wni4CeSdG91TF8dhaCuBNBmpgrB2rXp62dvv4XsKI4sVNl+FEDAVbDJVvreUxD4wzB3DLo4Ssdw3gKYHOoJZzOE+L2GA75Pr5tSO7Nfgh/43a8CCHwPYuCTu7E5E8hdgsyTd4zQ9ATSwT6u+Qug5XhX0ObrhDN2jOZeWKiveT719rMAJkVQck7xiX8a7hMQ6J5qRb+yEz7mJYB2M3wMXFerGJ/vpNI0lel3AUxmsZJ7Awi3TPMqpaez+Y5OJtzmJYBi2b2DgX8IBfIVe7u+Is29/QOJLgsCgMVmXvqbw+cOmXB7bcS4fq6PLboAVrE2tNzdIkDDM8b5Erti3j9XZWn8PRMCAJAvOauJ6J4ZjuU2+yXz2LkO3EYWQOtWJUj5u9yb5rK4tyr1SixZEUAwGectcraHd1+TwMqqZfwk1k5gvuyWCKg0jPb7Js+sCGBqRPMfAFaFAr7WrhjrYxVAseQ+xoTzGkaZ+fLaqHlfr77YuOvJkgCKJedKJrorxNGcO4giNwGFkvtS+Mx8vx/yyJIAhkvOeyXRxumPE9hUqxhNE0WtH1B0Aayd2B1emTKEXthqUfsly7g/1wTsDZXHq41TuTKBHTcJuHxAk5Ozg+yF9gjI3XYlNz1R1+7F6AIoT3jhTR72dt3sx+Ffg4zhsvdhD/IeSGYS2upaRf92L4MWa13Bkrz0Zq7Dl9Kzx3LT+zHjEkCqN3nGSmifGWvdQkZSOtWx3PRJ47gE0LTNW3P1Yj/N/fdZTCO5O7k+o3uhq+9l3a7kmi/hbLEYuQkoltxNTHhnw44kfm99xPzvSJ6qwokwUCy5ZzFhZtwv8aI9ZvxRrMPA1rP+DF5dq5j3JoJIGY3EQOswUDIero8a4XmBWfYiZ4BC2Q0uLgouTtr/SP6aPWZeGMnTFBUulr3zpQwurgTr0C/fUdEfS5F7kVwZKrlfF4SPhV66wa4Yt8WaAVrTTHCPjT5uLkvTXv8orOXXjtuNe3mk5Gp9zAytcUSxtLBlgzsY2ZycCg4uqp76NvmM+qj5s1gFgFWsFZY7vwHEUQ3D/dwMZGUeoDX9k+RfV3Xj7XOdworcBARBz5fd2wn4x4YAgp1AOw1tedQNiQv7zeyvPW9557En74UAkxCX1Sz98TT4FcWHYPi363B3c9POoA7vGZyXAJZafJzuOa8136CJNfaocWsUx1XZeBho7ZcFV9ITmSfURmjrXDXMSwCB0dYbv4NKhaAzbcv8+VyVqt/jYyBvOe8WHj/DQpjTbT9oQ72i/20ntcxbAPtPrjq/DJ/9Z9D/wtNW1m6mbZ1Ursp0x0D+Rj4KuvsMgd42E3zf9pzcSbtvpV2dWJ+3ACbbz5J3ERE3n02TeJGlfrYSQSf0z79MEHwS3vdbt4UT6GPVit58Hf9BqulKAO2aguBvQSYglhfYo+b/zB+ievNADARpn1080nowBPO4gLNrAWA1G/lh51tE4tyww8FCBAth2UL/fD+ODtIov6nFnutIynK4zQ98Jca3qpp+QdQ7jbsXQHBKZfJwqPNwqwga2QCQt5EwHrQt2ptGYtPuUzDJI3Lup3yJ62d99VPBN/fqF85nX2YsApgkcDUbxaP8f2HmtmfTgvv2QeK7GvgpgJ6Hr79++B68of6de1h+TMdbyO1zcAQ07wQQn+oHV8ZK+cHwDF/4DRn0+IX291G//IaN+AQwZTHoGAr2N7AQR6b9y+pn/4Ir7TTon4nS4WuHN3YBBJUcbXHek/4Yw78kfENYPxOeFt+DvpUvtHs8R1vX6VDvYL4nIoBGhZP/E1j3ribGpw7238DTQm66/eDfgOgBhv6lTmb4OsWSqACmnVjF2vA73dOlpPcDeA8TTiLI4Lqzw1WGaA7V/tET9kCKbZKwWQDPSfBTdc14bq6FnU6D3jRam89L6p3sMNCbDJAdvjKHRAkgcyGNBkgJIBpfmSutBJC5kEYDpAQQja/MlVYCyFxIowFSAojGV+ZKKwFkLqTRACkBROMrc6WVADIX0miAlACi8ZW50koAmQtpNEBKANH4ylxpJYDMhTQaICWAaHxlrrQSQOZCGg2QEkA0vjJXWgkgcyGNBkgJIBpfmSutBJC5kEYDpAQQja/MlVYCyFxIowFSAojGV+ZKKwFkLqTRACkBROMrc6WVADIX0miAlACi8ZW50v8PF4HRzPKOu+cAAAAASUVORK5CYII=",error_loadfail:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAEhklEQVRoQ92aTYgcVRDH/1Xd69coKChZFXPQ2enu3VVDoone9KA5GyWGiDmJrDGJsvELERREhKCra4wRcpGgIkEUb64XPYm4WZIYdvr1bPYiqEGMCslEmJ1+JW93Zp2ZzFf3dE8y9nH6Vb36VdV7Xa/eEBJ4lOPcBOB+EbkHgKOZb2OtrwNwdUX9Oc38F4ucAlEA4Ach+nbU93/rdXqKq2Ahm70htKztAuwA0fqYeuZI5DCJfOoUCn/E0REZ4OT4+C12qfSCZn6CgSviTNooo4F/GDjEWu9zCoVfoujsGmAhm728bNt7NfAKA1dGmaTrsSLnQfS6tqypsfn5UjdyXQEEuZxbZj7CwO3dKO11jAA/schWNwjMemn7dARQjvOIiHwE5kwnZYm+17oI5h2eUl+009sWIO95T4vIfgY6giZqfEWZBsQS2ekGwYet9Lc0LO95O0nkQBqGRdVJIk+1gmgKYNImJDI5f1E832SXEiJ6eNT3v2x8d4GBZsFq4GgvOW+vW4fM1FTdXMXJSZSPH4/q/P/Ga30OzBs8pQq1SuoAzFZZsu3ZXnebVABWrD6hLWtj7RZbB+C77ssA3ojvphXJFAEgRC+O+v6+qo2rAOYLy+VykMRHKk0AiJwnYMQNgl8NxCqA77rvAdjdq/fTjkDFvnc8pSZXAUxhVrLtn5OqbVKNAABTO9larzUF4HIElOM8I0TvJuH9PkXATLPbU+r9ZQDfceZ6KIkv4E47ApUJZz2lNpI5jAhRpBK2U6T6BICybQ8bgMeE6ONORkV53y8AIdpGfi63H8y7ohjYaWwfAaYNwDdgfqCTUVHe9wsAwNc077qLDNwaxcBOY/sFIESLJgJ/gtl0EBJ7+gUArc8YgBKYhxKzPuVaqM5OrUv/C4DBTqHBX8SOMwOiBwdyDZhtNMkyuuoEHh7G0ObNdT5ZmpmBPn06ST+Zw820AdgO4JNENfdJGYk8SnnPu5FElk83g/YMLS2tWSmnXfcogA2DBCBEP476/qbqgWaPyacBA9g16vsHlgGCXO76MrM5UibSdU69lFjpYq/1lDpTe6g3EdiTRBRSBwCmPKX2GltXAYJc7mZNVADRVb1CpAqgdVEsa6R6PdXY2HoJwJuXNADwvKfUW1Ub6wDmx8YuozCcJeCOXiBS/JAdK2Yym+6am1tqCmB+VI7jiMhcL83dXuBbyWrgrDCvH8/nT9WOado+9113iwY+v4Ta69oS2eIGwVeNgC37/8pxJoToYBrejKHzSU+pQ83k2l5gGIiQ6IOLFQkNaAYmWhlft4228kre8x6iMDwM5uqtewwHRhcxOW+JPN4sbTqugcbpfNfNATgC4M7opsSSOBYyb21csJFTqFZgeYvV+lnS+tUkPnZNsVauVl8rZjLTtVtlOxdEvsSr9FKf08BEUrWTubTQRAeJ6O2ofwCJDFD1hikANfM2mD97AHfHSRRTEgMwf/b4zBRmcXTEBqid7OT4+BorDO8DcC+JOEI0QmF4LYBrKuPOimX9TSILQhSw1t/b5fJ32cXF3+MYXSvzL4K/IE4mLilyAAAAAElFTkSuQmCC",error_unkown:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAIVUlEQVRoQ+2Za2xU1xHH/3PuvfvyY83T9hrbEAgETCCRC8YvsEMqRRinaoVbVU1UpNIPLVHV9kvTJm0eTanypWojSNUqbRq1lVqQQhpsqKXALmB7XQxNqHATIJAoLH4RA8Zr7+7dvWequxCE9+7TNq2Qer7shztnZn5nZs5jlnCPD7rH/cf/Af7XEZyVCHBbmzI4OVBHQjTD4M9ByBVSilII5AOICWBcMgaFwFliPglJR4rXd/XR85AzXYAZAQy1blzCkDulgSeEQHGOzgQY+JMBY3d5u/9yjnNvi08LYPjxmmJDqi8xeLuAUKdrPD5PQgfo94Y98uyi/SdGc9WVM8BAa8OTwpCvsBBFuRpLK2/QKClyZ0l7919z0Zs1QH9blW1OqGgPgXbkYiB3Wf51SVD7Dvl8sWzmZgUw0FrtAjv+RqBHs1E6UxkmdBgOo618nz+USVdGAHPl5066D4LE5nTKGEAoGkNQ1+O/USlhMMM8aVQiaIoCp6ogT7PBpWUuGwnZ7gnavpgpEhkBLrfUvy6Itqdy3nR8LBzB1VA47nQ2w6YIzHU44bbb4oApB8tXSzt6dqbTmRZgsLVxO5hfT6dgLKxjaGLCFNEZ3EksDrGCPrvki7X+/uunqquViD06J8ZyGbPcwMBWJtokAOFQFHgK8uLRSTmIv1J6oHtvqu8pAUa2NJXElNgHxHBnWtXxkH5sSI9u23j83SuZZM3vR9evWSIV+QOSvEMopJgQeZqWfKqUn8YMXlHe6b+aTCAlwEBLw2tE+EY2Dt2SeaG0vev5HOThrat6iBh/JmBVWWF+SggJ7Clr73oqawDzhDU4dm4ah1TOECerq13jttBfFBKti90FSdOJJeuaiiUL3u4eSIRIGoGhlvpfMNH3LMQMxFhCFSLdQucM4W1qUhEZedOpqq2VhYVJC5uJd3kOdD+TESB+MQsODZPC8xKFxyIRjIYiKC/MhzbLEGYkgrZwX0m+a5XbbrcskGQ56OnoKSPA3PhuD0sEBlrqG4noWLIl/mj0mqFLBDRNqbwbEGZN2JlOLplXlHxbIrm+9EBPX1qAwa0NzwGwFONkNIbAjfHdUiovkzC8mqIsuxsQvg1Vv60oKvimU7Uedkz0jOfA8V1pAS49VtetqqIuMQLD45NyVDcqNvtPXz5cu7ZMQcx3NyCONzx4X4Fm+7A4z2nJDj0W81b+vfeRTABXVFXMTwQIjN/wrzv6r9tgJgQQ8zoU5f7ZjkTfxjXvLiosfCjRh6ghhysO9ZSkBbjcUq8LIsup8vH18adru06/fOfkuwXR27D2p5VFBc8mAhiG1Bcd6plS4dYi3lrPlOSCcuHaaG1D9/u9iUq76ld4IlL1zWYkuurXNi+dU3Ak0ZZkcFlH15Q9PAlAAyc7HM6PjXo2Hn9/MNnuZELEWPVqQlk+G+nUU7u2bMm8gkCiLfNy6+nomuKexddASz0rZEVQoyHPgs5TSQFMQ7MJcfkL68qFYf/EkkJSYtHBnvQAHz1WKx2qYiEwmB9Z1NHtTXcEzxbEpdbGTSqzL9FWyIjxfYd606fQ+c/XRPLtmi1xss7Gi5UdfvOMSDuONa4slYbwzSSdLrXUv6AS/STRUDCsR+5/54Qj7S7Uv/nhobnOPEuLRI9G36vs/MfDmQDM73EIXXg1TVkxnZoIbKk/rQhak2jryuTk0Joj/yxNC3Ci8UFvudvdZNkBANaEsXzh2/4P7yZEYEvDchL4QCS50gXGxg+vO356yrvckuu++lU/Wuqe8zNVWAuZGb/zdHRl3ZXwrqsqIQFfLpEYbG38A5i/nrhIMSlx8erY05t6+6ecRRYvj2xYVbMwz9U7zzkl1eL6pIQkcI3nYPfJbKJgytyEYK+mqQ9kTCeiN6TBTwoBy3396mQYI5HwuubuM1NsWwAYEN21qwNL5xaVJn9wy3OK01a9cJ8vmAuEVOURh6KtzAiRRCmDcWH0eqDB31+R8TptzvfVrt5VnOf6YZHDshl9pr6zZDDUSqdORf8bENfCYVwJhl7a1Nv/40R7SV9k5h1HFcbFpW63TUlSC7eUdCpOdVsukXinZnWxeRXPJRKGZFy4OhaRBi9u7usfygogHoUNVXsKHNq3PflmhzzVkOdY0tdyqYk7ISoK8zM9TzEwPoEbeuRXzf5/fzeZFym7Ej21VXN1wtliV978NKkUL2wBvKEI8fOF7cfOZ5NSZx+taYDg9kKbLW3LxkydkYmJYbbbH2j2vXc9J4CbtbCqjUB7PYX5yE/Vt7mlVQIsgC4wOhjco7J2foyd15aFQsZIYWieYajLCVTHhMcJsDyYLKeuHsXAeBAM+lKT/8z+VAuTsbXora3aLQg7PQWZIbJZ/WxkgqbzwSAkc8rU+UxPRoC9bW3KgkD/fgFqXZjnQpHD2jHIxqlsZeI7zkQILOmtkYqV2768b5+Rbm5GgPhh1LTYgYhrL4FaC+wail0uKOnbKtn6e1vO3G2GJyYxruuApLfYGfxqs+/jcCZFWQHchDCbT1d+ScBOQYQFLifcDhuSvd4yGb3zu3lIXQ/r+HQyZKYMwPzKSHnV9zOtfNYplOiMWdggehWM+WaHzkwpt80GVUnbrbMwmXebG2Ed18KReLcP0hghUr+1qffMm7ksQNYRuFOpucVGgBfJwA4osJtXDrNVbnaY7aoCm6LE/9RQ6CaUwRIxZuiGgXDUwGQ0irBxK7UNRCD4N+ywPZdqq5xxDaRSEH+BSe0pScYTgkV5LisHxics8EdFkXtSvbWz0TetCCQqNi+AR+uqqpmxmYBqA1ihEErBKIzLEm4YjEEFOEuEk5LocFP3mVOJF7NsHE6UmRWA6RierTn3PMB/AOhneV6cNJeqAAAAAElFTkSuQmCC"
}};var d=new f(r.direction);function g(){}g.prototype=iws.Observable;var p=new g;var v=new iws.util.sync({});var m=null;var b=null;var w="";var y=null;if(r.path){m=iws.util.work.Spliter(iws.util.string.combinePath(r.path,"/engine/iws.w.split.js"),false);var x=iws.util.string.combinePath(r.path,"/engine/iws.w.loader.js");var k=iws.util.string.combinePath(r.path,"/engine/iws.w.loader.plugin.js");y=function t(e){if(b!==null)b.close();if(e===0){w=x}else if(e===1){w=k}b=new iws.util.work.WorkCrew(w,1,2,false);b.onstarted=function(t){if(t.cmd==="loadAndMakeThumb"){var e=d.item[t.id.index];if(e!==undefined){e.started=true;iws.util.run_waitMe(A(t.id.uniqueId),"facebook")}}else if(t.cmd==="loadpage"){p.fire("loadpage_start",t.id.uniqueId)}};b.onfinish=function(){var t=a();if(t===0){p.fire("thumbLoad",-1,d.item.length,"loadcomplite")}};b.oncanceled=function(t){if(t.cmd==="loadpage"){F=false;var e=t.id;setTimeout(B(),0)}};b.oncomplete=function(t,e){var i=e.data,r=i.id,s=j(r.uniqueId);var o=d.item[s];if(i.cmd==="loadAndMakeThumb"){if(o===undefined){return}o.pageInfo=i.pageInfo;if(i.src){o.pageSrc=i.src;var a=200;var l=new Image;l.onload=function(t){return function(e){var i=d.item[t];if(i===undefined)return;if(i.type==="image"&&i.errorMsg==""){var r=n._getDimension(this.width,this.height,a,a);i.imgWidth=r.w,i.imgHeight=r.h;i.imgsrcOriginal=i.imgsrc=n._makeSrcFromImage(this,r.w,r.h,20);C(t)}else{i.imgWidth=this.width,i.imgHeight=this.height;i.imgsrc=l.src;C(t,1)}_(i)}}(s);l.src=i.src}else if(i.bytearray){o.imgWidth=i.xsize,d.item[s].imgHeight=i.ysize;o.imgsrcOriginal=o.imgsrc=n._makeSrc(i.bytearray,i.xsize,i.ysize,20);o.pagebuffer=i.pagearray;C(s);_(o)}else{var h="",u="";if(!i.pageInfo.result){o.setError(i.error_msg);u=d.icon.error_loadfail}else{o.setError("unkown process!");u=d.icon.error_unkown}var l=new Image;l.onload=function(t){return function(e){var i=j(t);var n=d.item[i];if(n===undefined)return;n.imgWidth=this.width,n.imgHeight=this.height;n.imgsrc=l.src;C(i,1)}}(o.uniqueId);l.src=u}p.fire("thumbLoad",s,d.item.length,d.item[s]);s===0&&A(d.item[s].uniqueId).trigger("click")}else if(i.cmd==="loadpage"){F=false;if(o){o.pagebuffer=i.pagearray;o.pageInfo=i.pageInfo}if(R.length>0){setTimeout(B(),0)}p.fire("loadpage_end",r.uniqueId)}}};y(r.plugin===true?1:0)}function _(t){if(!t)return;if(!r.authority)return;setTimeout(function(t){return function(){var e=j(t);var i=d.item[e];if(i&&i.imgsrcOriginal){var n=new Image;n.onload=function(){if(j(t)==-1)return;var n=document.createElement("canvas"),s=n.getContext("2d");n.width=this.width;n.height=this.height;s.save();s.drawImage(this,0,0);var o=-i.angle;var a={x:this.width/2,y:this.height/2};var l={left:0,top:0,right:this.width,bottom:this.height};var h=iws.util.Rotate(o).rect(a.x,a.y,l);var u=iws.util.Rotate(-o).point(0,0,h.left,h.top);var c=this.width/i.pageInfo.width;var f={x:i.pageInfo.width/2,y:i.pageInfo.height/2};function d(t){var e=iws.util.getKlass(t.type,null,"object");var n=e.fromObject(t).clone();n._objectSizeChangeScale(c/1,{x:a.x-f.x,y:a.y-f.y},a);n._rotate(o,a);n._moveOffset({x:-u.x,y:-u.y});n.render(s,null,c/1*(i.pageInfo.xres/96))}r.authority.masking!="unvisible"&&i.masking.getData().forEach(function(t,e){d(t)});r.authority.annotation!="unvisible"&&i.annotation.getData().forEach(function(t,e){d(t)});s.restore();i.imgsrc=n.toDataURL("image/jpeg",20);C(e)};n.src=i.imgsrcOriginal}}}(t.uniqueId),10)}function C(t){var e=A(d.item[t].uniqueId);var i=e.children("div.thumb_border_wrap").children("div.thumb_border");var r=n._transform(d.item[t].imgWidth,d.item[t].imgHeight,i.width(),i.height(),d.item[t].angle);var s=i.children("div.thumb_img_wrap").children("img");s.attr("src",d.item[t].imgsrc);var o=d.item[t].type==="image"?r.ratio:1;s.css("transform","translate("+r.x+"px, "+r.y+"px) scale("+r.ratio+") rotate("+d.item[t].angleDisplay+"deg)");iws.util.hide_waitMe(e)}var S=n._MakeThumbFrame(s,d.direction);var T=$(S.div);var A=function(t){return T.children('[uniqueId="'+t+'"]').children("div.thumb_layout")};if(iws.scroll){e.addClass("contentHolder");iws.scroll.initialize(e)}var M={w:T.width(),h:T.height()};function E(){n.debug&&console.log("ChangeSize ... ("+M.w+", "+M.h+")");if(d===null)return;for(var t=0;t<d.item.length;t++)W(t)}function O(){var t=T.width();var i=T.height();if(r.direction==="V"&&t!=M.w){E();M.w=T.width()}if(r.direction==="H"&&i!=M.h){E();M.h=T.height()}iws.scroll&&iws.scroll.update(e)}var P=setInterval(O,1e3);function j(t){for(var e=0;e<d.item.length;e++){if(d.item[e].uniqueId===t){return e}}return-1}function I(t){v.clear(function(){if(m)m.init();if(b)b.init();$(S.div).empty();d.focusIndex=-1;for(var e=d.item.length-1;e>=0;e--){d.item.splice(e,1)}t&&t()})}var F=false;var D=null;var R=[];var B=function(){var t=R[R.length-1];var e=j(t.thumbinfo.uniqueId);var i=d.item[e];if(i==undefined){return}if(i.pagebuffer!==null||i.pageSrc!==""||i.errorMsg!==""){p.fire("thumbClick",e,i,t.oldIndex);i.pagebuffer=null;R.splice(0,R.length)}else{if(F===false){F=true;var n=[];n.push({cmd:"loadpage",buffer:i.filebuffer,id:{index:e,uniqueId:i.uniqueId}});n.forEach(function(t){t.__id=b.unshiftWork(t)})}}};var L=function(t,e){if(D!==null){clearTimeout(D)}R.push({index:t,oldIndex:e,thumbinfo:d.item[t]});D=setTimeout(B(),10)};function z(t,e){t=Array.isArray(t)?t:[t];p.fire("append-start");t.forEach(function(e,i){var n={pos:i,filedata:e,callback:function(e){p.fire("append-progress",this.__id,Math.max(v.uuid,t.length));Y(d.item.length,this.filedata,function(t){t&&p.fire("error",t);e&&e()})}};v.addWork(n)});v.addFinishCallback(e);v.addFinishCallback(function(){p.fire("append-complete")})}function q(t,e){e=e||0;try{var i=JSON.parse(t);if(typeof i==="object"){var n=function(t,e){e.angle&&G(t,e.angle);e.annotation&&d.item[t]&&d.item[t].annotation.setData(e.annotation);e.masking&&d.item[t]&&d.item[t].masking.setData(e.masking);p.fire("annotationLoaded",t)};if(Array.isArray(i)){i.forEach(function(t,i){n(e+i,t)})}else{n(e,i)}}}catch(t){p.fire("error","annotation load error: "+t.message)}}function Y(t,e,i){function n(t,e,i){var n=d.item[t]=new c(0,0,e);n.caption=i.caption||"";n.nextLine=i.text||"";if(i.key)n.key=i.key;n.type=i.type||"image";n.layout_wrap$=H(t,n.uniqueId);if(!b){p.fire("error","Loader  . path   engine  .")}var r={cmd:"loadAndMakeThumb",buffer:n.filebuffer,id:{index:t,uniqueId:n.uniqueId}};r.__id=b.addWork(r);return n}function s(t){if(e.annotation&&typeof e.annotation==="string"){var n=e.annotation.toLowerCase();var r=n.match(/^http?\:\/\/([^\:\/]+)/);if(r){iws.util.urlDownload(e.annotation,function(e){var n=j(t.uniqueId);q(e,n);i&&i()},function(t){i&&i("annotation:"+e.annotation+" - "+t)},{responseType:"text"})}else{var s=j(t.uniqueId);q(e.annotation,s);i&&i()}}else{i&&i()}p.fire("splited",d.item.length)}switch(e.type){case"image":var o=function(t,e,s,o){m.callBackonmessage(function(e){var i=e.data,a=i.bufferarray,l=d.item.length;if(r.readOnlyOne){var h=n(t,a[0].buffer,s);h.pageCount=a.length;if(h.pageCount>1){h.layout_wrap$.find(".thumb_multipage").css("display","block")}o&&o(h)}else{var u=null;for(var c=0;c<a.length;c++){var f=l+c;if(c==0){if(!s.text&&a.length>1){s.text="1"}u=n(f,a[c].buffer,s)}else{n(f,a[c].buffer,{caption:s.caption,text:(c+1).toString(),key:null})}}o&&o(u)}});m.callBackonerror(function(t){i&&i("An splite error occurred.")});m.postMessage({cmd:"split",buffer:e})};if(e.buffer){o(t,e.buffer,e,s)}else if(e.url){var a=iws.util.urlDownload(e.url,function(i){o(t,i,e,s)},function(n){var r=v.getCurrentWork();if(r.aborted===true){i&&i();return}var s=iws.util.base64.decode(d.icon.error_network.substr(d.icon.error_network.indexOf(",")+1));o(t,s,e,function(t){t.setError("image - "+e.url+" - "+n);i&&i()})});var l=v.getCurrentWork();l.quit=function(t,e){return function(){e.aborted=true;t.abort()}}(a,l)}else if(e.src){var h=iws.util.base64.decode(e.src.substr(e.src.indexOf(",")+1));o(t,h,e,s)}break;case"video":case"audio":var u=d.icon[e.type];var h=iws.util.base64.decode(u.substr(u.indexOf(",")+1));var f=n(t,h,e);f.mediaSource={type:e.type,sources:e.sources};e.title&&(f.mediaSource.title=e.title);e.poster&&(f.mediaSource.poster=e.poster);e.tracks&&(f.mediaSource.tracks=e.tracks);s();break;default:i&&i("Unkown file type! - "+e.type);break}}function W(t){if(t<0||t>=d.item.length)return;var e=d.item[t];var i=A(e.uniqueId);if(d.focusIndex==t){i.addClass("thumb_layout_focused")}else{i.removeClass("thumb_layout_focused")}var r=i.children("div.thumb_border_wrap").children("div.thumb_border");if(e.selected===true){r.addClass("thumb_border_select")}else{r.removeClass("thumb_border_select")}var s=n._transform(e.imgWidth,e.imgHeight,r.width(),r.height(),e.angle);var o=r.children("div.thumb_img_wrap").children("img");var a=e.type==="image"?s.ratio:1;o.css("transform","translate("+s.x+"px, "+s.y+"px) scale("+a+") rotate("+e.angleDisplay+"deg)")}function X(t,e){var i=$("<div/>",{class:"thumb_border_wrap",id:"thumb_border_wrap_"+t});var s=$("<input/>",{type:"checkbox",class:"thumb_check",id:"thumb_check"+t});s.css("visibility",d.checkVisible===true?"visible":"hidden");s.click(function(t,e){return function(t){var i=j(e);if($(this).is(":checked")==true){d.item[i].selected=true}else{d.item[i].selected=false}W(i);t.stopPropagation()}}(t,e));i.append(s);var o=$("<img/>",{class:"thumb_img",id:"thumb_img_"+t});o.attr("src",d.icon.image);o.css("opacity","0.0");var a=$("<div/>",{class:"thumb_img_wrap"});a.append(o);var l=$("<div/>",{class:"thumb_border"});l.append(a);i.append(l);o.load(function(t){return function(e){var i=j(t);if(i>=0){d.item[i].imgWidth=this.width;d.item[i].imgHeight=this.height;var r=A(t).children("div.thumb_border_wrap").children("div.thumb_border");var s=n._transform(this.width,this.height,r.width(),r.height(),d.item[i].angle);var o=r.children("div.thumb_img_wrap").children("img");var a=d.item[i].type==="image"?s.ratio:1;o.css("transform","translate("+s.x+"px, "+s.y+"px) scale("+a+") rotate("+d.item[i].angleDisplay+"deg)");o.css("opacity","1.0")}}}(e));var h=$('<div class="thumb_number" id="thumb_number_'+t.toString()+'">'+(t+1)+"</div>");r.useThumbNumber?h.css("visibility","visible"):h.css("visibility","hidden");i.append(h);if(r.useBookMark&&d.item[t].type=="image"){var u=$('<i class="thumb_bookmark"></i>');u.addClass("thumb_bookmark_uncheck");i.append(u);r.useBookMarkClick&&u.on("click",function(t){return function(e){e.preventDefault();e.stopPropagation();var i=j(t);d.item[i].bookmark.setData(!d.item[i].bookmark.getData())}}(e))}var c=$('<i class="thumb_annotation"></i>');i.append(c);var f=$('<i class="thumb_multipage"></i>');i.append(f);return i}function H(t,e){var i=$("<div/>",{class:"thumb_layout_wrap",id:"thumb_layout_wrap_"+t.toString()});i.attr("uniqueId",e);i.attr("index",t.toString());var n=$("<div>",{class:"thumb_layout",id:"thumb_layout_"+t});n.click(u(t,e));i.append(n);T.append(i);var r=X(t,e);n.append(r);i.append('<div class="thumb_caption">'+d.item[t].caption+"</div>");i.append('<div class="thumb_caption_nextLine">'+d.item[t].nextLine+"</div>");return i}var V=function(t){return(d.checkVisible===true?false:d.focusIndex===t)||d.item[t].selected===true};function U(t,e){for(var i=0;i<d.item.length;i++){if(V(i)&&d.item[i].type=="image"){d.item[i].angleDisplay=d.item[i].angleDisplay+t;d.item[i].angle=(d.item[i].angle+t)%360;if(d.item[i].angle<0)d.item[i].angle=360+d.item[i].angle;W(i);e&&e(t,d.item[i])}}}function N(){for(var t=d.item.length-1;t>=0;t--){if(V(t)){T.children("div.thumb_layout_wrap").remove('[uniqueId="'+d.item[t].uniqueId+'"]');d.item.splice(t,1)}}for(var t=0;t<d.item.length;t++){var e=A(d.item[t].uniqueId).children("div.thumb_border_wrap").children("div.thumb_number");e.text((t+1).toString())}}function Q(t){if(t>=0&&t<d.item.length)return d.item[t].angle;else return 0}function G(t,e){if(e%90!==0)return false;try{d.item[t].angleDisplay=e;d.item[t].angle=e%360;if(d.item[t].angle<0)d.item[t].angle=360+d.item[t].angle;W(t);return true}catch(t){return false}}return{setOption:function(t){r=$.extend({},r,t)},init:function(t){I(t)},appendContents:function(t,e){z(t,e)},setWidth:function(t){d.width=t},setHeight:function(t){d.height=t},rotate:function(t,e){U(t,e)},getAngle:function(t){return Q(t)},setAngle:function(t,e){return G(t,e)},remove:function(){N();if(d.focusIndex>=0){if(d.focusIndex>=d.item.length){d.focusIndex=d.item.length-1}if(d.focusIndex>=0){A(d.item[d.focusIndex].uniqueId).trigger("click")}else{p.fire("thumbClick",-1,"removeAll",-1)}}},setBookmark:function(t,e){d.item[t]&&d.item[t].bookmark.setData(e)},getBookmark:function(t){if(d.item[t]){return d.item[t].bookmark.getData()}return false},setSelect:function(t,e){d.item[t].selected=e;var i=A(d.item[t].uniqueId).children("div.thumb_border_wrap").children(".thumb_check");i.prop("checked",e);W(t)},getSelect:function(t){return d.item[t].selected},setCaption:function(t,e){var i=d.item[t];if(i){i.caption=e;var n=T.children('[uniqueId="'+i.uniqueId+'"]').children("div.thumb_caption");n.text(e)}},getCaption:function(t){var e=d.item[t];if(e){return e.caption}return""},setText:function(t,e){var i=d.item[t];if(i){i.nextLine=e;var n=i.layout_wrap$.find("div.thumb_caption_nextLine");n.text(e)}},getText:function(t){var e=d.item[t];if(e){return e.nextLine}return""},setKey:function(t,e){if(!d.item[t])return;d.item[t].key=e},getKey:function(t){return d.item[t]&&d.item[t].key||null},setPrintString:function(t,e){var i=$.extend({},d.item[t].printString,e);d.item[t].printString=i},get pageIndex(){return d.focusIndex},set pageIndex(t){if(t>=0&&t<d.item.length){A(d.item[t].uniqueId).trigger("click")}},pageCount:function(){return d.item.length},get selectVisible(){return d.checkVisible},set selectVisible(t){d.checkVisible=t;for(var e=0;e<d.item.length;e++){var i=A(d.item[e].uniqueId).children("div.thumb_border_wrap").children(".thumb_check");if(d.checkVisible===true){i.css("visibility","visible")}else{i.css("visibility","hidden")}}},getItem:function(t){return d.item[t]},each:function(t){for(var e=0;e<d.item.length;e++){t&&t(d.item[e],e)}},setLoadType:function(t){y(t)},print:function(){var t=[];for(var e=0;e<d.item.length;e++){if(V(e)&&d.item[e].type=="image")t.push({cmd:"print",buffer:d.item[e].filebuffer,pageSrc:d.item[e].pageSrc,id:{index:e,uniqueId:d.item[e].uniqueId,page:{angle:d.item[e].angle,annotation:d.item[e].annotation.getData(),masking:d.item[e].masking.getData(),pageinfo:d.item[e].pageInfo,filter:d.item[e].filter,printString:d.item[e].printString}}})}if(t.length>0){iws.util.print.image(w,t,r)}},pageSave:function(e,i){var n=";base64,";function r(e){var i=e.indexOf(n)+n.length;var r=t.atob(e.substring(i));return Uint8Array.from(Array.prototype.map.call(r,function(t){return t.charCodeAt(0)}))}var s=d.focusIndex;if(s==-1){i(false,null);p.fire("error","  . \n .")}else if(d.item[s].type=="image"){if(d.item[s].filebuffer){i(true,d.item[s].filebuffer)}else if(d.item[s].pageSrc!=""){var o=r(d.item[s].pageSrc);i(true,o)}else{p.fire("error","   . \n .")}}else{i(false,null);p.fire("error","   . \n .")}},pageSaveTiff:function(t){var e=3;var i=[];var n=[];for(var r=0;r<d.item.length;r++){if(V(r)&&d.item[r].type=="image")n.push({cmd:"savepage",buffer:d.item[r].filebuffer,id:{index:r,uniqueId:d.item[r].uniqueId,angle:d.item[r].angle},format:e})}var s=new iws.util.work.WorkCrew(x,1,1,false);s.oncomplete=function(t,e){var n=e.data,r=n.id;i.push({id:n.id,filearray:n.filearray})};s.onfinish=function(){s.close();m.init();m.callBackonmessage(function(e){var i=e.data;t(i.success,i.bufferarray)});m.callBackonerror(function(e){console.log("An merge error occurred.");t(false,"exception")});m.postMessage({cmd:"merge",buffer:i})};n.forEach(function(t){t.__id=s.addWork(t)})},annotationSave:function(t){var e=new Array;d.item.forEach(function(t,i){var n={version:1};n.angle=Q(i);n.annotation=t.annotation.getData();n.masking=t.masking.getData();if(n.angle==0&&n.annotation.length==0&&n.masking.length==0){n={}}e.push(n)});var i=JSON.stringify(e);t(i)},annotationLoad:function(t,e){q(t,e)},findIndex:function(t){return j(t)},getObserver:function(){return p},destroy:function(){s.off("dragover drop keydown focus blur scroll click mousemove");T.remove();if(d){for(var t=d.item.length-1;t>=0;t--){d.item.splice(t,1)}d=null}if(m!==null){m.close();m=null}if(b!==null){b.close();b=null}clearInterval(P)},drawAnnototation:function(t){_(d.item[t])}}}})(window);(function(){"use strict";function t(){this.initialize.apply(this,arguments)}iws.Page=iws.util.createInheritClass(t,iws.Observable,{containerClass:"page-container",lowerCanvasEl:null,viewportTransform:[1,0,0,1,0,0],backgroundVpt:true,overlayVpt:true,backgroundColor:"",imageCtrl:null,stopRendering:true,dirty:false,autoResize:true,reSampleUse:true,reSampleRate:.8,reSampleFilter:"convolveFloat32",info:{},filter:{},initialize:function(t,e){e||(e={});this.imageCtrl=new iws.ImageControl(this);this.trackMouse=new iws.TrackMouse;this._initWrapperElement(t);this._initOptions(e);this._initEventListeners();this._initResample();if(!window.requestAnimationFrame){window.requestAnimationFrame=function(t){var e=(new Date).getTime();var i=Math.max(0,16-(e-r));var n=window.setTimeout(function(){t(e+i)},i);var r=e+i;return n}}this.mainToolbar=new iws.toolbar.page(this);this.setTrackMode("move");this.fire("annotation:use",false);if(typeof this.visibleToolbar!=="undefined"){this.fire("toolbar:visible",this.visibleToolbar)}if(typeof this.fitMode!=="undefined"){this.setFitMode(this.fitMode)}if(this.autoResize){this.resizer=new iws.util.resize(this.fullScreenEl,this._reSize.bind(this))}this._reSize();if(typeof window.Hammer!=="undefined"){this.touchInfo=new function(){return{isStarted:false,scale:0,pinchScale:0,timerId:0,center:{x:0,y:0}}};var i=/mobile|tablet|ip(ad|hone|od)|android/i;var n=i.test(navigator.userAgent);var r=new Hammer(this.lowerCanvasEl,{domEvents:true});r.on("swipeleft",function(){if(!n)return;var t=this.imageCtrl.getDrawRect();var e=t.right-t.left;var i=t.bottom-t.top;if(this.getTrackMode()==="move"&&e<=this.width){this.fire("page:swipe_left")}}.bind(this));r.on("swiperight",function(){if(!n)return;var t=this.imageCtrl.getDrawRect();var e=t.right-t.left;var i=t.bottom-t.top;if(this.getTrackMode()==="move"&&e<=this.width){this.fire("page:swipe_right")}}.bind(this));r.get("pinch").set({enable:true});r.on("pan",function(t){}.bind(this));r.on("panend",function(t){});r.on("pinchstart",function(t){this.touchInfo.isStarted=true}.bind(this));r.on("pinch",function(t){if(this.getTrackMode()==="move"){this.touchInfo.pinchScale=t.scale;var e=$(this.lowerCanvasEl).offset();this.touchInfo.center={x:t.center.x-e.left,y:t.center.y-e.top};clearTimeout(this.touchInfo.timerId);this.touchInfo.timerId=setTimeout(function(){var t=this.touchInfo.scale*this.touchInfo.pinchScale;this._zoom({name:"custom",scale:t},this.touchInfo.center)}.bind(this),1)}}.bind(this));r.on("pinchend",function(t){this.touchInfo.isStarted=false}.bind(this));r.on("doubletap",function(t){console.log("doubletap");if(this.getTrackMode()==="move"){var e=this.getFitMode();if(e.name!=="auto"){this.setFitMode({name:"auto"})}else{var i=$(this.lowerCanvasEl).offset();var n={x:t.center.x-i.left,y:t.center.y-i.top};this._zoom({name:"custom",scale:1},n)}}}.bind(this))}},_initWrapperElement:function(t){this.wrapperEl=t;iws.util.makeElementUnselectable(this.wrapperEl);$(this.wrapperEl).css("overflow","hidden");this.fullScreenEl=iws.util.makeElement("div",{class:"page-fullScreen"});this.wrapperEl.appendChild(this.fullScreenEl);this.pageContainer=iws.util.makeElement("div",{class:"page-container"});this.fullScreenEl.appendChild(this.pageContainer);this._createLowerCanvas(this.pageContainer);this.elErrorContainer=iws.util.makeElement("div",{class:"page-errorContainer w3-container"});this.elErrorContainer.innerHTML='<div class="w3-panel w3-red"><h3>Error!</h3><p>Message.</p></div>';this.pageContainer.appendChild(this.elErrorContainer);this.tooltipBox=iws.util.makeElement("div",{class:"iws-viewer-tooltip"});iws.util.makeElementUnselectable(this.tooltipBox);this.pageContainer.appendChild(this.tooltipBox);this.pageContainer.addClass("contentHolder");iws.scroll&&iws.scroll.initialize(this.pageContainer,{handlers:["click-rail","drag-scrollbar"],customInfo:{getContentInfo:function(){var t=this.imageCtrl.getDrawRect();var e=t.right-t.left;var i=t.bottom-t.top;return{scrollWidth:e,scrollHeight:i,scrollLeft:-t.left,scrollTop:-t.top}}.bind(this),setContentInfo:function(t){var e=this.imageCtrl.getDrawRect();if(t.direction==="top"){var i=e.top-t.value;this.imageCtrl.move({X:0,Y:-i});this.renderAll()}else if(t.direction==="left"){var n=e.left-t.value;this.imageCtrl.move({X:-n,Y:0});this.renderAll()}}.bind(this)}});this.observe("page:render",function(){iws.scroll&&iws.scroll.update(this.pageContainer)});if(iws.pageFilter){this.pageFilter=new iws.pageFilter(this)}},_createLowerCanvas:function(t){this.lowerCanvasEl=iws.util.makeElement("canvas",{class:"lower-canvas"});this.contextContainer=this.lowerCanvasEl.getContext("2d");this.contextContainer.imageSmoothingEnabled=true;t.appendChild(this.lowerCanvasEl)},_reSize:function(){var t=this.fullScreenEl.clientWidth;var e=this.fullScreenEl.clientHeight;var i=t;var n=e;if(this.mainToolbar.isVisible()){n=e-this.mainToolbar.height()}this.pageContainer.style.width=i+"px";this.pageContainer.style.height=n+"px";this.lowerCanvasEl.width=i;this.lowerCanvasEl.height=n;this.lowerCanvasEl.style.width=i+"px";this.lowerCanvasEl.style.height=n+"px";this.width=parseInt(t,10)||0;this.height=parseInt(e,10)||0;this.imageCtrl.fitRefresh();this.renderAll()},_initOptions:function(t){for(var e in t){this[e]=t[e]}this.viewportTransform=this.viewportTransform.slice()},_initEventListeners:function(){$(this.lowerCanvasEl).on("mousedown touchstart",this.onMouseDown.bind(this));$(this.lowerCanvasEl).on("mousemove touchmove",this.onMouseMove.bind(this));$(this.lowerCanvasEl).on("mousewheel DOMMouseScroll",this.onMouseWheel.bind(this));$(this.lowerCanvasEl).on("dblclick",this.onMouseDblclick.bind(this));this.observe("page:zoom",function(){this.tooltip()});this.observe("page:fitMode",function(){this.tooltip()})},_initResample:function(){if(typeof Worker==="undefined"||typeof this.path==="undefined")return;if(this.reSampleUse){var t=new iws.resizer;var e=function(e,i,n,r,s){var o=Date.now();var a=document.createElement("canvas");a.width=r.width=i;a.height=r.height=n;t.resize(e,a,{quality:0,alpha:true,unsharpAmount:80,unsharpRadius:.6,unsharpThreshold:2,transferable:true}).then(function(){r.getContext("2d").drawImage(a,0,0);s&&s()}).catch(function(t){console.log(t);throw t})};var i=function(){this.initialize.apply(this,arguments)};i.prototype={reSampler_Queue:[],reSampler_Running:false,lastInfo:{scale:0,width:0,height:0},currentInfo:{scale:0,width:0,height:0},initialize:function(t,e,i){for(var n in t){this[n]=t[n]}this.callback_Resampled=e;this.callback_Canceled=i},requestResample:function(t,e){this.currentInfo={scale:t,width:e.width,height:e.height};this.timer_Resample&&clearTimeout(this.timer_Resample);if(this._needToResample(t)){this.timer_Resample=setTimeout(function(){this.reSampler_Queue.push({scale:t,width:e.width,height:e.height});if(!this.reSampler_Running){this._workLastRequest()}}.bind(this),100)}else{this.callback_Canceled&&this.callback_Canceled()}},init:function(){this.reSampler_Running=false;this.lastInfo={scale:0,width:0,height:0};this.currentInfo={scale:0,width:0,height:0};for(var t=this.reSampler_Queue.length-1;t>=0;t--){this.reSampler_Queue.splice(t,1)}},_workLastRequest:function(){var t=this.reSampler_Queue.pop();if(t.scale!==this.lastInfo.scale){this.lastInfo=t;this.reSampler_Running=true;e(this.imgCtrl.getCanvas(),t.width,t.height,this.imgCtrl.getCanvasResample(),function(){this.reSampler_Running=false;this.callback_Resampled()}.bind(this))}for(var i=this.reSampler_Queue.length-1;i>=0;i--){this.reSampler_Queue.splice(i,1)}},_needToResample:function(t){return t<=this.reSampleRate}};var n=function(t,e,i){this.renderAll()};var r=function(){this.imageCtrl.clearResample();this.renderAll()};var s=function(){if(this.imageCtrl.isValid()){this.reSample.requestResample(this.imageCtrl.scale,this.imageCtrl.getScaleSize())}};this.reSample=new i({path:this.path,reSampleRate:this.reSampleRate,reSampleFilter:this.reSampleFilter,imgCtrl:this.imageCtrl},n.bind(this),r.bind(this));this.observe("page:setRawData",function(){this.reSample.init()});this.observe("page:setFilter",function(){this.reSample.init();s.call(this)});this.observe("canvas:cleared",function(){this.reSample.init()});this.observe("page:zoom",function(){s.call(this)});this.observe("page:fitMode",function(){s.call(this)})}},_initSpliter:function(){if(typeof Worker==="undefined"||typeof this.path==="undefined")return;this.pages=[];this.observe("canvas:cleared",function(){this.pages=[];this.spliter&&this.spliter.init()});this.observe("page:setBuffer",function(t,e){this.spliter&&this.spliter.callBackonmessage(function(t){var i=t.data,n=i.bufferarray;this.pages=n;if(this.pages.length>1){this.pageContainer.appendChild('<div id="lg-counter"><span id="lg-counter-current">2</span> / <span id="lg-counter-all">4</span></div>')}e&&e()}.bind(this));this.spliter&&this.spliter.callBackonerror(function(t){var i="A splite error occurred.(page)";this.fire("error",i);e&&e(i)}.bind(this));this.spliter&&this.spliter.postMessage({cmd:"split",buffer:t})}.bind(this));this.spliter=iws.util.work.Spliter(iws.util.string.combinePath(this.path,"/engine/iws.w.split.js"),false)},setCursor:function(t){this.lowerCanvasEl.style.cursor=t},onMouseDown:function(t){if(this.touchInfo){this.touchInfo.scale=this.imageCtrl.scale}$(this.lowerCanvasEl).off("mousemove touchmove");$(document).on("mousemove touchmove",this.onMouseMove.bind(this));$(document).on("mouseup touchend",this.onMouseUp.bind(this));this._onMouseDown(t.originalEvent||t)},onMouseMove:function(t){this._onMouseMove(t.originalEvent||t)},onMouseUp:function(t){$(document).off("mouseup touchend");$(document).off("mousemove touchmove");$(this.lowerCanvasEl).on("mousemove touchmove",this.onMouseMove.bind(this));this._onMouseUp(t.originalEvent||t)},_onMouseDown:function(t){var e=iws.util.getPointers(t);if(e.length===1){var i=this.getPointer(t);this.trackMouse.mouseMovePos=this.trackMouse.mouseDownPos=i;this.trackMouse.leftMouseButtonDown=true;this.renderAll()}else{console.log("_onMouseDown : ("+e[0].x+", "+e[0].y+"), ("+e[1].x+", "+e[1].y+")")}},_onMouseMove:function(t){if(!this.touchInfo||this.touchInfo&&!this.touchInfo.isStarted){var e=this.getPointer(t);var i=this.trackMouse.mousePrevMoveOffset.x=e.x-this.trackMouse.mouseMovePos.x,n=this.trackMouse.mousePrevMoveOffset.y=e.y-this.trackMouse.mouseMovePos.y;if(this.trackMouse.isMove()){this.imageCtrl.move({X:i,Y:n})}if(this.imageCtrl.isInDrawImage(this.contextContainer,e)){if(this.trackMouse.mouseType=="move")this.setCursor("move");else if(this.trackMouse.mouseType=="range")this.setCursor("crosshair");else if(this.trackMouse.mouseType=="glass"){if(this.trackMouse.leftMouseButtonDown){this.setCursor("none")}else this.setCursor("pointer")}}else{this.setCursor("default")}this.trackMouse.mouseMovePos=e;this.renderAll()}},_onMouseUp:function(t){if(this.trackMouse.isRange()&&this.imageCtrl.isValid()){var e=this.trackMouse.getIntersectRect(this.imageCtrl.getDrawRect());var i=this.imageCtrl.getImageRect(e);var n=iws.util.Rect(i);if(n.width()>4&&n.height()>4){this.fire("mouse:drawRanged",n.round())}}this.trackMouse.leftMouseButtonDown=false;this.renderAll()},onMouseWheel:function(t){t.preventDefault();t.stopPropagation();var e=$(this.lowerCanvasEl).offset(),i=(t.pageX||t.originalEvent.pageX)-e.left,n=(t.pageY||t.originalEvent.pageY)-e.top;var r=this.getPointer(t.originalEvent||t);if(t.originalEvent.detail<0||t.originalEvent.wheelDelta>0){this._zoom("in",r)}else{this._zoom("out",r)}},onMouseDblclick:function(t){t.preventDefault();t.stopPropagation();if(this.getTrackMode()==="move"){this.setFitMode({name:"auto"})}},tooltip:function(){if(!this.imageCtrl.isValid())return;var t=this;var e=true;var i=t.tooltipBox;var n=t.imageCtrl.scale;function r(t){return typeof t==="undefined"}function s(t,e){if(!r(t.textContent)){t.textContent=e}else{t.innerText=e}}s(i,Math.round(n*100)+"%");clearTimeout(t.tooltiping);if(!t.tooltiping){if(e){if(t.fading){iws.event.dispatchEvent(i,"transitionend")}i.addClass("iws-viewer-show");i.addClass("iws-viewer-fade");i.addClass("iws-viewer-transition");i.addClass("iws-viewer-in")}else{i.addClass("iws-viewer-show")}}else{clearTimeout(t.tooltiping)}t.tooltiping=setTimeout(function(){if(e){iws.event.addListener(i,"transitionend",function(){i.removeClass("iws-viewer-show");i.removeClass("iws-viewer-fade");i.removeClass("iws-viewer-transition");t.fading=false},true);i.removeClass("iws-viewer-in");t.fading=true}else{i.removeClass("iws-viewer-show")}t.tooltiping=false},1e3)},clearContext:function(t){t.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this.clearContext(this.contextContainer);this.imageCtrl.clear();this.fire("canvas:cleared");this.renderAll();this.stopRendering=true;$(this.elErrorContainer).css("display","none");return this},setInfo:function(t){for(var e in t){this.info[e]=t[e];if(e in this.imageCtrl.ImageProps){this.imageCtrl[e]=t[e]}}},_setDefault:function(){this.pageFilter&&this.pageFilter.changeDefaultValue();$(this.elErrorContainer).css("display","none")},setSrc:function(t,e,i){this._setDefault();var n=Date.now();this.imageCtrl.setSrc(t,e,function(){i&&i();this.renderAll()}.bind(this))},setRawData:function(t,e,i,n,r){this._setDefault();var s=Date.now();this.imageCtrl.setRawData(e,i,new Uint8Array(t),n,function(){r&&r();this.renderAll()}.bind(this))},setBuffer:function(t,e){this.fire("page:setBuffer",t,e)},setErrorMsg:function(t){this.clear();$(this.elErrorContainer).find("p").text(t);$(this.elErrorContainer).css("display","inline-block")},setFitMode:function(t){this.imageCtrl.fitMode=t;this.renderAll()},getFitMode:function(){return this.imageCtrl.fitMode},_zoom:function(t,e){this.imageCtrl.zoom(t,e);this.renderAll()},zoomIn:function(){this._zoom("in")},zoomOut:function(){this._zoom("out")},setRotate:function(t){this.imageCtrl.rotate(t);this.renderAll()},setAngle:function(t){this.imageCtrl.setAngle(t);this.renderAll()},setTrackMode:function(t){this.trackMouse.mouseType=t;this.fire("mouseTrackChange",t)},getTrackMode:function(){return this.trackMouse.mouseType},renderAll:function(){if(iws.useAnimationFrame){this.dirty=true;if(this.stopRendering){this.stopRendering=false;var t=this;var e=function(){if(t.dirty){t.dirty=false;var i=t.contextContainer;t._renderCanvas(i)}if(!t.stopRendering)window.requestAnimationFrame(e)};e()}}else{this._renderCanvas(this.contextContainer)}return this},_renderCanvas:function(t){this._renderBefore(t);console.log("_renderCanvas.................");this.imageCtrl.render(t);this._renderTracking(t);this._renderAfter(t)},_renderBefore:function(t){this.clearContext(t);this.fire("before:render");this._renderBackgroundOrOverlay(t,"background")},_renderTracking:function(t){if(this.trackMouse.isGlass()){this.trackMouse.drawMagnifyGlass(this.lowerCanvasEl)}if(this.trackMouse.isRange()&&this.imageCtrl.isValid()){this.trackMouse.drawRange(this.lowerCanvasEl,this.imageCtrl.getDrawRect())}},_renderAfter:function(t){this._renderBackgroundOrOverlay(t,"overlay");this.fire("after:render")},_renderBackgroundOrOverlay:function(t,e){var i=this[e+"Color"];if(i){t.fillStyle=i.toLive?i.toLive(t):i;t.fillRect(i.offsetX||0,i.offsetY||0,this.width,this.height)}i=this[e+"Image"];if(i){if(this[e+"Vpt"]){t.save();t.transform.apply(t,this.viewportTransform)}i.render(t);this[e+"Vpt"]&&t.restore()}},setBackgroundColor:function(t){return this.__setBgOverlayColor("backgroundColor",t,this.renderAll.bind(this))},__setBgOverlayColor:function(t,e,i){if(e&&e.source){var n=this;iws.util.loadImage(e.source,function(r){if(r!=null){n[t]=new iws.Pattern({source:r,
repeat:e.repeat,offsetX:e.offsetX,offsetY:e.offsetY})}i&&i()})}else{this[t]=e;i&&i()}return this},restorePointerVpt:function(t){return iws.util.transformPoint(t,iws.util.invertTransform(this.viewportTransform))},getPointer:function(t,e){var i=iws.util.getPointer(t),n=this.lowerCanvasEl.getBoundingClientRect(),r=n.width||0,s=n.height||0,o;if(!r||!s){if("top"in n&&"bottom"in n){s=Math.abs(n.top-n.bottom)}if("right"in n&&"left"in n){r=Math.abs(n.right-n.left)}}this._offset=iws.util.getElementOffset(this.lowerCanvasEl);i.x=i.x-this._offset.left;i.y=i.y-this._offset.top;if(!e){i=this.restorePointerVpt(i)}if(r===0||s===0){o={width:1,height:1}}else{o={width:this.lowerCanvasEl.width/r,height:this.lowerCanvasEl.height/s}}return{x:i.x*o.width,y:i.y*o.height}},crop:function(t,e){var i=this.imageCtrl.getRotateSize();var n=document.createElement("canvas");n.width=i.width;n.height=i.height;var r=n.getContext("2d");var s={x:this.imageCtrl.width/2,y:this.imageCtrl.height/2};r.translate(s.x,s.y);r.rotate(this.imageCtrl.angle*Math.PI/180);r.translate(-s.x,-s.y);var o={left:0,top:0,right:this.imageCtrl.width,bottom:this.imageCtrl.height};var a=iws.util.Rotate;var l=this.imageCtrl.angle;var h=a(l).rect(s.x,s.y,o);var u=a(-l).point(0,0,h.left,h.top);r.drawImage(this.imageCtrl.imgCanvas,-u.x,-u.y);var c=iws.util.Rect(t).width();var f=iws.util.Rect(t).height();var d=document.createElement("canvas");d.width=c;d.height=f;d.getContext("2d").drawImage(n,t.left,t.top,c,f,0,0,c,f);function g(t){var e=t.split(","),i=e[0].match(/:(.*?);/)[1],n=atob(e[1]),r=n.length,s=new Uint8Array(r);while(r--){s[r]=n.charCodeAt(r)}return s}var p=d.toDataURL("image/png");e&&e(p,g(p))},visible:function(t,e){this.fire(t+":visible",e)},setFilter:function(){if(this.pageFilter&&this.filter){this.pageFilter.setFilter()}},showFilter:function(t){if(this.pageFilter){return this.pageFilter.showFilter(t)}return null},destroy:function(){if(this.reSample){this.reSample.init();this.reSample=null}if(this.spliter){this.spliter.init();this.spliter=null}$(this.fullScreenEl).remove()}})})();(function(){iws.pageFilter=function(t){this.page=t;this.initialize()};iws.pageFilter.prototype={defaultValue:iws.util.filter.defaultValue,initialize:function(){this.imageFilter=iws.util.makeElement("div",{class:"page-imageFilter",id:"imageFilter"});this.imageFilter.innerHTML='<a class="handle ui-slideouttab-handle-rounded">Filter<i class="fa fa-icon fa-bank"></i></a>'+'<div class="range-slider">'+'<label class="range-label" >Brightness</label>'+'<div class="range-input-wrap">'+'<input id="brightness" class="range-slider__range" type="range" value="0" min="-255" max="255" step="5">'+'<span class="range-slider__value">0</span>'+"</div>"+"</div>"+'<div class="range-slider">'+'<label class="range-label" >Contrast</label>'+'<div class="range-input-wrap">'+'<input id="contrast" class="range-slider__range" type="range" value="0" min="-100" max="100" step="5">'+'<span class="range-slider__value">0</span>'+"</div>"+"</div>"+'<div class="range-slider">'+'<label class="range-label" >Gamma</label>'+'<div class="range-input-wrap">'+'<input id="gamma" class="range-slider__range" type="range" value="100" min="0" max="255" step="5">'+'<span class="range-slider__value">0</span>'+"</div>"+"</div>"+'<button type="button" class="range-btn range-btnGray" id="reset" title="Set default value">Reset default</button>';this.page.pageContainer.appendChild(this.imageFilter);var t=this;$(this.imageFilter).find("button#reset").on("click",function(){t.changeDefaultValue();var e=$(t.imageFilter).find(".range-slider__range");e.each(function(){$(this).trigger("input")})});$(this.imageFilter).tabSlideOut({offset:10,tabLocation:"bottom",offsetReverse:true,handleOffsetReverse:true});var e=function(){var e=$(this.imageFilter).find(".range-slider"),i=$(this.imageFilter).find(".range-slider__range"),n=$(this.imageFilter).find(".range-slider__value");var r=null;var s=this.page;n.each(function(){var e=$(this).prev().attr("id");var i=t.defaultValue[e];$(this).prev().val(i);$(this).html(i)});e.each(function(){i.on("input change",function(){$(this).next(n).html(this.value);clearTimeout(r);var e=this;r=setTimeout(function(){switch(e.id){case"brightness":case"contrast":{t.changeValue({gamma:t.defaultValue["gamma"]});t._executeFilter(function(e){t.changeValue({brightness:Number(i.filter("#brightness").val()),contrast:Number(i.filter("#contrast").val())});return iws.util.filter.brightness_contrast(e,t.page.filter.brightness,t.page.filter.contrast)})}break;case"gamma":{t.changeValue({brightness:t.defaultValue["brightness"],contrast:t.defaultValue["contrast"]});t._executeFilter(function(i){t.changeValue({gamma:Number(e.value)});return iws.util.filter.gamma(i,t.page.filter.gamma/100)})}break}},10)})})};e.call(this);this.page.observe("filter:visible",function(t){if(t==="show"){this.imageFilter.style.display="block"}if(t==="hide"){this.imageFilter.style.display="none"}}.bind(this))},_executeFilter:function(t){var e=this.page.imageCtrl.getOriginalImageData();if(e){var i=t(e);this.page.imageCtrl.putImageData(i);this.page.fire("page:setFilter");this.page.renderAll()}},changeDefaultValue:function(t){var e=this;var i=$(this.imageFilter).find(".range-slider__value");i.each(function(){var i=$(this).prev().attr("id");if(t){if(t.indexOf(i)==-1){return}}var n=e.defaultValue[i];$(this).prev().val(n);$(this).html(n)})},changeValue:function(t){var e=this;var i=$(this.imageFilter).find(".range-slider__value");i.each(function(){var i=$(this).prev().attr("id");if(t.hasOwnProperty(i)){var n=t[i];$(this).prev().val(n);$(this).html(n);e.page.filter[i]=n}})},setFilter:function(){var t=this;if(this.page.filter.hasOwnProperty("brightness")&&this.page.filter.hasOwnProperty("contrast")&&this.page.filter.hasOwnProperty("gamma")){if(this.page.filter.brightness!=this.defaultValue.brightness||this.page.filter.contrast!=this.defaultValue.contrast){this.changeDefaultValue(["gamma"]);this.changeValue({brightness:this.page.filter.brightness,contrast:this.page.filter.contrast});this._executeFilter(function(e){return iws.util.filter.brightness_contrast(e,t.page.filter.brightness,t.page.filter.contrast)})}else if(this.page.filter.gamma!=this.defaultValue.gamma){this.changeDefaultValue(["brightness","contrast"]);this.changeValue({gamma:this.page.filter.gamma});this._executeFilter(function(e){return iws.util.filter.gamma(e,t.page.filter.gamma/100)})}}},showFilter:function(t){return $(this.imageFilter).tabSlideOut(t||"toggle")}}})();(function(t){"use strict";var e=iws.logger(true,"[iws.media]");var i=e._log,n=e._warn;function r(t,e,n,r){i("_event:"+e+", bubbles:"+n)}var s={object:function(t){return t!==null&&typeof t==="object"},array:function(t){return t!==null&&(typeof t==="object"&&t.constructor===Array)},number:function(t){return t!==null&&(typeof t==="number"&&!isNaN(t-0)||typeof t==="object"&&t.constructor===Number)},string:function(t){return t!==null&&(typeof t==="string"||typeof t==="object"&&t.constructor===String)},boolean:function(t){return t!==null&&typeof t==="boolean"},nodeList:function(t){return t!==null&&t instanceof NodeList},htmlElement:function(t){return t!==null&&t instanceof HTMLElement},function:function(t){return t!==null&&typeof t==="function"},undefined:function(t){return t!==null&&typeof t==="undefined"}};var o=function(){var t=false,e="",i="",n=["webkit","o","moz","ms","khtml"];if(!s.undefined(document.cancelFullScreen)){t=true}else{for(var r=0,o=n.length;r<o;r++){e=n[r];if(!s.undefined(document[e+"CancelFullScreen"])){t=true;break}else if(!s.undefined(document.msExitFullscreen)&&document.msFullscreenEnabled){e="ms";t=true;break}}}i=e==="ms"?"MSFullscreenChange":e+"fullscreenchange";return{supportsFullScreen:t,prefix:e,fullScreenEventName:i,isFullScreen:function(t){if(s.undefined(t)){t=document.body}switch(this.prefix){case"":return document.fullscreenElement===t;case"moz":return document.mozFullScreenElement===t;default:return document[e+"FullscreenElement"]===t}},requestFullScreen:function(t){if(s.undefined(t)){t=document.body}return e===""?t.requestFullScreen():t[e+(e==="ms"?"RequestFullscreen":"RequestFullScreen")]()},cancelFullScreen:function(){return e===""?document.cancelFullScreen():document[e+(e==="ms"?"ExitFullscreen":"CancelFullScreen")]()},element:function(){return e===""?document.fullscreenElement:document[e+"FullscreenElement"]}}}();var a=function(){var t=navigator.userAgent,e=navigator.appName,i=""+parseFloat(navigator.appVersion),n=parseInt(navigator.appVersion,10),r,s,o,a=false,l=false,h=false,u=false;if(navigator.appVersion.indexOf("Windows NT")!==-1&&navigator.appVersion.indexOf("rv:11")!==-1){a=true;e="IE";i="11"}else if((s=t.indexOf("MSIE"))!==-1){a=true;e="IE";i=t.substring(s+5)}else if((s=t.indexOf("Chrome"))!==-1){h=true;e="Chrome";i=t.substring(s+7)}else if((s=t.indexOf("Safari"))!==-1){u=true;e="Safari";i=t.substring(s+7);if((s=t.indexOf("Version"))!==-1){i=t.substring(s+8)}}else if((s=t.indexOf("Firefox"))!==-1){l=true;e="Firefox";i=t.substring(s+8)}else if((r=t.lastIndexOf(" ")+1)<(s=t.lastIndexOf("/"))){e=t.substring(r,s);i=t.substring(s+1);if(e.toLowerCase()===e.toUpperCase()){e=navigator.appName}}if((o=i.indexOf(";"))!==-1){i=i.substring(0,o)}if((o=i.indexOf(" "))!==-1){i=i.substring(0,o)}n=parseInt(""+i,10);if(isNaN(n)){i=""+parseFloat(navigator.appVersion);n=parseInt(navigator.appVersion,10)}return{name:e,version:n,isIE:a,isFirefox:l,isChrome:h,isSafari:u,isIos:/(iPad|iPhone|iPod)/g.test(navigator.platform),isIphone:/(iPhone|iPod)/g.test(navigator.userAgent),isTouch:"ontouchstart"in document.documentElement}}();function l(){try{return window.self!==window.top}catch(t){return true}}function h(t){return t.keyCode?t.keyCode:t.which}function u(t,e){for(var i in e){t.setAttribute(i,s.boolean(e[i])&&e[i]?"":e[i])}}function c(t,e,i){var n=document.createElement(t);u(n,i);e.insertBefore(n,e.firstChild)}var f={autoplay:false,loop:false,seekTime:10,volume:10,volumeMin:0,volumeMax:10,volumeStep:1,duration:null,displayDuration:true,clickToPlay:true,hideControls:true,showPosterOnEnd:false,disableContextMenu:true,tooltips:{controls:false,seek:true},selectors:{html5:"video, audio",embed:"[data-type]",editable:"input, textarea, select, [contenteditable]",container:".iwsmedia",controls:{wrapper:".__controls"},buttons:{seek:'[data-btn="seek"]',play:'[data-btn="play"]',pause:'[data-btn="pause"]',restart:'[data-btn="restart"]',rewind:'[data-btn="rewind"]',forward:'[data-btn="fast-forward"]',mute:'[data-btn="mute"]',captions:'[data-btn="captions"]',fullscreen:'[data-btn="fullscreen"]'},volume:{input:'[data-btn="volume"]',display:".__volume--display"},progress:{container:".__progress",buffer:".__progress--buffer",played:".__progress--played"},captions:".__captions",currentTime:".__time--current",duration:".__time--duration"},classes:{setup:"c--setup",ready:"c--ready",videoWrapper:"c--video-wrapper",type:"iws--{0}",stopped:"c--stopped",playing:"c--playing",muted:"c--muted",loading:"c--loading",tooltip:"c--tooltip",hidden:"c--sr-only",hideControls:"c--hide-controls",isIos:"c--is-ios",isTouch:"c--is-touch",captions:{enabled:"c--captions-enabled",active:"c--captions-active"},fullscreen:{enabled:"c--fullscreen-enabled",active:"c--fullscreen-active"},tabFocus:"tab-focus"},captions:{defaultActive:false},fullscreen:{enabled:true,fallback:true,allowAudio:false},storage:{enabled:true,key:"iws.media"},controls:["play-large","play","progress","current-time","mute","volume","captions","fullscreen","restart","rewind","fast-forward"],i18n:{restart:"Restart",rewind:"Rewind {seektime} secs",play:"Play",pause:"Pause",forward:"Forward {seektime} secs",played:"played",buffered:"buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",toggleMute:"Mute",toggleCaptions:"Captions",toggleFullscreen:"Fullscreen"},types:{html5:["video","audio"]},events:["ready","ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","seeking","seeked","emptied"]};function d(t,e){if(t===0||e===0||isNaN(t)||isNaN(e)){return 0}return(t/e*100).toFixed(2)}function g(t,e){if(!t.length){t=[t]}for(var i=t.length-1;i>=0;i--){var n=i>0?e.cloneNode(true):e;var r=t[i];var s=r.parentNode;var o=r.nextSibling;n.appendChild(r);if(o){s.insertBefore(n,o)}else{s.appendChild(n)}return n}}function p(t,e,i,n){m(t,e,function(e){i.apply(t,[e])},n)}function v(t,e,i,n,r){var o=e.split(" ");if(!s.boolean(r)){r=false}if(t instanceof NodeList){for(var a=0;a<t.length;a++){if(t[a]instanceof Node){v(t[a],arguments[1],arguments[2],arguments[3])}}return}for(var l=0;l<o.length;l++){t[n?"addEventListener":"removeEventListener"](o[l],i,r)}}function m(t,e,i,n){if(t){v(t,e,i,true,n)}}function b(t,e,i,n){if(t){v(t,e,i,false,n)}}function w(t){var e=[];if(t.controls.indexOf("play-large")!==-1){e.push('<button type="button" data-btn="play" class="__play-large">','<svg><use xlink:href="#iws-play" /></svg>','<span class="c--tooltip">'+t.i18n.play+"</span>","</button>")}e.push("<div class="+t.selectors.controls.wrapper.replace(".","")+">");if(t.controls.indexOf("restart")!==-1){e.push('<button type="button" data-btn="restart">','<svg><use xlink:href="#iws-restart" /></svg>','<span class="c--tooltip">'+t.i18n.restart+"</span>","</button>")}if(t.controls.indexOf("rewind")!==-1){e.push('<button type="button" data-btn="rewind">','<svg><use xlink:href="#iws-rewind" /></svg>','<span class="c--tooltip">'+t.i18n.rewind+"</span>","</button>")}if(t.controls.indexOf("play")!==-1){e.push('<button type="button" data-btn="play">','<svg><use xlink:href="#iws-play" /></svg>','<span class="c--tooltip">'+t.i18n.play+"</span>","</button>",'<button type="button" data-btn="pause">','<svg><use xlink:href="#iws-pause" /></svg>','<span class="c--tooltip">'+t.i18n.pause+"</span>","</button>")}if(t.controls.indexOf("fast-forward")!==-1){e.push('<button type="button" data-btn="fast-forward">','<svg><use xlink:href="#iws-fast-forward" /></svg>','<span class="c--tooltip">'+t.i18n.forward+"</span>","</button>")}if(t.controls.indexOf("progress")!==-1){e.push('<span class="__progress">','<label for="seek{id}" class="c--tooltip">Seek</label>','<input id="seek{id}" class="__progress--seek" type="range" min="0" max="100" step="0.1" value="0" data-btn="seek">','<progress class="__progress--played" max="100" value="0" role="presentation"></progress>','<progress class="__progress--buffer" max="100" value="0">',"<span>0</span>% "+t.i18n.buffered,"</progress>");if(t.tooltips.seek){e.push('<span class="c--tooltip">00:00</span>')}e.push("</span>")}if(t.controls.indexOf("current-time")!==-1){e.push('<span class="__time">','<span class="c--tooltip">'+t.i18n.currentTime+"</span>",'<span class="__time--current">00:00</span>',"</span>")}if(t.controls.indexOf("duration")!==-1){e.push('<span class="__time">','<span class="c--tooltip">'+t.i18n.duration+"</span>",'<span class="__time--duration">00:00</span>',"</span>")}if(t.controls.indexOf("mute")!==-1){e.push('<button type="button" data-btn="mute">','<svg class="iconc--muted"><use xlink:href="#iws-muted" /></svg>','<svg><use xlink:href="#iws-volume" /></svg>','<span class="c--tooltip">'+t.i18n.toggleMute+"</span>","</button>")}if(t.controls.indexOf("volume")!==-1){e.push('<span class="__volume">','<label for="volume{id}" class="c--tooltip">'+t.i18n.volume+"</label>",'<input id="volume{id}" class="plyr__volume--input" type="range" min="'+t.volumeMin+'" max="'+t.volumeMax+'" value="'+t.volume+'" data-btn="volume">','<progress class="__volume--display" max="'+t.volumeMax+'" value="'+t.volumeMin+'" role="presentation"></progress>',"</span>")}if(t.controls.indexOf("captions")!==-1){e.push('<button type="button" data-btn="captions">','<svg class="icon--captions-on"><use xlink:href="#iws-captions-on" /></svg>','<svg><use xlink:href="#iws-captions-off" /></svg>','<span class="c--tooltip">'+t.i18n.toggleCaptions+"</span>","</button>")}if(t.controls.indexOf("fullscreen")!==-1){e.push('<button type="button" data-btn="fullscreen">','<svg class="icon--exit-fullscreen"><use xlink:href="#iws-exit-fullscreen" /></svg>','<svg><use xlink:href="#iws-enter-fullscreen" /></svg>','<span class="c--tooltip">'+t.i18n.toggleFullscreen+"</span>","</button>")}e.push("</div>");return e.join("")}iws.media=function(t,e){var n=this;var u=this;var c=$.extend({},f,e);this.config=c;this.parentEl=t;this.timers={};this._scroll={x:0,y:0};this._saveScrollPosition=function(){n._scroll={x:window.pageXOffset||0,y:window.pageYOffset||0}};this._restoreScrollPosition=function(){window.scrollTo(n._scroll.x,n._scroll.y)};this._eventCheckTab=function(t){function e(){var t=document.activeElement;if(!t||t===document.body){t=null}else{t=document.querySelector(":focus")}return t}function i(t){for(var e in u.buttons){var i=u.buttons[e];$(i).each(function(e){$(this).toggleClass(c.classes.tabFocus,this===t)})}}var n=h(t),r=e();if(n===9){i(r)}};this._eventHandleKey=function(t){var e=h(t),i=t.type==="keydown";if(!$.isNumeric(e)){return}function n(){var t=u.media.duration;if(!s.number(t)){return}I(t/10*(e-48))}if(i){var r=[48,49,50,51,52,53,54,56,57,32,75,38,40,77,39,37,70,67];if(r.indexOf(e)!==-1){t.preventDefault();t.stopPropagation()}switch(e){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:n();break;case 32:case 75:O();break;case 38:L();break;case 40:z();break;case 77:R();break;case 39:j();break;case 37:P();break;case 70:W();break;case 67:X();break}if(u.isFullscreen&&e===27){W()}}};this._setupMedia=function(){$(n.container).removeClass();$(n.container).addClass(c.selectors.container.replace(".",""));$(n.container).addClass(c.classes.type.replace("{0}",n.type));$(n.container).toggleClass(c.classes.stopped,c.autoplay);$(n.container).toggleClass(c.classes.isIos,a.isIos);$(n.container).toggleClass(c.classes.isTouch,a.isTouch);if(n.type==="video"){var t=document.createElement("div");t.setAttribute("class",c.classes.videoWrapper);g(n.media,t);n.videoContainer=t}};this._setupInterface=function(){var t=!n.container.querySelectorAll(c.selectors.controls.wrapper).length;if(t){var e=w(c);e=e.replace(/{seektime}/g,c.seekTime);e=e.replace(/{id}/g,Math.floor(Math.random()*1e4));n.container.insertAdjacentHTML("beforeend",e)}if(!y()){return}if(n.type==="audio"){$(u.controls).css("margin-top",(n.size.height-54)/2+"px")}if(t){x()}k();b();_();B();q();S();A()};this._ready=function(){window.setTimeout(function(){r(n.media,"ready")},0);$(n.media).toggleClass(c.classes.setup,true);$(n.container).toggleClass(c.classes.ready,true);if(c.autoplay){n._play()}};this._setTitle=function(){var t=c.i18n.play;if(s.string(c.title)&&c.title.length){t+=", "+c.title;n.container.setAttribute("aria-label",c.title)}if(n.buttons.play){for(var e=n.buttons.play.length-1;e>=0;e--){n.buttons.play[e].setAttribute("aria-label",t)}}};this._cancelRequests=function(){if(!(c.types.html5.indexOf(n.type)!==-1)){return}if(n.media){var t=n.media.querySelectorAll("source");for(var e=0;e<t.length;e++){t[e].parentNode.removeChild(t[e])}}};function v(){var t=null;n.storage={};if(!c.storage.enabled){return}window.localStorage.removeItem("plyr-volume");t=window.localStorage.getItem(c.storage.key);if(!t){return}else if(/^\d+(\.\d+)?$/.test(t)){Y({volume:parseFloat(t)})}else{n.storage=JSON.parse(t)}}function b(){if(u.type!=="audio"||c.fullscreen.allowAudio){var t=true;if(t||c.fullscreen.fallback&&!l()){$(u.container).toggleClass(c.classes.fullscreen.enabled,true)}else{i("Fullscreen not supported and fallback disabled")}}}function y(){try{u.controls=u.container.querySelector(c.selectors.controls.wrapper);u.buttons={};u.buttons.seek=u.container.querySelector(c.selectors.buttons.seek);u.buttons.play=u.container.querySelectorAll(c.selectors.buttons.play);u.buttons.pause=u.container.querySelector(c.selectors.buttons.pause);u.buttons.restart=u.container.querySelector(c.selectors.buttons.restart);u.buttons.rewind=u.container.querySelector(c.selectors.buttons.rewind);u.buttons.forward=u.container.querySelector(c.selectors.buttons.forward);u.buttons.fullscreen=u.container.querySelector(c.selectors.buttons.fullscreen);u.buttons.mute=u.container.querySelector(c.selectors.buttons.mute);u.buttons.captions=u.container.querySelector(c.selectors.buttons.captions);u.progress={};u.progress.container=u.container.querySelector(c.selectors.progress.container);u.progress.buffer={};u.progress.buffer.bar=u.container.querySelector(c.selectors.progress.buffer);u.progress.buffer.text=u.progress.buffer.bar&&u.progress.buffer.bar.getElementsByTagName("span")[0];u.progress.played=u.container.querySelector(c.selectors.progress.played);u.progress.tooltip=u.progress.container&&u.progress.container.querySelector("."+c.classes.tooltip);u.volume={};u.volume.input=u.container.querySelector(c.selectors.volume.input);u.volume.display=u.container.querySelector(c.selectors.volume.display);u.duration=u.container.querySelector(c.selectors.duration);u.currentTime=u.container.querySelector(c.selectors.currentTime);u.seekTime=u.container.querySelector(c.selectors.seekTime);return true}catch(t){i("It looks like there is a problem with your controls HTML");return false}}function x(){function t(){var t=O();var e=u.buttons[t?"play":"pause"],i=u.buttons[t?"pause":"play"];if(i&&i.length>1){i=i[i.length-1]}else{i=i[0]}if(i){var n=$(e).hasClass(c.classes.tabFocus);setTimeout(function(){i.focus();if(n){$(e).toggleClass(c.classes.tabFocus,false);$(i).toggleClass(c.classes.tabFocus,true)}},100)}}for(var e in u.buttons){var i=u.buttons[e];m(i,"blur",function(){$(i).toggleClass("tab-focus",false)})}p(u.buttons.play,"click",t);p(u.buttons.pause,"click",t);p(u.buttons.restart,"click",I);p(u.buttons.rewind,"click",P);p(u.buttons.forward,"click",j);p(u.buttons.seek,"change",I);p(u.volume.input,"change",function(){B(u.volume.input.value)});p(u.buttons.mute,"click",R);p(u.buttons.fullscreen,"click",W);m(document,o.fullScreenEventName,W);p(u.buttons.captions,"click",X);m(u.progress.container,"mouseenter mouseleave mousemove",V);if(c.hideControls){m(u.controls,"mouseenter mouseleave",function(t){u.controls.hover=t.type==="mouseenter"});m(u.controls,"mousedown mouseup touchstart touchend touchcancel",function(t){u.controls.pressed=["mousedown","touchstart"].indexOf(t.type)!==-1});m(u.controls,"focus blur",n._toggleControls,true)}m(u.volume.input,"wheel",function(t){t.preventDefault();var e=t.webkitDirectionInvertedFromDevice,i=c.volumeStep/5;if(t.deltaY<0||t.deltaX>0){if(e){z(i)}else{L(i)}}if(t.deltaY>0||t.deltaX<0){if(e){L(i)}else{z(i)}}})}function k(){m(u.media,"timeupdate seeking",S);m(u.media,"durationchange loadedmetadata",M);m(u.media,"ended",function(){if(u.type==="video"&&c.showPosterOnEnd){if(u.type==="video"){D()}I();u.media.load()}});m(u.media,"progress playing",T);m(u.media,"volumechange",q);m(u.media,"play pause ended",A);m(u.media,"waiting canplay seeked",E);if(c.clickToPlay&&u.type!=="audio"){var t=u.container.querySelector("."+c.classes.videoWrapper);if(!t){return}t.style.cursor="pointer";m(t,"click",function(){if(c.hideControls&&a.isTouch&&!u.media.paused){return}if(u.media.paused){n._play()}else if(u.media.ended){I();n._play()}else{n._pause()}})}if(c.disableContextMenu){m(u.media,"contextmenu",function(t){t.preventDefault()})}m(u.media,c.events.concat(["keyup","keydown"]).join(" "),function(t){r(u.container,t.type,true)})}function _(){if(u.type!=="video"){return}if(!u.container.querySelector(c.selectors.captions)){u.videoContainer.insertAdjacentHTML("afterbegin",'<div class="'+c.selectors.captions.replace(".","")+'"></div>')}u.usingTextTracks=false;if(u.media.textTracks){u.usingTextTracks=true}var t="",e,n=u.media.childNodes;for(var r=0;r<n.length;r++){if(n[r].nodeName.toLowerCase()==="track"){e=n[r].kind;if(e==="captions"||e==="subtitles"){t=n[r].getAttribute("src")}}}u.captionExists=t!==""?true:false;C(u);if(u.captionExists){var s=u.media.textTracks;for(var o=0;o<s.length;o++){s[o].mode="hidden"}if(a.isIE&&a.version>=10||a.isFirefox&&a.version>=31){i("Detected browser with known TextTrack issues - using manual fallback");u.usingTextTracks=false}if(u.usingTextTracks){i("TextTracks supported");for(var l=0;l<s.length;l++){var h=s[l];if(h.kind==="captions"||h.kind==="subtitles"){m(h,"cuechange",function(){if(this.activeCues[0]&&"text"in this.activeCues[0]){D(this.activeCues[0].getCueAsHTML())}else{D()}})}}}}}function C(){if(!u.buttons.captions){return}$(u.container).toggleClass(c.classes.captions.enabled,u.captionExists);if(u.captionExists){var t=u.storage.captionsEnabled;if(!s.boolean(t)){t=c.captions.defaultActive}if(t){$(u.container).toggleClass(c.classes.captions.active,true)}}}function S(t){if(!u.media)return;H(u.media.currentTime,u.currentTime);if(t&&t.type==="timeupdate"&&u.media.seeking){return}T(t)}function T(t){var e=u.progress.played,i=0,r=F();if(t){switch(t.type){case"timeupdate":case"seeking":if(u.controls.pressed){return}i=d(u.media.currentTime,r);if(t.type==="timeupdate"&&u.buttons.seek){u.buttons.seek.value=i}break;case"playing":case"progress":e=u.progress.buffer;i=function(){var t=u.media.buffered;if(t&&t.length){return d(t.end(0),r)}else if(s.number(t)){return t*100}return 0}();break}}n._setProgress(e,i)}this._setProgress=function(t,e){if(s.undefined(e)){e=0}if(s.undefined(t)){if(n.progress&&n.progress.buffer){t=n.progress.buffer}else{return}}if(s.htmlElement(t)){t.value=e}else if(t){if(t.bar){t.bar.value=e}if(t.text){t.text.innerHTML=e}}};function A(){if(!u.media)return;$(u.container).toggleClass(c.classes.playing,!u.media.paused);$(u.container).toggleClass(c.classes.stopped,u.media.paused);n._toggleControls(u.media.paused)}function M(){var t=F()||0;if(!u.duration&&c.displayDuration&&u.media.paused){H(t,u.currentTime)}if(u.duration){H(t,u.duration)}V()}function E(t){var e=t.type==="waiting";clearTimeout(n.timers.loading);n.timers.loading=setTimeout(function(){$(u.container).toggleClass(c.classes.loading,e);n._toggleControls(e)},e?250:0)}this._play=function(){u.media&&"play"in u.media&&u.media.play()};this._pause=function(){u.media&&"pause"in u.media&&u.media.pause()};function O(t){if(!t){t=u.media.paused}if(t){n._play()}else{n._pause()}return t}function P(t){if(!s.number(t)){t=c.seekTime}I(u.media.currentTime-t)}function j(t){if(!s.number(t)){t=c.seekTime}I(u.media.currentTime+t)}function I(t){var e=0,r=u.media.paused,s=F();if($.isNumeric(t)){e=t}else if(typeof t==="object"&&["input","change"].indexOf(t.type)!==-1){e=t.target.value/t.target.max*s}if(e<0){e=0}else if(e>s){e=s}n._updateSeekDisplay(e);try{u.media.currentTime=e.toFixed(4)}catch(t){}i("Seeking to "+u.media.currentTime+" seconds")}function F(){var t=parseInt(c.duration),e=0;if(u.media&&u.media.duration!==null&&!isNaN(u.media.duration)){e=u.media.duration}return isNaN(t)?e:t}this._updateSeekDisplay=function(t){if(!s.number(t)){t=0}var e=F(),i=d(t,e);if(n.progress&&n.progress.played){n.progress.played.value=i}if(n.buttons&&n.buttons.seek){n.buttons.seek.value=i}};function D(t){var e=$(c.selectors.captions)[0],i=document.createElement("span");e.innerHTML="";if(s.undefined(t)){t=""}if(s.string(t)){i.innerHTML=t.trim()}else{i.appendChild(t)}e.appendChild(i)}function R(t){if(!s.boolean(t)){t=!u.media.muted}u.media.muted=t;if(u.media.volume===0){B(c.volume)}}function B(t){var e=c.volumeMax,i=c.volumeMin;if(s.undefined(t)){t=u.storage.volume}if(t===null||isNaN(t)){t=c.volume}if(t>e){t=e}if(t<i){t=i}u.media.volume=parseFloat(t/e);if(u.volume.display){u.volume.display.value=t}if(t===0){u.media.muted=true}else if(u.media.muted&&t>0){R()}}function L(t){var e=u.media.muted?0:u.media.volume*c.volumeMax;if(!s.number(t)){t=c.volumeStep}B(e+t)}function z(t){var e=u.media.muted?0:u.media.volume*c.volumeMax;if(!s.number(t)){t=c.volumeStep}B(e-t)}function q(){var t=u.media.muted?0:u.media.volume*c.volumeMax;if(u.volume.input){u.volume.input.value=t}if(u.volume.display){u.volume.display.value=t}Y({volume:t});$(u.container).toggleClass(c.classes.muted,t===0)}function Y(t){$.extend(u.storage,t);window.localStorage.setItem(c.storage.key,JSON.stringify(u.storage))}function W(t){var e=o.supportsFullScreen;if(e){if(t&&t.type===o.fullScreenEventName){u.isFullscreen=o.isFullScreen(u.container)}else{if(!o.isFullScreen(u.container)){n._saveScrollPosition();o.requestFullScreen(u.container)}else{o.cancelFullScreen()}u.isFullscreen=o.isFullScreen(u.container);return}}else{u.isFullscreen=!u.isFullscreen;document.body.style.overflow=u.isFullscreen?"hidden":""}$(u.container).toggleClass(c.classes.fullscreen.active,u.isFullscreen);n.resize();r(u.container,u.isFullscreen?"enterfullscreen":"exitfullscreen",true);if(!u.isFullscreen&&e){n._restoreScrollPosition()}}function X(t){if(!u.buttons.captions){return}if(!s.boolean(t)){t=u.container.className.indexOf(c.classes.captions.active)===-1}u.captionsEnabled=t;$(u.container).toggleClass(c.classes.captions.active,u.captionsEnabled);r(u.container,u.captionsEnabled?"captionsenabled":"captionsdisabled",true);Y({captionsEnabled:u.captionsEnabled})}function H(t,e){if(!e){return}if(isNaN(t)){t=0}u.secs=parseInt(t%60);u.mins=parseInt(t/60%60);u.hours=parseInt(t/60/60%60);var i=parseInt(F()/60/60%60)>0;u.secs=("0"+u.secs).slice(-2);u.mins=("0"+u.mins).slice(-2);e.innerHTML=(i?u.hours+":":"")+u.mins+":"+u.secs}function V(t){var e=F();if(!c.tooltips.seek||!u.progress.container||e===0){return}var i=u.progress.container.getBoundingClientRect(),n=0,r=c.classes.tooltip+"--visible";if(!t){if($(u.progress.tooltip).hasClass(r)){n=u.progress.tooltip.style.left.replace("%","")}else{return}}else{n=100/i.width*(t.pageX-i.left)}if(n<0){n=0}else if(n>100){n=100}H(e/100*n,u.progress.tooltip);u.progress.tooltip.style.left=n+"%";if(t&&["mouseenter","mouseleave"].indexOf(t.type)!==-1){$(u.progress.tooltip).toggleClass(r,t.type==="mouseenter")}}this._toggleControls=function(t){if(!u.media||!c.hideControls||u.type==="audio"){return}var e=0,i=false,r=t,o=$(u.container).hasClass(c.classes.loading);if(!s.boolean(t)){if(t&&t.type){i=t.type==="enterfullscreen";r=["mousemove","touchstart","mouseenter","focus"].indexOf(t.type)!==-1;if(["mousemove","touchmove"].indexOf(t.type)!==-1){e=2e3}if(t.type==="focus"){e=3e3}}else{r=$(u.container).hasClass(c.classes.hideControls)}}window.clearTimeout(n.timers.hover);if(r||u.media.paused||o){$(u.container).toggleClass(c.classes.hideControls,false);if(u.media.paused||o){return}if(a.isTouch){e=3e3}}if(!r||!u.media.paused){n.timers.hover=window.setTimeout(function(){if((u.controls.pressed||u.controls.hover)&&!i){return}$(u.container).toggleClass(c.classes.hideControls,true)},e)}};function U(){var t=[];t.push('<svg xmlns="http://www.w3.org/2000/svg" style="display:none;">');t.push('<symbol id="iws-play" width="16" height="16" viewBox="0 0 16 16">','<path fill="#FFF" fill-rule="evenodd" d="M14.503 6.11L3.627.443C1.632-.596 0 .254 0 2.334v11.333c0 2.079 1.632 2.929 3.627 1.89L14.503 9.89c1.996-1.04 1.996-2.74 0-3.78"/>',"</symbol>");t.push('<symbol id="iws-pause" width="16" height="16" viewBox="0 0 16 16">','<path fill="#FFF" fill-rule="evenodd" d="M2.667.019a2.667 2.667 0 0 1 2.666 2.667v10.647a2.667 2.667 0 1 1-5.333 0V2.686A2.667 2.667 0 0 1 2.667.019zM13.333 0A2.667 2.667 0 0 1 16 2.667v10.647a2.667 2.667 0 1 1-5.333 0V2.667A2.667 2.667 0 0 1 13.333 0z"/>',"</symbol>");t.push('<symbol id="iws-enter-fullscreen" viewBox="0 0 16 16">','<path fill="#FFF" fill-rule="evenodd" d="M14.366 13.361h-2.322a1.32 1.32 0 1 0 0 2.639h3.608c.467 0 .878-.243 1.112-.61.152-.214.241-.476.241-.76v-3.608a1.32 1.32 0 1 0-2.639 0v2.34zM1.034 14.876a1.32 1.32 0 0 0 1.303 1.115h3.608a1.32 1.32 0 1 0 0-2.638H3.65V11.02a1.32 1.32 0 1 0-2.639 0v3.608c0 .084.008.167.024.248zM16.848.75A1.32 1.32 0 0 0 15.658 0H12.05a1.32 1.32 0 1 0 0 2.639h2.311v2.334a1.32 1.32 0 0 0 2.639 0V1.365c0-.222-.055-.43-.152-.614zM3.634 2.639H5.94A1.32 1.32 0 1 0 5.94 0H2.333a1.32 1.32 0 0 0-1.228.835c-.07.162-.11.34-.11.529v3.608a1.32 1.32 0 1 0 2.639 0V2.639z"/>',"</symbol>");t.push('<symbol id="iws-exit-fullscreen" viewBox="0 0 16 16">','<g fill="none" fill-rule="evenodd">','<g fill="#FFF">','<path d="M-2.634 13.361h-2.322a1.32 1.32 0 1 0 0 2.639h3.608c.467 0 .878-.243 1.112-.61.152-.214.241-.476.241-.76v-3.608a1.32 1.32 0 1 0-2.639 0v2.34zm-13.332 1.515a1.32 1.32 0 0 0 1.303 1.115h3.608a1.32 1.32 0 1 0 0-2.638h-2.296V11.02a1.32 1.32 0 1 0-2.639 0v3.608c0 .084.008.167.024.248zM-.152.75A1.32 1.32 0 0 0-1.342 0H-4.95a1.32 1.32 0 1 0 0 2.639h2.311v2.334a1.32 1.32 0 0 0 2.639 0V1.365c0-.222-.055-.43-.152-.614zm-13.214 1.888h2.307a1.32 1.32 0 1 0 0-2.639h-3.608a1.32 1.32 0 0 0-1.228.835c-.07.162-.11.34-.11.529v3.608a1.32 1.32 0 1 0 2.639 0V2.639z"/>','<path d="M12.676 3.386V1.394a1.354 1.354 0 0 0-2.71 0V4.7c0 .203.046.396.126.569.206.485.687.825 1.247.825h3.307a1.354 1.354 0 0 0 0-2.71h-1.97zM5.38 5.89c.417-.231.7-.676.7-1.186V1.397a1.354 1.354 0 0 0-2.71 0v1.989H1.359a1.354 1.354 0 1 0 0 2.709h3.306c.264 0 .51-.076.717-.205zm4.387 4.698c-.045.134-.07.277-.07.426v3.612a1.333 1.333 0 0 0 2.665 0v-2.361h2.304a1.333 1.333 0 0 0 0-2.666h-3.611c-.617 0-1.137.42-1.288.989zM3.644 12.31v2.308a1.333 1.333 0 1 0 2.665 0v-3.612c0-.41-.185-.778-.477-1.022a1.328 1.328 0 0 0-.888-.339H1.333a1.333 1.333 0 1 0 0 2.665h2.311z"/>',"</g>","</g>","</symbol>");
t.push('<symbol id="iws-volume" viewBox="0 0 16 16">','<g fill="none" fill-rule="evenodd">','<path fill="#FFF" d="M2.407 5.084a.717.717 0 0 0-.306.551v.078H.357A.361.361 0 0 0 0 6.077v3.845c0 .2.16.364.357.364H2.1v.079c0 .2.138.448.306.55l3.85 2.354c.397.295.732.295.732-.1V2.984c0-.683-.564-.356-.733-.253L2.407 5.084zm8.565-.285a.939.939 0 0 0-1.345 0 .983.983 0 0 0 0 1.372c.99 1.008.99 2.65 0 3.658a.982.982 0 0 0 0 1.371.936.936 0 0 0 1.345 0c1.73-1.765 1.73-4.636 0-6.4m2.705-2.516a.938.938 0 0 0-1.345 0 .984.984 0 0 0 0 1.372A6.16 6.16 0 0 1 14.098 8a6.16 6.16 0 0 1-1.766 4.344.985.985 0 0 0 0 1.372.941.941 0 0 0 1.345 0A8.11 8.11 0 0 0 16 8c0-2.16-.825-4.19-2.323-5.716"/>',"</g>","</symbol>");t.push('<symbol id="iws-muted" viewBox="0 0 16 16">','<g fill="none" fill-rule="evenodd">','<g fill="#FFF">','<path d="M2.658 4.887l-.277.17a.71.71 0 0 0-.302.545v.077H.353A.358.358 0 0 0 0 6.04V9.85c0 .199.158.36.353.36h1.726v.079c0 .198.136.443.302.546l3.808 2.332c.393.292.724.292.724-.1V7.98l1.927 1.4c-.088.133-.19.26-.306.38a.974.974 0 0 0 0 1.357.925.925 0 0 0 1.33 0c.19-.195.36-.404.51-.624l1.436 1.044c-.18.25-.381.49-.601.714a.977.977 0 0 0 0 1.36.93.93 0 0 0 1.33 0 8.08 8.08 0 0 0 .805-.96l1.192.867a.743.743 0 1 0 .874-1.202l-1.316-.957a8.123 8.123 0 0 0 .743-3.412c0-2.14-.816-4.152-2.297-5.664a.927.927 0 0 0-1.331 0 .976.976 0 0 0 0 1.359 6.11 6.11 0 0 1 1.747 4.305c0 .792-.147 1.56-.429 2.274l-1.529-1.11c.392-1.498.014-3.163-1.134-4.336a.927.927 0 0 0-1.33 0 .975.975 0 0 0 0 1.359 2.58 2.58 0 0 1 .732 1.717L6.913 6.141V2.974c0-.677-.558-.353-.724-.25l-2.16 1.322-2.621-1.905a.743.743 0 1 0-.874 1.202l2.124 1.544zM29.366 13.361h-2.322a1.32 1.32 0 1 0 0 2.639h3.608c.467 0 .878-.243 1.112-.61.152-.214.241-.476.241-.76v-3.608a1.32 1.32 0 1 0-2.639 0v2.34zm-13.332 1.515a1.32 1.32 0 0 0 1.303 1.115h3.608a1.32 1.32 0 1 0 0-2.638H18.65V11.02a1.32 1.32 0 1 0-2.639 0v3.608c0 .084.008.167.024.248zM31.848.75A1.32 1.32 0 0 0 30.658 0H27.05a1.32 1.32 0 1 0 0 2.639h2.311v2.334a1.32 1.32 0 0 0 2.639 0V1.365c0-.222-.055-.43-.152-.614zM18.634 2.639h2.307a1.32 1.32 0 1 0 0-2.639h-3.608a1.32 1.32 0 0 0-1.228.835c-.07.162-.11.34-.11.529v3.608a1.32 1.32 0 1 0 2.639 0V2.639z"/>',"</g>","</g>","</symbol>");t.push('<symbol id="iws-restart" viewBox="0 0 16 16"> <!--  -->','<g fill="none" fill-rule="evenodd">','<path fill="#FFF" d="M14.958 9.063l-4.722-.113a1 1 0 0 1-.73-1.657l2.418-2.771a1 1 0 0 1 1.535.033l2.304 2.884a1 1 0 0 1-.805 1.624z"/>','<path stroke="#FFF" stroke-linecap="round" stroke-width="3" d="M10.536 2.16a6.083 6.083 0 0 0-2.656-.608c-3.408 0-6.171 2.799-6.171 6.25C1.709 11.254 4.592 14 8 14c3.408 0 5-2.548 5-6"/>',"</g>","</symbol>");t.push('<symbol id="iws-captions-off" viewBox="0 0 16 16">','<g fill="none" fill-rule="evenodd">','<path fill="#FFF" d="M2 3h12a2 2 0 0 1 2 2v6.077a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm7.667 10.077h3.69l-3.489 2.859a.5.5 0 0 1-.801-.51l.6-2.349zM2.005 8.375h1.323a.672.672 0 1 1 0 1.343H2.005a.672.672 0 1 1 0-1.343zm3.333 0h3.99a.672.672 0 1 1 0 1.343h-3.99a.672.672 0 0 1 0-1.343zm6 0h2.657a.672.672 0 1 1 0 1.343h-2.657a.672.672 0 0 1 0-1.343zM2.005 10.39h5.323a.672.672 0 1 1 0 1.344H2.005a.672.672 0 1 1 0-1.344zm7.333 0h1.99a.672.672 0 1 1 0 1.344h-1.99a.672.672 0 0 1 0-1.344z"/>','<path fill="#FFF" d="M1.537.452l14.084 14.12a.749.749 0 1 1-1.06 1.06L.477 1.513a.749.749 0 1 1 1.06-1.06z"/>',"</g>","</symbol>");t.push('<symbol id="iws-captions-on" viewBox="0 0 16 16">','<g fill="none" fill-rule="evenodd">','<path fill="#FFF" d="M-13.333 4.925l-.26.16a.717.717 0 0 0-.306.55v.078h-1.744a.361.361 0 0 0-.357.364v3.845c0 .2.16.364.357.364h1.744v.079c0 .2.138.448.306.55l3.85 2.354c.397.295.732.295.732-.1V8.183l2.476 1.866a.983.983 0 0 0 .162 1.152.936.936 0 0 0 1.354-.01l1.426 1.075a6.24 6.24 0 0 1-.075.079.985.985 0 0 0 0 1.372.941.941 0 0 0 1.345 0c.093-.095.183-.191.27-.29l.584.44a.75.75 0 1 0 .903-1.198l-.596-.45A8.147 8.147 0 0 0 0 8c0-2.16-.825-4.19-2.323-5.716a.938.938 0 0 0-1.345 0 .984.984 0 0 0 0 1.372A6.16 6.16 0 0 1-1.902 8a6.197 6.197 0 0 1-.798 3.06l-1.464-1.103c.79-1.684.502-3.765-.864-5.158a.939.939 0 0 0-1.345 0 .983.983 0 0 0 0 1.372c.688.7.897 1.707.629 2.595l-3.267-2.462V2.983c0-.683-.564-.356-.733-.253l-2.213 1.354-2.527-1.904a.75.75 0 1 0-.903 1.198l2.054 1.547z"/>','<path fill="#FFF" d="M2 3h12a2 2 0 0 1 2 2v6.077a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm7.667 10.077h3.69l-3.489 2.859a.5.5 0 0 1-.801-.51l.6-2.349zM2.005 8.375h1.323a.672.672 0 1 1 0 1.343H2.005a.672.672 0 1 1 0-1.343zm3.333 0h3.99a.672.672 0 0 1 0 1.344h-3.99a.672.672 0 0 1 0-1.344zm6 0h2.657a.672.672 0 1 1 0 1.343h-2.657a.672.672 0 0 1 0-1.343zM2.005 10.39h5.323a.672.672 0 1 1 0 1.344H2.005a.672.672 0 1 1 0-1.344zm7.333 0h1.99a.672.672 0 1 1 0 1.344h-1.99a.672.672 0 0 1 0-1.344zM17.537.452l14.084 14.12a.749.749 0 1 1-1.06 1.06L16.477 1.513a.749.749 0 1 1 1.06-1.06z"/>',"</g>","</symbol>");t.push('<symbol id="iws-fast-forward" viewBox="0 0 16 16"> <!--  >> -->','<g fill="none" fill-rule="evenodd">','<path fill="#FFF" d="M7 5.778L2.04 2.333C.918 1.553 0 2.19 0 3.75v8.499c0 1.56.918 2.197 2.04 1.417L7 10.222v2.028c0 1.56.918 2.197 2.04 1.417l6.118-4.25c1.123-.78 1.123-2.055 0-2.835L9.04 2.332C7.918 1.554 7 2.192 7 3.752v2.027z"/>',"</g>","</symbol>");t.push('<symbol id="iws-rewind" viewBox="0 0 16 16"> <!--  << -->','<g fill="none" fill-rule="evenodd">','<path fill="#FFF" d="M-1.067 9.076l-4.723-.113a1 1 0 0 1-.73-1.657l2.418-2.772a1 1 0 0 1 1.535.033l2.305 2.885a1 1 0 0 1-.805 1.624z"/>','<path fill="#FFF" d="M9 5.778l4.96-3.445C15.082 1.553 16 2.19 16 3.75v8.499c0 1.56-.918 2.197-2.04 1.417L9 10.222v2.028c0 1.56-.918 2.197-2.04 1.417L.842 9.417c-1.123-.78-1.123-2.055 0-2.835l6.118-4.25C8.082 1.554 9 2.192 9 3.752v2.027z"/>',"</g>","</symbol>");t.push("</svg>");return t.join("")}function N(){if(n.init){return null}v();n.container=iws.util.makeElement("div",{class:c.selectors.container.replace(".","")});$(n.parentEl).append(U());$(n.parentEl).append(n.container);n.elErrorContainer=iws.util.makeElement("div",{class:"page-errorContainer w3-container"});n.elErrorContainer.innerHTML='<div class="w3-panel w3-red"><h3>Error!</h3><p>Message.</p></div>';n.parentEl.appendChild(n.elErrorContainer);n.container.setAttribute("tabindex",0);if(c.hideControls){m(u.container,"mouseenter mouseleave mousemove touchstart touchend touchcancel touchmove enterfullscreen",n._toggleControls)}m(u.container,"keydown keyup",n._eventHandleKey);m(window,"keyup",n._eventCheckTab);n.init=true}N()};iws.media.prototype.updateSource=function(t){if(!s.object(t)||!("sources"in t)){i("Invalid source format");return}var e=this;var n=this.config;$(this.container).toggleClass(n.classes.ready,false);this._pause();this._updateSeekDisplay();this._setProgress();this._cancelRequests();function r(t,i){if(s.string(i)){c(t,e.media,{src:i})}else if(i.constructor===Object){c(t,e.media,i)}else if(i.constructor===Array){for(var n=i.length-1;n>=0;n--){c(t,e.media,i[n])}}}function o(){e.container&&$(e.container).children().remove();if("type"in t){e.type=t.type}switch(e.type){case"video":e.media=document.createElement("video");e.resize();break;case"audio":e.media=document.createElement("audio");break;default:i("This format is not support.("+e.type+")");return}var o=function(t){if(!e.media)return;var i={1:"MEDIA_ERR_ABORTED - fetching process aborted by user",2:"MEDIA_ERR_NETWORK - error occurred when downloading",3:"MEDIA_ERR_DECODE - error occurred when decoding",4:"MEDIA_ERR_SRC_NOT_SUPPORTED - audio/video not supported"};var n="";if(e.media.error&&e.media.error.code){var r=i[e.media.error.code];if(r){n=r}}e.clear();$(e.elErrorContainer).find("p").text("Something went wrong.  "+n);$(e.elErrorContainer).css("display","inline-block")};$(e.elErrorContainer).css("display","none");e.media.addEventListener("error",o,true);e.container.insertBefore(e.media,e.container.firstChild);if(s.boolean(t.autoplay)){n.autoplay=t.autoplay}if(n.crossorigin){e.media.setAttribute("crossorigin","")}if(n.autoplay){e.media.setAttribute("autoplay","")}if("poster"in t){e.media.setAttribute("poster",t.poster)}if(n.loop){e.media.setAttribute("loop","")}r("source",t.sources);e._setupMedia();if("tracks"in t){r("track",t.tracks)}e.media.load();e._setupInterface();e._ready();n.title=t.title;e._setTitle()}clearTimeout(e.timers.cleanUp);o()};iws.media.prototype.resize=function(t){var e=this;if(e.media){if(e.type=="video"){if(e.isFullscreen){e.size=t||{width:e.container.clientWidth,height:e.container.clientHeight};$(e.media).css("width",e.size.width+"px");$(e.media).css("height",e.size.height+"px")}else{e.size=t||{width:e.parentEl.clientWidth,height:e.parentEl.clientHeight};$(e.media).css("width",e.size.width+"px");$(e.media).css("height",e.size.height+"px")}}}};iws.media.prototype.clear=function(){var t=this;clearTimeout(t.timers.cleanUp);t._pause();t.container&&$(t.container).children().remove();$(t.elErrorContainer).css("display","none");if(t.media){t.media.src="";t.media.load();delete t.media;t.media=null}};iws.media.prototype.destroy=function(){var t=this;t.clear();t.init=false;if(t.config.hideControls){b(plyr.container,"mouseenter mouseleave mousemove touchstart touchend touchcancel touchmove enterfullscreen",t._toggleControls)}b(plyr.container,"keydown keyup",t._eventHandleKey);b(window,"keyup",t._eventCheckTab);t.parentEl&&$(t.parentEl).children().remove();$(t.elErrorContainer).remove();i("Media destroyed!")}})(typeof exports!=="undefined"?exports:this);(function(){(function(){"use strict";function t(){this.initialize.apply(this,arguments)}iws.PageAnnotation=iws.util.createInheritClass(t,iws.Page,{defaultCursor:"default",moveCursor:"move",freeDrawingCursor:"crosshair",useAnnotation:false,useMasking:false,useFilter:false,annotation:null,masking:null,authority:{annotation:"editable",masking:"editable"},initialize:function(t,e){this.callSuper("initialize",t,e);this.annotToolbar=new iws.toolbar.annotation(this);this.maskingToolbar=new iws.toolbar.masking(this);this.annotation=new iws.PageAnnotation.annotation(this);this.masking=new iws.PageAnnotation.masking(this);this._initEvent();this.visible("annotation",this.useAnnotation?"show":"hide");this.visible("masking",this.useMasking?"show":"hide");this.visible("filter",this.useFilter?"show":"hide")},_reSize:function(){this.callSuper("_reSize")},keydownControl:false,_initEvent:function(){this.observe("page:zoom",this._eventPageZoom);this.observe("page:fitMode",this._eventPageZoom);this.observe("page:rotate",this._eventPageRotate);this.observe("page:move",this._eventPageMove);document.addEventListener("keydown",function(t){var e=t.key;if(e==="Control"){this.keydownControl=true;return}}.bind(this),false);document.addEventListener("keyup",function(t){var e=t.key;if(e==="Control"){this.keydownControl=false;return}}.bind(this),false)},_eventPageZoom:function(t){this.annotation&&this.annotation._annotations.getData().forEach(function(e){t.output&&e._objectSizeChangeScale(t.output.changeRate,t.output.offset,t.output.center)}.bind(this));this.masking&&this.masking._maskings.getData().forEach(function(e){e._objectSizeChangeScale(t.output.changeRate,t.output.offset,t.output.center)})},_eventPageRotate:function(t){var e=t.input.angle;var i=this.imageCtrl.getDrawCenter();this.annotation&&this.annotation._annotations.getData().forEach(function(t){t._rotate(e,i)});this.masking&&this.masking._maskings.getData().forEach(function(t){t._rotate(e,i)})},_eventPageMove:function(t){var e=t.output.offset;this.annotation&&this.annotation._annotations.getData().forEach(function(t){t._moveOffset(e)});this.masking&&this.masking._maskings.getData().forEach(function(t){t._moveOffset(e)})},clear:function(){this.annotation&&this.annotation._annotations.remove();this.masking&&this.masking._maskings.remove();this.callSuper("clear")},destroy:function(){this.clear();this.annotToolbar.destroy();this.maskingToolbar.destroy();this.annotation.destroy();this.masking.destroy();this.callSuper("destroy")},showAnnotation:function(t){this.fire("annotation:visible",t)},_enlivenObjects:function(t,e){var i=this;var n=[];Object.keys(t).map(function(r,s){var o=t[r];var a=iws.util.getKlass(o.type,null,"object");n[s]=a.fromObject(o);n[s]._set("canvas",i);e&&e(n[s],s)})},_renderCanvas:function(t){this._renderBefore(t);this.imageCtrl.render(t);this._renderMasking(t);this._drawMaskingControls(t);this._renderObjects(t);this._drawObjectsControls(t);this._renderTracking(t);if(iws.debug&&this.mousePoint){var e="mouse = "+this.mousePoint.x+", "+this.mousePoint.y;t.fillText(e,40,40)}this._renderAfter(t)},_renderTracking:function(t){this.callSuper("_renderTracking",t);this.fire("render:Tracking",t)},_renderObjects:function(t){t.save();t.transform.apply(t,this.viewportTransform);if(this.imageCtrl.isValid()&&this.imageCtrl.xres===undefined){console.log("need to get image resolution.")}var e=this.imageCtrl.scale;var i=this.imageCtrl.xres;this.authority&&this.authority.annotation!="unvisible"&&this.annotation&&this.annotation._annotations.getData().forEach(function(n){n.render(t,undefined,e*(i/96))});t.restore()},_drawObjectsControls:function(t){this.authority&&this.authority.annotation!="unvisible"&&this.annotation&&this.annotation._annotations.getData().forEach(function(e){e.active&&e._renderControls(t)})},_renderMasking:function(t){t.save();t.transform.apply(t,this.viewportTransform);this.authority&&this.authority.masking!="unvisible"&&this.masking&&this.masking._maskings.getData().forEach(function(e){e.render(t)});t.restore()},_drawMaskingControls:function(t){this.authority&&this.authority.masking!="unvisible"&&this.masking&&this.masking._maskings.getData().forEach(function(e){e.active&&e._renderControls(t)})},_onMouseDown:function(t){this.fire("MouseDown_beforeCallSuper",t);this.callSuper("_onMouseDown",t);this.fire("MouseDown_afterCallSuper",t)},_onMouseMove:function(t){this.fire("MouseMove_beforeCallSuper",t);this.callSuper("_onMouseMove",t);this.fire("MouseMove_afterCallSuper",t)},_onMouseUp:function(t){this.fire("MouseUp_beforeCallSuper",t);this.callSuper("_onMouseUp",t);this.fire("MouseUp_afterCallSuper",t)},getAnnotation:function(){var t=[];var e=this.imageCtrl.getBasicPoint();this.annotation&&this.annotation._annotations.getData().forEach(function(i){var n=i.clone();n._objectSizeChangeScale(e.rate,{x:0,y:0},this.imageCtrl.getDrawCenter());n._moveOffset({x:-e.x,y:-e.y});t.push(n)}.bind(this));var i=t.filter(function(t){return!t.excludeFromExport}).map(function(t){return t["toObject"](null)},this);return i},setAnnotation:function(t){this.annotation&&this.annotation._annotations._remove();var e=iws.util.clone(t);this._enlivenObjects(e,function(t,e){this.annotation&&this.annotation._annotations._add(t)}.bind(this));var i=this.imageCtrl.getBasicPoint();this.annotation&&this.annotation._annotations.getData().forEach(function(t){t._moveOffset(i);t._objectSizeChangeScale(this.imageCtrl.scale,{x:0,y:0},this.imageCtrl.getDrawCenter())}.bind(this));this.renderAll()},addAnnotation:function(t){var e=this.imageCtrl.getBasicPoint();t._moveOffset(e);t._objectSizeChangeScale(this.imageCtrl.scale,{x:0,y:0},this.imageCtrl.getDrawCenter());this.annotation&&this.annotation._annotations.add(t);this.renderAll()},removeAnnotation:function(){this.annotation&&this.annotation._annotations.remove();this.renderAll()},getMasking:function(){var t=[];var e=this.imageCtrl.getBasicPoint();this.masking&&this.masking._maskings.getData().forEach(function(i){var n=i.clone();n._objectSizeChangeScale(e.rate,{x:0,y:0},this.imageCtrl.getDrawCenter());n._moveOffset({x:-e.x,y:-e.y});t.push(n)}.bind(this));var i=t.filter(function(t){return!t.excludeFromExport}).map(function(t){return t["toObject"](null)},this);return i},setMasking:function(t){this.masking._maskings._remove();var e=iws.util.clone(t);this._enlivenObjects(e,function(t,e){t.setControlsVisibility({mtr:false,mrdel:false});this.masking._maskings._add(t)}.bind(this));var i=this.imageCtrl.getBasicPoint();this.masking._maskings.getData().forEach(function(t){t._moveOffset(i);t._objectSizeChangeScale(this.imageCtrl.scale,{x:0,y:0},this.imageCtrl.getDrawCenter())}.bind(this));this.renderAll()},addMasking:function(t,e,i,n,r){r=r||"#000";var s=new iws.objectRect({top:e,left:t,width:i,height:n,backgroundColor:r});s.setControlsVisibility({mtr:false,mrdel:false});var o=this.imageCtrl.getBasicPoint();s._moveOffset(o);s._objectSizeChangeScale(this.imageCtrl.scale,{x:0,y:0},this.imageCtrl.getDrawCenter());this.masking._maskings.add(s);this.renderAll()},removeMasking:function(){this.masking&&this.masking._maskings.remove();this.renderAll()}})})()})();(function(){var t=function(){this.initialize.apply(this,arguments)};t.prototype={annotationMap:["annotSelect","annotDrawFree","annotDrawLine","annotDrawArrowLine","annotDrawEllipse","annotDrawRect","annotDrawText","annotDrawCheckV","annotDrawCheckX","annotDrawStamp"],_annotations:null,initialize:function(){this.page=arguments[0];var t=this;this._annotations=function(){var e=[];function i(){e.push.apply(e,arguments)}function n(){var t=false;if(arguments.length===0){if(e.length>0){e.splice(0,e.length);t=true;return}}for(var i=0,n=arguments.length;i<n;i++){var r=e.indexOf(arguments[i]);if(r!==-1){t=true;e.splice(r,1)}}return t}return{add:function(){i.apply(this,arguments);t.page.fire("object:added")},_add:function(){i.apply(this,arguments)},remove:function(){var e=n.apply(this,arguments);if(e){t.page.fire("object:removed")}return e},_remove:function(){return n.apply(this,arguments)},getData:function(){return e}}}();this.createObject=null;this._initialize_event()},destroy:function(){},isSelectMode:function(){return this.page.getTrackMode()===this.annotationMap[0]},setSelectMode:function(){this.page.setTrackMode(this.annotationMap[0])},isAnnotationMode:function(){if(this.page.authority&&this.page.authority.annotation!=="editable")return false;var t=this.page.getTrackMode();var e=this.annotationMap.indexOf(t);return e>=0},_initialize_event:function(){this.page.observe("MouseDown_afterCallSuper",function(t){if(!this.isAnnotationMode())return;this.__onMouseDown_AnnotationControl(t)}.bind(this));this.page.observe("MouseMove_afterCallSuper",function(t){if(!this.isAnnotationMode())return;this.__onMouseMove_AnnotationControl(t)}.bind(this));this.page.observe("MouseUp_beforeCallSuper",function(t){if(!this.isAnnotationMode())return;this.__onMouseUp_AnnotationControl(t)}.bind(this));this.page.observe("render:Tracking",function(t){if(!this.isSelectMode())return;var e=this.page;if(e.trackMouse.leftMouseButtonDown&&!this._currentTransform){e.trackMouse.drawSelect(e.lowerCanvasEl,e.trackMouse.getRect(),"blue","blue")}}.bind(this));document.addEventListener("keydown",function(t){var e=t.key;if(this.isSelectMode()){if(t.which===46){var i=this._selectedObjects();i.length>0&&this._annotations.remove.apply(this._annotations,i);this.page.renderAll()}else if(t.which===65&&t.shiftKey){this._annotations.getData().forEach(function(t){t.set("active",true)});this.page.renderAll()}}}.bind(this),false)},__onMouseDown_AnnotationControl:function(t){var e=this.page.getPointer(t,true);console.log("down : "+this.page.getTrackMode());if(this.isSelectMode()){var i=iws.util.object._findTarget(e,this._annotations.getData());switch(i.find){case"contain":if(!t.ctrlKey){if(i.active===false){this.deActiveAll();this._setActiveObject(i.target)}}else{if(i.active===false){this._setActiveObject(i.target)}else{this._deActiveObject(i.target);this._selectedObjects().length===1&&this._setActiveObject(this._selectedObjects()[0])}}case"corner":break;case"nothing":this.deActiveAll();break}if(i.target){this._setupCurrentTransform(e,i.target);i.target.fire("mouseDown",t)}}else{var n=this.page.annotToolbar.getInitParam(this.page.getTrackMode());switch(this.page.getTrackMode()){case"annotDrawFree":this.createObject=new iws.objectPath(n);this._add(this.createObject);break;case"annotDrawArrowLine":this.createObject=new iws.objectArrowLine(n);this._add(this.createObject);break;case"annotDrawLine":this.createObject=new iws.objectLine(n);this._add(this.createObject);break;case"annotDrawEllipse":this.createObject=new iws.objectEllipse(n);this._add(this.createObject);break;case"annotDrawRect":this.createObject=new iws.objectRect(n);this._add(this.createObject);break;case"annotDrawText":var r=$(this.page.wrapperEl).find(".annotText");if(r.length!=0){return}var s=this._makeText(t);setTimeout(function(){s.select()},1);break;case"annotDrawCheckV":this.createObject=new iws.objectImageCheckV(n);this._add(this.createObject);break;case"annotDrawCheckX":this.createObject=new iws.objectImageCheckX(n);this._add(this.createObject);break;case"annotDrawStamp":this.createObject=new iws.objectStamp(n);this._add(this.createObject);break}this.deActiveAll();this.createObject&&this.createObject._onCreateMouseDown(t)}this.page.renderAll()},__onMouseMove_AnnotationControl:function(t){if(this.isSelectMode()){var e=this.page.getPointer(t,true);if(!this._currentTransform){var i=iws.util.object._findTarget(e,this._annotations.getData());iws.util.object.setCursorFromEvent(e,i.target,function(t){this.page.setCursor(t)}.bind(this))}else{var n=this._selectedObjects();if(n.length>1){var e=this.page.getPointer(t);n.forEach(function(e){e._moveOffset(this.page.trackMouse.mousePrevMoveOffset);this.page.fire("object:moving",{target:e});e.fire("mouseMove",t)}.bind(this));this._currentTransform.actionPerformed=true;this.page.renderAll()}else{this._currentTransform.target.isMoving=true;this.__performTransformAction(this._currentTransform,e);this._currentTransform.actionPerformed&&this.page.renderAll();this._currentTransform.target.fire("mouseMove",t)}this._currentTransform.lastPointer=this.page.getPointer(t)}}else{this.page.setCursor(this.page.defaultCursor);this.createObject&&this.createObject._onCreateMouseMove(t);this.page.renderAll()}},__onMouseUp_AnnotationControl:function(t){console.log("up : "+this.page.getTrackMode());if(this.isSelectMode()){if(this._currentTransform){this._finalizeCurrentTransform();this._currentTransform.target.fire("mouseUp",t);this._currentTransform=null;this.page.renderAll()}else{if(this.createObject){this.createObject=null}else{this._collectObjects()}}}else{if(this.createObject){if(!this.page.keydownControl){this.setSelectMode()}this.createObject._onCreateMouseUp(t);this._setActiveObject(this.createObject);this.page.fire("object:modified",{target:this.createObject});this.createObject=null}}},_add:function(t){t._set("canvas",this.page);t.setCoords();this._annotations.add(t)},deActiveAll:function(){var t=[];this._annotations.getData().forEach(function(e){if(e.get("active")){e.set("active",false);t.push(e)}});this.page.fire("selection:cleared",{objects:t});return this},_selectedObjects:function(){var t=[];for(var e=0;e<this._annotations.getData().length;e++){if(this._annotations.getData()[e].get("active"))t.push(this._annotations.getData()[e])}return t},_deActiveObject:function(t,e){t.set("active",false);(e===undefined||e===true)&&this.page.fire("selection:cleared",{target:t,selecteds:this._selectedObjects()});this.page.renderAll()},_setActiveObject:function(t,e){t.set("active",true);(e===undefined||e===true)&&this.page.fire("object:selected",{target:t,selecteds:this._selectedObjects()});this.page.renderAll()},_collectObjects:function(){var t=[],e,i=this.page.trackMouse.getLT(),n=this.page.trackMouse.getRB(),r=new iws.Point(i.x,i.y),s=new iws.Point(n.x,n.y),o=i.x===n.x&&i.y===n.y;for(var a=this._annotations.getData().length;a--;){e=this._annotations.getData()[a];if(!e||!e.selectable||!e.visible){continue}if(e.isContainedWithinRect(r,s)){t.push(e);if(o){break}}}t.forEach(function(t){t.set("active",true)});this.page.fire("object:selected",{target:t.length===1?t[0]:null,selecteds:this._selectedObjects()})},_makeText:function(t){var e=$('<textarea placeholder="Memo ... " class="annotText"></textarea>');var i=this.page.getPointer(t);var n=this.page.annotToolbar.getInitParam(this.page.getTrackMode());this.page.imageCtrl.xres=this.page.imageCtrl.xres<96?96:this.page.imageCtrl.xres;var r=this.page.imageCtrl.scale*(this.page.imageCtrl.xres/96);var s=n["fontSize"]*r;var o=Math.round(s*8);var a=Math.round(s*3);var l=1.2;e.css({left:i.x,top:i.y,width:o,height:a,"font-family":"Jeju Gothic","font-size":s+"px",color:n["fontColor"],background:n["backgroundColor"],position:"absolute","line-height":l,border:"0 none white",padding:0,outline:"none","IME-MODE":"active"}).appendTo($(this.page.pageContainer));var h=this;e.on("focusout",function(t){if($(this).val()!=""){h.setSelectMode();n["left"]=i.x;n["top"]=i.y;n["width"]=e.width();n["height"]=e.height();h.createObject=new iws.objectText(n);h.createObject.text=$(this).val();h._add(h.createObject);h._setActiveObject(h.createObject);console.log("focusout");h.page.fire("object:modified",{target:h.createObject})}$(this).remove()});e.on("input",function(){e.css({"overflow-y":"hidden"}).height(e[0].scrollHeight)});return e}};iws.util.extend(t.prototype,iws.Observable);iws.PageAnnotation.annotation=t;(function(){iws.util.extend(iws.PageAnnotation.annotation.prototype,{_finalizeCurrentTransform:function(){var t=this._currentTransform,e=t.target;if(e._scaling){e._scaling=false}if(e.isMoving){e.isMoving=false}e.setCoords();if(this._previousOriginX&&this._previousOriginY){e.restoreOriginXY(this._previousOriginX,this._previousOriginY);this._previousOriginX=null;this._previousOriginY=null}if(t.actionPerformed){this.page.fire("object:modified",{target:e});e.fire("modified")}},__performTransformAction:function(t,e){var i=e.x,n=e.y,r=t.target,s=t.action,o=false;if(s==="rotate"){(o=this.__rotateObject(i,n))&&this.fire("object:rotating",{target:r})}else if(s==="scale"){(o=this.__onScale(t,i,n))&&this.fire("object:scaling",{target:r})}else if(s==="scaleX"){(o=this.__scaleObject(i,n,"x"))&&this.fire("object:scaling",{target:r})}else if(s==="scaleY"){(o=this.__scaleObject(i,n,"y"))&&this.fire("object:scaling",{target:r})}else if(s==="drag"){o=this.__translateObject(i,n);if(o){this.page.renderAll();this.page.fire("object:moving",{target:r});this.page.setCursor(r.moveCursor||this.moveCursor)}}t.actionPerformed=o},__rotateObject:function(t,e){var i=this._currentTransform;if(i.target.get("lockRotation")){return false}var n=Math.atan2(i.ey-i.top,i.ex-i.left),r=Math.atan2(e-i.top,t-i.left),s=iws.util.radiansToDegrees(r-n+i.theta);if(s<0){s=360+s}i.target.angle=s%360;return true},__translateObject:function(t,e){var i=this._currentTransform,n=i.target;return n.translateOffset(t,e,i.offsetX,i.offsetY,i.lastPointer)},__onScale:function(t,e,i){if(t.currentAction==="scale"){this._resetCurrentTransform()}t.currentAction="scaleEqually";return this.__scaleObject(e,i,"equally")},__scaleObject:function(t,e,i){var n=this._currentTransform,r=n.target,s=r.get("lockScalingX"),o=r.get("lockScalingY"),a=r.get("lockScalingFlip");if(s&&o){return false}var l=r.translateToOriginPoint(r.getCenterPoint(),n.originX,n.originY),h=r.toLocalPoint(new iws.Point(t,e),n.originX,n.originY),u=r._getTransformedDimensions(),c=false;iws.util.object.__setLocalMouse(h,n);var f=r.getCenterPoint();if(r instanceof iws.objectText){var d=r.width*(h.x/r.scaleX/(r.width+r.strokeWidth));if(d>=r.getMinWidth()){r.set("width",d);c=true}}else if(r instanceof iws.objectLine||r instanceof iws.objectArrowLine){r._cornerMove(t,e);c=true}else{c=this.__setObjectScale(h,n,s,o,i,a,u)}r.setPositionByOrigin(l,n.originX,n.originY,f);return c},__setObjectScale:function(t,e,i,n,r,s,o){var a=e.target,l=false,h=false,u=false,c,f,d,g;d=t.x*a.scaleX/o.x;g=t.y*a.scaleY/o.y;c=a.scaleX!==d;f=a.scaleY!==g;if(s&&d<=0&&d<a.scaleX){l=true}if(s&&g<=0&&g<a.scaleY){h=true}if(r==="equally"&&!i&&!n){l||h||(u=this.__scaleObjectEqually(t,a,e,o))}else if(!r){l||i||a.set("scaleX",d)&&(u=u||c);h||n||a.set("scaleY",g)&&(u=u||f)}else if(r==="x"&&!a.get("lockUniScaling")){l||i||a.set("scaleX",d)&&(u=u||c)}else if(r==="y"&&!a.get("lockUniScaling")){h||n||a.set("scaleY",g)&&(u=u||f)}e.newScaleX=d;e.newScaleY=g;l||h||this.__flipObject(e,r);return u},__scaleObjectEqually:function(t,e,i,n){var r=t.y+t.x,s=n.y*i.original.scaleY/e.scaleY+n.x*i.original.scaleX/e.scaleX,o;i.newScaleX=i.original.scaleX*r/s;i.newScaleY=i.original.scaleY*r/s;o=i.newScaleX!==e.scaleX||i.newScaleY!==e.scaleY;e.set("scaleX",i.newScaleX);e.set("scaleY",i.newScaleY);return o},__flipObject:function(t,e){if(t.newScaleX<0&&e!=="y"){if(t.originX==="left"){t.originX="right"}else if(t.originX==="right"){t.originX="left"}}if(t.newScaleY<0&&e!=="x"){if(t.originY==="top"){t.originY="bottom"}else if(t.originY==="bottom"){t.originY="top"}}},_setupCurrentTransform:function(t,e){var i=e._findTargetCorner(t);var n=iws.util.object._getActionFromCorner(e,i);var r=iws.util.object._getOriginFromCorner(e,i);this._currentTransform={target:e,action:n,corner:i,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:t.x-e.left,offsetY:t.y-e.top,originX:r.x,originY:r.y,ex:t.x,ey:t.y,lastX:t.x,lastY:t.y,left:e.left,top:e.top,theta:iws.util.degreesToRadians(e.angle),width:e.width*e.scaleX,mouseXSign:1,mouseYSign:1,lastPointer:{x:t.x,y:t.y}};this._currentTransform.original={left:e.left,top:e.top,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,originX:r.x,originY:r.y};this._resetCurrentTransform()},_resetCurrentTransform:function(){var t=this._currentTransform;if(this._shouldCenterTransform(t.target)){if(t.action==="rotate"){this._setOriginToCenter(t.target)}else{if(t.originX!=="center"){if(t.originX==="right"){t.mouseXSign=-1}else{t.mouseXSign=1}}if(t.originY!=="center"){if(t.originY==="bottom"){t.mouseYSign=-1}else{t.mouseYSign=1}}t.originX="center";t.originY="center"}}else{t.originX=t.original.originX;t.originY=t.original.originY}},_setOriginToCenter:function(t){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var e=t.getCenterPoint();t.originX="center";t.originY="center";t.left=e.x;t.top=e.y;this._currentTransform.left=t.left;this._currentTransform.top=t.top},_shouldCenterTransform:function(t){var e=this._currentTransform,i;if(e.action==="scale"||e.action==="scaleX"||e.action==="scaleY"){i=this.centeredScaling||t.centeredScaling}else if(e.action==="rotate"){i=this.centeredRotation||t.centeredRotation}return i?!e.altKey:e.altKey}})})()})();(function(){var t=function(){this.initialize.apply(this,arguments)};t.prototype={maskingMap:["maskingSelect","maskingBlack","maskingRed"],_maskings:null,initialize:function(){this.page=arguments[0];var t=this;this._maskings=function(){var e=[];function i(){e.push.apply(e,arguments)}function n(){var t=false;if(arguments.length===0){if(e.length>0){e.splice(0,e.length);t=true;return}}for(var i=0,n=arguments.length;i<n;i++){var r=e.indexOf(arguments[i]);if(r!==-1){t=true;e.splice(r,1)}}return t}return{add:function(){i.apply(this,arguments);t.page.fire("masking:added")},_add:function(){i.apply(this,arguments)},remove:function(){var e=n.apply(this,arguments);if(e){t.page.fire("masking:removed")}return e},_remove:function(){return n.apply(this,arguments)},getData:function(){return e}}}();this.createObject=null;this._initialize_event()},destroy:function(){},isSelectMode:function(){return this.page.getTrackMode()===this.maskingMap[0]},setSelectMode:function(){this.page.setTrackMode(this.maskingMap[0])},isMaskingMode:function(){if(this.page.authority&&this.page.authority.masking!=="editable")return false;var t=this.page.getTrackMode();var e=this.maskingMap.indexOf(t);return e>=0},_initialize_event:function(){this.page.observe("MouseDown_afterCallSuper",function(t){if(!this.isMaskingMode())return;this.__onMouseDown(t)}.bind(this));this.page.observe("MouseMove_afterCallSuper",function(t){if(!this.isMaskingMode())return;this.__onMouseMove(t)}.bind(this));this.page.observe("MouseUp_beforeCallSuper",function(t){if(!this.isMaskingMode())return;this.__onMouseUp(t)}.bind(this));this.page.observe("render:Tracking",function(t){if(!this.isSelectMode())return;var e=this.page;if(e.trackMouse.leftMouseButtonDown&&!this._currentTransform){
e.trackMouse.drawSelect(e.lowerCanvasEl,e.trackMouse.getRect(),"black","black")}}.bind(this));document.addEventListener("keydown",function(t){var e=t.key;if(this.isSelectMode()){if(t.which===46){var i=this._selectedObjects();i.length>0&&this._maskings.remove.apply(this._maskings,i);this.page.renderAll()}else if(t.which===65&&t.shiftKey){this._maskings.getData().forEach(function(t){t.set("active",true)});this.page.renderAll()}}}.bind(this),false)},deActiveAll:function(){var t=this._maskings.getData();t.forEach(function(t){t.set("active",false)})},_setupCurrentTransform:function(t,e){var i=e._findTargetCorner(t);var n=iws.util.object._getActionFromCorner(e,i);var r=iws.util.object._getOriginFromCorner(e,i);this._currentTransform={target:e,action:n,corner:i,scaleX:e.scaleX,scaleY:e.scaleY,offsetX:t.x-e.left,offsetY:t.y-e.top,originX:r.x,originY:r.y,ex:t.x,ey:t.y,lastX:t.x,lastY:t.y,left:e.left,top:e.top,theta:iws.util.degreesToRadians(e.angle),width:e.width*e.scaleX,mouseXSign:1,mouseYSign:1,lastPointer:{x:t.x,y:t.y}};this._currentTransform.original={left:e.left,top:e.top,scaleX:e.scaleX,scaleY:e.scaleY,originX:r.x,originY:r.y}},_finalizeCurrentTransform:function(){var t=this._currentTransform;if(t.target._scaling){t.target._scaling=false}t.target.setCoords();if(t.actionPerformed){this.page.fire("masking:modified",{target:t.target})}},_add:function(t){function e(t){this.createObject=new iws.objectRect({backgroundColor:t});this.createObject.setControlsVisibility({mtr:false,mrdel:false});this.createObject._set("canvas",this.page);this._maskings.add(this.createObject)}switch(t){case"maskingBlack":e.call(this,"black");break;case"maskingRed":e.call(this,"red");break}},__onMouseDown:function(t){if(this.isSelectMode()){var e=this.page.getPointer(t,true);var i=iws.util.object._findTarget(e,this._maskings.getData());switch(i.find){case"contain":if(i.active===false){this.deActiveAll();i.target.set("active",true)}case"corner":break;case"nothing":this.deActiveAll();break}if(i.target){this._setupCurrentTransform(e,i.target);i.target.fire("mouseDown",t)}}else{this.deActiveAll();this._add(this.page.getTrackMode());this.createObject&&this.createObject._onCreateMouseDown(t)}this.page.renderAll()},__onMouseMove:function(t){if(this.isSelectMode()){var e=this.page.getPointer(t,true);if(!this._currentTransform){var i=iws.util.object._findTarget(e,this._maskings.getData());iws.util.object.setCursorFromEvent(e,i.target,function(t){this.page.setCursor(t)}.bind(this))}else{var n=this._selectedObjects();if(n.length>1){n.forEach(function(e){e._moveOffset(this.page.trackMouse.mousePrevMoveOffset);this.page.fire("masking:moving",{target:e});e.fire("mouseMove",t)}.bind(this));this._currentTransform.actionPerformed=true;this.page.renderAll()}else{this.__performTransformAction(this._currentTransform,e);this._currentTransform.actionPerformed&&this.page.renderAll();this._currentTransform.target.fire("mouseMove",t)}this._currentTransform.lastPointer=e}}else{this.page.setCursor(this.page.defaultCursor);this.createObject&&this.createObject._onCreateMouseMove(t);this.page.renderAll()}},__onMouseUp:function(t){if(this.isSelectMode()){if(this._currentTransform){this._finalizeCurrentTransform();this._currentTransform.target.fire("mouseUp",t);this._currentTransform=null;this.page.renderAll()}else{this._collectObjects()}}else{if(this.createObject){if(!this.page.keydownControl){this.setSelectMode()}this.createObject.set("active",true);this.createObject._onCreateMouseUp(t);this.page.fire("masking:modified",{target:this.createObject});this.createObject=null}}},_selectedObjects:function(){var t=[];for(var e=0;e<this._maskings.getData().length;e++){if(this._maskings.getData()[e].get("active"))t.push(this._maskings.getData()[e])}return t},_collectObjects:function(){var t=[],e,i=this.page.trackMouse.getLT(),n=this.page.trackMouse.getRB(),r=new iws.Point(i.x,i.y),s=new iws.Point(n.x,n.y),o=i.x===n.x&&i.y===n.y;for(var a=this._maskings.getData().length;a--;){e=this._maskings.getData()[a];if(!e||!e.selectable||!e.visible){continue}if(e.isContainedWithinRect(r,s)){t.push(e);if(o){break}}}t.forEach(function(t){t.set("active",true)})},__performTransformAction:function(t,e){var i=e.x,n=e.y,r=t.target,s=t.action,o=false;if(s==="scale"){(o=this.__onScale(t,i,n))&&this.page.fire("masking:scaling",{target:r})}else if(s==="scaleX"){(o=this.__scaleObject(t,i,n,"x"))&&this.page.fire("masking:scaling",{target:r})}else if(s==="scaleY"){(o=this.__scaleObject(t,i,n,"y"))&&this.page.fire("masking:scaling",{target:r})}else if(s==="drag"){(o=r.translateOffset(i,n,t.offsetX,t.offsetY,t.lastPointer))&&this.page.fire("masking:moving",{target:r})}t.actionPerformed=o},__onScale:function(t,e,i){if(!t.target.get("lockUniScaling")){t.currentAction="scale";return this.__scaleObject(t,e,i)}else{if(t.currentAction==="scale"){this._resetCurrentTransform()}t.currentAction="scaleEqually";return this.__scaleObject(t,e,i,"equally")}},__scaleObject:function(t,e,i,n){var r=t.target;var s=r.translateToOriginPoint(r.getCenterPoint(),t.originX,t.originY),o=r.toLocalPoint(new iws.Point(e,i),t.originX,t.originY),a=r._getTransformedDimensions(),l=false;iws.util.object.__setLocalMouse(o,t);var h=r.getCenterPoint();l=this.__setObjectScale(o,t,n,a);r.setPositionByOrigin(s,t.originX,t.originY,h);return l},__setObjectScale:function(t,e,i,n){var r=e.target,s=false,o,a,l,h;l=t.x*r.scaleX/n.x;h=t.y*r.scaleY/n.y;o=r.scaleX!==l;a=r.scaleY!==h;if(i==="equally"){s=this.__scaleObjectEqually(t,r,e,n)}else if(!i){r.set("scaleX",l)&&(s=s||o);r.set("scaleY",h)&&(s=s||a)}else if(i==="x"&&!r.get("lockUniScaling")){r.set("scaleX",l)&&(s=s||o)}else if(i==="y"&&!r.get("lockUniScaling")){r.set("scaleY",h)&&(s=s||a)}e.newScaleX=l;e.newScaleY=h;this.__flipObject(e,i);return s},__scaleObjectEqually:function(t,e,i,n){var r=t.y+t.x,s=n.y*i.original.scaleY/e.scaleY+n.x*i.original.scaleX/e.scaleX,o;i.newScaleX=i.original.scaleX*r/s;i.newScaleY=i.original.scaleY*r/s;o=i.newScaleX!==e.scaleX||i.newScaleY!==e.scaleY;e.set("scaleX",i.newScaleX);e.set("scaleY",i.newScaleY);return o},__flipObject:function(t,e){if(t.newScaleX<0&&e!=="y"){if(t.originX==="left"){t.originX="right"}else if(t.originX==="right"){t.originX="left"}}if(t.newScaleY<0&&e!=="x"){if(t.originY==="top"){t.originY="bottom"}else if(t.originY==="bottom"){t.originY="top"}}}};iws.util.extend(t.prototype,iws.Observable);iws.PageAnnotation.masking=t})();(function(){(function(){iws.util.object={setCursorFromEvent:function(){var t={defaultCursor:"default",hoverCursor:"move",rotationCursor:"crosshair",deleteCursor:"pointer"};var e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7};var i=["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"];var n=function(i,n,s){if(i in e){s&&s(r(i,n))}else if(i==="mtr"&&n.hasRotatingPoint){s&&s(t.rotationCursor)}else{s&&s(t.defaultCursor);return false}};var r=function(t,n){var r=Math.round(n.get("angle")%360/45);if(r<0){r+=8}r+=e[t];r%=8;return i[r]};return function(e,i,r){if(!i){r&&r(t.defaultCursor);return false}var s=i.hoverCursor||t.hoverCursor;if(!i.selectable){r&&r(s)}else{var o=i._findTargetCorner&&i._findTargetCorner(e);if(!o){r&&r(s)}else{n(o,i,r)}}return true}}(),_findTarget:function(t,e){var i={find:"nothing",active:false,target:null};var n=[];for(var r=0;r<e.length;r++){var s=e[r];if(s.get("active")===true){if(s._findTargetCorner(t)){i.find="corner";i.active=true;i.target=s;return i}else if(s.containsPoint(t)){i.find="contain";i.active=true;i.target=s;return i}}else{n.push(e[r])}}for(var r=0;r<n.length;r++){var s=n[r];if(s._findTargetCorner(t)){i.find="corner";i.target=s;return i}else if(s.containsPoint(t)){i.find="contain";i.target=s;return i}}return i},_getActionFromCorner:function(t,e){if(!e){return"drag"}switch(e){case"mrdel":return"delete";case"mtr":return"rotate";case"ml":case"mr":return"scaleX";case"mt":case"mb":return"scaleY";default:return"scale"}},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};if(e==="ml"||e==="tl"||e==="bl"){i.x="right"}else if(e==="mr"||e==="tr"||e==="br"){i.x="left"}if(e==="tl"||e==="mt"||e==="tr"){i.y="bottom"}else if(e==="bl"||e==="mb"||e==="br"){i.y="top"}return i},__setLocalMouse:function(t,e){var i=e.target;if(e.originX==="right"){t.x*=-1}else if(e.originX==="center"){t.x*=e.mouseXSign*2;if(t.x<0){e.mouseXSign=-e.mouseXSign}}if(e.originY==="bottom"){t.y*=-1}else if(e.originY==="center"){t.y*=e.mouseYSign*2;if(t.y<0){e.mouseYSign=-e.mouseYSign}}if(Math.abs(t.x)>i.padding){if(t.x<0){t.x+=i.padding}else{t.x-=i.padding}}else{t.x=0}if(Math.abs(t.y)>i.padding){if(t.y<0){t.y+=i.padding}else{t.y-=i.padding}}else{t.y=0}}}})()})();(function(){function t(){this.initialize.apply(this,arguments)}iws.Object=iws.util.createInheritClass(t,iws.Observable,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,delIconSize:20,transparentCorners:true,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:false,centeredRotation:true,fill:"",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:true,evented:true,visible:true,hasControls:true,hasBorders:true,hasRotatingPoint:true,rotatingPointOffset:40,deletePointOffset:20,perPixelTargetFind:false,includeDefaultValues:true,clipTo:null,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,lockScalingY:false,lockUniScaling:false,lockSkewingX:false,lockSkewingY:false,lockScalingFlip:false,excludeFromExport:false,stateProperties:("top left width height scaleX scaleY flipX flipY originX originY transformMatrix "+"stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit "+"angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor "+"skewX skewY").split(" "),imgDelete:null,initialize:function(t){if(t){this.setOptions(t)}},_initGradient:function(t){if(t.fill&&t.fill.colorStops&&!(t.fill instanceof iws.Gradient)){this.set("fill",new iws.Gradient(t.fill))}if(t.stroke&&t.stroke.colorStops&&!(t.stroke instanceof iws.Gradient)){this.set("stroke",new iws.Gradient(t.stroke))}},_initPattern:function(t){if(t.fill&&t.fill.source&&!(t.fill instanceof iws.Pattern)){this.set("fill",new iws.Pattern(t.fill))}if(t.stroke&&t.stroke.source&&!(t.stroke instanceof iws.Pattern)){this.set("stroke",new iws.Pattern(t.stroke))}},_initClipping:function(t){if(!t.clipTo||typeof t.clipTo!=="string"){return}var e=iws.util.getFunctionBody(t.clipTo);if(typeof e!=="undefined"){this.clipTo=new Function("ctx",e)}},setOptions:function(t){for(var e in t){this.set(e,t[e])}this._initGradient(t);this._initPattern(t);this._initClipping(t)},toObject:function(t){var e=2,i={type:this.type,left:parseFloat(Number(this.left).toFixed(e)),top:parseFloat(Number(this.top).toFixed(e)),width:parseFloat(Number(this.width).toFixed(e)),height:parseFloat(Number(this.height).toFixed(e)),stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:parseFloat(Number(this.strokeWidth).toFixed(e)),scaleX:parseFloat(Number(this.scaleX).toFixed(e)),scaleY:parseFloat(Number(this.scaleY).toFixed(e)),angle:parseFloat(Number(this.angle).toFixed(e)),opacity:parseFloat(Number(this.opacity).toFixed(e)),visible:this.visible};iws.util.populateWithProperties(this,i,t);return i},toDatalessObject:function(t){return this.toObject(t)},toString:function(){return"#<iws."+capitalize(this.type)+">"},get:function(t){return this[t]},getObjectScaling:function(){var t=this.scaleX,e=this.scaleY;if(this.group){var i=this.group.getObjectScaling();t*=i.scaleX;e*=i.scaleY}return{scaleX:t,scaleY:e}},_setObject:function(t){for(var e in t){this._set(e,t[e])}},set:function(t,e){if(typeof t==="object"){this._setObject(t)}else{if(typeof e==="function"&&t!=="clipTo"){this._set(t,e(this.get(t)))}else{this._set(t,e)}}return this},_set:function(t,e){var i=t==="scaleX"||t==="scaleY";if(i){e=this._constrainScale(e)}if(t==="scaleX"&&e<0){this.flipX=!this.flipX;e*=-1}else if(t==="scaleY"&&e<0){this.flipY=!this.flipY;e*=-1}this[t]=e;if(t==="width"||t==="height"){this.minScaleLimit=Math.min(.1,1/Math.max(this.width,this.height))}return this},translateOffset:function(t,e,i,n){var r=t-i,s=e-n,o=!this.get("lockMovementX")&&this.left!==r,a=!this.get("lockMovementY")&&this.top!==s;o&&this.set("left",r);a&&this.set("top",s);return o||a},setOnGroup:function(){},toggle:function(t){var e=this.get(t);if(typeof e==="boolean"){this.set(t,!e)}return this},setSourcePath:function(t){this.sourcePath=t;return this},getViewportTransform:function(){if(this.canvas&&this.canvas.viewportTransform){return this.canvas.viewportTransform}return[1,0,0,1,0,0]},transform:function(t,e){var i=e?this._getLeftTopCoords():this.getCenterPoint();if(iws.debug){t.save();t.textBaseline="alphabetic";t.font="14px sans-serif";var n="scale="+(this.scaleX*(this.flipX?-1:1)).toFixed(2)+", "+(this.scaleY*(this.flipY?-1:1)).toFixed(2);var r=t.measureText(" ").width;t.fillText(n,this.left+this.width,this.top+this.height+r);t.restore()}t.translate(i.x,i.y);t.rotate(iws.util.degreesToRadians(this.angle));var s=this.scaleX*(this.flipX?-1:1);var o=this.scaleY*(this.flipY?-1:1);t.scale(s,o);var a=Math.tan(iws.util.degreesToRadians(this.skewX));var l=Math.tan(iws.util.degreesToRadians(this.skewY));t.transform(1,0,a,1,0,0);t.transform(1,l,0,1,0,0)},render:function(t,e,i){if(!this.visible){return}t.save();this._setupCompositeOperation(t);this.drawSelectionBackground(t);if(!e){this.transform(t)}this._setOpacity(t);this._setShadow(t);this._setStrokeStyles(t);this._setFillStyles(t);if(this.transformMatrix){t.transform.apply(t,this.transformMatrix)}this._render(t,e,i);t.restore();t.save();this.drawDelete(t);t.restore();if(iws.debug){t.save();t.textBaseline="alphabetic";t.font="14px sans-serif";var n="("+this.left.toFixed(2)+", "+this.top.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")";t.fillText(n,this.left,this.top);var r="c="+this.getCenterPoint().x.toFixed(2)+", "+this.getCenterPoint().y.toFixed(2);t.fillText(r,this.getCenterPoint().x,this.getCenterPoint().y);t.restore()}},_renderBackground:function(t){if(!this.backgroundColor){return}t.fillStyle=this.backgroundColor;t.fillRect(-this.width/2,-this.height/2,this.width,this.height);this._removeShadow(t)},_setOpacity:function(t){if(this.group){this.group._setOpacity(t)}t.globalAlpha*=this.opacity},_setStrokeStyles:function(t){if(this.stroke){t.lineWidth=this.strokeWidth;t.lineCap=this.strokeLineCap;t.lineJoin=this.strokeLineJoin;t.miterLimit=this.strokeMiterLimit;t.strokeStyle=this.stroke.toLive?this.stroke.toLive(t,this):this.stroke}},_setFillStyles:function(t){if(this.fill){t.fillStyle=this.fill.toLive?this.fill.toLive(t,this):this.fill}},_setLineDash:function(t,e,i){if(!e){return}if(1&e.length){e.push.apply(e,e)}if(supportsLineDash){t.setLineDash(e)}else{i&&i(t)}},_renderControls:function(t,e){if(!this.active||e||this.group&&this.group!==this.canvas.getActiveGroup()){return}var i=this.getViewportTransform(),n=this.calcTransformMatrix(),r;n=iws.util.multiplyTransformMatrices(i,n);r=iws.util.qrDecompose(n);t.save();t.translate(r.translateX,r.translateY);t.lineWidth=1*this.borderScaleFactor;t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;t.rotate(iws.util.degreesToRadians(this.angle));this.drawBorders(t);this.drawControls(t);t.restore()},_setShadow:function(t){if(!this.shadow){return}var e=this.canvas&&this.canvas.viewportTransform[0]||1,i=this.canvas&&this.canvas.viewportTransform[3]||1,n=this.getObjectScaling();t.shadowColor=this.shadow.color;t.shadowBlur=this.shadow.blur*(e+i)*(n.scaleX+n.scaleY)/4;t.shadowOffsetX=this.shadow.offsetX*e*n.scaleX;t.shadowOffsetY=this.shadow.offsetY*i*n.scaleY},_removeShadow:function(t){if(!this.shadow){return}t.shadowColor="";t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0},_renderFill:function(t){if(!this.fill){return}t.save();if(this.fill.gradientTransform){var e=this.fill.gradientTransform;t.transform.apply(t,e)}if(this.fill.toLive){t.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)}if(this.fillRule==="evenodd"){t.fill("evenodd")}else{t.fill()}t.restore()},_renderStroke:function(t){if(!this.stroke||this.strokeWidth===0){return}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(t)}t.save();if(this.stroke.gradientTransform){var e=this.stroke.gradientTransform;t.transform.apply(t,e)}if(this.stroke.toLive){t.translate(-this.width/2+this.stroke.offsetX||0,-this.height/2+this.stroke.offsetY||0)}t.stroke();t.restore()},clone:function(t,e){if(this.constructor.fromObject){return this.constructor.fromObject(this.toObject(e),t)}return new iws.Object(this.toObject(e))},isType:function(t){return this.type===t},toJSON:function(t){return this.toObject(t)},setColor:function(t){this.set("fill",t);return this},setAngle:function(t){var e=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;if(e){this._setOriginToCenter()}this.set("angle",t);if(e){this._resetOrigin()}return this},centerH:function(){this.canvas&&this.canvas.centerObjectH(this);return this},viewportCenterH:function(){this.canvas&&this.canvas.viewportCenterObjectH(this);return this},centerV:function(){this.canvas&&this.canvas.centerObjectV(this);return this},viewportCenterV:function(){this.canvas&&this.canvas.viewportCenterObjectV(this);return this},center:function(){this.canvas&&this.canvas.centerObject(this);return this},viewportCenter:function(){this.canvas&&this.canvas.viewportCenterObject(this);return this},remove:function(){this.canvas&&this.canvas.remove(this);return this},getLocalPointer:function(t,e){e=e||this.canvas.getPointer(t);var i=new iws.Point(e.x,e.y),n=this._getLeftTopCoords();if(this.angle){i=iws.util.rotatePoint(i,n,iws.util.degreesToRadians(-this.angle))}return{x:i.x-n.x,y:i.y-n.y}},_setupCompositeOperation:function(t){if(this.globalCompositeOperation){t.globalCompositeOperation=this.globalCompositeOperation}}})})();(function(){var t=iws.util.degreesToRadians,e={left:-.5,center:0,right:.5},i={top:-.5,center:0,bottom:.5};iws.util.extend(iws.Object.prototype,{translateToGivenOrigin:function(t,n,r,s,o){var a=t.x,l=t.y,h,u,c;if(typeof n==="string"){n=e[n]}else{n-=.5}if(typeof s==="string"){s=e[s]}else{s-=.5}h=s-n;if(typeof r==="string"){r=i[r]}else{r-=.5}if(typeof o==="string"){o=i[o]}else{o-=.5}u=o-r;if(h||u){c=this._getTransformedDimensions();a=t.x+h*c.x;l=t.y+u*c.y}return new iws.Point(a,l)},translateToCenterPoint:function(e,i,n){var r=this.translateToGivenOrigin(e,i,n,"center","center");if(this.angle){return iws.util.rotatePoint(r,e,t(this.angle))}return r},translateToOriginPoint:function(e,i,n){var r=this.translateToGivenOrigin(e,"center","center",i,n);if(this.angle){return iws.util.rotatePoint(r,e,t(this.angle))}return r},getCenterPoint:function(){var t=new iws.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(e,i,n){var r=this.getCenterPoint(),s,o;if(typeof i!=="undefined"&&typeof n!=="undefined"){s=this.translateToGivenOrigin(r,"center","center",i,n)}else{s=new iws.Point(this.left,this.top)}o=new iws.Point(e.x,e.y);if(this.angle){o=iws.util.rotatePoint(o,r,-t(this.angle))}return o.subtractEquals(s)},setPositionByOrigin:function(t,e,i){var n=this.translateToCenterPoint(t,e,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x);this.set("top",r.y)},adjustPosition:function(i){var n=t(this.angle),r=this.getWidth(),s=Math.cos(n)*r,o=Math.sin(n)*r,a,l;if(typeof this.originX==="string"){a=e[this.originX]}else{a=this.originX-.5}if(typeof i==="string"){l=e[i]}else{l=i-.5}this.left+=s*(l-a);this.top+=o*(l-a);this.setCoords();this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center";this.originY="center";this.left=t.x;this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=t.x;this.top=t.y;this._originalOriginX=null;this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})})();(function(){function t(t){return[new iws.Point(t.tl.x,t.tl.y),new iws.Point(t.tr.x,t.tr.y),new iws.Point(t.br.x,t.br.y),new iws.Point(t.bl.x,t.bl.y)]}var e=iws.util.degreesToRadians,i=iws.util.multiplyTransformMatrices;iws.util.extend(iws.Object.prototype,{oCoords:null,intersectsWithRect:function(e,i){var n=t(this.oCoords),r=iws.Intersection.intersectPolygonRectangle(n,e,i);return r.status==="Intersection"},intersectsWithObject:function(e){var i=iws.Intersection.intersectPolygonPolygon(t(this.oCoords),t(e.oCoords));return i.status==="Intersection"||e.isContainedWithinObject(this)||this.isContainedWithinObject(e)},isContainedWithinObject:function(e){var i=t(this.oCoords),n=0;for(;n<4;n++){if(!e.containsPoint(i[n])){return false}}return true},isContainedWithinRect:function(t,e){var i=this.getBoundingRect();return i.left>=t.x&&i.left+i.width<=e.x&&i.top>=t.y&&i.top+i.height<=e.y},containsPoint:function(t){if(!this.oCoords){this.setCoords()}var e=iws.util.find.getContainFromCoords(this.oCoords,t);if(e){e=e}return e},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();return iws.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){if(Math.abs(t)<this.minScaleLimit){if(t<0){return-this.minScaleLimit}else{return this.minScaleLimit}}return t},scale:function(t){t=this._constrainScale(t);if(t<0){this.flipX=!this.flipX;this.flipY=!this.flipY;t*=-1}this.scaleX=t;this.scaleY=t;this.setCoords();return this},scaleToWidth:function(t){var e=this.getBoundingRect().width/this.getWidth();return this.scale(t/this.width/e)},scaleToHeight:function(t){var e=this.getBoundingRect().height/this.getHeight();return this.scale(t/this.height/e)},setCoords:function(){var t=e(this.angle),i=this.getViewportTransform(),n=this._calculateCurrentDimensions(),r=n.x,s=n.y;if(r<0){r=Math.abs(r)}var o=Math.sin(t),a=Math.cos(t),l=r>0?Math.atan(s/r):0,h=r/Math.cos(l)/2,u=Math.cos(l+t)*h,c=Math.sin(l+t)*h,f=iws.util.transformPoint(this.getCenterPoint(),i),d=new iws.Point(f.x-u,f.y-c),g=new iws.Point(d.x+r*a,d.y+r*o),p=new iws.Point(d.x-s*o,d.y+s*a),v=new iws.Point(f.x+u,f.y+c),m=new iws.Point((d.x+p.x)/2,(d.y+p.y)/2),b=new iws.Point((g.x+d.x)/2,(g.y+d.y)/2),w=new iws.Point((v.x+g.x)/2,(v.y+g.y)/2),y=new iws.Point((v.x+p.x)/2,(v.y+p.y)/2),x=new iws.Point(b.x+o*this.rotatingPointOffset,b.y-a*this.rotatingPointOffset),k=new iws.Point(w.x+this.deletePointOffset*a,w.y+this.deletePointOffset*o);this.oCoords={tl:d,tr:g,br:v,bl:p,ml:m,mt:b,mr:w,mb:y,mtr:x,mrdel:k};this._setCornerCoords&&this._setCornerCoords(this.oCoords);this._setCornerCoords_del(this.oCoords);return this},_calcRotateMatrix:function(){if(this.angle){var t=e(this.angle),i=Math.cos(t),n=Math.sin(t);return[i,n,-n,i,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var t=this.getCenterPoint(),e=[1,0,0,1,t.x,t.y],n=this._calcRotateMatrix(),r=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,true),s=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0];s=i(s,e);s=i(s,n);s=i(s,r);return s},_calcDimensionsTransformMatrix:function(t,n,r){var s=[1,0,Math.tan(e(t)),1],o=[1,Math.tan(e(n)),0,1],a=this.scaleX*(r&&this.flipX?-1:1),l=this.scaleY*(r&&this.flipY?-1:1),h=[a,0,0,l],u=i(h,s,true);return i(u,o,true)}})})();(function(){var t=iws.util.degreesToRadians,e=function(){return typeof G_vmlCanvasManager!=="undefined"};iws.util.extend(iws.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||!this.active){return false}var e=t.x,i=t.y,n,r;this.__corner=0;for(var s in this.oCoords){if(!this.isControlVisible(s)){continue}if(s==="mtr"&&!this.hasRotatingPoint){continue}if(this.get("lockUniScaling")&&(s==="mt"||s==="mr"||s==="mb"||s==="ml")){continue}var o=iws.util.find.getContainFromCoords(this.oCoords[s].corner,{x:e,y:i});if(o){this.__corner=s;return s}}return false},findDeleteButton:function(t){},_setCornerCoords:function(e){var i=Math.sqrt(2*Math.pow(this.delIconSize,2))/2;var n=t(45-this.angle),r=this.cornerSize*.707106,s=r*Math.cos(n),o=r*Math.sin(n),a,l;for(var h in e){a=e[h].x;l=e[h].y;e[h].corner={tl:{x:a-o,y:l-s},tr:{x:a+s,y:l-o},bl:{x:a-s,y:l+o},br:{x:a+o,y:l+s}}}},_setCornerCoords_del:function(e){var i=t(45-this.angle),n=Math.sqrt(2)/2,r=this.delIconSize*n,s=r*Math.cos(i),o=r*Math.sin(i),a,l;var h="mrdel";a=e[h].x;l=e[h].y;e[h].corner={tl:{x:a-o,y:l-s},tr:{x:a+s,y:l-o},bl:{x:a-s,y:l+o},br:{x:a+o,y:l+s}}},_getNonTransformedDimensions:function(){var t=this.strokeWidth,e=this.width,i=this.height,n=true,r=true;if(this.type==="line"&&this.strokeLineCap==="butt"){r=e;n=i}if(r){i+=i<0?-t:t}if(n){e+=e<0?-t:t}return{x:e,y:i}},_getTransformedDimensions:function(t,e){if(typeof t==="undefined"){t=this.skewX}if(typeof e==="undefined"){e=this.skewY}var i=this._getNonTransformedDimensions(),n=i.x/2,r=i.y/2,s=[{x:-n,y:-r},{x:n,y:-r},{x:-n,y:r},{x:n,y:r}],o,a=this._calcDimensionsTransformMatrix(t,e,false),l;for(o=0;o<s.length;o++){s[o]=iws.util.transformPoint(s[o],a)}l=iws.util.makeBoundingBoxFromPoints(s);return{x:l.width,y:l.height}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),e=this._getTransformedDimensions(),i=e.x,n=e.y,r=iws.util.transformPoint(new iws.Point(i,n),t,true);return r.scalarAdd(2*this.padding)},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.group||!this.active){return this}e.save();var i=this.getCenterPoint(),n=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;e.translate(i.x,i.y);e.scale(1/r[0],1/r[3]);e.rotate(t(this.angle));e.fillStyle=this.selectionBackgroundColor;e.fillRect(-n.x/2,-n.y/2,n.x,n.y);e.restore();return this},drawDelete:function(t){var e=this.getViewportTransform(),i=this.calcTransformMatrix(),n;i=iws.util.multiplyTransformMatrices(e,i);n=iws.util.qrDecompose(i);t.save();t.translate(n.translateX,n.translateY);t.rotate(iws.util.degreesToRadians(this.angle));var r=this._calculateCurrentDimensions(),s=1/this.borderScaleFactor,o=r.x+s,a=r.y+s;t.restore()},drawBorders:function(t){if(!this.hasBorders){return this}var e=this._calculateCurrentDimensions(),i=1/this.borderScaleFactor,n=e.x+i,r=e.y+i;t.save();t.strokeStyle=this.borderColor;t.strokeRect(-n/2,-r/2,n,r);if(this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var s=-r/2;t.beginPath();t.moveTo(0,s);t.lineTo(0,s-this.rotatingPointOffset);t.closePath();t.stroke()}t.restore();return this},drawControls:function(t){if(!this.hasControls){return this}var e=this._calculateCurrentDimensions(),i=e.x,n=e.y,r=this.cornerSize,s=-(i+r)/2,o=-(n+r)/2,a=this.transparentCorners?"stroke":"fill";t.save();t.strokeStyle=t.fillStyle=this.cornerColor;if(!this.transparentCorners){t.strokeStyle=this.cornerStrokeColor}this._setLineDash(t,this.cornerDashArray,null);this._drawControl("tl",t,a,s,o);this._drawControl("tr",t,a,s+i,o);this._drawControl("bl",t,a,s,o+n);this._drawControl("br",t,a,s+i,o+n);if(!this.get("lockUniScaling")){this._drawControl("mt",t,a,s+i/2,o);this._drawControl("mb",t,a,s+i/2,o+n);this._drawControl("mr",t,a,s+i,o+n/2);this._drawControl("ml",t,a,s,o+n/2)}if(this.hasRotatingPoint){this._drawControl("mtr",t,a,s+i/2,o-this.rotatingPointOffset)}t.restore();return this},_drawControl:function(t,i,n,r,s){if(!this.isControlVisible(t)){return}var o=this.cornerSize,a=!this.transparentCorners&&this.cornerStrokeColor;switch(this.cornerStyle){case"circle":i.beginPath();i.arc(r+o/2,s+o/2,o/2,0,2*Math.PI,false);i[n]();if(a){i.stroke()}break;default:e()||this.transparentCorners||i.clearRect(r,s,o,o);i[n+"Rect"](r,s,o,o);if(a){i.strokeRect(r,s,o,o)}}},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){this._getControlsVisibility()[t]=e;return this},setControlsVisibility:function(t){t||(t={});for(var e in t){this.setControlVisible(e,t[e])}return this},_getControlsVisibility:function(){if(!this._controlsVisibility){this._controlsVisibility={tl:true,tr:true,br:true,bl:true,ml:true,mt:true,mr:true,mb:true,mtr:true,mrdel:true}}return this._controlsVisibility}})})();(function(){iws.util.extend(iws.Object.prototype,{_onCreateMouseDown:function(t){},_onCreateMouseMove:function(t){var e=this.canvas.trackMouse.getRect();this.set({left:e.left}).set({top:e.top});this.set("width",Math.abs(e.right-e.left)).set("height",Math.abs(e.bottom-e.top))},_onCreateMouseUp:function(t){this.setCoords()},restoreOriginXY:function(t,e){var i=this.translateToOriginPoint(this.getCenterPoint(),t,e);this.originX=t;this.originY=e;this.left=i.x;this.top=i.y},_rotate:function(t,e){var i=iws.util.Rotate(t).point(e.x,e.y,this.left,this.top);this.set({angle:(this.angle+t+360)%360,left:i.x,top:i.y});this.setCoords()},_moveOffset:function(t){var e=this.left;var i=this.top;this.set({left:e+t.x,top:i+t.y});this.setCoords()},_objectSizeChangeScale:function(t,e,i){var n=function(t,e,i,n){var r={width:e.x-t.x,height:e.y-t.y};return{x:i.x-r.width*n,y:i.y-r.height*n}};var r={x:this.get("left")+this.get("width")/2,y:this.get("top")+this.get("height")/2};var s={x:i.x-e.x,y:i.y-e.y};var o=n(r,s,i,t);this.set({left:o.x-t*(this.width/2),top:o.y-t*(this.height/2),width:t*this.get("width"),height:t*this.get("height")});this.setCoords()}})})();(function(t){"use strict";var e=t.iws||(t.iws={}),i=e.util.extend,n={left:1,top:1,x1:1,x2:1,y1:1,y2:1,angle:1};if(e.objectArrowLine){e.warn("iws.ArrowLine is already defined");return}function r(){this.initialize.apply(this,arguments)}e.objectArrowLine=e.util.createInheritClass(r,e.Object,{type:"arrowLine",x1:0,y1:0,x2:0,y2:0,lineHeight:14,initialize:function(t){t=t||{};this.callSuper("initialize",t);this.setControlsVisibility({tl:false,tr:false,br:false,bl:false,ml:true,mt:false,mr:true,mb:false,mtr:true});this._initValue(t);this.setCoords();this.originX="left";this.originY="top"},_initValue:function(t){t||(t={});this.width=this.width||e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.height=this.height||this.lineHeight;this.angle=this.angle||e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle;this.left=this.left||this.x1;this.top=this.top||this.y1-this.lineHeight/2},_changeWidthHeight:function(){this.width=e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.height=this.lineHeight;this.angle=e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle;this.left=this.x1;this.top=this.y1-this.lineHeight/2},_cornerMove:function(t,i){if(this.__corner==="mr"){this.set("x2",t).set("y2",i);this.width=e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.angle=e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle}else if(this.__corner==="ml"){this.set("x1",t).set("y1",i);this.width=e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.angle=e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle;this.left=this.x1;this.top=this.y1-this.lineHeight/2;
}},_set:function(t,e){this.callSuper("_set",t,e);if(typeof n[t]!=="undefined"){}return this},translateOffset:function(t,e,i,n){var r=t-i,s=e-n,o=!this.get("lockMovementX")&&this.left!==r,a=!this.get("lockMovementY")&&this.top!==s;var l=this.x2-this.x1;this.x1=r;this.x2=l+this.x1;var h=this.y2-this.y1;this.y1=s+this.lineHeight/2;this.y2=h+this.y1;this.left=this.x1;this.top=s;return o||a},_render:function(t,e){t.beginPath();t.moveTo(-this.width/2,0);t.lineTo(this.width/2,0);t.closePath();t.lineWidth=this.strokeWidth;var i=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle;this.stroke&&this._renderStroke(t);t.strokeStyle=i;var n={h:8,w:14};this._drawArrow(t,n,{x:this.width/2,y:0},{x:-this.width/2,y:0})},__getAngleBetweenPoints:function(t,e){var i={x:e.x-t.x,y:e.y-t.y};return Math.atan2(i.y,i.x)*180/Math.PI},_drawArrow:function(t,e,i,n){var r=this.__getAngleBetweenPoints(i,n);t.save();t.translate(n.x,n.y);t.rotate(r*Math.PI/180);t.beginPath();t.moveTo(0,0);t.lineTo(0,-e.h);t.lineTo(e.w,0);t.lineTo(0,+e.h);t.closePath();t.fillStyle=t.strokeStyle;t.stroke();t.fill();t.restore()},toObject:function(t){var e=2;return i(this.callSuper("toObject",t),{x1:parseFloat(Number(this.x1).toFixed(e)),y1:parseFloat(Number(this.y1).toFixed(e)),x2:parseFloat(Number(this.x2).toFixed(e)),y2:parseFloat(Number(this.y2).toFixed(e))})},setCoords:function(){this.callSuper("setCoords");this.x1=this.oCoords.ml.x;this.y1=this.oCoords.ml.y;this.x2=this.oCoords.mr.x;this.y2=this.oCoords.mr.y;return this}});e.objectArrowLine.fromObject=function(t,i){var n=new e.objectArrowLine(t);i&&i(n);return n}})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectArrowLine.prototype,{_onCreateMouseDown:function(t){var e=this.canvas.getPointer(t);this.set({x1:e.x,y1:e.y,x2:e.x,y2:e.y})},_onCreateMouseMove:function(t){var e=this.canvas.getPointer(t);this.set({x1:e.x}).set({y1:e.y});this._changeWidthHeight()},_onCreateMouseUp:function(t){this.callSuper("_onCreateMouseUp",t)},_objectSizeChangeScale:function(t,e,i){var n=function(t,e,i,n){var r={width:e.x-t.x,height:e.y-t.y};return{x:i.x-r.width*n,y:i.y-r.height*n}};var r={x:this.get("left")+this.get("width")/2,y:this.get("top")+this.get("height")/2};var s={x:i.x-e.x,y:i.y-e.y};var o=n(r,s,i,t);var a=n({x:this.x1,y:this.y1},s,i,t);var l=n({x:this.x2,y:this.y2},s,i,t);this.set({left:o.x-t*(this.width/2),top:o.y-t*(this.height/2),x1:a.x,y1:a.y,x2:l.x,y2:l.y,width:t*this.get("width"),height:t*this.get("height")});this.setCoords()},_moveOffset:function(t){var e=this.left;var i=this.top;this.set({left:e+t.x,top:i+t.y});var n=this.x1;var r=this.y1;var s=this.x2;var o=this.y2;this.set({x1:n+t.x,y1:r+t.y});this.set({x2:s+t.x,y2:o+t.y});this.setCoords()}})})();(function(){iws.util.extend(iws.objectArrowLine.prototype,{})})();(function(t){"use strict";function e(){this.initialize.apply(this,arguments)}iws.objectEllipse=iws.util.createInheritClass(e,iws.Object,{type:"ellipse",initialize:function(t){t=t||{};this.callSuper("initialize",t)},_render:function(t,e){if(this.width===1&&this.height===1){t.fillRect(-.5,-.5,1,1);return}t.beginPath();var i=this.width*.5;var n=this.height*.5;t.transform(1,0,0,n/i,0,0);t.arc(0,0,i,0,Math.PI*2,false);t.closePath();this._renderBackground(t);this._renderStroke(t)},_renderBackground:function(t){if(!this.backgroundColor)return;t.save();t.fillStyle=this.backgroundColor;t.fill();t.restore()},toObject:function(t){var e=iws.util.extend(this.callSuper("toObject",t),{backgroundColor:this.backgroundColor});return e}});iws.objectEllipse.fromObject=function(t,e){var i=new iws.objectEllipse(t);e&&e(i);return i}})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectEllipse.prototype,{_onCreateMouseDown:function(t){var e=this.canvas.getPointer(t);this.set({left:e.x,top:e.y,originX:"left",originY:"top",width:10,height:10})},_onCreateMouseMove:function(t){this.callSuper("_onCreateMouseMove",t)},_onCreateMouseUp:function(t){this.callSuper("_onCreateMouseUp",t)}})})();(function(t){"use strict";var e=iws.util.extend;if(t.iws.objectImage){iws.warn("iws.objectImage is already defined.");return}function i(){this.initialize.apply(this,arguments)}iws.objectImage=iws.util.createInheritClass(i,iws.Object,{type:"image",initialize:function(t){t||(t={});this.callSuper("initialize",t);this._initElement(null,t)},_initElement:function(t,e){function i(t){return typeof t==="string"?document.getElementById(t):t}t&&this.setElement(i(t),e)},setElement:function(t,e){this._element=t;this._setWidthHeight(e);return this},_setWidthHeight:function(t){this.width="width"in t?t.width:this.getElement()?this.getElement().width||0:0;this.height="height"in t?t.height:this.getElement()?this.getElement().height||0:0},getElement:function(){return this._element},_stroke:function(t){if(!this.stroke||this.strokeWidth===0){return}var e=this.width/2,i=this.height/2;t.beginPath();t.moveTo(-e,-i);t.lineTo(e,-i);t.lineTo(e,i);t.lineTo(-e,i);t.lineTo(-e,-i);t.closePath()},_render:function(t,e){var i=e?this.left:-this.width/2;var n=e?this.top:-this.height/2;t.globalAlpha=.9;if(this._element){t.drawImage(this._element,i,n,this.width,this.height)}else{t.fillStyle="red";t.fillRect(i,n,this.width,this.height)}this._stroke(t);this._renderStroke(t)},_resetWidthHeight:function(){var t=this.getElement();this.set("width",t.width);this.set("height",t.height)},toObject:function(t){var e=iws.util.extend(this.callSuper("toObject",t),{});return e}});iws.objectImage.fromObject=function(t,e){var i=new iws.objectImage(t);e&&e(i);return i}})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectImage.prototype,{_onCreateMouseDown:function(t){var e=this.canvas.getPointer(t);this.set({left:e.x,top:e.y,originX:"left",originY:"top",width:10,height:10})},_onCreateMouseMove:function(t){var e=this.canvas.trackMouse.getRect();this.set({left:e.left}).set({top:e.top});var i=Math.max(Math.abs(e.right-e.left),Math.abs(e.bottom-e.top));this.set("width",i).set("height",i)},_onCreateMouseUp:function(t){if(this.width<=10||this.height<=10){if(this.getElement()){var e=this.canvas.getPointer(t);this._resetWidthHeight();this.set({left:this.left-this.width/2,top:this.top-this.height/2})}}this.setCoords()}})})();(function(t){"use strict";if(t.iws.objectImageCheckV){iws.warn("iws.objectImageCheckV is already defined.");return}function e(){this.initialize.apply(this,arguments)}iws.objectImageCheckV=iws.util.createInheritClass(e,iws.Object,{type:"imageCheckV",initialize:function(t){t||(t={});this.callSuper("initialize",t);this._initElement(iws.imgSrc.checkVElement,t)},_initElement:function(t,e){function i(t){return typeof t==="string"?document.getElementById(t):t}t&&this.setElement(i(t),e)},setElement:function(t,e){this._element=t;this._setWidthHeight(e);return this},_setWidthHeight:function(t){this.width="width"in t?t.width:this.getElement()?this.getElement().width||0:0;this.height="height"in t?t.height:this.getElement()?this.getElement().height||0:0},getElement:function(){return this._element},_stroke:function(t){if(!this.stroke||this.strokeWidth===0){return}var e=this.width/2,i=this.height/2;t.beginPath();t.moveTo(-e,-i);t.lineTo(e,-i);t.lineTo(e,i);t.lineTo(-e,i);t.lineTo(-e,-i);t.closePath()},_render:function(t,e){var i=e?this.left:-this.width/2;var n=e?this.top:-this.height/2;t.globalAlpha=.9;if(this._element){t.drawImage(this._element,i,n,this.width,this.height)}else{t.fillStyle="red";t.fillRect(i,n,this.width,this.height)}this._stroke(t);this._renderStroke(t)},_resetWidthHeight:function(){var t=this.getElement();this.set("width",t.width);this.set("height",t.height)},toObject:function(t){var e=iws.util.extend(this.callSuper("toObject",t),{});return e}});iws.objectImageCheckV.fromObject=function(t,e){var i=new iws.objectImageCheckV(t);e&&e(i);return i}})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectImageCheckV.prototype,{_onCreateMouseDown:function(t){var e=this.canvas.getPointer(t);this.set({left:e.x,top:e.y,originX:"left",originY:"top",width:10,height:10})},_onCreateMouseMove:function(t){var e=this.canvas.trackMouse.getRect();this.set({left:e.left}).set({top:e.top});var i=Math.max(Math.abs(e.right-e.left),Math.abs(e.bottom-e.top));this.set("width",i).set("height",i)},_onCreateMouseUp:function(t){if(this.width<=10||this.height<=10){if(this.getElement()){var e=this.canvas.getPointer(t);this._resetWidthHeight();this.set({left:this.left-this.width/2,top:this.top-this.height/2})}}this.setCoords()}})})();(function(t){"use strict";if(t.iws.objectImageCheckX){iws.warn("iws.objectImageCheckX is already defined.");return}function e(){this.initialize.apply(this,arguments)}iws.objectImageCheckX=iws.util.createInheritClass(e,iws.Object,{type:"imageCheckX",initialize:function(t){t||(t={});this.callSuper("initialize",t);this._initElement(iws.imgSrc.checkXElement,t)},_initElement:function(t,e){function i(t){return typeof t==="string"?document.getElementById(t):t}t&&this.setElement(i(t),e)},setElement:function(t,e){this._element=t;this._setWidthHeight(e);return this},_setWidthHeight:function(t){this.width="width"in t?t.width:this.getElement()?this.getElement().width||0:0;this.height="height"in t?t.height:this.getElement()?this.getElement().height||0:0},getElement:function(){return this._element},_stroke:function(t){if(!this.stroke||this.strokeWidth===0){return}var e=this.width/2,i=this.height/2;t.beginPath();t.moveTo(-e,-i);t.lineTo(e,-i);t.lineTo(e,i);t.lineTo(-e,i);t.lineTo(-e,-i);t.closePath()},_render:function(t,e){var i=e?this.left:-this.width/2;var n=e?this.top:-this.height/2;t.globalAlpha=.9;if(this._element){t.drawImage(this._element,i,n,this.width,this.height)}else{t.fillStyle="red";t.fillRect(i,n,this.width,this.height)}this._stroke(t);this._renderStroke(t)},_resetWidthHeight:function(){var t=this.getElement();this.set("width",t.width);this.set("height",t.height)},toObject:function(t){var e=iws.util.extend(this.callSuper("toObject",t),{});return e}});iws.objectImageCheckX.fromObject=function(t,e){var i=new iws.objectImageCheckX(t);e&&e(i);return i}})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectImageCheckX.prototype,{_onCreateMouseDown:function(t){var e=this.canvas.getPointer(t);this.set({left:e.x,top:e.y,originX:"left",originY:"top",width:10,height:10})},_onCreateMouseMove:function(t){var e=this.canvas.trackMouse.getRect();this.set({left:e.left}).set({top:e.top});var i=Math.max(Math.abs(e.right-e.left),Math.abs(e.bottom-e.top));this.set("width",i).set("height",i)},_onCreateMouseUp:function(t){if(this.width<=10||this.height<=10){if(this.getElement()){var e=this.canvas.getPointer(t);this._resetWidthHeight();this.set({left:this.left-this.width/2,top:this.top-this.height/2})}}this.setCoords()}})})();(function(t){"use strict";var e=t.iws||(t.iws={}),i=e.util.extend,n={left:1,top:1,x1:1,x2:1,y1:1,y2:1,angle:1};if(e.objectLine){e.warn("iws.Line is already defined");return}function r(){this.initialize.apply(this,arguments)}e.objectLine=e.util.createInheritClass(r,e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,lineHeight:14,initialize:function(t){t=t||{};this.callSuper("initialize",t);this.setControlsVisibility({tl:false,tr:false,br:false,bl:false,ml:true,mt:false,mr:true,mb:false,mtr:true});this._initValue(t);this.setCoords();this.originX="left";this.originY="top"},_initValue:function(t){t||(t={});this.width=this.width||e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.height=this.height||this.lineHeight;this.angle=this.angle||e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle;this.left=this.left||this.x1;this.top=this.top||this.y1-this.lineHeight/2},_changeWidthHeight:function(){this.width=e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.height=this.lineHeight;this.angle=e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle;this.left=this.x1;this.top=this.y1-this.lineHeight/2},_cornerMove:function(t,i){if(this.__corner==="mr"){this.set("x2",t).set("y2",i);this.width=e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.angle=e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle}else if(this.__corner==="ml"){this.set("x1",t).set("y1",i);this.width=e.util.find.distanceOfTwoPoints({x:this.x1,y:this.y1},{x:this.x2,y:this.y2});this.angle=e.util.find.getAngleFromPointToPoint(this.x1,this.y1,this.x2,this.y2).angle;this.left=this.x1;this.top=this.y1-this.lineHeight/2}},_set:function(t,e){this.callSuper("_set",t,e);if(typeof n[t]!=="undefined"){}return this},translateOffset:function(t,e,i,n){var r=t-i,s=e-n,o=!this.get("lockMovementX")&&this.left!==r,a=!this.get("lockMovementY")&&this.top!==s;var l=this.x2-this.x1;this.x1=r;this.x2=l+this.x1;var h=this.y2-this.y1;this.y1=s+this.lineHeight/2;this.y2=h+this.y1;this.left=this.x1;this.top=s;return o||a},_render:function(t,e){t.beginPath();t.moveTo(-this.width/2,0);t.lineTo(this.width/2,0);t.lineWidth=this.strokeWidth;var i=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle;this.stroke&&this._renderStroke(t);t.strokeStyle=i},toObject:function(t){var e=2;return i(this.callSuper("toObject",t),{x1:parseFloat(Number(this.x1).toFixed(e)),y1:parseFloat(Number(this.y1).toFixed(e)),x2:parseFloat(Number(this.x2).toFixed(e)),y2:parseFloat(Number(this.y2).toFixed(e))})},complexity:function(){return 1},setCoords:function(){this.callSuper("setCoords");this.x1=this.oCoords.ml.x;this.y1=this.oCoords.ml.y;this.x2=this.oCoords.mr.x;this.y2=this.oCoords.mr.y;return this}});e.objectLine.fromObject=function(t,i){var n=new e.objectLine(t);i&&i(n);return n}})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectLine.prototype,{_onCreateMouseDown:function(t){var e=this.canvas.getPointer(t);this.set({x1:e.x,y1:e.y,x2:e.x,y2:e.y})},_onCreateMouseMove:function(t){var e=this.canvas.getPointer(t);this.set({x1:e.x}).set({y1:e.y});this._changeWidthHeight()},_onCreateMouseUp:function(t){this.callSuper("_onCreateMouseUp",t)},_objectSizeChangeScale:function(t,e,i){var n=function(t,e,i,n){var r={width:e.x-t.x,height:e.y-t.y};return{x:i.x-r.width*n,y:i.y-r.height*n}};var r={x:this.get("left")+this.get("width")/2,y:this.get("top")+this.get("height")/2};var s={x:i.x-e.x,y:i.y-e.y};var o=n(r,s,i,t);var a=n({x:this.x1,y:this.y1},s,i,t);var l=n({x:this.x2,y:this.y2},s,i,t);this.set({left:o.x-t*(this.width/2),top:o.y-t*(this.height/2),x1:a.x,y1:a.y,x2:l.x,y2:l.y,width:t*this.get("width"),height:t*this.get("height")});this.setCoords()},_moveOffset:function(t){var e=this.left;var i=this.top;this.set({left:e+t.x,top:i+t.y});var n=this.x1;var r=this.y1;var s=this.x2;var o=this.y2;this.set({x1:n+t.x,y1:r+t.y});this.set({x2:s+t.x,y2:o+t.y});this.setCoords()}})})();(function(){iws.util.extend(iws.objectLine.prototype,{})})();(function(t){"use strict";var e=t.iws||(t.iws={}),i=e.util.array.min,n=e.util.array.max,r=e.util.extend,s=e.util.drawArc;if(e.objectPath){e.warn("iws.Path is already defined");return}function o(){this.initialize.apply(this,arguments)}e.objectPath=e.util.createInheritClass(o,e.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(t){t=t||{};this.path=[];this.callSuper("initialize",t);this._setPositionDimensions(t)},_setPositionDimensions:function(t){var e=this._parseDimensions();this.minX=e.left;this.minY=e.top;this.width=e.width;this.height=e.height;if(typeof t.left==="undefined"){this.left=e.left+(this.originX==="center"?this.width/2:this.originX==="right"?this.width:0)}if(typeof t.top==="undefined"){this.top=e.top+(this.originY==="center"?this.height/2:this.originY==="bottom"?this.height:0)}},_renderPathCommands:function(t){var i=this.getCenterPoint();t.beginPath();for(var n=0,r=this.path.length;n<r;++n){var s=this.path[n];switch(s[0]){case"L":var o=s[1];var a=s[2];t.lineTo(o-i.x,a-i.y);if(e.debug){if(n%17===0){t.save();t.textBaseline="alphabetic";t.font="14px sans-serif";var l="L="+o.toFixed(2)+", "+a.toFixed(2);t.fillText(l,o,a);t.restore()}}break;case"M":var o=s[1];var a=s[2];t.moveTo(o-i.x,a-i.y);if(e.debug){t.save();t.textBaseline="alphabetic";t.font="14px sans-serif";var h="M="+o.toFixed(2)+", "+a.toFixed(2);t.fillText(h,o,a);t.restore()}break}}},_render:function(t){this._renderPathCommands(t);this._renderFill(t);this._renderStroke(t)},toObject:function(t){var e=2;var i=r(this.callSuper("toObject",t),{path:this.path.map(function(t){var i=t.slice();var n=i.map(function(t){if(typeof t==="number"&&!isNaN(t)){t=parseFloat(Number(t).toFixed(e))}return t});return n})});return i},_parseDimensions:function(){var t=[],e=[],r,s=null,o=0,a=0;for(var l=0,h=this.path.length;l<h;++l){r=this.path[l];switch(r[0]){case"L":o=r[1];a=r[2];break;case"M":o=r[1];a=r[2];break}s=r;t.push(o);e.push(a)}var u=i(t)||0,c=i(e)||0,f=n(t)||0,d=n(e)||0,g=f-u,p=d-c,v={left:u,top:c,width:g,height:p};return v}});e.objectPath.fromObject=function(t,i){var n=new e.objectPath(t);i&&i(n);return n};e.objectPath.async=true})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectPath.prototype,{_onCreateMouseDown:function(t){var e=this.canvas.getPointer(t);this._addPoint(["M",e.x,e.y])},_onCreateMouseMove:function(t){var e=this.canvas.getPointer(t);this._addPoint(["L",e.x,e.y]);this.canvas.renderAll()},_onCreateMouseUp:function(t){this.callSuper("_onCreateMouseUp",t)},_addPoint:function(t){this.path.push(t);this._setPositionDimensions({})},_objectSizeChangeScale:function(t,e,i){var n=function(t,e,i,n){var r={width:e.x-t.x,height:e.y-t.y};return{x:i.x-r.width*n,y:i.y-r.height*n}};var r={x:this.get("left")+this.get("width")/2,y:this.get("top")+this.get("height")/2};var s={x:i.x-e.x,y:i.y-e.y};var o=n(r,s,i,t);for(var a=0;a<this.path.length;a++){var l=this.path[a];if(l.length>=3){var h=n({x:l[1],y:l[2]},s,i,t);l[1]=h.x;l[2]=h.y}}this.set({left:o.x-t*(this.get("width")/2),top:o.y-t*(this.get("height")/2),width:t*this.get("width"),height:t*this.get("height")});this.setCoords()},_moveOffset:function(t){var e=this.left;var i=this.top;this.set({left:e+t.x,top:i+t.y});for(var n=0;n<this.path.length;n++){var r=this.path[n];if(r.length>=3){r[1]+=t.x;r[2]+=t.y}}this.setCoords()},_rotate:function(t,e){var i=iws.util.Rotate(t).point(e.x,e.y,this.left,this.top);this.set({angle:(this.angle+t)%360,left:i.x,top:i.y});var n=this.getCenterPoint();for(var r=0;r<this.path.length;r++){var s=this.path[r];if(s.length>=3){var o=iws.util.Rotate(t).point(e.x,e.y,s[1],s[2]);var a=iws.util.Rotate(-t).point(n.x,n.y,o.x,o.y);s[1]=a.x;s[2]=a.y}}this.setCoords()},translateOffset:function(t,e,i,n,r){console.log("x="+t+", y="+e+", offsetX="+i+"offsetY="+n);var s=t-i,o=e-n,a=!this.get("lockMovementX")&&this.left!==s,l=!this.get("lockMovementY")&&this.top!==o;var h={x:t-r.x,y:e-r.y};if(!a){h.x=0}if(!l){h.y=0}this._moveOffset(h);return a||l},setPositionByOrigin:function(t,e,i,n){var r=this.translateToCenterPoint(t,e,i),s=this.translateToOriginPoint(r,this.originX,this.originY);this.set("left",s.x);this.set("top",s.y);var o={x:r.x-n.x,y:r.y-n.y};for(var a=0;a<this.path.length;a++){var l=this.path[a];if(l.length>=3){l[1]+=o.x;l[2]+=o.y}}}})})();(function(t){"use strict";var e=iws.Object.prototype.stateProperties.concat();e.push("rx","ry","x","y");function i(){this.initialize.apply(this,arguments)}iws.objectRect=iws.util.createInheritClass(i,iws.Object,{stateProperties:e,type:"rect",rx:0,ry:0,initialize:function(t){t=t||{};this.callSuper("initialize",t);this._initRxRy()},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx}else if(this.ry&&!this.rx){this.rx=this.ry}},_render:function(t,e){if(this.width===1&&this.height===1){t.fillRect(-.5,-.5,1,1);return}var i=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0,r=this.width,s=this.height,o=e?this.left:-this.width/2,a=e?this.top:-this.height/2,l=i!==0||n!==0,h=1-.5522847498;t.beginPath();t.moveTo(o+i,a);t.lineTo(o+r-i,a);l&&t.bezierCurveTo(o+r-h*i,a,o+r,a+h*n,o+r,a+n);t.lineTo(o+r,a+s-n);l&&t.bezierCurveTo(o+r,a+s-h*n,o+r-h*i,a+s,o+r-i,a+s);t.lineTo(o+i,a+s);l&&t.bezierCurveTo(o+h*i,a+s,o,a+s-h*n,o,a+s-n);t.lineTo(o,a+n);l&&t.bezierCurveTo(o,a+h*n,o+h*i,a,o+i,a);t.closePath();this._renderBackground(t);this._renderStroke(t)},toObject:function(t){var e=iws.util.extend(this.callSuper("toObject",t),{backgroundColor:this.backgroundColor});return e}});iws.objectRect.fromObject=function(t,e){var i=new iws.objectRect(t);e&&e(i);return i}})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectRect.prototype,{_onCreateMouseDown:function(t){var e=this.canvas.getPointer(t);this.set({left:e.x,top:e.y,originX:"left",originY:"top",width:10,height:10})},_onCreateMouseMove:function(t){this.callSuper("_onCreateMouseMove",t)},_onCreateMouseUp:function(t){this.callSuper("_onCreateMouseUp",t)}})})();(function(t){"use strict";if(t.iws.objectStamp){iws.warn("iws.objectStamp is already defined.");return}function e(){this.initialize.apply(this,arguments)}iws.objectStamp=iws.util.createInheritClass(e,iws.Object,{_dimensionAffectingProps:{fontSize:true,fontWeight:true,fontFamily:true,fontStyle:true,text:true},type:"stamp",margin:8,stroke:"red",strokeWidth:4,fontColor:"red",fontSize:40,fontWeight:"800",fontFamily:"Jeju Gothic",text:"APPROVE",initialize:function(t){t||(t={});this.callSuper("initialize",t)},_set:function(t,e){this.callSuper("_set",t,e);if(t in this._dimensionAffectingProps){this.setCoords()}},_stroke:function(t){if(!this.stroke||this.strokeWidth===0){return}var e=this.width/2,i=this.height/2;t.beginPath();t.moveTo(-e,-i);t.lineTo(e,-i);t.lineTo(e,i);t.lineTo(-e,i);t.lineTo(-e,-i);t.closePath()},_render:function(t,e,i){var n=e?this.left:-this.width/2;var r=e?this.top:-this.height/2;t.globalAlpha=.9;t.lineWidth=this.strokeWidth*this.baseScale;t.strokeStyle=this.stroke;t.strokeRect(n,r,this.width,this.height);t.fillStyle=this.fontColor;t.fillText(this.text,n+this.margin*this.baseScale,r+this.height-this.margin*2*this.baseScale);this._stroke(t);this._renderStroke(t)},render:function(t,e,i){if(!this.visible){return}t.save();this.baseScale=i;t.textBaseline="alphabetic";t.font=[this.fontStyle,this.fontWeight,this.fontSize*this.baseScale+"px",this.fontFamily].join(" ");this.height=this.fontSize*this.baseScale+this.margin*2*this.baseScale;this.width=t.measureText(this.text).width+this.margin*2*this.baseScale;if(this.mouseDownPos){this.set({left:this.mouseDownPos.x-this.width/2}).set({top:this.mouseDownPos.y-this.height/2});this.mouseDownPos=undefined}if(!e){this.transform(t)}this._render(t);t.restore()},toObject:function(t){var e=iws.util.extend(this.callSuper("toObject",t),{text:this.text,fontColor:this.fontColor,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle});return e}});iws.objectStamp.fromObject=function(t,e){var i=new iws.objectStamp(t);e&&e(i);return i}})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectStamp.prototype,{_onCreateMouseDown:function(t){var e=this.canvas.getPointer(t);this.mouseDownPos=e},_onCreateMouseMove:function(t){var e=this.canvas.getPointer(t);this.set({left:e.x-this.width/2}).set({top:e.y-this.height/2})},_onCreateMouseUp:function(t){this.setCoords()}})})();(function(t){"use strict";var e=t.iws||(t.iws={}),i=e.util.extend,n=e.util.clone,r=e.util.toFixed,s=e.Object.NUM_FRACTION_DIGITS,o=2;if(e.objectText){e.warn("iws.Text is already defined");return}var a=e.Object.prototype.stateProperties.concat();a.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight");function l(){this.initialize.apply(this,arguments)}e.objectText=e.util.createInheritClass(l,e.Object,{_dimensionAffectingProps:{fontSize:true,fontWeight:true,fontFamily:true,fontStyle:true,lineHeight:true,text:true,charSpacing:true,textAlign:true,strokeWidth:true,width:true,height:true},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontColor:"rgb(0,0,0)",fontSize:40,fontWeight:"normal",fontFamily:"Jeju Gothic",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.2,stateProperties:a,stroke:null,shadow:null,charSpacing:0,minWidth:20,dynamicMinWidth:2,__cachedLines:null,baseScale:1,initialize:function(t){t=t||{};this.callSuper("initialize",t);this.ctx=document.createElement("canvas").getContext("2d");this.initBehavior();this.setControlsVisibility({tl:false,tr:false,br:false,bl:false,ml:true,mt:false,mr:true,mb:false,mtr:true})},_render:function(t){this._setOpacity(t);this._setShadow(t);this._setupCompositeOperation(t);this._renderBackground(t);this._setStrokeStyles(t);this._renderText(t);this._renderTextDecoration(t)},_renderText:function(t){this._renderTextFill(t);this._renderTextStroke(t)},_setTextStyles:function(t){t.textBaseline="alphabetic";t.font=[this.fontStyle,this.fontWeight,this.fontSize*this.baseScale+"px",this.fontFamily].join(" ")},_getTextHeight:function(){var t,e=0;for(var i=0,n=this._textLines.length;i<n;i++){t=this._getHeightOfLine();e+=t}return e},_getTextWidth:function(t){var e=this._getLineWidth(t,0);for(var i=1,n=this._textLines.length;i<n;i++){var r=this._getLineWidth(t,i);if(r>e){e=r}}return e},_getNonTransformedDimensions:function(){return{x:this.width,y:this.height}},_renderChars:function(t,e,i,n,r){var s=t.slice(0,-4),o,a;if(this[s].toLive){var l=-this.width/2+this[s].offsetX||0,h=-this.height/2+this[s].offsetY||0;e.save();e.translate(l,h);n-=l;r-=h}if(this.charSpacing!==0){var u=this._getWidthOfCharSpacing();i=i.split("");for(var c=0,f=i.length;c<f;c++){o=i[c];a=e.measureText(o).width+u;e[t](o,n,r);n+=a>0?a:0}}else{e[t](i,n,r)}this[s].toLive&&e.restore()},_renderTextLine:function(t,e,i,n,r,s){var o=this._getLineWidth(e,s);if(this.textAlign!=="justify"||this.width<o){this._renderChars(t,e,i,n,r,s);return}var a=i.split(/\s+/),l=0,h=this._getWidthOfWords(e,a.join(""),s,0),u=this.width-h,c=a.length-1,f=c>0?u/c:0,d=0,g;for(var p=0,v=a.length;p<v;p++){while(i[l]===" "&&l<i.length){l++}g=a[p];this._renderChars(t,e,g,n+d,r,s,l);d+=this._getWidthOfWords(e,g,s,l)+f;l+=g.length}},_getWidthOfWords:function(t,e){var i=t.measureText(e).width,n,r;if(this.charSpacing!==0){n=e.split("").length;r=n*this._getWidthOfCharSpacing();i+=r}return i>0?i:0},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},isEmptyStyles:function(){return true},_renderTextCommon:function(t,e){var i=0,n=this._getLeftOffset(),r=this._getTopOffset();for(var s=0,o=this._textLines.length;s<o;s++){var a=this._getHeightOfLine(t,s),l=a/this.lineHeight,h=this._getLineWidth(t,s),u=this._getLineLeftOffset(h);this._renderTextLine(e,t,this._textLines[s],n+u,r+i+l,s);i+=a}},_renderTextFill:function(t){t.fillStyle=this.fontColor;this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){if((!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()){return}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(t)}t.save();t.beginPath();this._renderTextCommon(t,"strokeText");t.closePath();t.restore()},_getHeightOfLine:function(){return this.fontSize*this.baseScale*this.lineHeight},_getLineLeftOffset:function(t){if(this.textAlign==="center"){return(this.width-t)/2}if(this.textAlign==="right"){return this.width-t}return 0},_clearCache:function(){this.__lineWidths=[]},_getLineWidth:function(t,e){if(this.__lineWidths[e]){return this.__lineWidths[e]===-1?this.width:this.__lineWidths[e]}var i,n,r=this._textLines[e];if(r===""){i=0}else{i=this._measureLine(t,e)}this.__lineWidths[e]=i;if(i&&this.textAlign==="justify"){n=r.split(/\s+/);if(n.length>1){this.__lineWidths[e]=-1}}return i},_getWidthOfCharSpacing:function(){if(this.charSpacing!==0){return this.fontSize*this.baseScale*this.charSpacing/1e3}return 0},_measureLine:function(t,e){var i=this._textLines[e],n=t.measureText(i).width,r=0,s,o;if(this.charSpacing!==0){s=i.split("").length;r=(s-1)*this._getWidthOfCharSpacing()}o=n+r;return o>0?o:0},_renderTextDecoration:function(t){if(!this.textDecoration){return}var e=this.height/2,i=this,n=[];function r(n){var r,s=0,o,a,l,h,u,c;var f=i.fontSize*this.baseScale;for(r=0,o=i._textLines.length;r<o;r++){h=i._getLineWidth(t,r);u=i._getLineLeftOffset(h);c=i._getHeightOfLine(t,r);for(a=0,l=n.length;a<l;a++){t.fillRect(i._getLeftOffset()+u,s+n[a]*f-e,h,f/15)}s+=c}}if(this.textDecoration.indexOf("underline")>-1){n.push(.85)}if(this.textDecoration.indexOf("line-through")>-1){n.push(.43)}if(this.textDecoration.indexOf("overline")>-1){n.push(-.12)}if(n.length>0){r(n)}},render:function(t,e,i){if(!this.visible){return}t.save();this.baseScale=i;this._setTextStyles(t);this.dynamicMinWidth=0;this._textLines=this._splitTextIntoLines();this._clearCache();if(this.width<this.getMinWidth()){this.width=this.getMinWidth()}this.height=this._getTextHeight();this.setCoords();this.drawSelectionBackground(t);if(!e){this.transform(t)}if(this.transformMatrix){t.transform.apply(t,this.transformMatrix)}this._render(t);t.restore();this.drawDelete(t)},_getWidthOfSpace:function(t,e){if(this.__widthOfSpace[e]){return this.__widthOfSpace[e]}var i=this._textLines[e],n=this._getWidthOfWords(t,i,e,0),r=this.width-n,s=i.length-i.replace(this._reSpacesAndTabs,"").length,o=Math.max(r/s,t.measureText(" ").width);this.__widthOfSpace[e]=o;return o},_wrapText:function(t,e){var i=e.split(this._reNewline),n=[],r;for(r=0;r<i.length;r++){n=n.concat(this._wrapLine(t,i[r],r))}return n},_getWidthOfChar:function(t,e,i,n){if(!this._isMeasuring&&this.textAlign==="justify"&&this._reSpacesAndTabs.test(e)){return this._getWidthOfSpace(t,i)}t.save();var r=this._applyCharStylesGetWidth(t,e,i,n);if(this.charSpacing!==0){r+=this._getWidthOfCharSpacing()}t.restore();return r>0?r:0},_measureText:function(t,e,i,n){var r=0;n=n||0;for(var s=0,o=e.length;s<o;s++){r+=this._getWidthOfChar(t,e[s],i,s+n)}return r},_wrapLine:function(t,e,i){var n=0,r=[],s="",o=e.split(" "),a="",l=0,h=" ",u=0,c=0,f=0,d=true,g=this._getWidthOfCharSpacing();for(var p=0;p<o.length;p++){a=o[p];u=t.measureText(a).width;l+=a.length;n+=c+u-g;if(n>=this.width&&!d){r.push(s);s="";n=u;d=true}else{n+=g}if(!d){s+=h}s+=a;c=t.measureText(h).width;l++;d=false;if(u>f){f=u}}p&&r.push(s);if(f>this.dynamicMinWidth){this.dynamicMinWidth=f-g}return r},_splitTextIntoLines:function(){var t=this.textAlign;this.ctx.save();this._setTextStyles(this.ctx);this.textAlign="left";var e=this._wrapText(this.ctx,this.text);this.textAlign=t;this.ctx.restore();this._textLines=e;this._styleMap=this._generateStyleMap();return e},_generateStyleMap:function(){var t=0,e=0,i=0,n={};for(var r=0;r<this._textLines.length;r++){if(this.text[i]==="\n"&&r>0){e=0;i++;t++}else if(this.text[i]===" "&&r>0){e++;i++}n[r]={line:t,offset:e};i+=this._textLines[r].length;e+=this._textLines[r].length}return n},toObject:function(t){var e=i(this.callSuper("toObject",t),{text:this.text,fontColor:this.fontColor,backgroundColor:this.backgroundColor,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle});return e},_set:function(t,e){this.callSuper("_set",t,e);if(t in this._dimensionAffectingProps){this.setCoords()}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)}});e.objectText.fromObject=function(t,i){var n=new e.objectText(t);i&&i(n);return n}})(typeof exports!=="undefined"?exports:this);(function(){iws.util.extend(iws.objectText.prototype,{initBehavior:function(){this.initSelect();this.initDeselect();this.initMousedownHandler();this.initMouseupHandler();this.initDoubleClickSimulation();this.initTextClickHandler()},initSelect:function(){this.observe("selected",function(t){setTimeout(function(){this.selected=true}.bind(this),100)})},initDeselect:function(){this.observe("deselected",function(t){this.selected=false})},initMousedownHandler:function(){this.observe("mouseDown",function(t){var e=this.canvas.getPointer(t);this.__mousedownX=e.x;this.__mousedownY=e.y;this.__isMousedown=true;this.__lastSelected=this.selected})},_isObjectMoved:function(t){var e=this.canvas.getPointer(t);return this.__mousedownX!==e.x||this.__mousedownY!==e.y;
},initMouseupHandler:function(){this.observe("mouseUp",function(t){this.__isMousedown=false;if(this._isObjectMoved(t)){return}if(this.__lastSelected&&!this.__corner){this.fire("textClick",t)}this.selected=true})},initTextClickHandler:function(){this.observe("textClick",function(){this.visible=false;this.active=false;this.canvas.renderAll();var t=this.fontSize*this.baseScale;var e=1.2;var i=$('<textarea class="annotText"></textarea>');i.val(this.text);i.css({left:this.left,top:this.top,width:this.width,height:this.height+2,"font-family":"Jeju Gothic","font-size":t+"px",color:this.fontColor,background:this.backgroundColor,position:"absolute","line-height":e,border:"0 none white",padding:0,outline:"none","IME-MODE":"active"}).appendTo($(this.canvas.pageContainer));var n=this;i.on("focusout blur",function(t){if($(this).val()!=""){n.set("text",$(this).val());n.set("width",i.width());n.set("height",i.height())}n.visible=true;n.active=true;n.canvas.renderAll();$(this).remove()});i.on("input",function(){i.css({"overflow-y":"hidden"}).height(i[0].scrollHeight)});setTimeout(function(){i.select()},1)})},initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.observe("mouseDown",this.onMouseDown.bind(this))},onMouseDown:function(t){this.__newClickTime=+new Date;var e=this.canvas.getPointer(t);this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=e},isDoubleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault();t.stopPropagation&&t.stopPropagation()}})})();(function(){iws.toolbar.annotation=function(t){this.page=t;this.initialize()};iws.toolbar.annotation.prototype={mappingParam:{fillColor:"backgroundColor",strokeColor:"stroke",fontColor:"fontColor"},mappingObject:{path:"annotDrawFree",line:"annotDrawLine",rect:"annotDrawRect",text:"annotDrawText",ellipse:"annotDrawEllipse",arrowline:"annotDrawArrowLine",imageCheckV:"annotDrawCheckV",imageCheckX:"annotDrawCheckX",stamp:"annotDrawStamp"},configProperty:{strokeWidth:{value:".js-selected-properties-stroke-width-value",parent:".js-selected-properties-stroke-width"},strokeColor:{value:".js-selected-properties-stroke-color-value",parent:".js-selected-properties-stroke-color"},fillColor:{value:".js-selected-properties-fill-color-value",parent:".js-selected-properties-fill-color"},backgroundColor:{value:".js-selected-properties-background-color-value",parent:".js-selected-properties-background-color"},fontFamily:{value:".js-selected-properties-font-family-value",parent:".js-selected-properties-font-family"},fontColor:{value:".js-selected-properties-font-color-value",parent:".js-selected-properties-font-color"},fontSize:{value:".js-selected-properties-font-size-value",parent:".js-selected-properties-font-size"},fontStyle:{value:".js-selected-properties-font-style-value",parent:".js-selected-properties-font-style"},fontWeight:{value:".js-selected-properties-font-weight-value",parent:".js-selected-properties-font-weight"}},initialize:function(){this._makeProperties();this._makeToolbar();this._eventListen();var t=function(t){return function(e){var i=this._getDomElementValue($(e.target));var n=this.properties[t].getValue(i);this.properties[t].setValue(n);var r=this.page.annotation&&this.page.annotation._selectedObjects();if(r&&r.length==1){var s=r[0];if(s){s.set(this.mappingParam[t]||t,n);this.page.renderAll()}}}};this._eachPropertyConfig(function(e,i){var n=$(i.value);var r=this.properties[e].getValue();n.change(t(e).bind(this));this._setDomElementValue(n,r)}.bind(this));this._updateProperty("",[])},getInitParam:function(t){var e=this._toolProperties(t);var i={};e.forEach(function(t){var e=this.mappingParam[t]||t;var n=this.properties[t].getValue();i[e]=n}.bind(this));return i},_makeProperties:function(){var t=function(t){this.parser=t.parser||function(t){return t};this.initial=t.initial;this.save=t.save||function(){}};var e={};var i={fillColor:"iws.viewer.annotation.fillColor",strokeColor:"iws.viewer.annotation.strokeColor",strokeWidth:"iws.viewer.annotation.strokeWidth",fontFamily:"iws.viewer.annotation.fontFamily",fontSize:"iws.viewer.annotation.fontSize",fontStyle:"iws.viewer.annotation.fontStyle",fontWeight:"iws.viewer.annotation.fontWeight",fontColor:"iws.viewer.annotation.fontColor",backgroundColor:"iws.viewer.annotation.backgroundColor"};var n={fillColor:new t({initial:function(){return localStorage.getItem(i.fillColor)||"rgba(0, 0, 200, 0.5)"}(),save:function(t){localStorage.setItem(i.fillColor,t)}}),strokeColor:new t({initial:function(){return localStorage.getItem(i.strokeColor)||"red"}(),save:function(t){localStorage.setItem(i.strokeColor,t)}}),strokeWidth:new t({initial:function(){var t=localStorage.getItem(i.strokeWidth);return t&&isNaN(t)?1:t||2}(),parser:function(t){return parseInt(t,10)},save:function(t){localStorage.setItem(i.strokeWidth,t)}}),fontFamily:new t({initial:function(){return localStorage.getItem(i.fontFamily)||"Jeju Gothic"}(),save:function(t){localStorage.setItem(i.fontFamily,t)}}),fontSize:new t({initial:function(){return localStorage.getItem(i.fontSize)||16}(),parser:function(t){return parseInt(t,10)},save:function(t){localStorage.setItem(i.fontSize,t)}}),fontStyle:new t({initial:function(){return localStorage.getItem(i.fontStyle)||"normal"}(),save:function(t){localStorage.setItem(i.fontStyle,t)}}),fontWeight:new t({initial:function(){return localStorage.getItem(i.fontWeight)||"normal"}(),save:function(t){localStorage.setItem(i.fontWeight,t)}}),fontColor:new t({initial:function(){return localStorage.getItem(i.fontColor)||"black"}(),save:function(t){localStorage.setItem(i.fontColor,t)}}),backgroundColor:new t({initial:function(){return localStorage.getItem(i.backgroundColor)||"rgba(240, 240, 240, 0.9)"}(),save:function(t){localStorage.setItem(i.backgroundColor,t)}})};for(var r in n){if(n.hasOwnProperty(r)){var s=n[r];var o=this;e[r]=function(t,e){var i=e.initial;return{getValue:function(n){if(typeof n!="undefined"){i=e.parser(n);o.fire("property:change",t)}return i},setValue:function(t){e.save(t)}}}(r,s)}}this.properties=e},_setDomElementValue:function(t,e){if(e===null||e=="none"){return}if(t.is('[type="checkbox"]')){t.prop("checked",e==t.val())}else{t.val((e||"").toString())}t.trigger("change")},_getDomElementValue:function(t){if(t.is('[type="checkbox"]')){if(t.prop("checked")){return t.val()}else{return"normal"}}else{return t.val()}},_toolProperties:function(t){switch(t){case"annotDrawFree":case"annotDrawArrowLine":case"annotDrawLine":return["strokeColor","strokeWidth"];case"annotDrawEllipse":case"annotDrawRect":return["fillColor","strokeColor","strokeWidth"];case"annotDrawText":return["fontColor","backgroundColor","fontFamily","fontStyle","fontSize","fontWeight"];default:return[]}},_eachPropertyConfig:function(t){for(var e in this.configProperty){if(this.configProperty.hasOwnProperty(e)){t(e,this.configProperty[e])}}},_updateDOM:function(t){var e=t.target&&this.mappingObject[t.target.type]||"";var i={};var n=this._toolProperties(e);n.forEach(function(e){var n=this.mappingParam[e]||e;i[e]=t.target.get(n)}.bind(this));this._updateProperty(e,i)},_updateProperty:function(t,e){var i=this._toolProperties(t);this._eachPropertyConfig(function(t,n){if(i.indexOf(t)>=0){this.property.querySelectorAll(n.parent).forEach(function(t){t.style.display=""});if(typeof e!=="undefined")this._setDomElementValue($(n.value),e[t])}else{this.property.querySelectorAll(n.parent).forEach(function(t){t.style.display="none"})}}.bind(this))},_makeToolbar:function(){this.annotToolbarEl=iws.util.makeElement("div",{class:"pop-annotation"});this.page.pageContainer.appendChild(this.annotToolbarEl);this.__makeDomTool();this.__makeDomProperty();var t=this;$(this.annotToolbarEl).append('<a class="handle ui-slideouttab-handle-rounded">Tool</a>');this.tabSlide=$(this.annotToolbarEl).tabSlideOut({clickScreenToClose:false,offset:10,tabLocation:"right",offsetReverse:false,handleOffsetReverse:false,onOpenStart:function(){t.fire("annotation_tab","openStart")},onOpen:function(){t.page.setTrackMode("annotSelect");t.fire("annotation_tab","open")},onClose:function(){t.page.annotation&&t.page.annotation.deActiveAll();t.fire("annotation_tab","close");t.page.setTrackMode("move")}});$(this.annotToolbarEl).filter(".ui-slideouttab-panel").css("background-color","transparent")},__makeDomTool:function(){this.poptool=iws.util.makeElement("div",{class:"pop-tool",id:"pop-tool",draggable:"false"});this.annotToolbarEl.appendChild(this.poptool);this.poptool.innerHTML='<div class="popbtn-group-v">'+'<button class="popbtn" id="annotSelect" title="Select annotation"><i class="vIcon-Select"></i></button>'+'<button class="popbtn" id="annotDelete" title="Delete annotation"><i class="vIcon-Delete"></i></button>'+'<button class="popbtn" id="annotDrawFree" title="Draw freely"><i class="vIcon-DrawFree"></i></button>'+'<button class="popbtn" id="annotDrawLine" title="Draw line"><i class="vIcon-DrawLine"></i></button>'+'<button class="popbtn" id="annotDrawArrowLine" title="Draw arrow-line"><i class="vIcon-DrawArrowLine"></i></button>'+'<button class="popbtn" id="annotDrawEllipse" title="Draw ellipse"><i class="vIcon-DrawEllipse"></i></button>'+'<button class="popbtn" id="annotDrawRect" title="Draw rectangle"><i class="vIcon-DrawRect"></i></button>'+'<button class="popbtn" id="annotDrawText" title="Write memo"><i class="vIcon-DrawText"></i></button>'+'<button class="popbtn" id="annotDrawCheckV" title="Draw V check"><i class="vIcon-DrawCheckV"></i></button>'+'<button class="popbtn" id="annotDrawCheckX" title="Draw X check"><i class="vIcon-DrawCheckX"></i></button>'+'<button class="popbtn" id="annotDrawStamp" title="Draw Stamp"><i class="vIcon-DrawStamp"></i></button>'+"</div>"},__makeDomProperty:function(){this.property=iws.util.makeElement("div",{class:"pop-property"});this.annotToolbarEl.appendChild(this.property);this.property.innerHTML='<div class="property-group-v">'+"<dl>"+'<dt class="js-selected-properties-stroke-width">Stroke width</dt>'+'<dd class="js-selected-properties-stroke-width">'+'<select class="js-selected-properties-stroke-width-value property-span">'+'<option value="1">1</option>'+'<option value="2">2</option>'+'<option value="3">3</option>'+'<option value="4">4</option>'+'<option value="5">5</option>'+"</select>"+"</dd>"+'<dt class="js-selected-properties-fill-color">Fill color</dt>'+'<dd class="js-selected-properties-fill-color">'+'<input type="text" class="js-selected-properties-fill-color-value property-span js-color"/>'+"</dd>"+'<dt class="js-selected-properties-stroke-color">Stroke color</dt>'+'<dd class="js-selected-properties-stroke-color">'+'<input type="text" class="js-selected-properties-stroke-color-value property-span js-color"/>'+"</dd>"+'<dt class="js-selected-properties-font-color">font Color</dt>'+'<dd class="js-selected-properties-font-color">'+'<input type="text" class="js-selected-properties-font-color-value property-span js-color"/>'+"</dd>"+'<dt class="js-selected-properties-background-color">background</dt>'+'<dd class="js-selected-properties-background-color">'+'<input type="text" class="js-selected-properties-background-color-value property-span js-color"/>'+"</dd>"+'<dt class="js-selected-properties-font-size">Font Size</dt>'+'<dd class="js-selected-properties-font-size">'+'<select type="text" class="js-selected-properties-font-size-value property-span">'+'<option value="12">12</option>'+'<option value="14">14</option>'+'<option value="16">16</option>'+'<option value="20">20</option>'+'<option value="24">24</option>'+'<option value="36">36</option>'+'<option value="48">48</option>'+'<option value="64">64</option>'+'<option value="72">72</option>'+"</select>"+"</dd>"+'<dt class="js-selected-properties-font-style">Italic</dt>'+'<dd class="js-selected-properties-font-style">'+'<input class="popbtn js-selected-properties-font-style-value" type="checkbox" value="italic"/><i class="icon-italic"></i>'+"</dd>"+'<dt class="js-selected-properties-font-weight">Bold</dt>'+'<dd class="js-selected-properties-font-weight">'+'<input class="popbtn js-selected-properties-font-weight-value" type="checkbox" value="bold"/><i class="icon-bold"></i>'+"</dd>"+"</dl>"+"</div>";$(this.property).find(".js-color").each(function(t,e){var i=$(e);if(typeof i.spectrum=="function"){i.spectrum({showPalette:true,palette:[["white","black"],["blue","CornflowerBlue"],["red","Coral"],["yellow","Chartreuse"],["Grey","Green"],["Peru","Pink"],["rgb(255, 128, 0)","hsv 100 70 50"]],showAlpha:true,preferredFormat:"rgb"})}i.change(function(){var t=i.val();if(typeof i.spectrum=="function"){if(i.spectrum("get")!=t){i.spectrum("set",t)}}})})},_eventListen:function(){var t=this.poptool.querySelectorAll(".popbtn");var e=this;t.forEach(function(t){t.addEventListener("click",function(){if(t.id=="annotDelete"){var i=e.page.annotation;var n=i&&i._selectedObjects();if(n&&n.length>0){i._annotations.remove.apply(i._annotations,n);e.page.renderAll();i&&i.setSelectMode()}}else{e.page.setTrackMode(t.id,true)}})});this.page.observe("after:render",function(){if(this.page.imageCtrl.isValid()){this.poptool.querySelectorAll("*").forEach(function(t){t.removeAttribute("disabled")});this.property.querySelectorAll("*").forEach(function(t){t.removeAttribute("disabled")})}else{this.poptool.querySelectorAll("*").forEach(function(t){t.setAttribute("disabled",true)});this.property.querySelectorAll("*").forEach(function(t){t.setAttribute("disabled",true)})}}.bind(this));this.page.observe("annotation:visible",function(t){if(t==="show"){this.annotToolbarEl.style.display="block"}if(t==="hide"){this.annotToolbarEl.style.display="none"}}.bind(this));this.page.observe("mouseTrackChange",function(t){this.poptool.querySelectorAll(".popbtn").forEach(function(t){t.removeClass("toggled")});var e=this.poptool.querySelector("#"+t);if(e)e.addClass("toggled");this.fire("tool:change",t)}.bind(this));this.observe("tool:change",function(t){if(t!=="annotSelect"){this.page.annotation&&this.page.annotation.deActiveAll();this.page.renderAll()}this._updateProperty(t)});this.page.observe("object:selected",function(t){if(t.selecteds.length===1){this._updateDOM(t)}else{this._updateProperty("")}}.bind(this));this.page.observe("selection:cleared",function(t){this._updateProperty("")}.bind(this));this.page.observe("object:removed",function(t){this._updateProperty("")}.bind(this))},destroy:function(){$(this.property).find(".js-color").each(function(t,e){var i=$(e);if(typeof i.spectrum=="function"){i.spectrum("destroy")}})}};iws.util.extend(iws.toolbar.annotation.prototype,iws.Observable)})();(function(){iws.toolbar.masking=function(t){this.page=t;this.initialize()};iws.toolbar.masking.prototype={initialize:function(){this._makeToolbar();this._eventListen()},_makeToolbar:function(){this.maskingToolbarEl=iws.util.makeElement("div",{class:"pop-masking"});this.page.pageContainer.appendChild(this.maskingToolbarEl);this.__makeDomTool();var t=this;$(this.maskingToolbarEl).append('<a class="handle ui-slideouttab-handle-rounded">Masking</a>');this.tabSlide=$(this.maskingToolbarEl).tabSlideOut({clickScreenToClose:false,offset:54,tabLocation:"right",offsetReverse:false,handleOffsetReverse:false,onOpen:function(){t.page.masking.setSelectMode()},onClose:function(){t.page.masking&&t.page.masking.deActiveAll();t.page.setTrackMode("move")}});$(this.maskingToolbarEl).filter(".ui-slideouttab-panel").css("background-color","transparent")},__makeDomTool:function(){this.poptool=iws.util.makeElement("div",{class:"pop-tool",id:"pop-tool",draggable:"false"});this.maskingToolbarEl.appendChild(this.poptool);this.poptool.innerHTML='<div id="pop-command">'+'<div class="popbtn-group-v">'+'<button class="popbtn" id="maskingSelect" title="Select masking"><i class="vIcon-maskingSelect"></i></button>'+'<button class="popbtn" id="maskingDelete" title="Select masking"><i class="vIcon-maskingDelete"></i></button>'+'<button class="popbtn" id="maskingBlack" title="black mask"><i class="vIcon-maskingBlack"></i></button>'+'<button class="popbtn" id="maskingRed" title="red mask"><i class="vIcon-maskingRed"></i></button>'+"</div>"+"</div>"},_eventListen:function(){var t=this.poptool.querySelectorAll(".popbtn");var e=this;t.forEach(function(t){t.addEventListener("click",function(){if(t.id=="maskingDelete"){var i=e.page.masking;var n=i&&i._selectedObjects();if(n&&n.length>0){i._maskings.remove.apply(i._maskings,n);e.page.renderAll();i&&i.setSelectMode()}}else{e.page.setTrackMode(t.id,true)}})});this.page.observe("after:render",function(){if(this.page.imageCtrl.isValid()){this.poptool.querySelectorAll("*").forEach(function(t){t.removeAttribute("disabled")})}else{this.poptool.querySelectorAll("*").forEach(function(t){t.setAttribute("disabled",true)})}}.bind(this));this.page.observe("masking:visible",function(t){if(t==="show"){this.maskingToolbarEl.style.display="block"}if(t==="hide"){this.maskingToolbarEl.style.display="none"}}.bind(this));this.page.observe("mouseTrackChange",function(t){this.poptool.querySelectorAll(".popbtn").forEach(function(t){t.removeClass("toggled")});var e=this.poptool.querySelector("#"+t);if(e)e.addClass("toggled");this.fire("tool:change",t)}.bind(this));this.page.annotToolbar&&this.page.annotToolbar.observe("annotation_tab",function(t){if(this.page.useMasking){switch(t){case"openStart":if($(e.maskingToolbarEl).tabSlideOut("isOpen")){$(e.maskingToolbarEl).tabSlideOut("close")}e.maskingToolbarEl.style.display="none";break;case"close":e.maskingToolbarEl.style.display="block";break}}});this.observe("tool:change",function(t){})},destroy:function(){}};iws.util.extend(iws.toolbar.masking.prototype,iws.Observable)})();(function(){iws.toolbar.page=function(t){this.page=t;this.initialize()};iws.toolbar.page.prototype={toolbarMargin:8,trackModeMap:["move","range","glass","annotSelect","annotPath","annotLine","annotRect","annotText"],trackModeMapping:{move:"trackMove",range:"trackRange",glass:"trackGlass"},initialize:function(){this._makeToolbar();this.page.observe("toolbar:visible",function(t){if(t){this.toolbarContainerEl.style.display="block"}else{this.toolbarContainerEl.style.display="none"}}.bind(this))},isVisible:function(){if(this.toolbarContainerEl.style.display!=="none")return true;else return false},height:function(){var t=this.toolbarContainerEl.clientHeight;return t},_makeToolbar:function(){this.toolbarContainerEl=iws.util.makeElement("div",{class:"pageToolbar_Container"});var t=this.page.pageContainer.parentElement;t.insertBefore(this.toolbarContainerEl,this.page.pageContainer);this.toolbarFrameEl=iws.util.makeElement("div",{class:"pageToolbar_Frame"});this.toolbarContainerEl.appendChild(this.toolbarFrameEl);this.__makeToolbarLeft();this.__makeToolbarZoom();this.__makeToolbarRight()},__makeToolbarLeft:function(){this.toolbarLeft=iws.util.makeElement("div",{class:"pageToolbar"});this.toolbarFrameEl.appendChild(this.toolbarLeft);this.toolbarLeft.innerHTML='<button id="scalePlus" type="button" class="pageToolbarButton" title="ZoomIn"><i class="pageToolbarButton_scalePlus"></i></button>'+'<button id="scaleMinus" type="button" class="pageToolbarButton" title="ZoomOut"><i class="pageToolbarButton_scaleMinus"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<button id="fitWidth" type="button" class="pageToolbarButton" title="Fix Width"><i class="pageToolbarButton_fitWidth"></i></button>'+'<button id="fitHeight" type="button" class="pageToolbarButton" title="Fix Height"><i class="pageToolbarButton_fitHeight"></i></button>'+'<button id="fitAuto" type="button" class="pageToolbarButton" title="Fix Auto"><i class="pageToolbarButton_fitAuto"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<button id="rotate270" type="button" class="pageToolbarButton" title="Rotate 270"><i class="pageToolbarButton_rotate270"></i></button>'+'<button id="rotate90" type="button" class="pageToolbarButton" title="Rotate 90"><i class="pageToolbarButton_rotate90"></i></button>'+'<button id="rotate180" type="button" class="pageToolbarButton" title="Rotate 180"><i class="pageToolbarButton_rotate180"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<div class="trackModeGroup" style="display:inline-block;"> '+'<button id="trackMove" type="button" class="pageToolbarButton" title="Move Image" value="move"><i class="pageToolbarButton_trackMove"></i> </button>'+'<button id="trackRange" type="button" class="pageToolbarButton" title="Select area" value="range"><i class="pageToolbarButton_trackRange"></i> </button>'+'<button id="trackGlass" type="button" class="pageToolbarButton" title="Magnifying Glass" value="glass"><i class="pageToolbarButton_trackGlass"></i> </button>'+"</div>";this.toolbarLeft.querySelector("#scalePlus").addEventListener("click",function(){this.page.zoomIn()}.bind(this),false);this.toolbarLeft.querySelector("#scaleMinus").addEventListener("click",function(){this.page.zoomOut()}.bind(this),false);this.toolbarLeft.querySelector("#fitWidth").addEventListener("click",function(){this.page.setFitMode({name:"width"})}.bind(this),false);this.toolbarLeft.querySelector("#fitHeight").addEventListener("click",function(){this.page.setFitMode({name:"height"})}.bind(this),false);this.toolbarLeft.querySelector("#fitAuto").addEventListener("click",function(){this.page.setFitMode({name:"auto"})}.bind(this),false);this.toolbarLeft.querySelector("#rotate270").addEventListener("click",function(){this.page.setRotate(270)}.bind(this),false);this.toolbarLeft.querySelector("#rotate90").addEventListener("click",function(){this.page.setRotate(90)}.bind(this),false);this.toolbarLeft.querySelector("#rotate180").addEventListener("click",function(){this.page.setRotate(180)}.bind(this),false);this.toolbarLeft.querySelector("#trackMove").addEventListener("click",function(){this.page.setTrackMode("move")}.bind(this),false);this.toolbarLeft.querySelector("#trackRange").addEventListener("click",function(){this.page.setTrackMode("range")}.bind(this),false);this.toolbarLeft.querySelector("#trackGlass").addEventListener("click",function(){this.page.setTrackMode("glass")}.bind(this),false);this.buttonTrackModeGroup=this.toolbarLeft.querySelector(".trackModeGroup");this.page.observe("mouseTrackChange",function(t){if(this.trackModeMap.indexOf(t)>=0){this.buttonTrackModeGroup.querySelectorAll(".pageToolbarButton").forEach(function(t){t.removeClass("toggled")});var e=this.buttonTrackModeGroup.querySelector("#"+this.trackModeMapping[t]);if(e)e.addClass("toggled")}}.bind(this))},__makeToolbarZoom:function(){this.toolbarZoom=iws.util.makeElement("div",{class:"pageToolbar"});this.toolbarFrameEl.appendChild(this.toolbarZoom);this.toolbarZoom.innerHTML='<span id="scaleSelectContainer" class="iws-dropdownToolbarButton">'+'<select id="scaleSelect" title="Zoom" tabindex="23" data-l10n-id="zoom">'+'<option id="pageAutoOption"    title="" value="auto" >Fit auto</option>'+'<option id="pageFitWidthOption" title="" value="width" >Fit Width</option>'+'<option id="pageFitHeightOption" title="" value="height" >Fit Height</option>'+'<option id="customScaleOption" title="" value="custom">0%</option>'+'<option title="" value="0.25"  >25%</option>'+'<option title="" value="0.5"   >50%</option>'+'<option title="" value="0.75"  >75%</option>'+'<option title="" value="1"     >100%</option>'+'<option title="" value="1.25"  >125%</option>'+'<option title="" value="1.5"   >150%</option>'+'<option title="" value="2"     >200%</option>'+'<option title="" value="3"     >300%</option>'+'<option title="" value="4"     >400%</option>'+"</select>"+"</span>";var t=this;this.toolbarZoom.querySelector("#scaleSelect").addEventListener("change",function(e){switch(this.value){case"auto":case"width":case"height":t.page.setFitMode({name:this.value});break;default:t.page._zoom({name:"custom",scale:this.value})}},false);function e(t){var e=this.toolbarZoom.querySelector("#scaleSelect").options;var i=false;for(var n=0,r=e.length;n<r;n++){var s=e[n];if(s.value!==t){s.selected=false;continue}s.selected=true;i=true}return i}function i(){var t=this.toolbarZoom.querySelector("#scaleSelect");var i=this.page.getFitMode();var n="";switch(i.name){case"width":case"height":case"auto":n=i.name;break;case"scale":n=i.scale;break}var r=e.call(this,n);if(!r){var s=document.getElementById("customScaleOption");s.textContent="scale";s.selected=true}}this.page.observe("page:zoom",i.bind(this));this.page.observe("page:fitMode",i.bind(this))},__makeToolbarRight:function(){this.toolbarRight=iws.util.makeElement("div",{class:"pageToolbar size"});this.toolbarFrameEl.appendChild(this.toolbarRight);this.toolbarRight.innerHTML='<button id="fullDisplay" type="button" class="pageToolbarButton" title="Full screen"><i class="pageToolbarButton_FullScreen"></i></button>';this.toolbarRight.querySelector("#fullDisplay").addEventListener("click",function(){iws.util.fullscreen.toggleFullScreen(this.page.fullScreenEl)}.bind(this),false);iws.util.fullscreen.onFullScreenChange(function(t){if(t){$(this.toolbarRight).children("button#fullDisplay").children("i").removeClass("pageToolbarButton_FullScreen");$(this.toolbarRight).children("button#fullDisplay").children("i").addClass("pageToolbarButton_OriginalScreen")}else{$(this.toolbarRight).children("button#fullDisplay").children("i").removeClass("pageToolbarButton_OriginalScreen");$(this.toolbarRight).children("button#fullDisplay").children("i").addClass("pageToolbarButton_FullScreen")}}.bind(this))}}})();(function(){"use strict";function t(){console.log("iws.multiPage start.");this.status="created";this.initialize.apply(this,arguments)}iws.multiPage=iws.util.createInheritClass(t,iws.Observable,{thumb:null,page:null,media:null,thumbShow:true,saveType:"annotation",useAnnotation:false,useMasking:false,useFilter:false,reSampleUse:true,reSampleRate:.8,reSampleFilter:"convolveFloat32",printAutoFit:false,authority:{annotation:"editable",masking:"editable"},readOnlyOne:false,pageType:"image",initialize:function(t,e){e||(e={});this._initOptions(e);this._initWrapperElement(t);iws.imgSrc={checkV:iws.util.string.combinePath(this.path,"/img/iws.annotation.check.V.png"),checkX:iws.util.string.combinePath(this.path,"/img/iws.annotation.check.X.png")};iws.util.loadImage(iws.imgSrc.checkV,function(t){if(t){iws.imgSrc.checkVElement=t}else{this._showError("Loading file("+t.checkV+") error!")}}.bind(this));iws.util.loadImage(iws.imgSrc.checkX,function(t){if(t){iws.imgSrc.checkXElement=t}else{this._showError("Loading file("+t.checkX+") error!")}}.bind(this));this._addThumb();this._addPage();this._addMedia();this.mainToolbar=new iws.toolbar.multiPage(this);this.setTrackMode("move");this.visible("annotation",this.useAnnotation?"show":"hide");this.visible("masking",this.useMasking?"show":"hide");this.visible("filter",this.useFilter?"show":"hide");this.selectVisible();this._initEvent();if(this.selectMode!=undefined){this.selectVisible(this.selectMode)}this.resizer=new iws.util.resize(this.fullScreenEl,this._reSize.bind(this));this._reSize();$(t).on("destroyed",function(){if(this.status==="created"){console.log("viewer destroyed");this.destroy&&this.destroy()}}.bind(this));$.event.special.destroyed={remove:function(t){if(t.handler){t.handler()}}}},_initWrapperElement:function(t){this.wrapperEl=t;iws.util.makeElementUnselectable(this.wrapperEl);this.fullScreenEl=iws.util.makeElement("div",{class:"multiPage-fullScreen"});this.wrapperEl.appendChild(this.fullScreenEl);this.pageContainerEl=iws.util.makeElement("div",{class:"multiPage-container"});this.fullScreenEl.appendChild(this.pageContainerEl);this.loadProgressEl=iws.util.makeElement("div",{class:"multiPage-progress progress-position"});this.loadProgressEl.innerHTML='<div class="w3-grey w3-round w3-tiny">'+'    <div class="progressbar w3-container w3-blue w3-round" style="width:25%;box-sizing:border-box">25%</div>'+"  </div>";this.fullScreenEl.appendChild(this.loadProgressEl);this.pageFrameEl=iws.util.makeElement("div",{class:"multiPage-frame"});this.pageContainerEl.appendChild(this.pageFrameEl);this.thumbContainer=iws.util.makeElement("div",{class:"iws_thumbnailContainer iws_thumbnailContainer_show"});this.thumbSelectAllEl=iws.util.makeElement("label",{class:"thumb_selectAll_hide"});this.thumbSelectAllEl.innerHTML='<input type="checkbox" class="selectall"> Select all';this.thumbContainer.appendChild(this.thumbSelectAllEl);this.thumbEl=iws.util.makeElement("div",{class:"iws-thumbnail iws-thumbnail_full"});this.thumbContainer.appendChild(this.thumbEl);this.pageFrameEl.appendChild(this.thumbContainer);this.pageEl=iws.util.makeElement("div",{class:"iws-format-image iws-page iws-page_move"});this.pageFrameEl.appendChild(this.pageEl);this.mediaEl=iws.util.makeElement("div",{class:"iws-format-media iws-page iws-page_move iws-page-hide"});this.pageFrameEl.appendChild(this.mediaEl)},_initOptions:function(t){for(var e in t){this[e]=t[e]}},_addThumb:function(){var t={debug:false,direction:"V",path:this.path,beforehandLoad:false,plugin:false,printAutoFit:this.printAutoFit,printMark:this.printMark,useBookMark:this.useBookMark,useBookMarkClick:this.useBookMarkClick,useThumbNumber:this.useThumbNumber,readOnlyOne:this.readOnlyOne};this.thumb=iwsT.Thumbnail(this.thumbEl,t)},_addPage:function(){var t={autoResize:false,fitMode:this.fitMode,path:this.path,visibleToolbar:false,useAnnotation:this.useAnnotation,useMasking:this.useMasking,useFilter:this.useFilter,reSampleUse:this.reSampleUse,reSampleRate:this.reSampleRate,reSampleFilter:this.reSampleFilter,imgSrc:this.imgSrc,authority:this.authority};this.page=new iws.PageAnnotation(this.pageEl,t);this.page.pageKey="";this.page.observe("mouseTrackChange",function(t){this.fire("mouseTrackChange",t)}.bind(this));this.page.observe("page:zoom",function(t){this.fire("page:zoom",t)}.bind(this));this.page.observe("page:fitMode",function(t){this.fire("page:fitMode",t)}.bind(this));this.page.observe("page:swipe_left",function(t){this.pageNext()}.bind(this));this.page.observe("page:swipe_right",function(t){this.pagePrev()}.bind(this))},_addMedia:function(){var t={};this.media=new iws.media(this.mediaEl,t)},_getHandlingType:function(){if($(this.pageEl).hasClass("iws-page-hide")){return"media"}else if($(this.mediaEl).hasClass("iws-page-hide")){return"image"}},_initEvent:function(){var t=this.thumbSelectAllEl.querySelectorAll(".selectall");var e=this;t.forEach(function(t){t.addEventListener("click",function(){var i=e.thumb.pageCount();for(var n=0;n<i;n++){e.thumb.setSelect(n,t.checked)}})});var i=this.thumb.getObserver();var n=this;i.observe("splited",function(t){this.fire("pageNumberChange",this.pageIndex)}.bind(this));i.observe("append-start",function(){this.loadProgressEl.style.display="block";this.fire("append-start")}.bind(this));i.observe("append-progress",function(t,e){var i=this.loadProgressEl.querySelector(".progressbar");i.style.width=(t+1)/e*100+"%";i.innerHTML=(t+1).toString()+" / "+e.toString();this.fire("append-progress",t,e)}.bind(this));i.observe("append-complete",function(){this.loadProgressEl.style.display="none";this.fire("append-complete")}.bind(this));i.observe("thumbLoad",function(t,e,i){}.bind(this));i.observe("thumbClick",function(t,e,i){if(this._getHandlingType()=="image"){this._backup()}this._setPage(t);this.fire("thumbClick",t)}.bind(this));i.observe("annotationLoaded",function(t){if(t==this.thumb.findIndex(this.page.pageKey)){var e=this.thumb.getItem(t);if(e){this.page.setAngle(e.angle);this.page.setAnnotation(e.annotation.getData());this.page.setMasking(e.masking.getData())}}}.bind(this));i.observe("error",function(t){n._showError(t)});i.observe("loadpage_start",function(t){iws.util.run_waitMe($(n.pageEl),"roundBounce")});i.observe("loadpage_end",function(t){
iws.util.hide_waitMe($(n.pageEl))});function r(t){this.fire("mouse:drawRanged",t)}this.page.observe("mouse:drawRanged",r.bind(this));function s(){var t=this.thumb.findIndex(this.page.pageKey);if(t!==-1){var e=this.thumb.getItem(t);e.annotation.setData(this.page.getAnnotation());var i=e.annotation.getData()}}function o(){var t=this.thumb.findIndex(this.page.pageKey);if(t!==-1){var e=this.thumb.getItem(t);e.masking.setData(this.page.getMasking())}}this.page.observe("object:removed",function(){s.apply(this)}.bind(this));this.page.observe("object:modified",function(){s.apply(this)}.bind(this));this.page.observe("masking:removed",function(){o.apply(this)}.bind(this));this.page.observe("masking:modified",function(){o.apply(this)}.bind(this))},_setPage:function(t){if(t>=0){var e=this.thumb.getItem(t);this.pageType=e.type=="video"||e.type=="audio"?"media":e.type;if(this.pageType!==this._getHandlingType()){this.fire("changeType",this.pageType)}if(e.type=="image"){$(this.pageEl).toggleClass("iws-page-hide",false);$(this.mediaEl).toggleClass("iws-page-hide",true);this.media.clear();this.page.pageKey=e.uniqueId;this.page.setInfo(e.pageInfo);var i=function(t,e){return function(){t.setAnnotation(e.annotation.getData());t.setMasking(e.masking.getData());t.filter=e.filter||{};t.setFilter()}}(this.page,e);if(e.errorMsg){this.page.setErrorMsg(e.errorMsg)}else if(e.pageSrc&&e.pageSrc!=""){this.page.setSrc(e.pageSrc,e.angle,i)}else if(e.pagebuffer){this.page.setRawData(e.pagebuffer,e.pageInfo.width,e.pageInfo.height,e.angle,i)}}else if(e.type=="video"||e.type=="audio"){$(this.mediaEl).toggleClass("iws-page-hide",false);$(this.pageEl).toggleClass("iws-page-hide",true);this.page.clear();this.media.mediaKey=e.uniqueId;this.media.updateSource(e.mediaSource)}}else{this.media.clear();this.page.clear()}this.fire("pageNumberChange",t)},_reSize:function(){var t=this.fullScreenEl.clientWidth;var e=this.fullScreenEl.clientHeight;var i=t;var n=e;if(this.mainToolbar&&this.mainToolbar.isVisible()){n=e-this.mainToolbar.height()}this.pageContainerEl.style.width=i+"px";this.pageContainerEl.style.height=n+"px";if(t<640||!this.thumbShow){this.thumbContainer.removeClass("iws_thumbnailContainer_show");this.thumbContainer.addClass("iws_thumbnailContainer_hide");this.pageEl.removeClass("iws-page_move");this.pageEl.addClass("iws-page_full");this.mediaEl.removeClass("iws-page_move");this.mediaEl.addClass("iws-page_full")}else{this.thumbContainer.removeClass("iws_thumbnailContainer_hide");this.thumbContainer.addClass("iws_thumbnailContainer_show");this.pageEl.removeClass("iws-page_full");this.pageEl.addClass("iws-page_move");this.mediaEl.removeClass("iws-page_full");this.mediaEl.addClass("iws-page_move")}this.page&&this.page._reSize();this.media&&this.media.resize();this.fire("resize",{width:t,height:e})},_showError:function(t){iws.util.showError(this.fullScreenEl,t)},clear:function(t){this.thumb.init(t);this.page.clear();this.media&&this.media.clear();this.fire("pageNumberChange",-1)},loadFile:function(t,e){this.clear(function(){this.thumb.append(t,e)}.bind(this))},appendFile:function(t,e){t=Array.isArray(t)?t:[t];var i=[];t.forEach(function(t){i.push({type:"image",buffer:t})});this.thumb.appendContents(i,e)},loadUrl:function(t,e){this.clear(function(){this.appendUrl(t,e)}.bind(this))},appendUrl:function(t,e){t=Array.isArray(t)?t:[t];var i=[];t.forEach(function(t){i.push({type:"image",url:t})});this.thumb.appendContents(i,e)},appendBase64:function(t,e){t=Array.isArray(t)?t:[t];var i=[];t.forEach(function(t){i.push({type:"image",src:t})});this.thumb.appendContents(i,e)},appendContents:function(t,e){this.thumb.appendContents(t,e)},print:function(){this._backup();this.thumb.print()},loadAnnotation:function(t,e){e=e||0;this.thumb.annotationLoad(t,e)},_backup:function(){var t=this.thumb.findIndex(this.page.pageKey);if(t!==-1){var e=this.thumb.getItem(t);e.annotation.setData(this.page.getAnnotation());e.masking.setData(this.page.getMasking());e.filter=this.page.filter}},saveAnnotation:function(){this._backup();this.thumb.annotationSave(function(t){var e=t===""?false:true;this.fire("saveAnnotation",{success:e,annotation:t})}.bind(this))},saveImage:function(){var t=function(t,e){this.fire("saveImage",{success:t,byteArray:e})};this.thumb.pageSave(5,t.bind(this))},_zoom:function(t){this.page._zoom(t)},zoomIn:function(){this.page.zoomIn()},zoomOut:function(){this.page.zoomOut()},_changeKlass:function(t){var e=iws.util.getKlass(t.type,null,"object");return e.fromObject(t)},_changeObject:function(t){return t["toObject"]()},rotate:function(t){var e=this;this.thumb.rotate(t,function(t,i){if(i.uniqueId===e.page.pageKey){e.page.setRotate(t)}else{var n=function(i,n){var r=e._changeKlass(n);if(t==90||t==270){var s={x:i.pageInfo.width/2,y:i.pageInfo.height/2};var o=s.y-s.x;r._rotate(t,s);if(t==90){if(i.angle==90||i.angle==270)r._moveOffset({x:o,y:-o});else if(i.angle==0||i.angle==180){r._moveOffset({x:-o,y:-o})}}else if(t==270){if(i.angle==90||i.angle==270){r._moveOffset({x:o,y:-o})}else if(i.angle==0||i.angle==180){r._moveOffset({x:o,y:o})}}}else if(t==180){if(i.angle==90||i.angle==270){var s={y:i.pageInfo.width/2,x:i.pageInfo.height/2};r._rotate(t,s)}else if(i.angle==0||i.angle==180){var s={x:i.pageInfo.width/2,y:i.pageInfo.height/2};r._rotate(t,s)}}return e._changeObject(r)};i.annotation.getData().forEach(function(t,e){i.annotation.getData()[e]=n(i,t)});i.masking.getData().forEach(function(t,e){i.masking.getData()[e]=n(i,t)})}})},setAngle:function(t,e){var i=this.thumb.setAngle(t,e);if(i){if(this.thumb.getItem(t).uniqueId===this.page.pageKey){this.page.setAngle(e)}}return i},getAngle:function(t){return this.thumb.getAngle(t)},setFitMode:function(t){this.page.setFitMode(t)},getFitMode:function(){return this.page.getFitMode()},setTrackMode:function(t){this.page.setTrackMode(t)},pagePrev:function(){this.thumb.pageIndex=this.thumb.pageIndex-1},pageNext:function(){this.thumb.pageIndex=this.thumb.pageIndex+1},pageCount:function(){return this.thumb.pageCount()},showAnnotation:function(t){this.page.visible("annotation",t)},selectVisible:function(t){this.thumb.selectVisible=t;if(t){this.thumbSelectAllEl.removeClass("thumb_selectAll_hide");this.thumbSelectAllEl.addClass("thumb_selectAll");this.thumbEl.removeClass("iws-thumbnail_full");this.thumbEl.addClass("iws-thumbnail_move")}else{this.thumbSelectAllEl.removeClass("thumb_selectAll");this.thumbSelectAllEl.addClass("thumb_selectAll_hide");this.thumbEl.removeClass("iws-thumbnail_move");this.thumbEl.addClass("iws-thumbnail_full")}},showButton:function(t,e){this.fire("toolbar:buttonShow",t,e)},visible:function(t,e){this.page.visible(t,e)},crop:function(t,e){this.page.crop(t,e)},destroy:function(){console.log("iws.multiPage destroy.");this.thumb.destroy();this.page.destroy();$(this.fullScreenEl).remove();this.status="destroyed"},refresh:function(){this._reSize()},addAnnotation:function(t){this.page.addAnnotation(t)},removeAnnotation:function(){this.page.removeAnnotation()},addMasking:function(t,e,i,n,r){this.page.addMasking(t,e,i,n,r)},removeMasking:function(){this.page.removeMasking()},setPrintAutoFit:function(t){this.printAutoFit=t;this.thumb.setOption({printAutoFit:t})},showFilter:function(t){return this.page.showFilter(t)},setSelect:function(t,e){this.thumb.setSelect(t,e)},getSelect:function(t){return this.thumb.getSelect(t)},setPrintString:function(t,e){this.thumb.setPrintString(t,e)},setPrintMark:function(t){this.thumb.setOption({printMark:t})},setBookmark:function(t,e){this.thumb.setBookmark(t,e)},getBookmark:function(t){return this.thumb.getBookmark(t)},setKey:function(t,e){this.thumb.setKey(t,e)},getKey:function(t){return this.thumb.getKey(t)},setCaption:function(t,e){this.thumb.setCaption(t,e)},getCaption:function(t){return this.thumb.getCaption(t)},setText:function(t,e){this.thumb.setText(t,e)},getText:function(t){return this.thumb.getText(t)},setAuthority:function(t,e){this.page.authority[t]=e;e!=="editable"?this.visible(t,"hide"):this.visible(t,this.useAnnotation?"show":"hide");this.thumb.setOption({authority:this.page.authority});this.page.renderAll();this.thumb.each(function(t,e){this.thumb.drawAnnototation(e)}.bind(this))},getAuthority:function(){return this.page.authority}});try{if(!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return true}}).x){Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:false,configurable:true,value:function(t,e){Object.defineProperty(this,t,{get:e,enumerable:true,configurable:true})}});Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:false,configurable:true,value:function(t,e){Object.defineProperty(this,t,{set:e,enumerable:true,configurable:true})}})}}catch(t){}iws.multiPage.prototype.__defineGetter__("pageIndex",function(){return this.thumb.pageIndex});iws.multiPage.prototype.__defineSetter__("pageIndex",function(t){this.thumb.pageIndex=t})})();(function(){iws.toolbar.multiPage=function(t){this.viewer=t;this.initialize()};iws.toolbar.multiPage.prototype={toolbarMargin:8,trackModeMap:["move","range","glass"],trackModeMapping:{move:"trackMove",range:"trackRange",glass:"trackGlass"},initialize:function(){this._makeToolbar()},isVisible:function(){if(this.toolbarContainerEl.style.display!=="none")return true;else return false},height:function(){var t=this.toolbarContainerEl.clientHeight;return t},_makeToolbar:function(){this.toolbarContainerEl=iws.util.makeElement("div",{class:"pageToolbar_Container"});var t=this.viewer.pageContainerEl.parentElement;t.insertBefore(this.toolbarContainerEl,this.viewer.pageContainerEl);this.toolbarFrameEl=iws.util.makeElement("div",{class:"pageToolbar_Frame"});this.toolbarContainerEl.appendChild(this.toolbarFrameEl);this.__makeToolbarCommon(this.toolbarFrameEl);this.__makeToolbarPage(this.toolbarFrameEl);this.__makeToolbarMove(this.toolbarFrameEl);this.__makeToolbarSize(this.toolbarFrameEl);this.__makeToolbarZoom(this.toolbarFrameEl);var e=this;this.viewer.observe("resize",function(t){if(t.width<818){e.toolbarRight.style.display="none"}else{e.toolbarRight.style.display="inline-block"}if(t.width<750){e.toolbarCommon.style.display="none"}else{e.toolbarCommon.style.display="inline-block"}if(t.width<590){e.toolbarPage.style.display="none"}else{e.toolbarPage.style.display="inline-block"}e.toolbarPageCssOrigianl={toolbarPage:$(e.toolbarPage).css("display"),toolbarZoom:$(e.toolbarZoom).css("display")};e.viewer.fire("changeType",e.viewer.pageType)});this.viewer.observe("toolbar:buttonShow",function(t,i){console.log(t+" "+i);switch(t){case"thumbnail":{i?$(e.toolbarCommon).find("#thumbtoggle").css("display","inline-block"):$(e.toolbarCommon).find("#thumbtoggle").css("display","none");i?$(e.toolbarCommon).find("#separator1").css("display","inline-block"):$(e.toolbarCommon).find("#separator1").css("display","none")}break;case"openfile":{i?$(e.toolbarCommon).find("#openfile").css("display","inline-block"):$(e.toolbarCommon).find("#openfile").css("display","none")}break;case"print":{i?$(e.toolbarCommon).find("#print").css("display","inline-block"):$(e.toolbarCommon).find("#print").css("display","none")}break;case"save":{i?$(e.toolbarCommon).find("#save").css("display","inline-block"):$(e.toolbarCommon).find("#save").css("display","none")}break;case"select":{i?$(e.toolbarCommon).find("#checkVisible").css("display","inline-block"):$(e.toolbarCommon).find("#checkVisible").css("display","none")}break;case"delete":{i?$(e.toolbarCommon).find("#delete").css("display","inline-block"):$(e.toolbarCommon).find("#delete").css("display","none")}break;case"move":{i?$(e.toolbarPage).find("#trackMove").css("display","inline-block"):$(e.toolbarPage).find("#trackMove").css("display","none")}break;case"range":{i?$(e.toolbarPage).find("#trackRange").css("display","inline-block"):$(e.toolbarPage).find("#trackRange").css("display","none")}break;case"glass":{i?$(e.toolbarPage).find("#trackGlass").css("display","inline-block"):$(e.toolbarPage).find("#trackGlass").css("display","none")}break}});this.viewer.observe("changeType",function(t){if(t=="image"){$(e.toolbarPage).css("visibility",e.toolbarPageCssOrigianl.toolbarPage==="none"?"hidden":"visible");$(e.toolbarZoom).css("visibility",e.toolbarPageCssOrigianl.toolbarZoom==="none"?"hidden":"visible")}else if(t=="media"){$(e.toolbarPage).css("visibility","hidden");$(e.toolbarZoom).css("visibility","hidden")}})},__makeToolbarCommon:function(t){this.toolbarCommon=iws.util.makeElement("div",{class:"pageToolbar common"});t.appendChild(this.toolbarCommon);this.toolbarCommon.innerHTML='<button id="thumbtoggle" type="button" class="pageToolbarButton" title="Show thumbnail"><i class="pageToolbarButton_thumbtoggle"></i></button>'+'<div id="separator1" class="pageToolbarButtonSeparator"></div>'+'<button id="openfile" type="button" class="pageToolbarButton" title="Open file"><i class="pageToolbarButton_openfile"></i><input type="file" style="display:none;" id="openfile_input" name="files[]" multiple/></button>'+'<button id="print" type="button" class="pageToolbarButton" title="Print"><i class="pageToolbarButton_print"></i></button>'+'<button id="save" type="button" class="pageToolbarButton" title="Save"><i class="pageToolbarButton_save"></i></button>'+'<button id="checkVisible" type="button" class="pageToolbarButton" title="Show check"><i class="pageToolbarButton_checkVisible"></i></button>'+'<button id="delete" type="button" class="pageToolbarButton" title="Delete"><i class="pageToolbarButton_delete"></i></button>';this.toolbarCommon.querySelector("#thumbtoggle").addEventListener("click",function(){this.viewer.thumbShow=!this.viewer.thumbShow;this.viewer._reSize()}.bind(this),false);this.toolbarCommon.querySelector("#openfile").addEventListener("click",function(){this.toolbarCommon.querySelector("#openfile_input").value="";$(this.toolbarCommon.querySelector("#openfile_input")).click()}.bind(this),false);this.toolbarCommon.querySelector("#openfile_input").addEventListener("click",function(){$(this.toolbarCommon.querySelector("#openfile_input")).click()}.bind(this),false);this.toolbarCommon.querySelector("#openfile_input").addEventListener("change",function(t){var e=t.target.files;var i=this.viewer;var n="";var r=[];var s=new iws.util.sync({callback:function(){console.log("File loaded.");i&&i.appendContents(r,function(){console.log("Load complete!")})}});Array.prototype.forEach.call(e,function(t){n+=escape(t.name)+"("+t.type+") - "+(t.size/1024).toFixed(2).toString()+" kb, last modified: "+t.lastModifiedDate.toLocaleDateString()+"\n";var e={file:t,callback:function(e){var i=new FileReader;i.onload=function(){var i={type:"image",buffer:this.result,caption:t.name+" ("+t.type+") - "+(t.size/1024).toFixed(2).toString()+" kb"};r.push(i);e&&e()};i.readAsArrayBuffer(this.file)}};s.addWork(e)})}.bind(this),false);this.toolbarCommon.querySelector("#print").addEventListener("click",function(){this.viewer.print()}.bind(this),false);this.toolbarCommon.querySelector("#save").addEventListener("click",function(){if(this.viewer.saveType==="image"){this.viewer.saveImage()}else if(this.viewer.saveType==="annotation"){this.viewer.saveAnnotation()}}.bind(this),false);this.toolbarCommon.querySelector("#checkVisible").addEventListener("click",function(){this.viewer.selectVisible(!this.viewer.thumb.selectVisible)}.bind(this),false);this.toolbarCommon.querySelector("#delete").addEventListener("click",function(){this.viewer.thumb.remove()}.bind(this),false)},__makeToolbarPage:function(t){this.toolbarPage=iws.util.makeElement("div",{class:"pageToolbar page"});t.appendChild(this.toolbarPage);this.toolbarPage.innerHTML='<button id="scalePlus" type="button" class="pageToolbarButton" title="ZoomIn"><i class="pageToolbarButton_scalePlus"></i></button>'+'<button id="scaleMinus" type="button" class="pageToolbarButton" title="ZoomOut"><i class="pageToolbarButton_scaleMinus"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<button id="fitWidth" type="button" class="pageToolbarButton" title="Fix Width"><i class="pageToolbarButton_fitWidth"></i></button>'+'<button id="fitHeight" type="button" class="pageToolbarButton" title="Fix Height"><i class="pageToolbarButton_fitHeight"></i></button>'+'<button id="fitAuto" type="button" class="pageToolbarButton" title="Fix Auto"><i class="pageToolbarButton_fitAuto"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<button id="rotate270" type="button" class="pageToolbarButton" title="Rotate 270"><i class="pageToolbarButton_rotate270"></i></button>'+'<button id="rotate90" type="button" class="pageToolbarButton" title="Rotate 90"><i class="pageToolbarButton_rotate90"></i></button>'+'<button id="rotate180" type="button" class="pageToolbarButton" title="Rotate 180"><i class="pageToolbarButton_rotate180"></i></button>'+'<div class="pageToolbarButtonSeparator"></div>'+'<div class="trackModeGroup" style="display:inline-block;"> '+'<button id="trackMove" type="button" class="pageToolbarButton" title="Move Image" value="move"><i class="pageToolbarButton_trackMove"></i> </button>'+'<button id="trackRange" type="button" class="pageToolbarButton" title="Select area" value="range"><i class="pageToolbarButton_trackRange"></i> </button>'+'<button id="trackGlass" type="button" class="pageToolbarButton" title="Magnifying Glass" value="glass"><i class="pageToolbarButton_trackGlass"></i> </button>'+"</div>";this.toolbarPage.querySelector("#scalePlus").addEventListener("click",function(){this.viewer.zoomIn()}.bind(this),false);this.toolbarPage.querySelector("#scaleMinus").addEventListener("click",function(){this.viewer.zoomOut()}.bind(this),false);this.toolbarPage.querySelector("#fitWidth").addEventListener("click",function(){this.viewer.setFitMode({name:"width"})}.bind(this),false);this.toolbarPage.querySelector("#fitHeight").addEventListener("click",function(){this.viewer.setFitMode({name:"height"})}.bind(this),false);this.toolbarPage.querySelector("#fitAuto").addEventListener("click",function(){this.viewer.setFitMode({name:"auto"})}.bind(this),false);this.toolbarPage.querySelector("#rotate270").addEventListener("click",function(){this.viewer.rotate(270)}.bind(this),false);this.toolbarPage.querySelector("#rotate90").addEventListener("click",function(){this.viewer.rotate(90)}.bind(this),false);this.toolbarPage.querySelector("#rotate180").addEventListener("click",function(){this.viewer.rotate(180)}.bind(this),false);this.toolbarPage.querySelector("#trackMove").addEventListener("click",function(){this.viewer.setTrackMode("move")}.bind(this),false);this.toolbarPage.querySelector("#trackRange").addEventListener("click",function(){this.viewer.setTrackMode("range")}.bind(this),false);this.toolbarPage.querySelector("#trackGlass").addEventListener("click",function(){this.viewer.setTrackMode("glass")}.bind(this),false);this.buttonTrackModeGroup=this.toolbarPage.querySelector(".trackModeGroup");this.viewer.observe("mouseTrackChange",function(t){this.buttonTrackModeGroup.querySelectorAll(".pageToolbarButton").forEach(function(t){t.removeClass("toggled")});if(this.trackModeMap.indexOf(t)>=0){var e=this.buttonTrackModeGroup.querySelector("#"+this.trackModeMapping[t]);if(e)e.addClass("toggled")}}.bind(this))},__makeToolbarMove:function(t){this.toolbarMove=iws.util.makeElement("div",{class:"pageToolbar move"});t.appendChild(this.toolbarMove);this.toolbarMove.innerHTML='<button id="prev" type="button" class="pageToolbarButton" title="Go to previous page"><i class="pageToolbarButton_prev"></i></button>'+'<input type="text" id="pageNumber" class="pageToolbarField pageNumber" value="" size="4" />'+'<button id="next" type="button" class="pageToolbarButton" title="Go to next page"><i class="pageToolbarButton_next"></i></button>';this.toolbarMove.querySelector("button#prev").addEventListener("click",function(){this.viewer.pagePrev()}.bind(this),false);this.toolbarMove.querySelector("button#next").addEventListener("click",function(){this.viewer.pageNext()}.bind(this),false);this.viewer.observe("pageNumberChange",function(t){this.toolbarMove.querySelector("#pageNumber").value=t+1+"/"+this.viewer.pageCount()}.bind(this))},__makeToolbarSize:function(t){if(window.self!==window.top){console.log("you are in an iframe!");return}this.toolbarRight=iws.util.makeElement("div",{class:"pageToolbar size"});this.toolbarFrameEl.appendChild(this.toolbarRight);this.toolbarRight.innerHTML='<button id="fullDisplay" type="button" class="pageToolbarButton" title="Full screen"><i class="pageToolbarButton_FullScreen"></i></button>';this.toolbarRight.querySelector("#fullDisplay").addEventListener("click",function(){iws.util.fullscreen.toggleFullScreen(this.viewer.fullScreenEl)}.bind(this),false);iws.util.fullscreen.onFullScreenChange(function(t){if(t){$(this.toolbarRight).children("button#fullDisplay").children("i").removeClass("pageToolbarButton_FullScreen");$(this.toolbarRight).children("button#fullDisplay").children("i").addClass("pageToolbarButton_OriginalScreen")}else{$(this.toolbarRight).children("button#fullDisplay").children("i").removeClass("pageToolbarButton_OriginalScreen");$(this.toolbarRight).children("button#fullDisplay").children("i").addClass("pageToolbarButton_FullScreen")}}.bind(this))},__makeToolbarZoom:function(t){this.toolbarZoom=iws.util.makeElement("div",{class:"pageToolbar zoom"});t.appendChild(this.toolbarZoom);this.toolbarZoom.innerHTML='<span id="scaleSelectContainer" class="iws-dropdownToolbarButton">'+'<select id="scaleSelect" title="Zoom" tabindex="23" data-l10n-id="zoom">'+'<option id="pageAutoOption"    title="" value="auto" >Fit auto</option>'+'<option id="pageFitWidthOption" title="" value="width" >Fit Width</option>'+'<option id="pageFitHeightOption" title="" value="height" >Fit Height</option>'+'<option id="pageFitOriginalOption" title="" value="original" >Fit Original</option>'+'<option id="customScaleOption" title="" value="custom">0%</option>'+'<option title="" value="0.25"  >25%</option>'+'<option title="" value="0.5"   >50%</option>'+'<option title="" value="0.75"  >75%</option>'+'<option title="" value="1"     >100%</option>'+'<option title="" value="1.25"  >125%</option>'+'<option title="" value="1.5"   >150%</option>'+'<option title="" value="2"     >200%</option>'+'<option title="" value="3"     >300%</option>'+'<option title="" value="4"     >400%</option>'+"</select>"+"</span>";var e=this;this.toolbarZoom.querySelector("#scaleSelect").addEventListener("change",function(t){switch(this.value){case"auto":case"width":case"height":case"original":e.viewer.setFitMode({name:this.value});break;default:e.viewer._zoom({name:"custom",scale:this.value})}},false);function i(t){var e=this.toolbarZoom.querySelector("#scaleSelect").options;var i=false;for(var n=0,r=e.length;n<r;n++){var s=e[n];if(s.value!==t){s.selected=false;continue}s.selected=true;i=true}return i}function n(){var t=this.toolbarZoom.querySelector("#scaleSelect");var e=this.viewer.getFitMode();var n="";switch(e.name){case"width":case"height":case"auto":n=e.name;break;case"scale":n=e.scale;break}var r=i.call(this,n);if(!r){var s=document.getElementById("customScaleOption");s.textContent="scale";s.selected=true}}this.viewer.observe("page:zoom",n.bind(this));this.viewer.observe("page:fitMode",n.bind(this))}}})();